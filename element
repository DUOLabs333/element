#!/usr/bin/env python3





import types
import sys
import base64
pyparsing_module=types.ModuleType("pyparsing")
#setattr(pyparsing_module,"__file__",__file__)
exec(base64.b64decode(b'bW9kdWxlX2RpY3Q9e30KCm1vZHVsZV9kaWN0WyJweXBhcnNpbmcvcHkudHlwZWQiXT0iIiIKCgoKIiIiCgptb2R1bGVfZGljdFsicHlwYXJzaW5nL3VuaWNvZGUucHkiXT0iIiIKCiMgdW5pY29kZS5weQoKCgppbXBvcnQgc3lzCgpmcm9tIGl0ZXJ0b29scyBpbXBvcnQgZmlsdGVyZmFsc2UKCmZyb20gdHlwaW5nIGltcG9ydCBMaXN0LCBUdXBsZSwgVW5pb24KCgoKCgpjbGFzcyBfbGF6eWNsYXNzcHJvcGVydHk6CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGZuKToKCiAgICAgICAgc2VsZi5mbiA9IGZuCgogICAgICAgIHNlbGYuX19kb2NfXyA9IGZuLl9fZG9jX18KCiAgICAgICAgc2VsZi5fX25hbWVfXyA9IGZuLl9fbmFtZV9fCgoKCiAgICBkZWYgX19nZXRfXyhzZWxmLCBvYmosIGNscyk6CgogICAgICAgIGlmIGNscyBpcyBOb25lOgoKICAgICAgICAgICAgY2xzID0gdHlwZShvYmopCgogICAgICAgIGlmIG5vdCBoYXNhdHRyKGNscywgXCJfaW50ZXJuXCIpIG9yIGFueSgKCiAgICAgICAgICAgIGNscy5faW50ZXJuIGlzIGdldGF0dHIoc3VwZXJjbGFzcywgXCJfaW50ZXJuXCIsIFtdKQoKICAgICAgICAgICAgZm9yIHN1cGVyY2xhc3MgaW4gY2xzLl9fbXJvX19bMTpdCgogICAgICAgICk6CgogICAgICAgICAgICBjbHMuX2ludGVybiA9IHt9CgogICAgICAgIGF0dHJuYW1lID0gc2VsZi5mbi5fX25hbWVfXwoKICAgICAgICBpZiBhdHRybmFtZSBub3QgaW4gY2xzLl9pbnRlcm46CgogICAgICAgICAgICBjbHMuX2ludGVyblthdHRybmFtZV0gPSBzZWxmLmZuKGNscykKCiAgICAgICAgcmV0dXJuIGNscy5faW50ZXJuW2F0dHJuYW1lXQoKCgoKClVuaWNvZGVSYW5nZUxpc3QgPSBMaXN0W1VuaW9uW1R1cGxlW2ludCwgaW50XSwgVHVwbGVbaW50XV1dCgoKCgoKY2xhc3MgdW5pY29kZV9zZXQ6CgogICAgXCJcIlwiCgogICAgQSBzZXQgb2YgVW5pY29kZSBjaGFyYWN0ZXJzLCBmb3IgbGFuZ3VhZ2Utc3BlY2lmaWMgc3RyaW5ncyBmb3IKCiAgICBgYGFscGhhc2BgLCBgYG51bXNgYCwgYGBhbHBoYW51bXNgYCwgYW5kIGBgcHJpbnRhYmxlc2BgLgoKICAgIEEgdW5pY29kZV9zZXQgaXMgZGVmaW5lZCBieSBhIGxpc3Qgb2YgcmFuZ2VzIGluIHRoZSBVbmljb2RlIGNoYXJhY3RlcgoKICAgIHNldCwgaW4gYSBjbGFzcyBhdHRyaWJ1dGUgYGBfcmFuZ2VzYGAuIFJhbmdlcyBjYW4gYmUgc3BlY2lmaWVkIHVzaW5nCgogICAgMi10dXBsZXMgb3IgYSAxLXR1cGxlLCBzdWNoIGFzOjoKCgoKICAgICAgICBfcmFuZ2VzID0gWwoKICAgICAgICAgICAgKDB4MDAyMCwgMHgwMDdlKSwKCiAgICAgICAgICAgICgweDAwYTAsIDB4MDBmZiksCgogICAgICAgICAgICAoMHgwMTAwLCksCgogICAgICAgICAgICBdCgoKCiAgICBSYW5nZXMgYXJlIGxlZnQtIGFuZCByaWdodC1pbmNsdXNpdmUuIEEgMS10dXBsZSBvZiAoeCwpIGlzIHRyZWF0ZWQgYXMgKHgsIHgpLgoKCgogICAgQSB1bmljb2RlIHNldCBjYW4gYWxzbyBiZSBkZWZpbmVkIHVzaW5nIG11bHRpcGxlIGluaGVyaXRhbmNlIG9mIG90aGVyIHVuaWNvZGUgc2V0czo6CgoKCiAgICAgICAgY2xhc3MgQ0pLKENoaW5lc2UsIEphcGFuZXNlLCBLb3JlYW4pOgoKICAgICAgICAgICAgcGFzcwoKICAgIFwiXCJcIgoKCgogICAgX3JhbmdlczogVW5pY29kZVJhbmdlTGlzdCA9IFtdCgoKCiAgICBAX2xhenljbGFzc3Byb3BlcnR5CgogICAgZGVmIF9jaGFyc19mb3JfcmFuZ2VzKGNscyk6CgogICAgICAgIHJldCA9IFtdCgogICAgICAgIGZvciBjYyBpbiBjbHMuX19tcm9fXzoKCiAgICAgICAgICAgIGlmIGNjIGlzIHVuaWNvZGVfc2V0OgoKICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICBmb3IgcnIgaW4gZ2V0YXR0cihjYywgXCJfcmFuZ2VzXCIsICgpKToKCiAgICAgICAgICAgICAgICByZXQuZXh0ZW5kKHJhbmdlKHJyWzBdLCByclstMV0gKyAxKSkKCiAgICAgICAgcmV0dXJuIFtjaHIoYykgZm9yIGMgaW4gc29ydGVkKHNldChyZXQpKV0KCgoKICAgIEBfbGF6eWNsYXNzcHJvcGVydHkKCiAgICBkZWYgcHJpbnRhYmxlcyhjbHMpOgoKICAgICAgICBcImFsbCBub24td2hpdGVzcGFjZSBjaGFyYWN0ZXJzIGluIHRoaXMgcmFuZ2VcIgoKICAgICAgICByZXR1cm4gXCJcIi5qb2luKGZpbHRlcmZhbHNlKHN0ci5pc3NwYWNlLCBjbHMuX2NoYXJzX2Zvcl9yYW5nZXMpKQoKCgogICAgQF9sYXp5Y2xhc3Nwcm9wZXJ0eQoKICAgIGRlZiBhbHBoYXMoY2xzKToKCiAgICAgICAgXCJhbGwgYWxwaGFiZXRpYyBjaGFyYWN0ZXJzIGluIHRoaXMgcmFuZ2VcIgoKICAgICAgICByZXR1cm4gXCJcIi5qb2luKGZpbHRlcihzdHIuaXNhbHBoYSwgY2xzLl9jaGFyc19mb3JfcmFuZ2VzKSkKCgoKICAgIEBfbGF6eWNsYXNzcHJvcGVydHkKCiAgICBkZWYgbnVtcyhjbHMpOgoKICAgICAgICBcImFsbCBudW1lcmljIGRpZ2l0IGNoYXJhY3RlcnMgaW4gdGhpcyByYW5nZVwiCgogICAgICAgIHJldHVybiBcIlwiLmpvaW4oZmlsdGVyKHN0ci5pc2RpZ2l0LCBjbHMuX2NoYXJzX2Zvcl9yYW5nZXMpKQoKCgogICAgQF9sYXp5Y2xhc3Nwcm9wZXJ0eQoKICAgIGRlZiBhbHBoYW51bXMoY2xzKToKCiAgICAgICAgXCJhbGwgYWxwaGFudW1lcmljIGNoYXJhY3RlcnMgaW4gdGhpcyByYW5nZVwiCgogICAgICAgIHJldHVybiBjbHMuYWxwaGFzICsgY2xzLm51bXMKCgoKICAgIEBfbGF6eWNsYXNzcHJvcGVydHkKCiAgICBkZWYgaWRlbnRjaGFycyhjbHMpOgoKICAgICAgICBcImFsbCBjaGFyYWN0ZXJzIGluIHRoaXMgcmFuZ2UgdGhhdCBhcmUgdmFsaWQgaWRlbnRpZmllciBjaGFyYWN0ZXJzLCBwbHVzIHVuZGVyc2NvcmUgJ18nXCIKCiAgICAgICAgcmV0dXJuIFwiXCIuam9pbigKCiAgICAgICAgICAgIHNvcnRlZCgKCiAgICAgICAgICAgICAgICBzZXQoCgogICAgICAgICAgICAgICAgICAgIFwiXCIuam9pbihmaWx0ZXIoc3RyLmlzaWRlbnRpZmllciwgY2xzLl9jaGFyc19mb3JfcmFuZ2VzKSkKCiAgICAgICAgICAgICAgICAgICAgKyBcIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXrCqsK1wrpcIgoKICAgICAgICAgICAgICAgICAgICArIFwiw4DDgcOCw4PDhMOFw4bDh8OIw4nDisOLw4zDjcOOw4/DkMORw5LDk8OUw5XDlsOYw5nDmsObw5zDncOew5/DoMOhw6LDo8Okw6XDpsOnw6jDqcOqw6vDrMOtw67Dr8Oww7HDssOzw7TDtcO2w7jDucO6w7vDvMO9w77Dv1wiCgogICAgICAgICAgICAgICAgICAgICsgXCJfXCIKCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICApCgogICAgICAgICkKCgoKICAgIEBfbGF6eWNsYXNzcHJvcGVydHkKCiAgICBkZWYgaWRlbnRib2R5Y2hhcnMoY2xzKToKCiAgICAgICAgXCJcIlwiCgogICAgICAgIGFsbCBjaGFyYWN0ZXJzIGluIHRoaXMgcmFuZ2UgdGhhdCBhcmUgdmFsaWQgaWRlbnRpZmllciBib2R5IGNoYXJhY3RlcnMsCgogICAgICAgIHBsdXMgdGhlIGRpZ2l0cyAwLTkKCiAgICAgICAgXCJcIlwiCgogICAgICAgIHJldHVybiBcIlwiLmpvaW4oCgogICAgICAgICAgICBzb3J0ZWQoCgogICAgICAgICAgICAgICAgc2V0KAoKICAgICAgICAgICAgICAgICAgICBjbHMuaWRlbnRjaGFycwoKICAgICAgICAgICAgICAgICAgICArIFwiMDEyMzQ1Njc4OVwiCgogICAgICAgICAgICAgICAgICAgICsgXCJcIi5qb2luKAoKICAgICAgICAgICAgICAgICAgICAgICAgW2MgZm9yIGMgaW4gY2xzLl9jaGFyc19mb3JfcmFuZ2VzIGlmIChcIl9cIiArIGMpLmlzaWRlbnRpZmllcigpXQoKICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgKQoKICAgICAgICApCgoKCgoKY2xhc3MgcHlwYXJzaW5nX3VuaWNvZGUodW5pY29kZV9zZXQpOgoKICAgIFwiXCJcIgoKICAgIEEgbmFtZXNwYWNlIGNsYXNzIGZvciBkZWZpbmluZyBjb21tb24gbGFuZ3VhZ2UgdW5pY29kZV9zZXRzLgoKICAgIFwiXCJcIgoKCgogICAgIyBmbXQ6IG9mZgoKCgogICAgIyBkZWZpbmUgcmFuZ2VzIGluIGxhbmd1YWdlIGNoYXJhY3RlciBzZXRzCgogICAgX3JhbmdlczogVW5pY29kZVJhbmdlTGlzdCA9IFsKCiAgICAgICAgKDB4MDAyMCwgc3lzLm1heHVuaWNvZGUpLAoKICAgIF0KCgoKICAgIGNsYXNzIEJhc2ljTXVsdGlsaW5ndWFsUGxhbmUodW5pY29kZV9zZXQpOgoKICAgICAgICBcIlVuaWNvZGUgc2V0IGZvciB0aGUgQmFzaWMgTXVsdGlsaW5ndWFsIFBsYW5lXCIKCiAgICAgICAgX3JhbmdlczogVW5pY29kZVJhbmdlTGlzdCA9IFsKCiAgICAgICAgICAgICgweDAwMjAsIDB4RkZGRiksCgogICAgICAgIF0KCgoKICAgIGNsYXNzIExhdGluMSh1bmljb2RlX3NldCk6CgogICAgICAgIFwiVW5pY29kZSBzZXQgZm9yIExhdGluLTEgVW5pY29kZSBDaGFyYWN0ZXIgUmFuZ2VcIgoKICAgICAgICBfcmFuZ2VzOiBVbmljb2RlUmFuZ2VMaXN0ID0gWwoKICAgICAgICAgICAgKDB4MDAyMCwgMHgwMDdFKSwKCiAgICAgICAgICAgICgweDAwQTAsIDB4MDBGRiksCgogICAgICAgIF0KCgoKICAgIGNsYXNzIExhdGluQSh1bmljb2RlX3NldCk6CgogICAgICAgIFwiVW5pY29kZSBzZXQgZm9yIExhdGluLUEgVW5pY29kZSBDaGFyYWN0ZXIgUmFuZ2VcIgoKICAgICAgICBfcmFuZ2VzOiBVbmljb2RlUmFuZ2VMaXN0ID0gWwoKICAgICAgICAgICAgKDB4MDEwMCwgMHgwMTdGKSwKCiAgICAgICAgXQoKCgogICAgY2xhc3MgTGF0aW5CKHVuaWNvZGVfc2V0KToKCiAgICAgICAgXCJVbmljb2RlIHNldCBmb3IgTGF0aW4tQiBVbmljb2RlIENoYXJhY3RlciBSYW5nZVwiCgogICAgICAgIF9yYW5nZXM6IFVuaWNvZGVSYW5nZUxpc3QgPSBbCgogICAgICAgICAgICAoMHgwMTgwLCAweDAyNEYpLAoKICAgICAgICBdCgoKCiAgICBjbGFzcyBHcmVlayh1bmljb2RlX3NldCk6CgogICAgICAgIFwiVW5pY29kZSBzZXQgZm9yIEdyZWVrIFVuaWNvZGUgQ2hhcmFjdGVyIFJhbmdlc1wiCgogICAgICAgIF9yYW5nZXM6IFVuaWNvZGVSYW5nZUxpc3QgPSBbCgogICAgICAgICAgICAoMHgwMzQyLCAweDAzNDUpLAoKICAgICAgICAgICAgKDB4MDM3MCwgMHgwMzc3KSwKCiAgICAgICAgICAgICgweDAzN0EsIDB4MDM3RiksCgogICAgICAgICAgICAoMHgwMzg0LCAweDAzOEEpLAoKICAgICAgICAgICAgKDB4MDM4QywpLAoKICAgICAgICAgICAgKDB4MDM4RSwgMHgwM0ExKSwKCiAgICAgICAgICAgICgweDAzQTMsIDB4MDNFMSksCgogICAgICAgICAgICAoMHgwM0YwLCAweDAzRkYpLAoKICAgICAgICAgICAgKDB4MUQyNiwgMHgxRDJBKSwKCiAgICAgICAgICAgICgweDFENUUsKSwKCiAgICAgICAgICAgICgweDFENjAsKSwKCiAgICAgICAgICAgICgweDFENjYsIDB4MUQ2QSksCgogICAgICAgICAgICAoMHgxRjAwLCAweDFGMTUpLAoKICAgICAgICAgICAgKDB4MUYxOCwgMHgxRjFEKSwKCiAgICAgICAgICAgICgweDFGMjAsIDB4MUY0NSksCgogICAgICAgICAgICAoMHgxRjQ4LCAweDFGNEQpLAoKICAgICAgICAgICAgKDB4MUY1MCwgMHgxRjU3KSwKCiAgICAgICAgICAgICgweDFGNTksKSwKCiAgICAgICAgICAgICgweDFGNUIsKSwKCiAgICAgICAgICAgICgweDFGNUQsKSwKCiAgICAgICAgICAgICgweDFGNUYsIDB4MUY3RCksCgogICAgICAgICAgICAoMHgxRjgwLCAweDFGQjQpLAoKICAgICAgICAgICAgKDB4MUZCNiwgMHgxRkM0KSwKCiAgICAgICAgICAgICgweDFGQzYsIDB4MUZEMyksCgogICAgICAgICAgICAoMHgxRkQ2LCAweDFGREIpLAoKICAgICAgICAgICAgKDB4MUZERCwgMHgxRkVGKSwKCiAgICAgICAgICAgICgweDFGRjIsIDB4MUZGNCksCgogICAgICAgICAgICAoMHgxRkY2LCAweDFGRkUpLAoKICAgICAgICAgICAgKDB4MjEyOSwpLAoKICAgICAgICAgICAgKDB4MjcxOSwgMHgyNzFBKSwKCiAgICAgICAgICAgICgweEFCNjUsKSwKCiAgICAgICAgICAgICgweDEwMTQwLCAweDEwMThEKSwKCiAgICAgICAgICAgICgweDEwMUEwLCksCgogICAgICAgICAgICAoMHgxRDIwMCwgMHgxRDI0NSksCgogICAgICAgICAgICAoMHgxRjdBMSwgMHgxRjdBNyksCgogICAgICAgIF0KCgoKICAgIGNsYXNzIEN5cmlsbGljKHVuaWNvZGVfc2V0KToKCiAgICAgICAgXCJVbmljb2RlIHNldCBmb3IgQ3lyaWxsaWMgVW5pY29kZSBDaGFyYWN0ZXIgUmFuZ2VcIgoKICAgICAgICBfcmFuZ2VzOiBVbmljb2RlUmFuZ2VMaXN0ID0gWwoKICAgICAgICAgICAgKDB4MDQwMCwgMHgwNTJGKSwKCiAgICAgICAgICAgICgweDFDODAsIDB4MUM4OCksCgogICAgICAgICAgICAoMHgxRDJCLCksCgogICAgICAgICAgICAoMHgxRDc4LCksCgogICAgICAgICAgICAoMHgyREUwLCAweDJERkYpLAoKICAgICAgICAgICAgKDB4QTY0MCwgMHhBNjcyKSwKCiAgICAgICAgICAgICgweEE2NzQsIDB4QTY5RiksCgogICAgICAgICAgICAoMHhGRTJFLCAweEZFMkYpLAoKICAgICAgICBdCgoKCiAgICBjbGFzcyBDaGluZXNlKHVuaWNvZGVfc2V0KToKCiAgICAgICAgXCJVbmljb2RlIHNldCBmb3IgQ2hpbmVzZSBVbmljb2RlIENoYXJhY3RlciBSYW5nZVwiCgogICAgICAgIF9yYW5nZXM6IFVuaWNvZGVSYW5nZUxpc3QgPSBbCgogICAgICAgICAgICAoMHgyRTgwLCAweDJFOTkpLAoKICAgICAgICAgICAgKDB4MkU5QiwgMHgyRUYzKSwKCiAgICAgICAgICAgICgweDMxQzAsIDB4MzFFMyksCgogICAgICAgICAgICAoMHgzNDAwLCAweDREQjUpLAoKICAgICAgICAgICAgKDB4NEUwMCwgMHg5RkVGKSwKCiAgICAgICAgICAgICgweEE3MDAsIDB4QTcwNyksCgogICAgICAgICAgICAoMHhGOTAwLCAweEZBNkQpLAoKICAgICAgICAgICAgKDB4RkE3MCwgMHhGQUQ5KSwKCiAgICAgICAgICAgICgweDE2RkUyLCAweDE2RkUzKSwKCiAgICAgICAgICAgICgweDFGMjEwLCAweDFGMjEyKSwKCiAgICAgICAgICAgICgweDFGMjE0LCAweDFGMjNCKSwKCiAgICAgICAgICAgICgweDFGMjQwLCAweDFGMjQ4KSwKCiAgICAgICAgICAgICgweDIwMDAwLCAweDJBNkQ2KSwKCiAgICAgICAgICAgICgweDJBNzAwLCAweDJCNzM0KSwKCiAgICAgICAgICAgICgweDJCNzQwLCAweDJCODFEKSwKCiAgICAgICAgICAgICgweDJCODIwLCAweDJDRUExKSwKCiAgICAgICAgICAgICgweDJDRUIwLCAweDJFQkUwKSwKCiAgICAgICAgICAgICgweDJGODAwLCAweDJGQTFEKSwKCiAgICAgICAgXQoKCgogICAgY2xhc3MgSmFwYW5lc2UodW5pY29kZV9zZXQpOgoKICAgICAgICBcIlVuaWNvZGUgc2V0IGZvciBKYXBhbmVzZSBVbmljb2RlIENoYXJhY3RlciBSYW5nZSwgY29tYmluaW5nIEthbmppLCBIaXJhZ2FuYSwgYW5kIEthdGFrYW5hIHJhbmdlc1wiCgogICAgICAgIF9yYW5nZXM6IFVuaWNvZGVSYW5nZUxpc3QgPSBbXQoKCgogICAgICAgIGNsYXNzIEthbmppKHVuaWNvZGVfc2V0KToKCiAgICAgICAgICAgIFwiVW5pY29kZSBzZXQgZm9yIEthbmppIFVuaWNvZGUgQ2hhcmFjdGVyIFJhbmdlXCIKCiAgICAgICAgICAgIF9yYW5nZXM6IFVuaWNvZGVSYW5nZUxpc3QgPSBbCgogICAgICAgICAgICAgICAgKDB4NEUwMCwgMHg5RkJGKSwKCiAgICAgICAgICAgICAgICAoMHgzMDAwLCAweDMwM0YpLAoKICAgICAgICAgICAgXQoKCgogICAgICAgIGNsYXNzIEhpcmFnYW5hKHVuaWNvZGVfc2V0KToKCiAgICAgICAgICAgIFwiVW5pY29kZSBzZXQgZm9yIEhpcmFnYW5hIFVuaWNvZGUgQ2hhcmFjdGVyIFJhbmdlXCIKCiAgICAgICAgICAgIF9yYW5nZXM6IFVuaWNvZGVSYW5nZUxpc3QgPSBbCgogICAgICAgICAgICAgICAgKDB4MzA0MSwgMHgzMDk2KSwKCiAgICAgICAgICAgICAgICAoMHgzMDk5LCAweDMwQTApLAoKICAgICAgICAgICAgICAgICgweDMwRkMsKSwKCiAgICAgICAgICAgICAgICAoMHhGRjcwLCksCgogICAgICAgICAgICAgICAgKDB4MUIwMDEsKSwKCiAgICAgICAgICAgICAgICAoMHgxQjE1MCwgMHgxQjE1MiksCgogICAgICAgICAgICAgICAgKDB4MUYyMDAsKSwKCiAgICAgICAgICAgIF0KCgoKICAgICAgICBjbGFzcyBLYXRha2FuYSh1bmljb2RlX3NldCk6CgogICAgICAgICAgICBcIlVuaWNvZGUgc2V0IGZvciBLYXRha2FuYSAgVW5pY29kZSBDaGFyYWN0ZXIgUmFuZ2VcIgoKICAgICAgICAgICAgX3JhbmdlczogVW5pY29kZVJhbmdlTGlzdCA9IFsKCiAgICAgICAgICAgICAgICAoMHgzMDk5LCAweDMwOUMpLAoKICAgICAgICAgICAgICAgICgweDMwQTAsIDB4MzBGRiksCgogICAgICAgICAgICAgICAgKDB4MzFGMCwgMHgzMUZGKSwKCiAgICAgICAgICAgICAgICAoMHgzMkQwLCAweDMyRkUpLAoKICAgICAgICAgICAgICAgICgweEZGNjUsIDB4RkY5RiksCgogICAgICAgICAgICAgICAgKDB4MUIwMDAsKSwKCiAgICAgICAgICAgICAgICAoMHgxQjE2NCwgMHgxQjE2NyksCgogICAgICAgICAgICAgICAgKDB4MUYyMDEsIDB4MUYyMDIpLAoKICAgICAgICAgICAgICAgICgweDFGMjEzLCksCgogICAgICAgICAgICBdCgoKCiAgICBjbGFzcyBIYW5ndWwodW5pY29kZV9zZXQpOgoKICAgICAgICBcIlVuaWNvZGUgc2V0IGZvciBIYW5ndWwgKEtvcmVhbikgVW5pY29kZSBDaGFyYWN0ZXIgUmFuZ2VcIgoKICAgICAgICBfcmFuZ2VzOiBVbmljb2RlUmFuZ2VMaXN0ID0gWwoKICAgICAgICAgICAgKDB4MTEwMCwgMHgxMUZGKSwKCiAgICAgICAgICAgICgweDMwMkUsIDB4MzAyRiksCgogICAgICAgICAgICAoMHgzMTMxLCAweDMxOEUpLAoKICAgICAgICAgICAgKDB4MzIwMCwgMHgzMjFDKSwKCiAgICAgICAgICAgICgweDMyNjAsIDB4MzI3QiksCgogICAgICAgICAgICAoMHgzMjdFLCksCgogICAgICAgICAgICAoMHhBOTYwLCAweEE5N0MpLAoKICAgICAgICAgICAgKDB4QUMwMCwgMHhEN0EzKSwKCiAgICAgICAgICAgICgweEQ3QjAsIDB4RDdDNiksCgogICAgICAgICAgICAoMHhEN0NCLCAweEQ3RkIpLAoKICAgICAgICAgICAgKDB4RkZBMCwgMHhGRkJFKSwKCiAgICAgICAgICAgICgweEZGQzIsIDB4RkZDNyksCgogICAgICAgICAgICAoMHhGRkNBLCAweEZGQ0YpLAoKICAgICAgICAgICAgKDB4RkZEMiwgMHhGRkQ3KSwKCiAgICAgICAgICAgICgweEZGREEsIDB4RkZEQyksCgogICAgICAgIF0KCgoKICAgIEtvcmVhbiA9IEhhbmd1bAoKCgogICAgY2xhc3MgQ0pLKENoaW5lc2UsIEphcGFuZXNlLCBIYW5ndWwpOgoKICAgICAgICBcIlVuaWNvZGUgc2V0IGZvciBjb21iaW5lZCBDaGluZXNlLCBKYXBhbmVzZSwgYW5kIEtvcmVhbiAoQ0pLKSBVbmljb2RlIENoYXJhY3RlciBSYW5nZVwiCgoKCiAgICBjbGFzcyBUaGFpKHVuaWNvZGVfc2V0KToKCiAgICAgICAgXCJVbmljb2RlIHNldCBmb3IgVGhhaSBVbmljb2RlIENoYXJhY3RlciBSYW5nZVwiCgogICAgICAgIF9yYW5nZXM6IFVuaWNvZGVSYW5nZUxpc3QgPSBbCgogICAgICAgICAgICAoMHgwRTAxLCAweDBFM0EpLAoKICAgICAgICAgICAgKDB4MEUzRiwgMHgwRTVCKQoKICAgICAgICBdCgoKCiAgICBjbGFzcyBBcmFiaWModW5pY29kZV9zZXQpOgoKICAgICAgICBcIlVuaWNvZGUgc2V0IGZvciBBcmFiaWMgVW5pY29kZSBDaGFyYWN0ZXIgUmFuZ2VcIgoKICAgICAgICBfcmFuZ2VzOiBVbmljb2RlUmFuZ2VMaXN0ID0gWwoKICAgICAgICAgICAgKDB4MDYwMCwgMHgwNjFCKSwKCiAgICAgICAgICAgICgweDA2MUUsIDB4MDZGRiksCgogICAgICAgICAgICAoMHgwNzAwLCAweDA3N0YpLAoKICAgICAgICBdCgoKCiAgICBjbGFzcyBIZWJyZXcodW5pY29kZV9zZXQpOgoKICAgICAgICBcIlVuaWNvZGUgc2V0IGZvciBIZWJyZXcgVW5pY29kZSBDaGFyYWN0ZXIgUmFuZ2VcIgoKICAgICAgICBfcmFuZ2VzOiBVbmljb2RlUmFuZ2VMaXN0ID0gWwoKICAgICAgICAgICAgKDB4MDU5MSwgMHgwNUM3KSwKCiAgICAgICAgICAgICgweDA1RDAsIDB4MDVFQSksCgogICAgICAgICAgICAoMHgwNUVGLCAweDA1RjQpLAoKICAgICAgICAgICAgKDB4RkIxRCwgMHhGQjM2KSwKCiAgICAgICAgICAgICgweEZCMzgsIDB4RkIzQyksCgogICAgICAgICAgICAoMHhGQjNFLCksCgogICAgICAgICAgICAoMHhGQjQwLCAweEZCNDEpLAoKICAgICAgICAgICAgKDB4RkI0MywgMHhGQjQ0KSwKCiAgICAgICAgICAgICgweEZCNDYsIDB4RkI0RiksCgogICAgICAgIF0KCgoKICAgIGNsYXNzIERldmFuYWdhcmkodW5pY29kZV9zZXQpOgoKICAgICAgICBcIlVuaWNvZGUgc2V0IGZvciBEZXZhbmFnYXJpIFVuaWNvZGUgQ2hhcmFjdGVyIFJhbmdlXCIKCiAgICAgICAgX3JhbmdlczogVW5pY29kZVJhbmdlTGlzdCA9IFsKCiAgICAgICAgICAgICgweDA5MDAsIDB4MDk3RiksCgogICAgICAgICAgICAoMHhBOEUwLCAweEE4RkYpCgogICAgICAgIF0KCgoKICAgICMgZm10OiBvbgoKCgoKCnB5cGFyc2luZ191bmljb2RlLkphcGFuZXNlLl9yYW5nZXMgPSAoCgogICAgcHlwYXJzaW5nX3VuaWNvZGUuSmFwYW5lc2UuS2FuamkuX3JhbmdlcwoKICAgICsgcHlwYXJzaW5nX3VuaWNvZGUuSmFwYW5lc2UuSGlyYWdhbmEuX3JhbmdlcwoKICAgICsgcHlwYXJzaW5nX3VuaWNvZGUuSmFwYW5lc2UuS2F0YWthbmEuX3JhbmdlcwoKKQoKCgpweXBhcnNpbmdfdW5pY29kZS5CTVAgPSBweXBhcnNpbmdfdW5pY29kZS5CYXNpY011bHRpbGluZ3VhbFBsYW5lCgoKCiMgYWRkIGxhbmd1YWdlIGlkZW50aWZpZXJzIHVzaW5nIGxhbmd1YWdlIFVuaWNvZGUKCnB5cGFyc2luZ191bmljb2RlLtin2YTYudix2KjZitipID0gcHlwYXJzaW5nX3VuaWNvZGUuQXJhYmljCgpweXBhcnNpbmdfdW5pY29kZS7kuK3mlocgPSBweXBhcnNpbmdfdW5pY29kZS5DaGluZXNlCgpweXBhcnNpbmdfdW5pY29kZS7QutC40YDQuNC70LvQuNGG0LAgPSBweXBhcnNpbmdfdW5pY29kZS5DeXJpbGxpYwoKcHlwYXJzaW5nX3VuaWNvZGUuzpXOu867zrfOvc65zrrOrCA9IHB5cGFyc2luZ191bmljb2RlLkdyZWVrCgpweXBhcnNpbmdfdW5pY29kZS7Xota015HXqNa015nXqiA9IHB5cGFyc2luZ191bmljb2RlLkhlYnJldwoKcHlwYXJzaW5nX3VuaWNvZGUu5pel5pys6KqeID0gcHlwYXJzaW5nX3VuaWNvZGUuSmFwYW5lc2UKCnB5cGFyc2luZ191bmljb2RlLkphcGFuZXNlLua8ouWtlyA9IHB5cGFyc2luZ191bmljb2RlLkphcGFuZXNlLkthbmppCgpweXBhcnNpbmdfdW5pY29kZS5KYXBhbmVzZS7jgqvjgr/jgqvjg4ogPSBweXBhcnNpbmdfdW5pY29kZS5KYXBhbmVzZS5LYXRha2FuYQoKcHlwYXJzaW5nX3VuaWNvZGUuSmFwYW5lc2Uu44Gy44KJ44GM44GqID0gcHlwYXJzaW5nX3VuaWNvZGUuSmFwYW5lc2UuSGlyYWdhbmEKCnB5cGFyc2luZ191bmljb2RlLu2VnOq1reyWtCA9IHB5cGFyc2luZ191bmljb2RlLktvcmVhbgoKcHlwYXJzaW5nX3VuaWNvZGUu4LmE4LiX4LiiID0gcHlwYXJzaW5nX3VuaWNvZGUuVGhhaQoKcHlwYXJzaW5nX3VuaWNvZGUu4KSm4KWH4KS14KSo4KS+4KSX4KSw4KWAID0gcHlwYXJzaW5nX3VuaWNvZGUuRGV2YW5hZ2FyaQoKCgoiIiIKCm1vZHVsZV9kaWN0WyJweXBhcnNpbmcvY29yZS5weSJdPSIiIgoKIwoKIyBjb3JlLnB5CgojCgppbXBvcnQgb3MKCmltcG9ydCB0eXBpbmcKCmZyb20gdHlwaW5nIGltcG9ydCAoCgogICAgTmFtZWRUdXBsZSwKCiAgICBVbmlvbiwKCiAgICBDYWxsYWJsZSwKCiAgICBBbnksCgogICAgR2VuZXJhdG9yLAoKICAgIFR1cGxlLAoKICAgIExpc3QsCgogICAgVGV4dElPLAoKICAgIFNldCwKCiAgICBTZXF1ZW5jZSwKCikKCmZyb20gYWJjIGltcG9ydCBBQkMsIGFic3RyYWN0bWV0aG9kCgpmcm9tIGVudW0gaW1wb3J0IEVudW0KCmltcG9ydCBzdHJpbmcKCmltcG9ydCBjb3B5CgppbXBvcnQgd2FybmluZ3MKCmltcG9ydCByZQoKaW1wb3J0IHN5cwoKZnJvbSBjb2xsZWN0aW9ucy5hYmMgaW1wb3J0IEl0ZXJhYmxlCgppbXBvcnQgdHJhY2ViYWNrCgppbXBvcnQgdHlwZXMKCmZyb20gb3BlcmF0b3IgaW1wb3J0IGl0ZW1nZXR0ZXIKCmZyb20gZnVuY3Rvb2xzIGltcG9ydCB3cmFwcwoKZnJvbSB0aHJlYWRpbmcgaW1wb3J0IFJMb2NrCgpmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKCgoKZnJvbSAudXRpbCBpbXBvcnQgKAoKICAgIF9GaWZvQ2FjaGUsCgogICAgX1VuYm91bmRlZENhY2hlLAoKICAgIF9fY29uZmlnX2ZsYWdzLAoKICAgIF9jb2xsYXBzZV9zdHJpbmdfdG9fcmFuZ2VzLAoKICAgIF9lc2NhcGVfcmVnZXhfcmFuZ2VfY2hhcnMsCgogICAgX2JzbGFzaCwKCiAgICBfZmxhdHRlbiwKCiAgICBMUlVNZW1vIGFzIF9MUlVNZW1vLAoKICAgIFVuYm91bmRlZE1lbW8gYXMgX1VuYm91bmRlZE1lbW8sCgopCgpmcm9tIC5leGNlcHRpb25zIGltcG9ydCAqCgpmcm9tIC5hY3Rpb25zIGltcG9ydCAqCgpmcm9tIC5yZXN1bHRzIGltcG9ydCBQYXJzZVJlc3VsdHMsIF9QYXJzZVJlc3VsdHNXaXRoT2Zmc2V0Cgpmcm9tIC51bmljb2RlIGltcG9ydCBweXBhcnNpbmdfdW5pY29kZQoKCgpfTUFYX0lOVCA9IHN5cy5tYXhzaXplCgpzdHJfdHlwZTogVHVwbGVbdHlwZSwgLi4uXSA9IChzdHIsIGJ5dGVzKQoKCgojCgojIENvcHlyaWdodCAoYykgMjAwMy0yMDIyICBQYXVsIFQuIE1jR3VpcmUKCiMKCiMgUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nCgojIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZQoKIyBcIlNvZnR3YXJlXCIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcKCiMgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLAoKIyBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8KCiMgcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvCgojIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKCiMKCiMgVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKCiMgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCgojCgojIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsCgojIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRgoKIyBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuCgojIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZCgojIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsCgojIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFCgojIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgoKIwoKCgoKCmlmIHN5cy52ZXJzaW9uX2luZm8gPj0gKDMsIDgpOgoKICAgIGZyb20gZnVuY3Rvb2xzIGltcG9ydCBjYWNoZWRfcHJvcGVydHkKCmVsc2U6CgoKCiAgICBjbGFzcyBjYWNoZWRfcHJvcGVydHk6CgogICAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCBmdW5jKToKCiAgICAgICAgICAgIHNlbGYuX2Z1bmMgPSBmdW5jCgoKCiAgICAgICAgZGVmIF9fZ2V0X18oc2VsZiwgaW5zdGFuY2UsIG93bmVyPU5vbmUpOgoKICAgICAgICAgICAgcmV0ID0gaW5zdGFuY2UuX19kaWN0X19bc2VsZi5fZnVuYy5fX25hbWVfX10gPSBzZWxmLl9mdW5jKGluc3RhbmNlKQoKICAgICAgICAgICAgcmV0dXJuIHJldAoKCgoKCmNsYXNzIF9fY29tcGF0X18oX19jb25maWdfZmxhZ3MpOgoKICAgIFwiXCJcIgoKICAgIEEgY3Jvc3MtdmVyc2lvbiBjb21wYXRpYmlsaXR5IGNvbmZpZ3VyYXRpb24gZm9yIHB5cGFyc2luZyBmZWF0dXJlcyB0aGF0IHdpbGwgYmUKCiAgICByZWxlYXNlZCBpbiBhIGZ1dHVyZSB2ZXJzaW9uLiBCeSBzZXR0aW5nIHZhbHVlcyBpbiB0aGlzIGNvbmZpZ3VyYXRpb24gdG8gVHJ1ZSwKCiAgICB0aG9zZSBmZWF0dXJlcyBjYW4gYmUgZW5hYmxlZCBpbiBwcmlvciB2ZXJzaW9ucyBmb3IgY29tcGF0aWJpbGl0eSBkZXZlbG9wbWVudAoKICAgIGFuZCB0ZXN0aW5nLgoKCgogICAgLSBgYGNvbGxlY3RfYWxsX0FuZF90b2tlbnNgYCAtIGZsYWcgdG8gZW5hYmxlIGZpeCBmb3IgSXNzdWUgIzYzIHRoYXQgZml4ZXMgZXJyb25lb3VzIGdyb3VwaW5nCgogICAgICBvZiByZXN1bHRzIG5hbWVzIHdoZW4gYW4gOmNsYXNzOmBBbmRgIGV4cHJlc3Npb24gaXMgbmVzdGVkIHdpdGhpbiBhbiA6Y2xhc3M6YE9yYCBvciA6Y2xhc3M6YE1hdGNoRmlyc3RgOwoKICAgICAgbWFpbnRhaW5lZCBmb3IgY29tcGF0aWJpbGl0eSwgYnV0IHNldHRpbmcgdG8gYGBGYWxzZWBgIG5vIGxvbmdlciByZXN0b3JlcyBwcmUtMi4zLjEKCiAgICAgIGJlaGF2aW9yCgogICAgXCJcIlwiCgoKCiAgICBfdHlwZV9kZXNjID0gXCJjb21wYXRpYmlsaXR5XCIKCgoKICAgIGNvbGxlY3RfYWxsX0FuZF90b2tlbnMgPSBUcnVlCgoKCiAgICBfYWxsX25hbWVzID0gW19fIGZvciBfXyBpbiBsb2NhbHMoKSBpZiBub3QgX18uc3RhcnRzd2l0aChcIl9cIildCgogICAgX2ZpeGVkX25hbWVzID0gXCJcIlwiCgogICAgICAgIGNvbGxlY3RfYWxsX0FuZF90b2tlbnMKCiAgICAgICAgXCJcIlwiLnNwbGl0KCkKCgoKCgpjbGFzcyBfX2RpYWdfXyhfX2NvbmZpZ19mbGFncyk6CgogICAgX3R5cGVfZGVzYyA9IFwiZGlhZ25vc3RpY1wiCgoKCiAgICB3YXJuX211bHRpcGxlX3Rva2Vuc19pbl9uYW1lZF9hbHRlcm5hdGlvbiA9IEZhbHNlCgogICAgd2Fybl91bmdyb3VwZWRfbmFtZWRfdG9rZW5zX2luX2NvbGxlY3Rpb24gPSBGYWxzZQoKICAgIHdhcm5fbmFtZV9zZXRfb25fZW1wdHlfRm9yd2FyZCA9IEZhbHNlCgogICAgd2Fybl9vbl9wYXJzZV91c2luZ19lbXB0eV9Gb3J3YXJkID0gRmFsc2UKCiAgICB3YXJuX29uX2Fzc2lnbm1lbnRfdG9fRm9yd2FyZCA9IEZhbHNlCgogICAgd2Fybl9vbl9tdWx0aXBsZV9zdHJpbmdfYXJnc190b19vbmVvZiA9IEZhbHNlCgogICAgd2Fybl9vbl9tYXRjaF9maXJzdF93aXRoX2xzaGlmdF9vcGVyYXRvciA9IEZhbHNlCgogICAgZW5hYmxlX2RlYnVnX29uX25hbWVkX2V4cHJlc3Npb25zID0gRmFsc2UKCgoKICAgIF9hbGxfbmFtZXMgPSBbX18gZm9yIF9fIGluIGxvY2FscygpIGlmIG5vdCBfXy5zdGFydHN3aXRoKFwiX1wiKV0KCiAgICBfd2FybmluZ19uYW1lcyA9IFtuYW1lIGZvciBuYW1lIGluIF9hbGxfbmFtZXMgaWYgbmFtZS5zdGFydHN3aXRoKFwid2FyblwiKV0KCiAgICBfZGVidWdfbmFtZXMgPSBbbmFtZSBmb3IgbmFtZSBpbiBfYWxsX25hbWVzIGlmIG5hbWUuc3RhcnRzd2l0aChcImVuYWJsZV9kZWJ1Z1wiKV0KCgoKICAgIEBjbGFzc21ldGhvZAoKICAgIGRlZiBlbmFibGVfYWxsX3dhcm5pbmdzKGNscykgLT4gTm9uZToKCiAgICAgICAgZm9yIG5hbWUgaW4gY2xzLl93YXJuaW5nX25hbWVzOgoKICAgICAgICAgICAgY2xzLmVuYWJsZShuYW1lKQoKCgoKCmNsYXNzIERpYWdub3N0aWNzKEVudW0pOgoKICAgIFwiXCJcIgoKICAgIERpYWdub3N0aWMgY29uZmlndXJhdGlvbiAoYWxsIGRlZmF1bHQgdG8gZGlzYWJsZWQpCgogICAgLSBgYHdhcm5fbXVsdGlwbGVfdG9rZW5zX2luX25hbWVkX2FsdGVybmF0aW9uYGAgLSBmbGFnIHRvIGVuYWJsZSB3YXJuaW5ncyB3aGVuIGEgcmVzdWx0cwoKICAgICAgbmFtZSBpcyBkZWZpbmVkIG9uIGEgOmNsYXNzOmBNYXRjaEZpcnN0YCBvciA6Y2xhc3M6YE9yYCBleHByZXNzaW9uIHdpdGggb25lIG9yIG1vcmUgOmNsYXNzOmBBbmRgIHN1YmV4cHJlc3Npb25zCgogICAgLSBgYHdhcm5fdW5ncm91cGVkX25hbWVkX3Rva2Vuc19pbl9jb2xsZWN0aW9uYGAgLSBmbGFnIHRvIGVuYWJsZSB3YXJuaW5ncyB3aGVuIGEgcmVzdWx0cwoKICAgICAgbmFtZSBpcyBkZWZpbmVkIG9uIGEgY29udGFpbmluZyBleHByZXNzaW9uIHdpdGggdW5ncm91cGVkIHN1YmV4cHJlc3Npb25zIHRoYXQgYWxzbwoKICAgICAgaGF2ZSByZXN1bHRzIG5hbWVzCgogICAgLSBgYHdhcm5fbmFtZV9zZXRfb25fZW1wdHlfRm9yd2FyZGBgIC0gZmxhZyB0byBlbmFibGUgd2FybmluZ3Mgd2hlbiBhIDpjbGFzczpgRm9yd2FyZGAgaXMgZGVmaW5lZAoKICAgICAgd2l0aCBhIHJlc3VsdHMgbmFtZSwgYnV0IGhhcyBubyBjb250ZW50cyBkZWZpbmVkCgogICAgLSBgYHdhcm5fb25fcGFyc2VfdXNpbmdfZW1wdHlfRm9yd2FyZGBgIC0gZmxhZyB0byBlbmFibGUgd2FybmluZ3Mgd2hlbiBhIDpjbGFzczpgRm9yd2FyZGAgaXMKCiAgICAgIGRlZmluZWQgaW4gYSBncmFtbWFyIGJ1dCBoYXMgbmV2ZXIgaGFkIGFuIGV4cHJlc3Npb24gYXR0YWNoZWQgdG8gaXQKCiAgICAtIGBgd2Fybl9vbl9hc3NpZ25tZW50X3RvX0ZvcndhcmRgYCAtIGZsYWcgdG8gZW5hYmxlIHdhcm5pbmdzIHdoZW4gYSA6Y2xhc3M6YEZvcndhcmRgIGlzIGRlZmluZWQKCiAgICAgIGJ1dCBpcyBvdmVyd3JpdHRlbiBieSBhc3NpZ25pbmcgdXNpbmcgYGAnPSdgYCBpbnN0ZWFkIG9mIGBgJzw8PSdgYCBvciBgYCc8PCdgYAoKICAgIC0gYGB3YXJuX29uX211bHRpcGxlX3N0cmluZ19hcmdzX3RvX29uZW9mYGAgLSBmbGFnIHRvIGVuYWJsZSB3YXJuaW5ncyB3aGVuIDpjbGFzczpgb25lX29mYCBpcwoKICAgICAgaW5jb3JyZWN0bHkgY2FsbGVkIHdpdGggbXVsdGlwbGUgc3RyIGFyZ3VtZW50cwoKICAgIC0gYGBlbmFibGVfZGVidWdfb25fbmFtZWRfZXhwcmVzc2lvbnNgYCAtIGZsYWcgdG8gYXV0by1lbmFibGUgZGVidWcgb24gYWxsIHN1YnNlcXVlbnQKCiAgICAgIGNhbGxzIHRvIDpjbGFzczpgUGFyc2VyRWxlbWVudC5zZXRfbmFtZWAKCgoKICAgIERpYWdub3N0aWNzIGFyZSBlbmFibGVkL2Rpc2FibGVkIGJ5IGNhbGxpbmcgOmNsYXNzOmBlbmFibGVfZGlhZ2AgYW5kIDpjbGFzczpgZGlzYWJsZV9kaWFnYC4KCiAgICBBbGwgd2FybmluZ3MgY2FuIGJlIGVuYWJsZWQgYnkgY2FsbGluZyA6Y2xhc3M6YGVuYWJsZV9hbGxfd2FybmluZ3NgLgoKICAgIFwiXCJcIgoKCgogICAgd2Fybl9tdWx0aXBsZV90b2tlbnNfaW5fbmFtZWRfYWx0ZXJuYXRpb24gPSAwCgogICAgd2Fybl91bmdyb3VwZWRfbmFtZWRfdG9rZW5zX2luX2NvbGxlY3Rpb24gPSAxCgogICAgd2Fybl9uYW1lX3NldF9vbl9lbXB0eV9Gb3J3YXJkID0gMgoKICAgIHdhcm5fb25fcGFyc2VfdXNpbmdfZW1wdHlfRm9yd2FyZCA9IDMKCiAgICB3YXJuX29uX2Fzc2lnbm1lbnRfdG9fRm9yd2FyZCA9IDQKCiAgICB3YXJuX29uX211bHRpcGxlX3N0cmluZ19hcmdzX3RvX29uZW9mID0gNQoKICAgIHdhcm5fb25fbWF0Y2hfZmlyc3Rfd2l0aF9sc2hpZnRfb3BlcmF0b3IgPSA2CgogICAgZW5hYmxlX2RlYnVnX29uX25hbWVkX2V4cHJlc3Npb25zID0gNwoKCgoKCmRlZiBlbmFibGVfZGlhZyhkaWFnX2VudW06IERpYWdub3N0aWNzKSAtPiBOb25lOgoKICAgIFwiXCJcIgoKICAgIEVuYWJsZSBhIGdsb2JhbCBweXBhcnNpbmcgZGlhZ25vc3RpYyBmbGFnIChzZWUgOmNsYXNzOmBEaWFnbm9zdGljc2ApLgoKICAgIFwiXCJcIgoKICAgIF9fZGlhZ19fLmVuYWJsZShkaWFnX2VudW0ubmFtZSkKCgoKCgpkZWYgZGlzYWJsZV9kaWFnKGRpYWdfZW51bTogRGlhZ25vc3RpY3MpIC0+IE5vbmU6CgogICAgXCJcIlwiCgogICAgRGlzYWJsZSBhIGdsb2JhbCBweXBhcnNpbmcgZGlhZ25vc3RpYyBmbGFnIChzZWUgOmNsYXNzOmBEaWFnbm9zdGljc2ApLgoKICAgIFwiXCJcIgoKICAgIF9fZGlhZ19fLmRpc2FibGUoZGlhZ19lbnVtLm5hbWUpCgoKCgoKZGVmIGVuYWJsZV9hbGxfd2FybmluZ3MoKSAtPiBOb25lOgoKICAgIFwiXCJcIgoKICAgIEVuYWJsZSBhbGwgZ2xvYmFsIHB5cGFyc2luZyBkaWFnbm9zdGljIHdhcm5pbmdzIChzZWUgOmNsYXNzOmBEaWFnbm9zdGljc2ApLgoKICAgIFwiXCJcIgoKICAgIF9fZGlhZ19fLmVuYWJsZV9hbGxfd2FybmluZ3MoKQoKCgoKCiMgaGlkZSBhYnN0cmFjdCBjbGFzcwoKZGVsIF9fY29uZmlnX2ZsYWdzCgoKCgoKZGVmIF9zaG91bGRfZW5hYmxlX3dhcm5pbmdzKAoKICAgIGNtZF9saW5lX3dhcm5fb3B0aW9uczogdHlwaW5nLkl0ZXJhYmxlW3N0cl0sIHdhcm5fZW52X3ZhcjogdHlwaW5nLk9wdGlvbmFsW3N0cl0KCikgLT4gYm9vbDoKCiAgICBlbmFibGUgPSBib29sKHdhcm5fZW52X3ZhcikKCiAgICBmb3Igd2Fybl9vcHQgaW4gY21kX2xpbmVfd2Fybl9vcHRpb25zOgoKICAgICAgICB3X2FjdGlvbiwgd19tZXNzYWdlLCB3X2NhdGVnb3J5LCB3X21vZHVsZSwgd19saW5lID0gKHdhcm5fb3B0ICsgXCI6Ojo6XCIpLnNwbGl0KAoKICAgICAgICAgICAgXCI6XCIKCiAgICAgICAgKVs6NV0KCiAgICAgICAgaWYgbm90IHdfYWN0aW9uLmxvd2VyKCkuc3RhcnRzd2l0aChcImlcIikgYW5kICgKCiAgICAgICAgICAgIG5vdCAod19tZXNzYWdlIG9yIHdfY2F0ZWdvcnkgb3Igd19tb2R1bGUpIG9yIHdfbW9kdWxlID09IFwicHlwYXJzaW5nXCIKCiAgICAgICAgKToKCiAgICAgICAgICAgIGVuYWJsZSA9IFRydWUKCiAgICAgICAgZWxpZiB3X2FjdGlvbi5sb3dlcigpLnN0YXJ0c3dpdGgoXCJpXCIpIGFuZCB3X21vZHVsZSBpbiAoXCJweXBhcnNpbmdcIiwgXCJcIik6CgogICAgICAgICAgICBlbmFibGUgPSBGYWxzZQoKICAgIHJldHVybiBlbmFibGUKCgoKCgppZiBfc2hvdWxkX2VuYWJsZV93YXJuaW5ncygKCiAgICBzeXMud2Fybm9wdGlvbnMsIG9zLmVudmlyb24uZ2V0KFwiUFlQQVJTSU5HRU5BQkxFQUxMV0FSTklOR1NcIikKCik6CgogICAgZW5hYmxlX2FsbF93YXJuaW5ncygpCgoKCgoKIyBidWlsZCBsaXN0IG9mIHNpbmdsZSBhcmcgYnVpbHRpbnMsIHRoYXQgY2FuIGJlIHVzZWQgYXMgcGFyc2UgYWN0aW9ucwoKX3NpbmdsZV9hcmdfYnVpbHRpbnMgPSB7CgogICAgc3VtLAoKICAgIGxlbiwKCiAgICBzb3J0ZWQsCgogICAgcmV2ZXJzZWQsCgogICAgbGlzdCwKCiAgICB0dXBsZSwKCiAgICBzZXQsCgogICAgYW55LAoKICAgIGFsbCwKCiAgICBtaW4sCgogICAgbWF4LAoKfQoKCgpfZ2VuZXJhdG9yVHlwZSA9IHR5cGVzLkdlbmVyYXRvclR5cGUKClBhcnNlQWN0aW9uID0gVW5pb25bCgogICAgQ2FsbGFibGVbW10sIEFueV0sCgogICAgQ2FsbGFibGVbW1BhcnNlUmVzdWx0c10sIEFueV0sCgogICAgQ2FsbGFibGVbW2ludCwgUGFyc2VSZXN1bHRzXSwgQW55XSwKCiAgICBDYWxsYWJsZVtbc3RyLCBpbnQsIFBhcnNlUmVzdWx0c10sIEFueV0sCgpdCgpQYXJzZUNvbmRpdGlvbiA9IFVuaW9uWwoKICAgIENhbGxhYmxlW1tdLCBib29sXSwKCiAgICBDYWxsYWJsZVtbUGFyc2VSZXN1bHRzXSwgYm9vbF0sCgogICAgQ2FsbGFibGVbW2ludCwgUGFyc2VSZXN1bHRzXSwgYm9vbF0sCgogICAgQ2FsbGFibGVbW3N0ciwgaW50LCBQYXJzZVJlc3VsdHNdLCBib29sXSwKCl0KClBhcnNlRmFpbEFjdGlvbiA9IENhbGxhYmxlW1tzdHIsIGludCwgXCJQYXJzZXJFbGVtZW50XCIsIEV4Y2VwdGlvbl0sIE5vbmVdCgpEZWJ1Z1N0YXJ0QWN0aW9uID0gQ2FsbGFibGVbW3N0ciwgaW50LCBcIlBhcnNlckVsZW1lbnRcIiwgYm9vbF0sIE5vbmVdCgpEZWJ1Z1N1Y2Nlc3NBY3Rpb24gPSBDYWxsYWJsZVsKCiAgICBbc3RyLCBpbnQsIGludCwgXCJQYXJzZXJFbGVtZW50XCIsIFBhcnNlUmVzdWx0cywgYm9vbF0sIE5vbmUKCl0KCkRlYnVnRXhjZXB0aW9uQWN0aW9uID0gQ2FsbGFibGVbW3N0ciwgaW50LCBcIlBhcnNlckVsZW1lbnRcIiwgRXhjZXB0aW9uLCBib29sXSwgTm9uZV0KCgoKCgphbHBoYXMgPSBzdHJpbmcuYXNjaWlfdXBwZXJjYXNlICsgc3RyaW5nLmFzY2lpX2xvd2VyY2FzZQoKaWRlbnRjaGFycyA9IHB5cGFyc2luZ191bmljb2RlLkxhdGluMS5pZGVudGNoYXJzCgppZGVudGJvZHljaGFycyA9IHB5cGFyc2luZ191bmljb2RlLkxhdGluMS5pZGVudGJvZHljaGFycwoKbnVtcyA9IFwiMDEyMzQ1Njc4OVwiCgpoZXhudW1zID0gbnVtcyArIFwiQUJDREVGYWJjZGVmXCIKCmFscGhhbnVtcyA9IGFscGhhcyArIG51bXMKCnByaW50YWJsZXMgPSBcIlwiLmpvaW4oW2MgZm9yIGMgaW4gc3RyaW5nLnByaW50YWJsZSBpZiBjIG5vdCBpbiBzdHJpbmcud2hpdGVzcGFjZV0pCgoKCl90cmltX2FyaXR5X2NhbGxfbGluZTogdHJhY2ViYWNrLlN0YWNrU3VtbWFyeSA9IE5vbmUKCgoKCgpkZWYgX3RyaW1fYXJpdHkoZnVuYywgbWF4X2xpbWl0PTMpOgoKICAgIFwiXCJcImRlY29yYXRvciB0byB0cmltIGZ1bmN0aW9uIGNhbGxzIHRvIG1hdGNoIHRoZSBhcml0eSBvZiB0aGUgdGFyZ2V0XCJcIlwiCgogICAgZ2xvYmFsIF90cmltX2FyaXR5X2NhbGxfbGluZQoKCgogICAgaWYgZnVuYyBpbiBfc2luZ2xlX2FyZ19idWlsdGluczoKCiAgICAgICAgcmV0dXJuIGxhbWJkYSBzLCBsLCB0OiBmdW5jKHQpCgoKCiAgICBsaW1pdCA9IDAKCiAgICBmb3VuZF9hcml0eSA9IEZhbHNlCgoKCiAgICBkZWYgZXh0cmFjdF90Yih0YiwgbGltaXQ9MCk6CgogICAgICAgIGZyYW1lcyA9IHRyYWNlYmFjay5leHRyYWN0X3RiKHRiLCBsaW1pdD1saW1pdCkKCiAgICAgICAgZnJhbWVfc3VtbWFyeSA9IGZyYW1lc1stMV0KCiAgICAgICAgcmV0dXJuIFtmcmFtZV9zdW1tYXJ5WzoyXV0KCgoKICAgICMgc3ludGhlc2l6ZSB3aGF0IHdvdWxkIGJlIHJldHVybmVkIGJ5IHRyYWNlYmFjay5leHRyYWN0X3N0YWNrIGF0IHRoZSBjYWxsIHRvCgogICAgIyB1c2VyJ3MgcGFyc2UgYWN0aW9uICdmdW5jJywgc28gdGhhdCB3ZSBkb24ndCBpbmN1ciBjYWxsIHBlbmFsdHkgYXQgcGFyc2UgdGltZQoKCgogICAgIyBmbXQ6IG9mZgoKICAgIExJTkVfRElGRiA9IDcKCiAgICAjIElGIEFOWSBDT0RFIENIQU5HRVMsIEVWRU4gSlVTVCBDT01NRU5UUyBPUiBCTEFOSyBMSU5FUywgQkVUV0VFTiBUSEUgTkVYVCBMSU5FIEFORAoKICAgICMgVEhFIENBTEwgVE8gRlVOQyBJTlNJREUgV1JBUFBFUiwgTElORV9ESUZGIE1VU1QgQkUgTU9ESUZJRUQhISEhCgogICAgX3RyaW1fYXJpdHlfY2FsbF9saW5lID0gKF90cmltX2FyaXR5X2NhbGxfbGluZSBvciB0cmFjZWJhY2suZXh0cmFjdF9zdGFjayhsaW1pdD0yKVstMV0pCgogICAgcGFfY2FsbF9saW5lX3N5bnRoID0gKF90cmltX2FyaXR5X2NhbGxfbGluZVswXSwgX3RyaW1fYXJpdHlfY2FsbF9saW5lWzFdICsgTElORV9ESUZGKQoKCgogICAgZGVmIHdyYXBwZXIoKmFyZ3MpOgoKICAgICAgICBub25sb2NhbCBmb3VuZF9hcml0eSwgbGltaXQKCiAgICAgICAgd2hpbGUgMToKCiAgICAgICAgICAgIHRyeToKCiAgICAgICAgICAgICAgICByZXQgPSBmdW5jKCphcmdzW2xpbWl0Ol0pCgogICAgICAgICAgICAgICAgZm91bmRfYXJpdHkgPSBUcnVlCgogICAgICAgICAgICAgICAgcmV0dXJuIHJldAoKICAgICAgICAgICAgZXhjZXB0IFR5cGVFcnJvciBhcyB0ZToKCiAgICAgICAgICAgICAgICAjIHJlLXJhaXNlIFR5cGVFcnJvcnMgaWYgdGhleSBkaWQgbm90IGNvbWUgZnJvbSBvdXIgYXJpdHkgdGVzdGluZwoKICAgICAgICAgICAgICAgIGlmIGZvdW5kX2FyaXR5OgoKICAgICAgICAgICAgICAgICAgICByYWlzZQoKICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgIHRiID0gdGUuX190cmFjZWJhY2tfXwoKICAgICAgICAgICAgICAgICAgICB0cmltX2FyaXR5X3R5cGVfZXJyb3IgPSAoCgogICAgICAgICAgICAgICAgICAgICAgICBleHRyYWN0X3RiKHRiLCBsaW1pdD0yKVstMV1bOjJdID09IHBhX2NhbGxfbGluZV9zeW50aAoKICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgIGRlbCB0YgoKCgogICAgICAgICAgICAgICAgICAgIGlmIHRyaW1fYXJpdHlfdHlwZV9lcnJvcjoKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxpbWl0IDwgbWF4X2xpbWl0OgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbWl0ICs9IDEKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKCgogICAgICAgICAgICAgICAgICAgIHJhaXNlCgogICAgIyBmbXQ6IG9uCgoKCiAgICAjIGNvcHkgZnVuYyBuYW1lIHRvIHdyYXBwZXIgZm9yIHNlbnNpYmxlIGRlYnVnIG91dHB1dAoKICAgICMgKGNhbid0IHVzZSBmdW5jdG9vbHMud3JhcHMsIHNpbmNlIHRoYXQgbWVzc2VzIHdpdGggZnVuY3Rpb24gc2lnbmF0dXJlKQoKICAgIGZ1bmNfbmFtZSA9IGdldGF0dHIoZnVuYywgXCJfX25hbWVfX1wiLCBnZXRhdHRyKGZ1bmMsIFwiX19jbGFzc19fXCIpLl9fbmFtZV9fKQoKICAgIHdyYXBwZXIuX19uYW1lX18gPSBmdW5jX25hbWUKCiAgICB3cmFwcGVyLl9fZG9jX18gPSBmdW5jLl9fZG9jX18KCgoKICAgIHJldHVybiB3cmFwcGVyCgoKCgoKZGVmIGNvbmRpdGlvbl9hc19wYXJzZV9hY3Rpb24oCgogICAgZm46IFBhcnNlQ29uZGl0aW9uLCBtZXNzYWdlOiBzdHIgPSBOb25lLCBmYXRhbDogYm9vbCA9IEZhbHNlCgopIC0+IFBhcnNlQWN0aW9uOgoKICAgIFwiXCJcIgoKICAgIEZ1bmN0aW9uIHRvIGNvbnZlcnQgYSBzaW1wbGUgcHJlZGljYXRlIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBgYFRydWVgYCBvciBgYEZhbHNlYGAKCiAgICBpbnRvIGEgcGFyc2UgYWN0aW9uLiBDYW4gYmUgdXNlZCBpbiBwbGFjZXMgd2hlbiBhIHBhcnNlIGFjdGlvbiBpcyByZXF1aXJlZAoKICAgIGFuZCA6Y2xhc3M6YFBhcnNlckVsZW1lbnQuYWRkX2NvbmRpdGlvbmAgY2Fubm90IGJlIHVzZWQgKHN1Y2ggYXMgd2hlbiBhZGRpbmcgYSBjb25kaXRpb24KCiAgICB0byBhbiBvcGVyYXRvciBsZXZlbCBpbiA6Y2xhc3M6YGluZml4X25vdGF0aW9uYCkuCgoKCiAgICBPcHRpb25hbCBrZXl3b3JkIGFyZ3VtZW50czoKCgoKICAgIC0gYGBtZXNzYWdlYGAgLSBkZWZpbmUgYSBjdXN0b20gbWVzc2FnZSB0byBiZSB1c2VkIGluIHRoZSByYWlzZWQgZXhjZXB0aW9uCgogICAgLSBgYGZhdGFsYGAgLSBpZiBUcnVlLCB3aWxsIHJhaXNlIDpjbGFzczpgUGFyc2VGYXRhbEV4Y2VwdGlvbmAgdG8gc3RvcCBwYXJzaW5nIGltbWVkaWF0ZWx5OwoKICAgICAgb3RoZXJ3aXNlIHdpbGwgcmFpc2UgOmNsYXNzOmBQYXJzZUV4Y2VwdGlvbmAKCgoKICAgIFwiXCJcIgoKICAgIG1zZyA9IG1lc3NhZ2UgaWYgbWVzc2FnZSBpcyBub3QgTm9uZSBlbHNlIFwiZmFpbGVkIHVzZXItZGVmaW5lZCBjb25kaXRpb25cIgoKICAgIGV4Y190eXBlID0gUGFyc2VGYXRhbEV4Y2VwdGlvbiBpZiBmYXRhbCBlbHNlIFBhcnNlRXhjZXB0aW9uCgogICAgZm4gPSBfdHJpbV9hcml0eShmbikKCgoKICAgIEB3cmFwcyhmbikKCiAgICBkZWYgcGEocywgbCwgdCk6CgogICAgICAgIGlmIG5vdCBib29sKGZuKHMsIGwsIHQpKToKCiAgICAgICAgICAgIHJhaXNlIGV4Y190eXBlKHMsIGwsIG1zZykKCgoKICAgIHJldHVybiBwYQoKCgoKCmRlZiBfZGVmYXVsdF9zdGFydF9kZWJ1Z19hY3Rpb24oCgogICAgaW5zdHJpbmc6IHN0ciwgbG9jOiBpbnQsIGV4cHI6IFwiUGFyc2VyRWxlbWVudFwiLCBjYWNoZV9oaXQ6IGJvb2wgPSBGYWxzZQoKKToKCiAgICBjYWNoZV9oaXRfc3RyID0gXCIqXCIgaWYgY2FjaGVfaGl0IGVsc2UgXCJcIgoKICAgIHByaW50KAoKICAgICAgICAoCgogICAgICAgICAgICBcInt9TWF0Y2gge30gYXQgbG9jIHt9KHt9LHt9KVxcbiAge31cXG4gIHt9XlwiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICBjYWNoZV9oaXRfc3RyLAoKICAgICAgICAgICAgICAgIGV4cHIsCgogICAgICAgICAgICAgICAgbG9jLAoKICAgICAgICAgICAgICAgIGxpbmVubyhsb2MsIGluc3RyaW5nKSwKCiAgICAgICAgICAgICAgICBjb2wobG9jLCBpbnN0cmluZyksCgogICAgICAgICAgICAgICAgbGluZShsb2MsIGluc3RyaW5nKSwKCiAgICAgICAgICAgICAgICBcIiBcIiAqIChjb2wobG9jLCBpbnN0cmluZykgLSAxKSwKCiAgICAgICAgICAgICkKCiAgICAgICAgKQoKICAgICkKCgoKCgpkZWYgX2RlZmF1bHRfc3VjY2Vzc19kZWJ1Z19hY3Rpb24oCgogICAgaW5zdHJpbmc6IHN0ciwKCiAgICBzdGFydGxvYzogaW50LAoKICAgIGVuZGxvYzogaW50LAoKICAgIGV4cHI6IFwiUGFyc2VyRWxlbWVudFwiLAoKICAgIHRva3M6IFBhcnNlUmVzdWx0cywKCiAgICBjYWNoZV9oaXQ6IGJvb2wgPSBGYWxzZSwKCik6CgogICAgY2FjaGVfaGl0X3N0ciA9IFwiKlwiIGlmIGNhY2hlX2hpdCBlbHNlIFwiXCIKCiAgICBwcmludChcInt9TWF0Y2hlZCB7fSAtPiB7fVwiLmZvcm1hdChjYWNoZV9oaXRfc3RyLCBleHByLCB0b2tzLmFzX2xpc3QoKSkpCgoKCgoKZGVmIF9kZWZhdWx0X2V4Y2VwdGlvbl9kZWJ1Z19hY3Rpb24oCgogICAgaW5zdHJpbmc6IHN0ciwKCiAgICBsb2M6IGludCwKCiAgICBleHByOiBcIlBhcnNlckVsZW1lbnRcIiwKCiAgICBleGM6IEV4Y2VwdGlvbiwKCiAgICBjYWNoZV9oaXQ6IGJvb2wgPSBGYWxzZSwKCik6CgogICAgY2FjaGVfaGl0X3N0ciA9IFwiKlwiIGlmIGNhY2hlX2hpdCBlbHNlIFwiXCIKCiAgICBwcmludCgKCiAgICAgICAgXCJ7fU1hdGNoIHt9IGZhaWxlZCwge30gcmFpc2VkOiB7fVwiLmZvcm1hdCgKCiAgICAgICAgICAgIGNhY2hlX2hpdF9zdHIsIGV4cHIsIHR5cGUoZXhjKS5fX25hbWVfXywgZXhjCgogICAgICAgICkKCiAgICApCgoKCgoKZGVmIG51bGxfZGVidWdfYWN0aW9uKCphcmdzKToKCiAgICBcIlwiXCInRG8tbm90aGluZycgZGVidWcgYWN0aW9uLCB0byBzdXBwcmVzcyBkZWJ1Z2dpbmcgb3V0cHV0IGR1cmluZyBwYXJzaW5nLlwiXCJcIgoKCgoKCmNsYXNzIFBhcnNlckVsZW1lbnQoQUJDKToKCiAgICBcIlwiXCJBYnN0cmFjdCBiYXNlIGxldmVsIHBhcnNlciBlbGVtZW50IGNsYXNzLlwiXCJcIgoKCgogICAgREVGQVVMVF9XSElURV9DSEFSUzogc3RyID0gXCIgXFxuXFx0XFxyXCIKCiAgICB2ZXJib3NlX3N0YWNrdHJhY2U6IGJvb2wgPSBGYWxzZQoKICAgIF9saXRlcmFsU3RyaW5nQ2xhc3M6IHR5cGluZy5PcHRpb25hbFt0eXBlXSA9IE5vbmUKCgoKICAgIEBzdGF0aWNtZXRob2QKCiAgICBkZWYgc2V0X2RlZmF1bHRfd2hpdGVzcGFjZV9jaGFycyhjaGFyczogc3RyKSAtPiBOb25lOgoKICAgICAgICByXCJcIlwiCgogICAgICAgIE92ZXJyaWRlcyB0aGUgZGVmYXVsdCB3aGl0ZXNwYWNlIGNoYXJzCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgICMgZGVmYXVsdCB3aGl0ZXNwYWNlIGNoYXJzIGFyZSBzcGFjZSwgPFRBQj4gYW5kIG5ld2xpbmUKCiAgICAgICAgICAgIFdvcmQoYWxwaGFzKVsxLCAuLi5dLnBhcnNlX3N0cmluZyhcImFiYyBkZWZcXG5naGkgamtsXCIpICAjIC0+IFsnYWJjJywgJ2RlZicsICdnaGknLCAnamtsJ10KCgoKICAgICAgICAgICAgIyBjaGFuZ2UgdG8ganVzdCB0cmVhdCBuZXdsaW5lIGFzIHNpZ25pZmljYW50CgogICAgICAgICAgICBQYXJzZXJFbGVtZW50LnNldF9kZWZhdWx0X3doaXRlc3BhY2VfY2hhcnMoXCIgXFx0XCIpCgogICAgICAgICAgICBXb3JkKGFscGhhcylbMSwgLi4uXS5wYXJzZV9zdHJpbmcoXCJhYmMgZGVmXFxuZ2hpIGprbFwiKSAgIyAtPiBbJ2FiYycsICdkZWYnXQoKICAgICAgICBcIlwiXCIKCiAgICAgICAgUGFyc2VyRWxlbWVudC5ERUZBVUxUX1dISVRFX0NIQVJTID0gY2hhcnMKCgoKICAgICAgICAjIHVwZGF0ZSB3aGl0ZXNwYWNlIGFsbCBwYXJzZSBleHByZXNzaW9ucyBkZWZpbmVkIGluIHRoaXMgbW9kdWxlCgogICAgICAgIGZvciBleHByIGluIF9idWlsdGluX2V4cHJzOgoKICAgICAgICAgICAgaWYgZXhwci5jb3B5RGVmYXVsdFdoaXRlQ2hhcnM6CgogICAgICAgICAgICAgICAgZXhwci53aGl0ZUNoYXJzID0gc2V0KGNoYXJzKQoKCgogICAgQHN0YXRpY21ldGhvZAoKICAgIGRlZiBpbmxpbmVfbGl0ZXJhbHNfdXNpbmcoY2xzOiB0eXBlKSAtPiBOb25lOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgU2V0IGNsYXNzIHRvIGJlIHVzZWQgZm9yIGluY2x1c2lvbiBvZiBzdHJpbmcgbGl0ZXJhbHMgaW50byBhIHBhcnNlci4KCgoKICAgICAgICBFeGFtcGxlOjoKCgoKICAgICAgICAgICAgIyBkZWZhdWx0IGxpdGVyYWwgY2xhc3MgdXNlZCBpcyBMaXRlcmFsCgogICAgICAgICAgICBpbnRlZ2VyID0gV29yZChudW1zKQoKICAgICAgICAgICAgZGF0ZV9zdHIgPSBpbnRlZ2VyKFwieWVhclwiKSArICcvJyArIGludGVnZXIoXCJtb250aFwiKSArICcvJyArIGludGVnZXIoXCJkYXlcIikKCgoKICAgICAgICAgICAgZGF0ZV9zdHIucGFyc2Vfc3RyaW5nKFwiMTk5OS8xMi8zMVwiKSAgIyAtPiBbJzE5OTknLCAnLycsICcxMicsICcvJywgJzMxJ10KCgoKCgogICAgICAgICAgICAjIGNoYW5nZSB0byBTdXBwcmVzcwoKICAgICAgICAgICAgUGFyc2VyRWxlbWVudC5pbmxpbmVfbGl0ZXJhbHNfdXNpbmcoU3VwcHJlc3MpCgogICAgICAgICAgICBkYXRlX3N0ciA9IGludGVnZXIoXCJ5ZWFyXCIpICsgJy8nICsgaW50ZWdlcihcIm1vbnRoXCIpICsgJy8nICsgaW50ZWdlcihcImRheVwiKQoKCgogICAgICAgICAgICBkYXRlX3N0ci5wYXJzZV9zdHJpbmcoXCIxOTk5LzEyLzMxXCIpICAjIC0+IFsnMTk5OScsICcxMicsICczMSddCgogICAgICAgIFwiXCJcIgoKICAgICAgICBQYXJzZXJFbGVtZW50Ll9saXRlcmFsU3RyaW5nQ2xhc3MgPSBjbHMKCgoKICAgIGNsYXNzIERlYnVnQWN0aW9ucyhOYW1lZFR1cGxlKToKCiAgICAgICAgZGVidWdfdHJ5OiB0eXBpbmcuT3B0aW9uYWxbRGVidWdTdGFydEFjdGlvbl0KCiAgICAgICAgZGVidWdfbWF0Y2g6IHR5cGluZy5PcHRpb25hbFtEZWJ1Z1N1Y2Nlc3NBY3Rpb25dCgogICAgICAgIGRlYnVnX2ZhaWw6IHR5cGluZy5PcHRpb25hbFtEZWJ1Z0V4Y2VwdGlvbkFjdGlvbl0KCgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBzYXZlbGlzdDogYm9vbCA9IEZhbHNlKToKCiAgICAgICAgc2VsZi5wYXJzZUFjdGlvbjogTGlzdFtQYXJzZUFjdGlvbl0gPSBsaXN0KCkKCiAgICAgICAgc2VsZi5mYWlsQWN0aW9uOiB0eXBpbmcuT3B0aW9uYWxbUGFyc2VGYWlsQWN0aW9uXSA9IE5vbmUKCiAgICAgICAgc2VsZi5jdXN0b21OYW1lID0gTm9uZQoKICAgICAgICBzZWxmLl9kZWZhdWx0TmFtZSA9IE5vbmUKCiAgICAgICAgc2VsZi5yZXN1bHRzTmFtZSA9IE5vbmUKCiAgICAgICAgc2VsZi5zYXZlQXNMaXN0ID0gc2F2ZWxpc3QKCiAgICAgICAgc2VsZi5za2lwV2hpdGVzcGFjZSA9IFRydWUKCiAgICAgICAgc2VsZi53aGl0ZUNoYXJzID0gc2V0KFBhcnNlckVsZW1lbnQuREVGQVVMVF9XSElURV9DSEFSUykKCiAgICAgICAgc2VsZi5jb3B5RGVmYXVsdFdoaXRlQ2hhcnMgPSBUcnVlCgogICAgICAgICMgdXNlZCB3aGVuIGNoZWNraW5nIGZvciBsZWZ0LXJlY3Vyc2lvbgoKICAgICAgICBzZWxmLm1heVJldHVybkVtcHR5ID0gRmFsc2UKCiAgICAgICAgc2VsZi5rZWVwVGFicyA9IEZhbHNlCgogICAgICAgIHNlbGYuaWdub3JlRXhwcnM6IExpc3RbXCJQYXJzZXJFbGVtZW50XCJdID0gbGlzdCgpCgogICAgICAgIHNlbGYuZGVidWcgPSBGYWxzZQoKICAgICAgICBzZWxmLnN0cmVhbWxpbmVkID0gRmFsc2UKCiAgICAgICAgIyBvcHRpbWl6ZSBleGNlcHRpb24gaGFuZGxpbmcgZm9yIHN1YmNsYXNzZXMgdGhhdCBkb24ndCBhZHZhbmNlIHBhcnNlIGluZGV4CgogICAgICAgIHNlbGYubWF5SW5kZXhFcnJvciA9IFRydWUKCiAgICAgICAgc2VsZi5lcnJtc2cgPSBcIlwiCgogICAgICAgICMgbWFyayByZXN1bHRzIG5hbWVzIGFzIG1vZGFsIChyZXBvcnQgb25seSBsYXN0KSBvciBjdW11bGF0aXZlIChsaXN0IGFsbCkKCiAgICAgICAgc2VsZi5tb2RhbFJlc3VsdHMgPSBUcnVlCgogICAgICAgICMgY3VzdG9tIGRlYnVnIGFjdGlvbnMKCiAgICAgICAgc2VsZi5kZWJ1Z0FjdGlvbnMgPSBzZWxmLkRlYnVnQWN0aW9ucyhOb25lLCBOb25lLCBOb25lKQoKICAgICAgICAjIGF2b2lkIHJlZHVuZGFudCBjYWxscyB0byBwcmVQYXJzZQoKICAgICAgICBzZWxmLmNhbGxQcmVwYXJzZSA9IFRydWUKCiAgICAgICAgc2VsZi5jYWxsRHVyaW5nVHJ5ID0gRmFsc2UKCiAgICAgICAgc2VsZi5zdXBwcmVzc193YXJuaW5nc186IExpc3RbRGlhZ25vc3RpY3NdID0gW10KCgoKICAgIGRlZiBzdXBwcmVzc193YXJuaW5nKHNlbGYsIHdhcm5pbmdfdHlwZTogRGlhZ25vc3RpY3MpIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgU3VwcHJlc3Mgd2FybmluZ3MgZW1pdHRlZCBmb3IgYSBwYXJ0aWN1bGFyIGRpYWdub3N0aWMgb24gdGhpcyBleHByZXNzaW9uLgoKCgogICAgICAgIEV4YW1wbGU6OgoKCgogICAgICAgICAgICBiYXNlID0gcHAuRm9yd2FyZCgpCgogICAgICAgICAgICBiYXNlLnN1cHByZXNzX3dhcm5pbmcoRGlhZ25vc3RpY3Mud2Fybl9vbl9wYXJzZV91c2luZ19lbXB0eV9Gb3J3YXJkKQoKCgogICAgICAgICAgICAjIHN0YXRlbWVudCB3b3VsZCBub3JtYWxseSByYWlzZSBhIHdhcm5pbmcsIGJ1dCBpcyBub3cgc3VwcHJlc3NlZAoKICAgICAgICAgICAgcHJpbnQoYmFzZS5wYXJzZVN0cmluZyhcInhcIikpCgoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIHNlbGYuc3VwcHJlc3Nfd2FybmluZ3NfLmFwcGVuZCh3YXJuaW5nX3R5cGUpCgogICAgICAgIHJldHVybiBzZWxmCgoKCiAgICBkZWYgY29weShzZWxmKSAtPiBcIlBhcnNlckVsZW1lbnRcIjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIE1ha2UgYSBjb3B5IG9mIHRoaXMgOmNsYXNzOmBQYXJzZXJFbGVtZW50YC4gIFVzZWZ1bCBmb3IgZGVmaW5pbmcKCiAgICAgICAgZGlmZmVyZW50IHBhcnNlIGFjdGlvbnMgZm9yIHRoZSBzYW1lIHBhcnNpbmcgcGF0dGVybiwgdXNpbmcgY29waWVzIG9mCgogICAgICAgIHRoZSBvcmlnaW5hbCBwYXJzZSBlbGVtZW50LgoKCgogICAgICAgIEV4YW1wbGU6OgoKCgogICAgICAgICAgICBpbnRlZ2VyID0gV29yZChudW1zKS5zZXRfcGFyc2VfYWN0aW9uKGxhbWJkYSB0b2tzOiBpbnQodG9rc1swXSkpCgogICAgICAgICAgICBpbnRlZ2VySyA9IGludGVnZXIuY29weSgpLmFkZF9wYXJzZV9hY3Rpb24obGFtYmRhIHRva3M6IHRva3NbMF0gKiAxMDI0KSArIFN1cHByZXNzKFwiS1wiKQoKICAgICAgICAgICAgaW50ZWdlck0gPSBpbnRlZ2VyLmNvcHkoKS5hZGRfcGFyc2VfYWN0aW9uKGxhbWJkYSB0b2tzOiB0b2tzWzBdICogMTAyNCAqIDEwMjQpICsgU3VwcHJlc3MoXCJNXCIpCgoKCiAgICAgICAgICAgIHByaW50KChpbnRlZ2VySyB8IGludGVnZXJNIHwgaW50ZWdlcilbMSwgLi4uXS5wYXJzZV9zdHJpbmcoXCI1SyAxMDAgNjQwSyAyNTZNXCIpKQoKCgogICAgICAgIHByaW50czo6CgoKCiAgICAgICAgICAgIFs1MTIwLCAxMDAsIDY1NTM2MCwgMjY4NDM1NDU2XQoKCgogICAgICAgIEVxdWl2YWxlbnQgZm9ybSBvZiBgYGV4cHIuY29weSgpYGAgaXMganVzdCBgYGV4cHIoKWBgOjoKCgoKICAgICAgICAgICAgaW50ZWdlck0gPSBpbnRlZ2VyKCkuYWRkX3BhcnNlX2FjdGlvbihsYW1iZGEgdG9rczogdG9rc1swXSAqIDEwMjQgKiAxMDI0KSArIFN1cHByZXNzKFwiTVwiKQoKICAgICAgICBcIlwiXCIKCiAgICAgICAgY3B5ID0gY29weS5jb3B5KHNlbGYpCgogICAgICAgIGNweS5wYXJzZUFjdGlvbiA9IHNlbGYucGFyc2VBY3Rpb25bOl0KCiAgICAgICAgY3B5Lmlnbm9yZUV4cHJzID0gc2VsZi5pZ25vcmVFeHByc1s6XQoKICAgICAgICBpZiBzZWxmLmNvcHlEZWZhdWx0V2hpdGVDaGFyczoKCiAgICAgICAgICAgIGNweS53aGl0ZUNoYXJzID0gc2V0KFBhcnNlckVsZW1lbnQuREVGQVVMVF9XSElURV9DSEFSUykKCiAgICAgICAgcmV0dXJuIGNweQoKCgogICAgZGVmIHNldF9yZXN1bHRzX25hbWUoCgogICAgICAgIHNlbGYsIG5hbWU6IHN0ciwgbGlzdF9hbGxfbWF0Y2hlczogYm9vbCA9IEZhbHNlLCAqLCBsaXN0QWxsTWF0Y2hlczogYm9vbCA9IEZhbHNlCgogICAgKSAtPiBcIlBhcnNlckVsZW1lbnRcIjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIERlZmluZSBuYW1lIGZvciByZWZlcmVuY2luZyBtYXRjaGluZyB0b2tlbnMgYXMgYSBuZXN0ZWQgYXR0cmlidXRlCgogICAgICAgIG9mIHRoZSByZXR1cm5lZCBwYXJzZSByZXN1bHRzLgoKCgogICAgICAgIE5vcm1hbGx5LCByZXN1bHRzIG5hbWVzIGFyZSBhc3NpZ25lZCBhcyB5b3Ugd291bGQgYXNzaWduIGtleXMgaW4gYSBkaWN0OgoKICAgICAgICBhbnkgZXhpc3RpbmcgdmFsdWUgaXMgb3ZlcndyaXR0ZW4gYnkgbGF0ZXIgdmFsdWVzLiBJZiBpdCBpcyBuZWNlc3NhcnkgdG8KCiAgICAgICAga2VlcCBhbGwgdmFsdWVzIGNhcHR1cmVkIGZvciBhIHBhcnRpY3VsYXIgcmVzdWx0cyBuYW1lLCBjYWxsIGBgc2V0X3Jlc3VsdHNfbmFtZWBgCgogICAgICAgIHdpdGggYGBsaXN0X2FsbF9tYXRjaGVzYGAgPSBUcnVlLgoKCgogICAgICAgIE5PVEU6IGBgc2V0X3Jlc3VsdHNfbmFtZWBgIHJldHVybnMgYSAqY29weSogb2YgdGhlIG9yaWdpbmFsIDpjbGFzczpgUGFyc2VyRWxlbWVudGAgb2JqZWN0OwoKICAgICAgICB0aGlzIGlzIHNvIHRoYXQgdGhlIGNsaWVudCBjYW4gZGVmaW5lIGEgYmFzaWMgZWxlbWVudCwgc3VjaCBhcyBhbgoKICAgICAgICBpbnRlZ2VyLCBhbmQgcmVmZXJlbmNlIGl0IGluIG11bHRpcGxlIHBsYWNlcyB3aXRoIGRpZmZlcmVudCBuYW1lcy4KCgoKICAgICAgICBZb3UgY2FuIGFsc28gc2V0IHJlc3VsdHMgbmFtZXMgdXNpbmcgdGhlIGFiYnJldmlhdGVkIHN5bnRheCwKCiAgICAgICAgYGBleHByKFwibmFtZVwiKWBgIGluIHBsYWNlIG9mIGBgZXhwci5zZXRfcmVzdWx0c19uYW1lKFwibmFtZVwiKWBgCgogICAgICAgIC0gc2VlIDpjbGFzczpgX19jYWxsX19gLiBJZiBgYGxpc3RfYWxsX21hdGNoZXNgYCBpcyByZXF1aXJlZCwgdXNlCgogICAgICAgIGBgZXhwcihcIm5hbWUqXCIpYGAuCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIGRhdGVfc3RyID0gKGludGVnZXIuc2V0X3Jlc3VsdHNfbmFtZShcInllYXJcIikgKyAnLycKCiAgICAgICAgICAgICAgICAgICAgICAgICsgaW50ZWdlci5zZXRfcmVzdWx0c19uYW1lKFwibW9udGhcIikgKyAnLycKCiAgICAgICAgICAgICAgICAgICAgICAgICsgaW50ZWdlci5zZXRfcmVzdWx0c19uYW1lKFwiZGF5XCIpKQoKCgogICAgICAgICAgICAjIGVxdWl2YWxlbnQgZm9ybToKCiAgICAgICAgICAgIGRhdGVfc3RyID0gaW50ZWdlcihcInllYXJcIikgKyAnLycgKyBpbnRlZ2VyKFwibW9udGhcIikgKyAnLycgKyBpbnRlZ2VyKFwiZGF5XCIpCgogICAgICAgIFwiXCJcIgoKICAgICAgICBsaXN0QWxsTWF0Y2hlcyA9IGxpc3RBbGxNYXRjaGVzIG9yIGxpc3RfYWxsX21hdGNoZXMKCiAgICAgICAgcmV0dXJuIHNlbGYuX3NldFJlc3VsdHNOYW1lKG5hbWUsIGxpc3RBbGxNYXRjaGVzKQoKCgogICAgZGVmIF9zZXRSZXN1bHRzTmFtZShzZWxmLCBuYW1lLCBsaXN0QWxsTWF0Y2hlcz1GYWxzZSk6CgogICAgICAgIGlmIG5hbWUgaXMgTm9uZToKCiAgICAgICAgICAgIHJldHVybiBzZWxmCgogICAgICAgIG5ld3NlbGYgPSBzZWxmLmNvcHkoKQoKICAgICAgICBpZiBuYW1lLmVuZHN3aXRoKFwiKlwiKToKCiAgICAgICAgICAgIG5hbWUgPSBuYW1lWzotMV0KCiAgICAgICAgICAgIGxpc3RBbGxNYXRjaGVzID0gVHJ1ZQoKICAgICAgICBuZXdzZWxmLnJlc3VsdHNOYW1lID0gbmFtZQoKICAgICAgICBuZXdzZWxmLm1vZGFsUmVzdWx0cyA9IG5vdCBsaXN0QWxsTWF0Y2hlcwoKICAgICAgICByZXR1cm4gbmV3c2VsZgoKCgogICAgZGVmIHNldF9icmVhayhzZWxmLCBicmVha19mbGFnOiBib29sID0gVHJ1ZSkgLT4gXCJQYXJzZXJFbGVtZW50XCI6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBNZXRob2QgdG8gaW52b2tlIHRoZSBQeXRob24gcGRiIGRlYnVnZ2VyIHdoZW4gdGhpcyBlbGVtZW50IGlzCgogICAgICAgIGFib3V0IHRvIGJlIHBhcnNlZC4gU2V0IGBgYnJlYWtfZmxhZ2BgIHRvIGBgVHJ1ZWBgIHRvIGVuYWJsZSwgYGBGYWxzZWBgIHRvCgogICAgICAgIGRpc2FibGUuCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpZiBicmVha19mbGFnOgoKICAgICAgICAgICAgX3BhcnNlTWV0aG9kID0gc2VsZi5fcGFyc2UKCgoKICAgICAgICAgICAgZGVmIGJyZWFrZXIoaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUsIGNhbGxQcmVQYXJzZT1UcnVlKToKCiAgICAgICAgICAgICAgICBpbXBvcnQgcGRiCgoKCiAgICAgICAgICAgICAgICAjIHRoaXMgY2FsbCB0byBwZGIuc2V0X3RyYWNlKCkgaXMgaW50ZW50aW9uYWwsIG5vdCBhIGNoZWNraW4gZXJyb3IKCiAgICAgICAgICAgICAgICBwZGIuc2V0X3RyYWNlKCkKCiAgICAgICAgICAgICAgICByZXR1cm4gX3BhcnNlTWV0aG9kKGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucywgY2FsbFByZVBhcnNlKQoKCgogICAgICAgICAgICBicmVha2VyLl9vcmlnaW5hbFBhcnNlTWV0aG9kID0gX3BhcnNlTWV0aG9kCgogICAgICAgICAgICBzZWxmLl9wYXJzZSA9IGJyZWFrZXIKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIGlmIGhhc2F0dHIoc2VsZi5fcGFyc2UsIFwiX29yaWdpbmFsUGFyc2VNZXRob2RcIik6CgogICAgICAgICAgICAgICAgc2VsZi5fcGFyc2UgPSBzZWxmLl9wYXJzZS5fb3JpZ2luYWxQYXJzZU1ldGhvZAoKICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgZGVmIHNldF9wYXJzZV9hY3Rpb24oc2VsZiwgKmZuczogUGFyc2VBY3Rpb24sICoqa3dhcmdzKSAtPiBcIlBhcnNlckVsZW1lbnRcIjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIERlZmluZSBvbmUgb3IgbW9yZSBhY3Rpb25zIHRvIHBlcmZvcm0gd2hlbiBzdWNjZXNzZnVsbHkgbWF0Y2hpbmcgcGFyc2UgZWxlbWVudCBkZWZpbml0aW9uLgoKCgogICAgICAgIFBhcnNlIGFjdGlvbnMgY2FuIGJlIGNhbGxlZCB0byBwZXJmb3JtIGRhdGEgY29udmVyc2lvbnMsIGRvIGV4dHJhIHZhbGlkYXRpb24sCgogICAgICAgIHVwZGF0ZSBleHRlcm5hbCBkYXRhIHN0cnVjdHVyZXMsIG9yIGVuaGFuY2Ugb3IgcmVwbGFjZSB0aGUgcGFyc2VkIHRva2Vucy4KCiAgICAgICAgRWFjaCBwYXJzZSBhY3Rpb24gYGBmbmBgIGlzIGEgY2FsbGFibGUgbWV0aG9kIHdpdGggMC0zIGFyZ3VtZW50cywgY2FsbGVkIGFzCgogICAgICAgIGBgZm4ocywgbG9jLCB0b2tzKWBgICwgYGBmbihsb2MsIHRva3MpYGAgLCBgYGZuKHRva3MpYGAgLCBvciBqdXN0IGBgZm4oKWBgICwgd2hlcmU6CgoKCiAgICAgICAgLSBzICAgPSB0aGUgb3JpZ2luYWwgc3RyaW5nIGJlaW5nIHBhcnNlZCAoc2VlIG5vdGUgYmVsb3cpCgogICAgICAgIC0gbG9jID0gdGhlIGxvY2F0aW9uIG9mIHRoZSBtYXRjaGluZyBzdWJzdHJpbmcKCiAgICAgICAgLSB0b2tzID0gYSBsaXN0IG9mIHRoZSBtYXRjaGVkIHRva2VucywgcGFja2FnZWQgYXMgYSA6Y2xhc3M6YFBhcnNlUmVzdWx0c2Agb2JqZWN0CgoKCiAgICAgICAgVGhlIHBhcnNlZCB0b2tlbnMgYXJlIHBhc3NlZCB0byB0aGUgcGFyc2UgYWN0aW9uIGFzIFBhcnNlUmVzdWx0cy4gVGhleSBjYW4gYmUKCiAgICAgICAgbW9kaWZpZWQgaW4gcGxhY2UgdXNpbmcgbGlzdC1zdHlsZSBhcHBlbmQsIGV4dGVuZCwgYW5kIHBvcCBvcGVyYXRpb25zIHRvIHVwZGF0ZQoKICAgICAgICB0aGUgcGFyc2VkIGxpc3QgZWxlbWVudHM7IGFuZCB3aXRoIGRpY3Rpb25hcnktc3R5bGUgaXRlbSBzZXQgYW5kIGRlbCBvcGVyYXRpb25zCgogICAgICAgIHRvIGFkZCwgdXBkYXRlLCBvciByZW1vdmUgYW55IG5hbWVkIHJlc3VsdHMuIElmIHRoZSB0b2tlbnMgYXJlIG1vZGlmaWVkIGluIHBsYWNlLAoKICAgICAgICBpdCBpcyBub3QgbmVjZXNzYXJ5IHRvIHJldHVybiB0aGVtIHdpdGggYSByZXR1cm4gc3RhdGVtZW50LgoKCgogICAgICAgIFBhcnNlIGFjdGlvbnMgY2FuIGFsc28gY29tcGxldGVseSByZXBsYWNlIHRoZSBnaXZlbiB0b2tlbnMsIHdpdGggYW5vdGhlciBgYFBhcnNlUmVzdWx0c2BgCgogICAgICAgIG9iamVjdCwgb3Igd2l0aCBzb21lIGVudGlyZWx5IGRpZmZlcmVudCBvYmplY3QgKGNvbW1vbiBmb3IgcGFyc2UgYWN0aW9ucyB0aGF0IHBlcmZvcm0gZGF0YQoKICAgICAgICBjb252ZXJzaW9ucykuIEEgY29udmVuaWVudCB3YXkgdG8gYnVpbGQgYSBuZXcgcGFyc2UgcmVzdWx0IGlzIHRvIGRlZmluZSB0aGUgdmFsdWVzCgogICAgICAgIHVzaW5nIGEgZGljdCwgYW5kIHRoZW4gY3JlYXRlIHRoZSByZXR1cm4gdmFsdWUgdXNpbmcgOmNsYXNzOmBQYXJzZVJlc3VsdHMuZnJvbV9kaWN0YC4KCgoKICAgICAgICBJZiBOb25lIGlzIHBhc3NlZCBhcyB0aGUgYGBmbmBgIHBhcnNlIGFjdGlvbiwgYWxsIHByZXZpb3VzbHkgYWRkZWQgcGFyc2UgYWN0aW9ucyBmb3IgdGhpcwoKICAgICAgICBleHByZXNzaW9uIGFyZSBjbGVhcmVkLgoKCgogICAgICAgIE9wdGlvbmFsIGtleXdvcmQgYXJndW1lbnRzOgoKCgogICAgICAgIC0gY2FsbF9kdXJpbmdfdHJ5ID0gKGRlZmF1bHQ9IGBgRmFsc2VgYCkgaW5kaWNhdGUgaWYgcGFyc2UgYWN0aW9uIHNob3VsZCBiZSBydW4gZHVyaW5nCgogICAgICAgICAgbG9va2FoZWFkcyBhbmQgYWx0ZXJuYXRlIHRlc3RpbmcuIEZvciBwYXJzZSBhY3Rpb25zIHRoYXQgaGF2ZSBzaWRlIGVmZmVjdHMsIGl0IGlzCgogICAgICAgICAgaW1wb3J0YW50IHRvIG9ubHkgY2FsbCB0aGUgcGFyc2UgYWN0aW9uIG9uY2UgaXQgaXMgZGV0ZXJtaW5lZCB0aGF0IGl0IGlzIGJlaW5nCgogICAgICAgICAgY2FsbGVkIGFzIHBhcnQgb2YgYSBzdWNjZXNzZnVsIHBhcnNlLiBGb3IgcGFyc2UgYWN0aW9ucyB0aGF0IHBlcmZvcm0gYWRkaXRpb25hbAoKICAgICAgICAgIHZhbGlkYXRpb24sIHRoZW4gY2FsbF9kdXJpbmdfdHJ5IHNob3VsZCBiZSBwYXNzZWQgYXMgVHJ1ZSwgc28gdGhhdCB0aGUgdmFsaWRhdGlvbgoKICAgICAgICAgIGNvZGUgaXMgaW5jbHVkZWQgaW4gdGhlIHByZWxpbWluYXJ5IFwidHJ5XCIgcGFyc2VzLgoKCgogICAgICAgIE5vdGU6IHRoZSBkZWZhdWx0IHBhcnNpbmcgYmVoYXZpb3IgaXMgdG8gZXhwYW5kIHRhYnMgaW4gdGhlIGlucHV0IHN0cmluZwoKICAgICAgICBiZWZvcmUgc3RhcnRpbmcgdGhlIHBhcnNpbmcgcHJvY2Vzcy4gIFNlZSA6Y2xhc3M6YHBhcnNlX3N0cmluZ2AgZm9yIG1vcmUKCiAgICAgICAgaW5mb3JtYXRpb24gb24gcGFyc2luZyBzdHJpbmdzIGNvbnRhaW5pbmcgYGA8VEFCPmBgIHMsIGFuZCBzdWdnZXN0ZWQKCiAgICAgICAgbWV0aG9kcyB0byBtYWludGFpbiBhIGNvbnNpc3RlbnQgdmlldyBvZiB0aGUgcGFyc2VkIHN0cmluZywgdGhlIHBhcnNlCgogICAgICAgIGxvY2F0aW9uLCBhbmQgbGluZSBhbmQgY29sdW1uIHBvc2l0aW9ucyB3aXRoaW4gdGhlIHBhcnNlZCBzdHJpbmcuCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgICMgcGFyc2UgZGF0ZXMgaW4gdGhlIGZvcm0gWVlZWS9NTS9ERAoKCgogICAgICAgICAgICAjIHVzZSBwYXJzZSBhY3Rpb24gdG8gY29udmVydCB0b2tzIGZyb20gc3RyIHRvIGludCBhdCBwYXJzZSB0aW1lCgogICAgICAgICAgICBkZWYgY29udmVydF90b19pbnQodG9rcyk6CgogICAgICAgICAgICAgICAgcmV0dXJuIGludCh0b2tzWzBdKQoKCgogICAgICAgICAgICAjIHVzZSBhIHBhcnNlIGFjdGlvbiB0byB2ZXJpZnkgdGhhdCB0aGUgZGF0ZSBpcyBhIHZhbGlkIGRhdGUKCiAgICAgICAgICAgIGRlZiBpc192YWxpZF9kYXRlKGluc3RyaW5nLCBsb2MsIHRva3MpOgoKICAgICAgICAgICAgICAgIGZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGUKCiAgICAgICAgICAgICAgICB5ZWFyLCBtb250aCwgZGF5ID0gdG9rc1s6OjJdCgogICAgICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgICAgICBkYXRlKHllYXIsIG1vbnRoLCBkYXkpCgogICAgICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsb2MsIFwiaW52YWxpZCBkYXRlIGdpdmVuXCIpCgoKCiAgICAgICAgICAgIGludGVnZXIgPSBXb3JkKG51bXMpCgogICAgICAgICAgICBkYXRlX3N0ciA9IGludGVnZXIgKyAnLycgKyBpbnRlZ2VyICsgJy8nICsgaW50ZWdlcgoKCgogICAgICAgICAgICAjIGFkZCBwYXJzZSBhY3Rpb25zCgogICAgICAgICAgICBpbnRlZ2VyLnNldF9wYXJzZV9hY3Rpb24oY29udmVydF90b19pbnQpCgogICAgICAgICAgICBkYXRlX3N0ci5zZXRfcGFyc2VfYWN0aW9uKGlzX3ZhbGlkX2RhdGUpCgoKCiAgICAgICAgICAgICMgbm90ZSB0aGF0IGludGVnZXIgZmllbGRzIGFyZSBub3cgaW50cywgbm90IHN0cmluZ3MKCiAgICAgICAgICAgIGRhdGVfc3RyLnJ1bl90ZXN0cygnJycKCiAgICAgICAgICAgICAgICAjIHN1Y2Nlc3NmdWwgcGFyc2UgLSBub3RlIHRoYXQgaW50ZWdlciBmaWVsZHMgd2VyZSBjb252ZXJ0ZWQgdG8gaW50cwoKICAgICAgICAgICAgICAgIDE5OTkvMTIvMzEKCgoKICAgICAgICAgICAgICAgICMgZmFpbCAtIGludmFsaWQgZGF0ZQoKICAgICAgICAgICAgICAgIDE5OTkvMTMvMzEKCiAgICAgICAgICAgICAgICAnJycpCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpZiBsaXN0KGZucykgPT0gW05vbmVdOgoKICAgICAgICAgICAgc2VsZi5wYXJzZUFjdGlvbiA9IFtdCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBpZiBub3QgYWxsKGNhbGxhYmxlKGZuKSBmb3IgZm4gaW4gZm5zKToKCiAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoXCJwYXJzZSBhY3Rpb25zIG11c3QgYmUgY2FsbGFibGVcIikKCiAgICAgICAgICAgIHNlbGYucGFyc2VBY3Rpb24gPSBbX3RyaW1fYXJpdHkoZm4pIGZvciBmbiBpbiBmbnNdCgogICAgICAgICAgICBzZWxmLmNhbGxEdXJpbmdUcnkgPSBrd2FyZ3MuZ2V0KAoKICAgICAgICAgICAgICAgIFwiY2FsbF9kdXJpbmdfdHJ5XCIsIGt3YXJncy5nZXQoXCJjYWxsRHVyaW5nVHJ5XCIsIEZhbHNlKQoKICAgICAgICAgICAgKQoKICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgZGVmIGFkZF9wYXJzZV9hY3Rpb24oc2VsZiwgKmZuczogUGFyc2VBY3Rpb24sICoqa3dhcmdzKSAtPiBcIlBhcnNlckVsZW1lbnRcIjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIEFkZCBvbmUgb3IgbW9yZSBwYXJzZSBhY3Rpb25zIHRvIGV4cHJlc3Npb24ncyBsaXN0IG9mIHBhcnNlIGFjdGlvbnMuIFNlZSA6Y2xhc3M6YHNldF9wYXJzZV9hY3Rpb25gLgoKCgogICAgICAgIFNlZSBleGFtcGxlcyBpbiA6Y2xhc3M6YGNvcHlgLgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgc2VsZi5wYXJzZUFjdGlvbiArPSBbX3RyaW1fYXJpdHkoZm4pIGZvciBmbiBpbiBmbnNdCgogICAgICAgIHNlbGYuY2FsbER1cmluZ1RyeSA9IHNlbGYuY2FsbER1cmluZ1RyeSBvciBrd2FyZ3MuZ2V0KAoKICAgICAgICAgICAgXCJjYWxsX2R1cmluZ190cnlcIiwga3dhcmdzLmdldChcImNhbGxEdXJpbmdUcnlcIiwgRmFsc2UpCgogICAgICAgICkKCiAgICAgICAgcmV0dXJuIHNlbGYKCgoKICAgIGRlZiBhZGRfY29uZGl0aW9uKHNlbGYsICpmbnM6IFBhcnNlQ29uZGl0aW9uLCAqKmt3YXJncykgLT4gXCJQYXJzZXJFbGVtZW50XCI6CgogICAgICAgIFwiXCJcIkFkZCBhIGJvb2xlYW4gcHJlZGljYXRlIGZ1bmN0aW9uIHRvIGV4cHJlc3Npb24ncyBsaXN0IG9mIHBhcnNlIGFjdGlvbnMuIFNlZQoKICAgICAgICA6Y2xhc3M6YHNldF9wYXJzZV9hY3Rpb25gIGZvciBmdW5jdGlvbiBjYWxsIHNpZ25hdHVyZXMuIFVubGlrZSBgYHNldF9wYXJzZV9hY3Rpb25gYCwKCiAgICAgICAgZnVuY3Rpb25zIHBhc3NlZCB0byBgYGFkZF9jb25kaXRpb25gYCBuZWVkIHRvIHJldHVybiBib29sZWFuIHN1Y2Nlc3MvZmFpbCBvZiB0aGUgY29uZGl0aW9uLgoKCgogICAgICAgIE9wdGlvbmFsIGtleXdvcmQgYXJndW1lbnRzOgoKCgogICAgICAgIC0gbWVzc2FnZSA9IGRlZmluZSBhIGN1c3RvbSBtZXNzYWdlIHRvIGJlIHVzZWQgaW4gdGhlIHJhaXNlZCBleGNlcHRpb24KCiAgICAgICAgLSBmYXRhbCA9IGlmIFRydWUsIHdpbGwgcmFpc2UgUGFyc2VGYXRhbEV4Y2VwdGlvbiB0byBzdG9wIHBhcnNpbmcgaW1tZWRpYXRlbHk7IG90aGVyd2lzZSB3aWxsIHJhaXNlCgogICAgICAgICAgUGFyc2VFeGNlcHRpb24KCiAgICAgICAgLSBjYWxsX2R1cmluZ190cnkgPSBib29sZWFuIHRvIGluZGljYXRlIGlmIHRoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgZHVyaW5nIGludGVybmFsIHRyeVBhcnNlIGNhbGxzLAoKICAgICAgICAgIGRlZmF1bHQ9RmFsc2UKCgoKICAgICAgICBFeGFtcGxlOjoKCgoKICAgICAgICAgICAgaW50ZWdlciA9IFdvcmQobnVtcykuc2V0X3BhcnNlX2FjdGlvbihsYW1iZGEgdG9rczogaW50KHRva3NbMF0pKQoKICAgICAgICAgICAgeWVhcl9pbnQgPSBpbnRlZ2VyLmNvcHkoKQoKICAgICAgICAgICAgeWVhcl9pbnQuYWRkX2NvbmRpdGlvbihsYW1iZGEgdG9rczogdG9rc1swXSA+PSAyMDAwLCBtZXNzYWdlPVwiT25seSBzdXBwb3J0IHllYXJzIDIwMDAgYW5kIGxhdGVyXCIpCgogICAgICAgICAgICBkYXRlX3N0ciA9IHllYXJfaW50ICsgJy8nICsgaW50ZWdlciArICcvJyArIGludGVnZXIKCgoKICAgICAgICAgICAgcmVzdWx0ID0gZGF0ZV9zdHIucGFyc2Vfc3RyaW5nKFwiMTk5OS8xMi8zMVwiKSAgIyAtPiBFeGNlcHRpb246IE9ubHkgc3VwcG9ydCB5ZWFycyAyMDAwIGFuZCBsYXRlciAoYXQgY2hhciAwKSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAobGluZToxLCBjb2w6MSkKCiAgICAgICAgXCJcIlwiCgogICAgICAgIGZvciBmbiBpbiBmbnM6CgogICAgICAgICAgICBzZWxmLnBhcnNlQWN0aW9uLmFwcGVuZCgKCiAgICAgICAgICAgICAgICBjb25kaXRpb25fYXNfcGFyc2VfYWN0aW9uKAoKICAgICAgICAgICAgICAgICAgICBmbiwgbWVzc2FnZT1rd2FyZ3MuZ2V0KFwibWVzc2FnZVwiKSwgZmF0YWw9a3dhcmdzLmdldChcImZhdGFsXCIsIEZhbHNlKQoKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICkKCgoKICAgICAgICBzZWxmLmNhbGxEdXJpbmdUcnkgPSBzZWxmLmNhbGxEdXJpbmdUcnkgb3Iga3dhcmdzLmdldCgKCiAgICAgICAgICAgIFwiY2FsbF9kdXJpbmdfdHJ5XCIsIGt3YXJncy5nZXQoXCJjYWxsRHVyaW5nVHJ5XCIsIEZhbHNlKQoKICAgICAgICApCgogICAgICAgIHJldHVybiBzZWxmCgoKCiAgICBkZWYgc2V0X2ZhaWxfYWN0aW9uKHNlbGYsIGZuOiBQYXJzZUZhaWxBY3Rpb24pIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgRGVmaW5lIGFjdGlvbiB0byBwZXJmb3JtIGlmIHBhcnNpbmcgZmFpbHMgYXQgdGhpcyBleHByZXNzaW9uLgoKICAgICAgICBGYWlsIGFjdG9uIGZuIGlzIGEgY2FsbGFibGUgZnVuY3Rpb24gdGhhdCB0YWtlcyB0aGUgYXJndW1lbnRzCgogICAgICAgIGBgZm4ocywgbG9jLCBleHByLCBlcnIpYGAgd2hlcmU6CgoKCiAgICAgICAgLSBzID0gc3RyaW5nIGJlaW5nIHBhcnNlZAoKICAgICAgICAtIGxvYyA9IGxvY2F0aW9uIHdoZXJlIGV4cHJlc3Npb24gbWF0Y2ggd2FzIGF0dGVtcHRlZCBhbmQgZmFpbGVkCgogICAgICAgIC0gZXhwciA9IHRoZSBwYXJzZSBleHByZXNzaW9uIHRoYXQgZmFpbGVkCgogICAgICAgIC0gZXJyID0gdGhlIGV4Y2VwdGlvbiB0aHJvd24KCgoKICAgICAgICBUaGUgZnVuY3Rpb24gcmV0dXJucyBubyB2YWx1ZS4gIEl0IG1heSB0aHJvdyA6Y2xhc3M6YFBhcnNlRmF0YWxFeGNlcHRpb25gCgogICAgICAgIGlmIGl0IGlzIGRlc2lyZWQgdG8gc3RvcCBwYXJzaW5nIGltbWVkaWF0ZWx5LlwiXCJcIgoKICAgICAgICBzZWxmLmZhaWxBY3Rpb24gPSBmbgoKICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgZGVmIF9za2lwSWdub3JhYmxlcyhzZWxmLCBpbnN0cmluZywgbG9jKToKCiAgICAgICAgZXhwcnNGb3VuZCA9IFRydWUKCiAgICAgICAgd2hpbGUgZXhwcnNGb3VuZDoKCiAgICAgICAgICAgIGV4cHJzRm91bmQgPSBGYWxzZQoKICAgICAgICAgICAgZm9yIGUgaW4gc2VsZi5pZ25vcmVFeHByczoKCiAgICAgICAgICAgICAgICB0cnk6CgogICAgICAgICAgICAgICAgICAgIHdoaWxlIDE6CgogICAgICAgICAgICAgICAgICAgICAgICBsb2MsIGR1bW15ID0gZS5fcGFyc2UoaW5zdHJpbmcsIGxvYykKCiAgICAgICAgICAgICAgICAgICAgICAgIGV4cHJzRm91bmQgPSBUcnVlCgogICAgICAgICAgICAgICAgZXhjZXB0IFBhcnNlRXhjZXB0aW9uOgoKICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgIHJldHVybiBsb2MKCgoKICAgIGRlZiBwcmVQYXJzZShzZWxmLCBpbnN0cmluZywgbG9jKToKCiAgICAgICAgaWYgc2VsZi5pZ25vcmVFeHByczoKCiAgICAgICAgICAgIGxvYyA9IHNlbGYuX3NraXBJZ25vcmFibGVzKGluc3RyaW5nLCBsb2MpCgoKCiAgICAgICAgaWYgc2VsZi5za2lwV2hpdGVzcGFjZToKCiAgICAgICAgICAgIGluc3RybGVuID0gbGVuKGluc3RyaW5nKQoKICAgICAgICAgICAgd2hpdGVfY2hhcnMgPSBzZWxmLndoaXRlQ2hhcnMKCiAgICAgICAgICAgIHdoaWxlIGxvYyA8IGluc3RybGVuIGFuZCBpbnN0cmluZ1tsb2NdIGluIHdoaXRlX2NoYXJzOgoKICAgICAgICAgICAgICAgIGxvYyArPSAxCgoKCiAgICAgICAgcmV0dXJuIGxvYwoKCgogICAgZGVmIHBhcnNlSW1wbChzZWxmLCBpbnN0cmluZywgbG9jLCBkb0FjdGlvbnM9VHJ1ZSk6CgogICAgICAgIHJldHVybiBsb2MsIFtdCgoKCiAgICBkZWYgcG9zdFBhcnNlKHNlbGYsIGluc3RyaW5nLCBsb2MsIHRva2VubGlzdCk6CgogICAgICAgIHJldHVybiB0b2tlbmxpc3QKCgoKICAgICMgQHByb2ZpbGUKCiAgICBkZWYgX3BhcnNlTm9DYWNoZSgKCiAgICAgICAgc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUsIGNhbGxQcmVQYXJzZT1UcnVlCgogICAgKSAtPiBUdXBsZVtpbnQsIFBhcnNlUmVzdWx0c106CgogICAgICAgIFRSWSwgTUFUQ0gsIEZBSUwgPSAwLCAxLCAyCgogICAgICAgIGRlYnVnZ2luZyA9IHNlbGYuZGVidWcgICMgYW5kIGRvQWN0aW9ucykKCiAgICAgICAgbGVuX2luc3RyaW5nID0gbGVuKGluc3RyaW5nKQoKCgogICAgICAgIGlmIGRlYnVnZ2luZyBvciBzZWxmLmZhaWxBY3Rpb246CgogICAgICAgICAgICAjIHByaW50KFwiTWF0Y2gge30gYXQgbG9jIHt9KHt9LCB7fSlcIi5mb3JtYXQoc2VsZiwgbG9jLCBsaW5lbm8obG9jLCBpbnN0cmluZyksIGNvbChsb2MsIGluc3RyaW5nKSkpCgogICAgICAgICAgICB0cnk6CgogICAgICAgICAgICAgICAgaWYgY2FsbFByZVBhcnNlIGFuZCBzZWxmLmNhbGxQcmVwYXJzZToKCiAgICAgICAgICAgICAgICAgICAgcHJlX2xvYyA9IHNlbGYucHJlUGFyc2UoaW5zdHJpbmcsIGxvYykKCiAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICBwcmVfbG9jID0gbG9jCgogICAgICAgICAgICAgICAgdG9rZW5zX3N0YXJ0ID0gcHJlX2xvYwoKICAgICAgICAgICAgICAgIGlmIHNlbGYuZGVidWdBY3Rpb25zLmRlYnVnX3RyeToKCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kZWJ1Z0FjdGlvbnMuZGVidWdfdHJ5KGluc3RyaW5nLCB0b2tlbnNfc3RhcnQsIHNlbGYsIEZhbHNlKQoKICAgICAgICAgICAgICAgIGlmIHNlbGYubWF5SW5kZXhFcnJvciBvciBwcmVfbG9jID49IGxlbl9pbnN0cmluZzoKCiAgICAgICAgICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jLCB0b2tlbnMgPSBzZWxmLnBhcnNlSW1wbChpbnN0cmluZywgcHJlX2xvYywgZG9BY3Rpb25zKQoKICAgICAgICAgICAgICAgICAgICBleGNlcHQgSW5kZXhFcnJvcjoKCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsZW5faW5zdHJpbmcsIHNlbGYuZXJybXNnLCBzZWxmKQoKICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgIGxvYywgdG9rZW5zID0gc2VsZi5wYXJzZUltcGwoaW5zdHJpbmcsIHByZV9sb2MsIGRvQWN0aW9ucykKCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXJyOgoKICAgICAgICAgICAgICAgICMgcHJpbnQoXCJFeGNlcHRpb24gcmFpc2VkOlwiLCBlcnIpCgogICAgICAgICAgICAgICAgaWYgc2VsZi5kZWJ1Z0FjdGlvbnMuZGVidWdfZmFpbDoKCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kZWJ1Z0FjdGlvbnMuZGVidWdfZmFpbCgKCiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RyaW5nLCB0b2tlbnNfc3RhcnQsIHNlbGYsIGVyciwgRmFsc2UKCiAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGlmIHNlbGYuZmFpbEFjdGlvbjoKCiAgICAgICAgICAgICAgICAgICAgc2VsZi5mYWlsQWN0aW9uKGluc3RyaW5nLCB0b2tlbnNfc3RhcnQsIHNlbGYsIGVycikKCiAgICAgICAgICAgICAgICByYWlzZQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgaWYgY2FsbFByZVBhcnNlIGFuZCBzZWxmLmNhbGxQcmVwYXJzZToKCiAgICAgICAgICAgICAgICBwcmVfbG9jID0gc2VsZi5wcmVQYXJzZShpbnN0cmluZywgbG9jKQoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICBwcmVfbG9jID0gbG9jCgogICAgICAgICAgICB0b2tlbnNfc3RhcnQgPSBwcmVfbG9jCgogICAgICAgICAgICBpZiBzZWxmLm1heUluZGV4RXJyb3Igb3IgcHJlX2xvYyA+PSBsZW5faW5zdHJpbmc6CgogICAgICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgICAgICBsb2MsIHRva2VucyA9IHNlbGYucGFyc2VJbXBsKGluc3RyaW5nLCBwcmVfbG9jLCBkb0FjdGlvbnMpCgogICAgICAgICAgICAgICAgZXhjZXB0IEluZGV4RXJyb3I6CgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsZW5faW5zdHJpbmcsIHNlbGYuZXJybXNnLCBzZWxmKQoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICBsb2MsIHRva2VucyA9IHNlbGYucGFyc2VJbXBsKGluc3RyaW5nLCBwcmVfbG9jLCBkb0FjdGlvbnMpCgoKCiAgICAgICAgdG9rZW5zID0gc2VsZi5wb3N0UGFyc2UoaW5zdHJpbmcsIGxvYywgdG9rZW5zKQoKCgogICAgICAgIHJldF90b2tlbnMgPSBQYXJzZVJlc3VsdHMoCgogICAgICAgICAgICB0b2tlbnMsIHNlbGYucmVzdWx0c05hbWUsIGFzTGlzdD1zZWxmLnNhdmVBc0xpc3QsIG1vZGFsPXNlbGYubW9kYWxSZXN1bHRzCgogICAgICAgICkKCiAgICAgICAgaWYgc2VsZi5wYXJzZUFjdGlvbiBhbmQgKGRvQWN0aW9ucyBvciBzZWxmLmNhbGxEdXJpbmdUcnkpOgoKICAgICAgICAgICAgaWYgZGVidWdnaW5nOgoKICAgICAgICAgICAgICAgIHRyeToKCiAgICAgICAgICAgICAgICAgICAgZm9yIGZuIGluIHNlbGYucGFyc2VBY3Rpb246CgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5zID0gZm4oaW5zdHJpbmcsIHRva2Vuc19zdGFydCwgcmV0X3Rva2VucykKCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBJbmRleEVycm9yIGFzIHBhcnNlX2FjdGlvbl9leGM6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjID0gUGFyc2VFeGNlcHRpb24oXCJleGNlcHRpb24gcmFpc2VkIGluIHBhcnNlIGFjdGlvblwiKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIGV4YyBmcm9tIHBhcnNlX2FjdGlvbl9leGMKCgoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdG9rZW5zIGlzIG5vdCBOb25lIGFuZCB0b2tlbnMgaXMgbm90IHJldF90b2tlbnM6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0X3Rva2VucyA9IFBhcnNlUmVzdWx0cygKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5zLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlc3VsdHNOYW1lLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc0xpc3Q9c2VsZi5zYXZlQXNMaXN0CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBpc2luc3RhbmNlKHRva2VucywgKFBhcnNlUmVzdWx0cywgbGlzdCkpLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbD1zZWxmLm1vZGFsUmVzdWx0cywKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlcnI6CgogICAgICAgICAgICAgICAgICAgICMgcHJpbnQgXCJFeGNlcHRpb24gcmFpc2VkIGluIHVzZXIgcGFyc2UgYWN0aW9uOlwiLCBlcnIKCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5kZWJ1Z0FjdGlvbnMuZGVidWdfZmFpbDoKCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZGVidWdBY3Rpb25zLmRlYnVnX2ZhaWwoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdHJpbmcsIHRva2Vuc19zdGFydCwgc2VsZiwgZXJyLCBGYWxzZQoKICAgICAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICByYWlzZQoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICBmb3IgZm4gaW4gc2VsZi5wYXJzZUFjdGlvbjoKCiAgICAgICAgICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5zID0gZm4oaW5zdHJpbmcsIHRva2Vuc19zdGFydCwgcmV0X3Rva2VucykKCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEluZGV4RXJyb3IgYXMgcGFyc2VfYWN0aW9uX2V4YzoKCiAgICAgICAgICAgICAgICAgICAgICAgIGV4YyA9IFBhcnNlRXhjZXB0aW9uKFwiZXhjZXB0aW9uIHJhaXNlZCBpbiBwYXJzZSBhY3Rpb25cIikKCiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIGV4YyBmcm9tIHBhcnNlX2FjdGlvbl9leGMKCgoKICAgICAgICAgICAgICAgICAgICBpZiB0b2tlbnMgaXMgbm90IE5vbmUgYW5kIHRva2VucyBpcyBub3QgcmV0X3Rva2VuczoKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldF90b2tlbnMgPSBQYXJzZVJlc3VsdHMoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5zLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmVzdWx0c05hbWUsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNMaXN0PXNlbGYuc2F2ZUFzTGlzdAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBpc2luc3RhbmNlKHRva2VucywgKFBhcnNlUmVzdWx0cywgbGlzdCkpLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsPXNlbGYubW9kYWxSZXN1bHRzLAoKICAgICAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICBpZiBkZWJ1Z2dpbmc6CgogICAgICAgICAgICAjIHByaW50KFwiTWF0Y2hlZFwiLCBzZWxmLCBcIi0+XCIsIHJldF90b2tlbnMuYXNfbGlzdCgpKQoKICAgICAgICAgICAgaWYgc2VsZi5kZWJ1Z0FjdGlvbnMuZGVidWdfbWF0Y2g6CgogICAgICAgICAgICAgICAgc2VsZi5kZWJ1Z0FjdGlvbnMuZGVidWdfbWF0Y2goCgogICAgICAgICAgICAgICAgICAgIGluc3RyaW5nLCB0b2tlbnNfc3RhcnQsIGxvYywgc2VsZiwgcmV0X3Rva2VucywgRmFsc2UKCiAgICAgICAgICAgICAgICApCgoKCiAgICAgICAgcmV0dXJuIGxvYywgcmV0X3Rva2VucwoKCgogICAgZGVmIHRyeV9wYXJzZShzZWxmLCBpbnN0cmluZzogc3RyLCBsb2M6IGludCwgcmFpc2VfZmF0YWw6IGJvb2wgPSBGYWxzZSkgLT4gaW50OgoKICAgICAgICB0cnk6CgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcGFyc2UoaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPUZhbHNlKVswXQoKICAgICAgICBleGNlcHQgUGFyc2VGYXRhbEV4Y2VwdGlvbjoKCiAgICAgICAgICAgIGlmIHJhaXNlX2ZhdGFsOgoKICAgICAgICAgICAgICAgIHJhaXNlCgogICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBzZWxmLmVycm1zZywgc2VsZikKCgoKICAgIGRlZiBjYW5fcGFyc2VfbmV4dChzZWxmLCBpbnN0cmluZzogc3RyLCBsb2M6IGludCkgLT4gYm9vbDoKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgc2VsZi50cnlfcGFyc2UoaW5zdHJpbmcsIGxvYykKCiAgICAgICAgZXhjZXB0IChQYXJzZUV4Y2VwdGlvbiwgSW5kZXhFcnJvcik6CgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHJldHVybiBUcnVlCgoKCiAgICAjIGNhY2hlIGZvciBsZWZ0LXJlY3Vyc2lvbiBpbiBGb3J3YXJkIHJlZmVyZW5jZXMKCiAgICByZWN1cnNpb25fbG9jayA9IFJMb2NrKCkKCiAgICByZWN1cnNpb25fbWVtb3M6IHR5cGluZy5EaWN0WwoKICAgICAgICBUdXBsZVtpbnQsIFwiRm9yd2FyZFwiLCBib29sXSwgVHVwbGVbaW50LCBVbmlvbltQYXJzZVJlc3VsdHMsIEV4Y2VwdGlvbl1dCgogICAgXSA9IHt9CgoKCiAgICAjIGFyZ3VtZW50IGNhY2hlIGZvciBvcHRpbWl6aW5nIHJlcGVhdGVkIGNhbGxzIHdoZW4gYmFja3RyYWNraW5nIHRocm91Z2ggcmVjdXJzaXZlIGV4cHJlc3Npb25zCgogICAgcGFja3JhdF9jYWNoZSA9ICgKCiAgICAgICAge30KCiAgICApICAjIHRoaXMgaXMgc2V0IGxhdGVyIGJ5IGVuYWJsZWRfcGFja3JhdCgpOyB0aGlzIGlzIGhlcmUgc28gdGhhdCByZXNldF9jYWNoZSgpIGRvZXNuJ3QgZmFpbAoKICAgIHBhY2tyYXRfY2FjaGVfbG9jayA9IFJMb2NrKCkKCiAgICBwYWNrcmF0X2NhY2hlX3N0YXRzID0gWzAsIDBdCgoKCiAgICAjIHRoaXMgbWV0aG9kIGdldHMgcmVwZWF0ZWRseSBjYWxsZWQgZHVyaW5nIGJhY2t0cmFja2luZyB3aXRoIHRoZSBzYW1lIGFyZ3VtZW50cyAtCgogICAgIyB3ZSBjYW4gY2FjaGUgdGhlc2UgYXJndW1lbnRzIGFuZCBzYXZlIG91cnNlbHZlcyB0aGUgdHJvdWJsZSBvZiByZS1wYXJzaW5nIHRoZSBjb250YWluZWQgZXhwcmVzc2lvbgoKICAgIGRlZiBfcGFyc2VDYWNoZSgKCiAgICAgICAgc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUsIGNhbGxQcmVQYXJzZT1UcnVlCgogICAgKSAtPiBUdXBsZVtpbnQsIFBhcnNlUmVzdWx0c106CgogICAgICAgIEhJVCwgTUlTUyA9IDAsIDEKCiAgICAgICAgVFJZLCBNQVRDSCwgRkFJTCA9IDAsIDEsIDIKCiAgICAgICAgbG9va3VwID0gKHNlbGYsIGluc3RyaW5nLCBsb2MsIGNhbGxQcmVQYXJzZSwgZG9BY3Rpb25zKQoKICAgICAgICB3aXRoIFBhcnNlckVsZW1lbnQucGFja3JhdF9jYWNoZV9sb2NrOgoKICAgICAgICAgICAgY2FjaGUgPSBQYXJzZXJFbGVtZW50LnBhY2tyYXRfY2FjaGUKCiAgICAgICAgICAgIHZhbHVlID0gY2FjaGUuZ2V0KGxvb2t1cCkKCiAgICAgICAgICAgIGlmIHZhbHVlIGlzIGNhY2hlLm5vdF9pbl9jYWNoZToKCiAgICAgICAgICAgICAgICBQYXJzZXJFbGVtZW50LnBhY2tyYXRfY2FjaGVfc3RhdHNbTUlTU10gKz0gMQoKICAgICAgICAgICAgICAgIHRyeToKCiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBzZWxmLl9wYXJzZU5vQ2FjaGUoaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zLCBjYWxsUHJlUGFyc2UpCgogICAgICAgICAgICAgICAgZXhjZXB0IFBhcnNlQmFzZUV4Y2VwdGlvbiBhcyBwZToKCiAgICAgICAgICAgICAgICAgICAgIyBjYWNoZSBhIGNvcHkgb2YgdGhlIGV4Y2VwdGlvbiwgd2l0aG91dCB0aGUgdHJhY2ViYWNrCgogICAgICAgICAgICAgICAgICAgIGNhY2hlLnNldChsb29rdXAsIHBlLl9fY2xhc3NfXygqcGUuYXJncykpCgogICAgICAgICAgICAgICAgICAgIHJhaXNlCgogICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgY2FjaGUuc2V0KGxvb2t1cCwgKHZhbHVlWzBdLCB2YWx1ZVsxXS5jb3B5KCksIGxvYykpCgogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZQoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICBQYXJzZXJFbGVtZW50LnBhY2tyYXRfY2FjaGVfc3RhdHNbSElUXSArPSAxCgogICAgICAgICAgICAgICAgaWYgc2VsZi5kZWJ1ZyBhbmQgc2VsZi5kZWJ1Z0FjdGlvbnMuZGVidWdfdHJ5OgoKICAgICAgICAgICAgICAgICAgICB0cnk6CgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRlYnVnQWN0aW9ucy5kZWJ1Z190cnkoaW5zdHJpbmcsIGxvYywgc2VsZiwgY2FjaGVfaGl0PVRydWUpCgogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBUeXBlRXJyb3I6CgogICAgICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh2YWx1ZSwgRXhjZXB0aW9uKToKCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5kZWJ1ZyBhbmQgc2VsZi5kZWJ1Z0FjdGlvbnMuZGVidWdfZmFpbDoKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRlYnVnQWN0aW9ucy5kZWJ1Z19mYWlsKAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0cmluZywgbG9jLCBzZWxmLCB2YWx1ZSwgY2FjaGVfaGl0PVRydWUKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgVHlwZUVycm9yOgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgICAgICAgICAgICAgcmFpc2UgdmFsdWUKCgoKICAgICAgICAgICAgICAgIGxvY18sIHJlc3VsdCwgZW5kbG9jID0gdmFsdWVbMF0sIHZhbHVlWzFdLmNvcHkoKSwgdmFsdWVbMl0KCiAgICAgICAgICAgICAgICBpZiBzZWxmLmRlYnVnIGFuZCBzZWxmLmRlYnVnQWN0aW9ucy5kZWJ1Z19tYXRjaDoKCiAgICAgICAgICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kZWJ1Z0FjdGlvbnMuZGVidWdfbWF0Y2goCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdHJpbmcsIGxvY18sIGVuZGxvYywgc2VsZiwgcmVzdWx0LCBjYWNoZV9oaXQ9VHJ1ZQoKICAgICAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICBleGNlcHQgVHlwZUVycm9yOgoKICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwoKCgogICAgICAgICAgICAgICAgcmV0dXJuIGxvY18sIHJlc3VsdAoKCgogICAgX3BhcnNlID0gX3BhcnNlTm9DYWNoZQoKCgogICAgQHN0YXRpY21ldGhvZAoKICAgIGRlZiByZXNldF9jYWNoZSgpIC0+IE5vbmU6CgogICAgICAgIFBhcnNlckVsZW1lbnQucGFja3JhdF9jYWNoZS5jbGVhcigpCgogICAgICAgIFBhcnNlckVsZW1lbnQucGFja3JhdF9jYWNoZV9zdGF0c1s6XSA9IFswXSAqIGxlbigKCiAgICAgICAgICAgIFBhcnNlckVsZW1lbnQucGFja3JhdF9jYWNoZV9zdGF0cwoKICAgICAgICApCgogICAgICAgIFBhcnNlckVsZW1lbnQucmVjdXJzaW9uX21lbW9zLmNsZWFyKCkKCgoKICAgIF9wYWNrcmF0RW5hYmxlZCA9IEZhbHNlCgogICAgX2xlZnRfcmVjdXJzaW9uX2VuYWJsZWQgPSBGYWxzZQoKCgogICAgQHN0YXRpY21ldGhvZAoKICAgIGRlZiBkaXNhYmxlX21lbW9pemF0aW9uKCkgLT4gTm9uZToKCiAgICAgICAgXCJcIlwiCgogICAgICAgIERpc2FibGVzIGFjdGl2ZSBQYWNrcmF0IG9yIExlZnQgUmVjdXJzaW9uIHBhcnNpbmcgYW5kIHRoZWlyIG1lbW9pemF0aW9uCgoKCiAgICAgICAgVGhpcyBtZXRob2QgYWxzbyB3b3JrcyBpZiBuZWl0aGVyIFBhY2tyYXQgbm9yIExlZnQgUmVjdXJzaW9uIGFyZSBlbmFibGVkLgoKICAgICAgICBUaGlzIG1ha2VzIGl0IHNhZmUgdG8gY2FsbCBiZWZvcmUgYWN0aXZhdGluZyBQYWNrcmF0IG5vciBMZWZ0IFJlY3Vyc2lvbgoKICAgICAgICB0byBjbGVhciBhbnkgcHJldmlvdXMgc2V0dGluZ3MuCgogICAgICAgIFwiXCJcIgoKICAgICAgICBQYXJzZXJFbGVtZW50LnJlc2V0X2NhY2hlKCkKCiAgICAgICAgUGFyc2VyRWxlbWVudC5fbGVmdF9yZWN1cnNpb25fZW5hYmxlZCA9IEZhbHNlCgogICAgICAgIFBhcnNlckVsZW1lbnQuX3BhY2tyYXRFbmFibGVkID0gRmFsc2UKCiAgICAgICAgUGFyc2VyRWxlbWVudC5fcGFyc2UgPSBQYXJzZXJFbGVtZW50Ll9wYXJzZU5vQ2FjaGUKCgoKICAgIEBzdGF0aWNtZXRob2QKCiAgICBkZWYgZW5hYmxlX2xlZnRfcmVjdXJzaW9uKAoKICAgICAgICBjYWNoZV9zaXplX2xpbWl0OiB0eXBpbmcuT3B0aW9uYWxbaW50XSA9IE5vbmUsICosIGZvcmNlPUZhbHNlCgogICAgKSAtPiBOb25lOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgRW5hYmxlcyBcImJvdW5kZWQgcmVjdXJzaW9uXCIgcGFyc2luZywgd2hpY2ggYWxsb3dzIGZvciBib3RoIGRpcmVjdCBhbmQgaW5kaXJlY3QKCiAgICAgICAgbGVmdC1yZWN1cnNpb24uIER1cmluZyBwYXJzaW5nLCBsZWZ0LXJlY3Vyc2l2ZSA6Y2xhc3M6YEZvcndhcmRgIGVsZW1lbnRzIGFyZQoKICAgICAgICByZXBlYXRlZGx5IG1hdGNoZWQgd2l0aCBhIGZpeGVkIHJlY3Vyc2lvbiBkZXB0aCB0aGF0IGlzIGdyYWR1YWxseSBpbmNyZWFzZWQKCiAgICAgICAgdW50aWwgZmluZGluZyB0aGUgbG9uZ2VzdCBtYXRjaC4KCgoKICAgICAgICBFeGFtcGxlOjoKCgoKICAgICAgICAgICAgaW1wb3J0IHB5cGFyc2luZyBhcyBwcAoKICAgICAgICAgICAgcHAuUGFyc2VyRWxlbWVudC5lbmFibGVfbGVmdF9yZWN1cnNpb24oKQoKCgogICAgICAgICAgICBFID0gcHAuRm9yd2FyZChcIkVcIikKCiAgICAgICAgICAgIG51bSA9IHBwLldvcmQocHAubnVtcykKCiAgICAgICAgICAgICMgbWF0Y2ggYG51bWAsIG9yIGBudW0gJysnIG51bWAsIG9yIGBudW0gJysnIG51bSAnKycgbnVtYCwgLi4uCgogICAgICAgICAgICBFIDw8PSBFICsgJysnIC0gbnVtIHwgbnVtCgoKCiAgICAgICAgICAgIHByaW50KEUucGFyc2Vfc3RyaW5nKFwiMSsyKzNcIikpCgoKCiAgICAgICAgUmVjdXJzaW9uIHNlYXJjaCBuYXR1cmFsbHkgbWVtb2l6ZXMgbWF0Y2hlcyBvZiBgYEZvcndhcmRgYCBlbGVtZW50cyBhbmQgbWF5CgogICAgICAgIHRodXMgc2tpcCByZWV2YWx1YXRpb24gb2YgcGFyc2UgYWN0aW9ucyBkdXJpbmcgYmFja3RyYWNraW5nLiBUaGlzIG1heSBicmVhawoKICAgICAgICBwcm9ncmFtcyB3aXRoIHBhcnNlIGFjdGlvbnMgd2hpY2ggcmVseSBvbiBzdHJpY3Qgb3JkZXJpbmcgb2Ygc2lkZS1lZmZlY3RzLgoKCgogICAgICAgIFBhcmFtZXRlcnM6CgoKCiAgICAgICAgLSBjYWNoZV9zaXplX2xpbWl0IC0gKGRlZmF1bHQ9YGBOb25lYGApIC0gbWVtb2l6ZSBhdCBtb3N0IHRoaXMgbWFueQoKICAgICAgICAgIGBgRm9yd2FyZGBgIGVsZW1lbnRzIGR1cmluZyBtYXRjaGluZzsgaWYgYGBOb25lYGAgKHRoZSBkZWZhdWx0KSwKCiAgICAgICAgICBtZW1vaXplIGFsbCBgYEZvcndhcmRgYCBlbGVtZW50cy4KCgoKICAgICAgICBCb3VuZGVkIFJlY3Vyc2lvbiBwYXJzaW5nIHdvcmtzIHNpbWlsYXIgYnV0IG5vdCBpZGVudGljYWwgdG8gUGFja3JhdCBwYXJzaW5nLAoKICAgICAgICB0aHVzIHRoZSB0d28gY2Fubm90IGJlIHVzZWQgdG9nZXRoZXIuIFVzZSBgYGZvcmNlPVRydWVgYCB0byBkaXNhYmxlIGFueQoKICAgICAgICBwcmV2aW91cywgY29uZmxpY3Rpbmcgc2V0dGluZ3MuCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpZiBmb3JjZToKCiAgICAgICAgICAgIFBhcnNlckVsZW1lbnQuZGlzYWJsZV9tZW1vaXphdGlvbigpCgogICAgICAgIGVsaWYgUGFyc2VyRWxlbWVudC5fcGFja3JhdEVuYWJsZWQ6CgogICAgICAgICAgICByYWlzZSBSdW50aW1lRXJyb3IoXCJQYWNrcmF0IGFuZCBCb3VuZGVkIFJlY3Vyc2lvbiBhcmUgbm90IGNvbXBhdGlibGVcIikKCiAgICAgICAgaWYgY2FjaGVfc2l6ZV9saW1pdCBpcyBOb25lOgoKICAgICAgICAgICAgUGFyc2VyRWxlbWVudC5yZWN1cnNpb25fbWVtb3MgPSBfVW5ib3VuZGVkTWVtbygpCgogICAgICAgIGVsaWYgY2FjaGVfc2l6ZV9saW1pdCA+IDA6CgogICAgICAgICAgICBQYXJzZXJFbGVtZW50LnJlY3Vyc2lvbl9tZW1vcyA9IF9MUlVNZW1vKGNhcGFjaXR5PWNhY2hlX3NpemVfbGltaXQpCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICByYWlzZSBOb3RJbXBsZW1lbnRlZEVycm9yKFwiTWVtbyBzaXplIG9mICVzXCIgJSBjYWNoZV9zaXplX2xpbWl0KQoKICAgICAgICBQYXJzZXJFbGVtZW50Ll9sZWZ0X3JlY3Vyc2lvbl9lbmFibGVkID0gVHJ1ZQoKCgogICAgQHN0YXRpY21ldGhvZAoKICAgIGRlZiBlbmFibGVfcGFja3JhdChjYWNoZV9zaXplX2xpbWl0OiBpbnQgPSAxMjgsICosIGZvcmNlOiBib29sID0gRmFsc2UpIC0+IE5vbmU6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBFbmFibGVzIFwicGFja3JhdFwiIHBhcnNpbmcsIHdoaWNoIGFkZHMgbWVtb2l6aW5nIHRvIHRoZSBwYXJzaW5nIGxvZ2ljLgoKICAgICAgICBSZXBlYXRlZCBwYXJzZSBhdHRlbXB0cyBhdCB0aGUgc2FtZSBzdHJpbmcgbG9jYXRpb24gKHdoaWNoIGhhcHBlbnMKCiAgICAgICAgb2Z0ZW4gaW4gbWFueSBjb21wbGV4IGdyYW1tYXJzKSBjYW4gaW1tZWRpYXRlbHkgcmV0dXJuIGEgY2FjaGVkIHZhbHVlLAoKICAgICAgICBpbnN0ZWFkIG9mIHJlLWV4ZWN1dGluZyBwYXJzaW5nL3ZhbGlkYXRpbmcgY29kZS4gIE1lbW9pemluZyBpcyBkb25lIG9mCgogICAgICAgIGJvdGggdmFsaWQgcmVzdWx0cyBhbmQgcGFyc2luZyBleGNlcHRpb25zLgoKCgogICAgICAgIFBhcmFtZXRlcnM6CgoKCiAgICAgICAgLSBjYWNoZV9zaXplX2xpbWl0IC0gKGRlZmF1bHQ9IGBgMTI4YGApIC0gaWYgYW4gaW50ZWdlciB2YWx1ZSBpcyBwcm92aWRlZAoKICAgICAgICAgIHdpbGwgbGltaXQgdGhlIHNpemUgb2YgdGhlIHBhY2tyYXQgY2FjaGU7IGlmIE5vbmUgaXMgcGFzc2VkLCB0aGVuCgogICAgICAgICAgdGhlIGNhY2hlIHNpemUgd2lsbCBiZSB1bmJvdW5kZWQ7IGlmIDAgaXMgcGFzc2VkLCB0aGUgY2FjaGUgd2lsbAoKICAgICAgICAgIGJlIGVmZmVjdGl2ZWx5IGRpc2FibGVkLgoKCgogICAgICAgIFRoaXMgc3BlZWR1cCBtYXkgYnJlYWsgZXhpc3RpbmcgcHJvZ3JhbXMgdGhhdCB1c2UgcGFyc2UgYWN0aW9ucyB0aGF0CgogICAgICAgIGhhdmUgc2lkZS1lZmZlY3RzLiAgRm9yIHRoaXMgcmVhc29uLCBwYWNrcmF0IHBhcnNpbmcgaXMgZGlzYWJsZWQgd2hlbgoKICAgICAgICB5b3UgZmlyc3QgaW1wb3J0IHB5cGFyc2luZy4gIFRvIGFjdGl2YXRlIHRoZSBwYWNrcmF0IGZlYXR1cmUsIHlvdXIKCiAgICAgICAgcHJvZ3JhbSBtdXN0IGNhbGwgdGhlIGNsYXNzIG1ldGhvZCA6Y2xhc3M6YFBhcnNlckVsZW1lbnQuZW5hYmxlX3BhY2tyYXRgLgoKICAgICAgICBGb3IgYmVzdCByZXN1bHRzLCBjYWxsIGBgZW5hYmxlX3BhY2tyYXQoKWBgIGltbWVkaWF0ZWx5IGFmdGVyCgogICAgICAgIGltcG9ydGluZyBweXBhcnNpbmcuCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIGltcG9ydCBweXBhcnNpbmcKCiAgICAgICAgICAgIHB5cGFyc2luZy5QYXJzZXJFbGVtZW50LmVuYWJsZV9wYWNrcmF0KCkKCgoKICAgICAgICBQYWNrcmF0IHBhcnNpbmcgd29ya3Mgc2ltaWxhciBidXQgbm90IGlkZW50aWNhbCB0byBCb3VuZGVkIFJlY3Vyc2lvbiBwYXJzaW5nLAoKICAgICAgICB0aHVzIHRoZSB0d28gY2Fubm90IGJlIHVzZWQgdG9nZXRoZXIuIFVzZSBgYGZvcmNlPVRydWVgYCB0byBkaXNhYmxlIGFueQoKICAgICAgICBwcmV2aW91cywgY29uZmxpY3Rpbmcgc2V0dGluZ3MuCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpZiBmb3JjZToKCiAgICAgICAgICAgIFBhcnNlckVsZW1lbnQuZGlzYWJsZV9tZW1vaXphdGlvbigpCgogICAgICAgIGVsaWYgUGFyc2VyRWxlbWVudC5fbGVmdF9yZWN1cnNpb25fZW5hYmxlZDoKCiAgICAgICAgICAgIHJhaXNlIFJ1bnRpbWVFcnJvcihcIlBhY2tyYXQgYW5kIEJvdW5kZWQgUmVjdXJzaW9uIGFyZSBub3QgY29tcGF0aWJsZVwiKQoKICAgICAgICBpZiBub3QgUGFyc2VyRWxlbWVudC5fcGFja3JhdEVuYWJsZWQ6CgogICAgICAgICAgICBQYXJzZXJFbGVtZW50Ll9wYWNrcmF0RW5hYmxlZCA9IFRydWUKCiAgICAgICAgICAgIGlmIGNhY2hlX3NpemVfbGltaXQgaXMgTm9uZToKCiAgICAgICAgICAgICAgICBQYXJzZXJFbGVtZW50LnBhY2tyYXRfY2FjaGUgPSBfVW5ib3VuZGVkQ2FjaGUoKQoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICBQYXJzZXJFbGVtZW50LnBhY2tyYXRfY2FjaGUgPSBfRmlmb0NhY2hlKGNhY2hlX3NpemVfbGltaXQpCgogICAgICAgICAgICBQYXJzZXJFbGVtZW50Ll9wYXJzZSA9IFBhcnNlckVsZW1lbnQuX3BhcnNlQ2FjaGUKCgoKICAgIGRlZiBwYXJzZV9zdHJpbmcoCgogICAgICAgIHNlbGYsIGluc3RyaW5nOiBzdHIsIHBhcnNlX2FsbDogYm9vbCA9IEZhbHNlLCAqLCBwYXJzZUFsbDogYm9vbCA9IEZhbHNlCgogICAgKSAtPiBQYXJzZVJlc3VsdHM6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBQYXJzZSBhIHN0cmluZyB3aXRoIHJlc3BlY3QgdG8gdGhlIHBhcnNlciBkZWZpbml0aW9uLiBUaGlzIGZ1bmN0aW9uIGlzIGludGVuZGVkIGFzIHRoZSBwcmltYXJ5IGludGVyZmFjZSB0byB0aGUKCiAgICAgICAgY2xpZW50IGNvZGUuCgoKCiAgICAgICAgOnBhcmFtIGluc3RyaW5nOiBUaGUgaW5wdXQgc3RyaW5nIHRvIGJlIHBhcnNlZC4KCiAgICAgICAgOnBhcmFtIHBhcnNlX2FsbDogSWYgc2V0LCB0aGUgZW50aXJlIGlucHV0IHN0cmluZyBtdXN0IG1hdGNoIHRoZSBncmFtbWFyLgoKICAgICAgICA6cGFyYW0gcGFyc2VBbGw6IHJldGFpbmVkIGZvciBwcmUtUEVQOCBjb21wYXRpYmlsaXR5LCB3aWxsIGJlIHJlbW92ZWQgaW4gYSBmdXR1cmUgcmVsZWFzZS4KCiAgICAgICAgOnJhaXNlcyBQYXJzZUV4Y2VwdGlvbjogUmFpc2VkIGlmIGBgcGFyc2VfYWxsYGAgaXMgc2V0IGFuZCB0aGUgaW5wdXQgc3RyaW5nIGRvZXMgbm90IG1hdGNoIHRoZSB3aG9sZSBncmFtbWFyLgoKICAgICAgICA6cmV0dXJuczogdGhlIHBhcnNlZCBkYXRhIGFzIGEgOmNsYXNzOmBQYXJzZVJlc3VsdHNgIG9iamVjdCwgd2hpY2ggbWF5IGJlIGFjY2Vzc2VkIGFzIGEgYGxpc3RgLCBhIGBkaWN0YCwgb3IKCiAgICAgICAgICBhbiBvYmplY3Qgd2l0aCBhdHRyaWJ1dGVzIGlmIHRoZSBnaXZlbiBwYXJzZXIgaW5jbHVkZXMgcmVzdWx0cyBuYW1lcy4KCgoKICAgICAgICBJZiB0aGUgaW5wdXQgc3RyaW5nIGlzIHJlcXVpcmVkIHRvIG1hdGNoIHRoZSBlbnRpcmUgZ3JhbW1hciwgYGBwYXJzZV9hbGxgYCBmbGFnIG11c3QgYmUgc2V0IHRvIGBgVHJ1ZWBgLiBUaGlzCgogICAgICAgIGlzIGFsc28gZXF1aXZhbGVudCB0byBlbmRpbmcgdGhlIGdyYW1tYXIgd2l0aCA6Y2xhc3M6YFN0cmluZ0VuZGAoKS4KCgoKICAgICAgICBUbyByZXBvcnQgcHJvcGVyIGNvbHVtbiBudW1iZXJzLCBgYHBhcnNlX3N0cmluZ2BgIG9wZXJhdGVzIG9uIGEgY29weSBvZiB0aGUgaW5wdXQgc3RyaW5nIHdoZXJlIGFsbCB0YWJzIGFyZQoKICAgICAgICBjb252ZXJ0ZWQgdG8gc3BhY2VzICg4IHNwYWNlcyBwZXIgdGFiLCBhcyBwZXIgdGhlIGRlZmF1bHQgaW4gYGBzdHJpbmcuZXhwYW5kdGFic2BgKS4gSWYgdGhlIGlucHV0IHN0cmluZwoKICAgICAgICBjb250YWlucyB0YWJzIGFuZCB0aGUgZ3JhbW1hciB1c2VzIHBhcnNlIGFjdGlvbnMgdGhhdCB1c2UgdGhlIGBgbG9jYGAgYXJndW1lbnQgdG8gaW5kZXggaW50byB0aGUgc3RyaW5nCgogICAgICAgIGJlaW5nIHBhcnNlZCwgb25lIGNhbiBlbnN1cmUgYSBjb25zaXN0ZW50IHZpZXcgb2YgdGhlIGlucHV0IHN0cmluZyBieSBkb2luZyBvbmUgb2YgdGhlIGZvbGxvd2luZzoKCgoKICAgICAgICAtIGNhbGxpbmcgYGBwYXJzZV93aXRoX3RhYnNgYCBvbiB5b3VyIGdyYW1tYXIgYmVmb3JlIGNhbGxpbmcgYGBwYXJzZV9zdHJpbmdgYCAoc2VlIDpjbGFzczpgcGFyc2Vfd2l0aF90YWJzYCksCgogICAgICAgIC0gZGVmaW5lIHlvdXIgcGFyc2UgYWN0aW9uIHVzaW5nIHRoZSBmdWxsIGBgKHMsbG9jLHRva3MpYGAgc2lnbmF0dXJlLCBhbmQgcmVmZXJlbmNlIHRoZSBpbnB1dCBzdHJpbmcgdXNpbmcgdGhlCgogICAgICAgICAgcGFyc2UgYWN0aW9uJ3MgYGBzYGAgYXJndW1lbnQsIG9yCgogICAgICAgIC0gZXhwbGljaXRseSBleHBhbmQgdGhlIHRhYnMgaW4geW91ciBpbnB1dCBzdHJpbmcgYmVmb3JlIGNhbGxpbmcgYGBwYXJzZV9zdHJpbmdgYC4KCgoKICAgICAgICBFeGFtcGxlczoKCgoKICAgICAgICBCeSBkZWZhdWx0LCBwYXJ0aWFsIG1hdGNoZXMgYXJlIE9LLgoKCgogICAgICAgID4+PiByZXMgPSBXb3JkKCdhJykucGFyc2Vfc3RyaW5nKCdhYWFhYWJhYWEnKQoKICAgICAgICA+Pj4gcHJpbnQocmVzKQoKICAgICAgICBbJ2FhYWFhJ10KCgoKICAgICAgICBUaGUgcGFyc2luZyBiZWhhdmlvciB2YXJpZXMgYnkgdGhlIGluaGVyaXRpbmcgY2xhc3Mgb2YgdGhpcyBhYnN0cmFjdCBjbGFzcy4gUGxlYXNlIHJlZmVyIHRvIHRoZSBjaGlsZHJlbgoKICAgICAgICBkaXJlY3RseSB0byBzZWUgbW9yZSBleGFtcGxlcy4KCgoKICAgICAgICBJdCByYWlzZXMgYW4gZXhjZXB0aW9uIGlmIHBhcnNlX2FsbCBmbGFnIGlzIHNldCBhbmQgaW5zdHJpbmcgZG9lcyBub3QgbWF0Y2ggdGhlIHdob2xlIGdyYW1tYXIuCgoKCiAgICAgICAgPj4+IHJlcyA9IFdvcmQoJ2EnKS5wYXJzZV9zdHJpbmcoJ2FhYWFhYmFhYScsIHBhcnNlX2FsbD1UcnVlKQoKICAgICAgICBUcmFjZWJhY2sgKG1vc3QgcmVjZW50IGNhbGwgbGFzdCk6CgogICAgICAgIC4uLgoKICAgICAgICBweXBhcnNpbmcuUGFyc2VFeGNlcHRpb246IEV4cGVjdGVkIGVuZCBvZiB0ZXh0LCBmb3VuZCAnYicgIChhdCBjaGFyIDUpLCAobGluZToxLCBjb2w6NikKCiAgICAgICAgXCJcIlwiCgogICAgICAgIHBhcnNlQWxsID0gcGFyc2VfYWxsIG9yIHBhcnNlQWxsCgoKCiAgICAgICAgUGFyc2VyRWxlbWVudC5yZXNldF9jYWNoZSgpCgogICAgICAgIGlmIG5vdCBzZWxmLnN0cmVhbWxpbmVkOgoKICAgICAgICAgICAgc2VsZi5zdHJlYW1saW5lKCkKCiAgICAgICAgZm9yIGUgaW4gc2VsZi5pZ25vcmVFeHByczoKCiAgICAgICAgICAgIGUuc3RyZWFtbGluZSgpCgogICAgICAgIGlmIG5vdCBzZWxmLmtlZXBUYWJzOgoKICAgICAgICAgICAgaW5zdHJpbmcgPSBpbnN0cmluZy5leHBhbmR0YWJzKCkKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgbG9jLCB0b2tlbnMgPSBzZWxmLl9wYXJzZShpbnN0cmluZywgMCkKCiAgICAgICAgICAgIGlmIHBhcnNlQWxsOgoKICAgICAgICAgICAgICAgIGxvYyA9IHNlbGYucHJlUGFyc2UoaW5zdHJpbmcsIGxvYykKCiAgICAgICAgICAgICAgICBzZSA9IEVtcHR5KCkgKyBTdHJpbmdFbmQoKQoKICAgICAgICAgICAgICAgIHNlLl9wYXJzZShpbnN0cmluZywgbG9jKQoKICAgICAgICBleGNlcHQgUGFyc2VCYXNlRXhjZXB0aW9uIGFzIGV4YzoKCiAgICAgICAgICAgIGlmIFBhcnNlckVsZW1lbnQudmVyYm9zZV9zdGFja3RyYWNlOgoKICAgICAgICAgICAgICAgIHJhaXNlCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICMgY2F0Y2ggYW5kIHJlLXJhaXNlIGV4Y2VwdGlvbiBmcm9tIGhlcmUsIGNsZWFyaW5nIG91dCBweXBhcnNpbmcgaW50ZXJuYWwgc3RhY2sgdHJhY2UKCiAgICAgICAgICAgICAgICByYWlzZSBleGMud2l0aF90cmFjZWJhY2soTm9uZSkKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHJldHVybiB0b2tlbnMKCgoKICAgIGRlZiBzY2FuX3N0cmluZygKCiAgICAgICAgc2VsZiwKCiAgICAgICAgaW5zdHJpbmc6IHN0ciwKCiAgICAgICAgbWF4X21hdGNoZXM6IGludCA9IF9NQVhfSU5ULAoKICAgICAgICBvdmVybGFwOiBib29sID0gRmFsc2UsCgogICAgICAgICosCgogICAgICAgIGRlYnVnOiBib29sID0gRmFsc2UsCgogICAgICAgIG1heE1hdGNoZXM6IGludCA9IF9NQVhfSU5ULAoKICAgICkgLT4gR2VuZXJhdG9yW1R1cGxlW1BhcnNlUmVzdWx0cywgaW50LCBpbnRdLCBOb25lLCBOb25lXToKCiAgICAgICAgXCJcIlwiCgogICAgICAgIFNjYW4gdGhlIGlucHV0IHN0cmluZyBmb3IgZXhwcmVzc2lvbiBtYXRjaGVzLiAgRWFjaCBtYXRjaCB3aWxsIHJldHVybiB0aGUKCiAgICAgICAgbWF0Y2hpbmcgdG9rZW5zLCBzdGFydCBsb2NhdGlvbiwgYW5kIGVuZCBsb2NhdGlvbi4gIE1heSBiZSBjYWxsZWQgd2l0aCBvcHRpb25hbAoKICAgICAgICBgYG1heF9tYXRjaGVzYGAgYXJndW1lbnQsIHRvIGNsaXAgc2Nhbm5pbmcgYWZ0ZXIgJ24nIG1hdGNoZXMgYXJlIGZvdW5kLiAgSWYKCiAgICAgICAgYGBvdmVybGFwYGAgaXMgc3BlY2lmaWVkLCB0aGVuIG92ZXJsYXBwaW5nIG1hdGNoZXMgd2lsbCBiZSByZXBvcnRlZC4KCgoKICAgICAgICBOb3RlIHRoYXQgdGhlIHN0YXJ0IGFuZCBlbmQgbG9jYXRpb25zIGFyZSByZXBvcnRlZCByZWxhdGl2ZSB0byB0aGUgc3RyaW5nCgogICAgICAgIGJlaW5nIHBhcnNlZC4gIFNlZSA6Y2xhc3M6YHBhcnNlX3N0cmluZ2AgZm9yIG1vcmUgaW5mb3JtYXRpb24gb24gcGFyc2luZwoKICAgICAgICBzdHJpbmdzIHdpdGggZW1iZWRkZWQgdGFicy4KCgoKICAgICAgICBFeGFtcGxlOjoKCgoKICAgICAgICAgICAgc291cmNlID0gXCJzbGRqZjEyM2xzZGpqa2YzNDVzbGRramY4Nzlsa2pzZmQ5ODdcIgoKICAgICAgICAgICAgcHJpbnQoc291cmNlKQoKICAgICAgICAgICAgZm9yIHRva2Vucywgc3RhcnQsIGVuZCBpbiBXb3JkKGFscGhhcykuc2Nhbl9zdHJpbmcoc291cmNlKToKCiAgICAgICAgICAgICAgICBwcmludCgnICcqc3RhcnQgKyAnXicqKGVuZC1zdGFydCkpCgogICAgICAgICAgICAgICAgcHJpbnQoJyAnKnN0YXJ0ICsgdG9rZW5zWzBdKQoKCgogICAgICAgIHByaW50czo6CgoKCiAgICAgICAgICAgIHNsZGpmMTIzbHNkamprZjM0NXNsZGtqZjg3OWxranNmZDk4NwoKICAgICAgICAgICAgXl5eXl4KCiAgICAgICAgICAgIHNsZGpmCgogICAgICAgICAgICAgICAgICAgIF5eXl5eXl4KCiAgICAgICAgICAgICAgICAgICAgbHNkamprZgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXl5eXl5eCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbGRramYKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF5eXl5eXgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGtqc2ZkCgogICAgICAgIFwiXCJcIgoKICAgICAgICBtYXhNYXRjaGVzID0gbWluKG1heE1hdGNoZXMsIG1heF9tYXRjaGVzKQoKICAgICAgICBpZiBub3Qgc2VsZi5zdHJlYW1saW5lZDoKCiAgICAgICAgICAgIHNlbGYuc3RyZWFtbGluZSgpCgogICAgICAgIGZvciBlIGluIHNlbGYuaWdub3JlRXhwcnM6CgogICAgICAgICAgICBlLnN0cmVhbWxpbmUoKQoKCgogICAgICAgIGlmIG5vdCBzZWxmLmtlZXBUYWJzOgoKICAgICAgICAgICAgaW5zdHJpbmcgPSBzdHIoaW5zdHJpbmcpLmV4cGFuZHRhYnMoKQoKICAgICAgICBpbnN0cmxlbiA9IGxlbihpbnN0cmluZykKCiAgICAgICAgbG9jID0gMAoKICAgICAgICBwcmVwYXJzZUZuID0gc2VsZi5wcmVQYXJzZQoKICAgICAgICBwYXJzZUZuID0gc2VsZi5fcGFyc2UKCiAgICAgICAgUGFyc2VyRWxlbWVudC5yZXNldENhY2hlKCkKCiAgICAgICAgbWF0Y2hlcyA9IDAKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgd2hpbGUgbG9jIDw9IGluc3RybGVuIGFuZCBtYXRjaGVzIDwgbWF4TWF0Y2hlczoKCiAgICAgICAgICAgICAgICB0cnk6CgogICAgICAgICAgICAgICAgICAgIHByZWxvYyA9IHByZXBhcnNlRm4oaW5zdHJpbmcsIGxvYykKCiAgICAgICAgICAgICAgICAgICAgbmV4dExvYywgdG9rZW5zID0gcGFyc2VGbihpbnN0cmluZywgcHJlbG9jLCBjYWxsUHJlUGFyc2U9RmFsc2UpCgogICAgICAgICAgICAgICAgZXhjZXB0IFBhcnNlRXhjZXB0aW9uOgoKICAgICAgICAgICAgICAgICAgICBsb2MgPSBwcmVsb2MgKyAxCgogICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgaWYgbmV4dExvYyA+IGxvYzoKCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXMgKz0gMQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGVidWc6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidG9rZW5zXCI6IHRva2Vucy5hc0xpc3QoKSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3RhcnRcIjogcHJlbG9jLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJlbmRcIjogbmV4dExvYywKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgICAgIHlpZWxkIHRva2VucywgcHJlbG9jLCBuZXh0TG9jCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBvdmVybGFwOgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRsb2MgPSBwcmVwYXJzZUZuKGluc3RyaW5nLCBsb2MpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmV4dGxvYyA+IGxvYzoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jID0gbmV4dExvYwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYyArPSAxCgogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYyA9IG5leHRMb2MKCiAgICAgICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYyA9IHByZWxvYyArIDEKCiAgICAgICAgZXhjZXB0IFBhcnNlQmFzZUV4Y2VwdGlvbiBhcyBleGM6CgogICAgICAgICAgICBpZiBQYXJzZXJFbGVtZW50LnZlcmJvc2Vfc3RhY2t0cmFjZToKCiAgICAgICAgICAgICAgICByYWlzZQoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAjIGNhdGNoIGFuZCByZS1yYWlzZSBleGNlcHRpb24gZnJvbSBoZXJlLCBjbGVhcnMgb3V0IHB5cGFyc2luZyBpbnRlcm5hbCBzdGFjayB0cmFjZQoKICAgICAgICAgICAgICAgIHJhaXNlIGV4Yy53aXRoX3RyYWNlYmFjayhOb25lKQoKCgogICAgZGVmIHRyYW5zZm9ybV9zdHJpbmcoc2VsZiwgaW5zdHJpbmc6IHN0ciwgKiwgZGVidWc6IGJvb2wgPSBGYWxzZSkgLT4gc3RyOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgRXh0ZW5zaW9uIHRvIDpjbGFzczpgc2Nhbl9zdHJpbmdgLCB0byBtb2RpZnkgbWF0Y2hpbmcgdGV4dCB3aXRoIG1vZGlmaWVkIHRva2VucyB0aGF0IG1heQoKICAgICAgICBiZSByZXR1cm5lZCBmcm9tIGEgcGFyc2UgYWN0aW9uLiAgVG8gdXNlIGBgdHJhbnNmb3JtX3N0cmluZ2BgLCBkZWZpbmUgYSBncmFtbWFyIGFuZAoKICAgICAgICBhdHRhY2ggYSBwYXJzZSBhY3Rpb24gdG8gaXQgdGhhdCBtb2RpZmllcyB0aGUgcmV0dXJuZWQgdG9rZW4gbGlzdC4KCiAgICAgICAgSW52b2tpbmcgYGB0cmFuc2Zvcm1fc3RyaW5nKClgYCBvbiBhIHRhcmdldCBzdHJpbmcgd2lsbCB0aGVuIHNjYW4gZm9yIG1hdGNoZXMsCgogICAgICAgIGFuZCByZXBsYWNlIHRoZSBtYXRjaGVkIHRleHQgcGF0dGVybnMgYWNjb3JkaW5nIHRvIHRoZSBsb2dpYyBpbiB0aGUgcGFyc2UKCiAgICAgICAgYWN0aW9uLiAgYGB0cmFuc2Zvcm1fc3RyaW5nKClgYCByZXR1cm5zIHRoZSByZXN1bHRpbmcgdHJhbnNmb3JtZWQgc3RyaW5nLgoKCgogICAgICAgIEV4YW1wbGU6OgoKCgogICAgICAgICAgICB3ZCA9IFdvcmQoYWxwaGFzKQoKICAgICAgICAgICAgd2Quc2V0X3BhcnNlX2FjdGlvbihsYW1iZGEgdG9rczogdG9rc1swXS50aXRsZSgpKQoKCgogICAgICAgICAgICBwcmludCh3ZC50cmFuc2Zvcm1fc3RyaW5nKFwibm93IGlzIHRoZSB3aW50ZXIgb2Ygb3VyIGRpc2NvbnRlbnQgbWFkZSBnbG9yaW91cyBzdW1tZXIgYnkgdGhpcyBzdW4gb2YgeW9yay5cIikpCgoKCiAgICAgICAgcHJpbnRzOjoKCgoKICAgICAgICAgICAgTm93IElzIFRoZSBXaW50ZXIgT2YgT3VyIERpc2NvbnRlbnQgTWFkZSBHbG9yaW91cyBTdW1tZXIgQnkgVGhpcyBTdW4gT2YgWW9yay4KCiAgICAgICAgXCJcIlwiCgogICAgICAgIG91dDogTGlzdFtzdHJdID0gW10KCiAgICAgICAgbGFzdEUgPSAwCgogICAgICAgICMgZm9yY2UgcHJlc2VydmF0aW9uIG9mIDxUQUI+cywgdG8gbWluaW1pemUgdW53YW50ZWQgdHJhbnNmb3JtYXRpb24gb2Ygc3RyaW5nLCBhbmQgdG8KCiAgICAgICAgIyBrZWVwIHN0cmluZyBsb2NzIHN0cmFpZ2h0IGJldHdlZW4gdHJhbnNmb3JtX3N0cmluZyBhbmQgc2Nhbl9zdHJpbmcKCiAgICAgICAgc2VsZi5rZWVwVGFicyA9IFRydWUKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgZm9yIHQsIHMsIGUgaW4gc2VsZi5zY2FuX3N0cmluZyhpbnN0cmluZywgZGVidWc9ZGVidWcpOgoKICAgICAgICAgICAgICAgIG91dC5hcHBlbmQoaW5zdHJpbmdbbGFzdEU6c10pCgogICAgICAgICAgICAgICAgaWYgdDoKCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh0LCBQYXJzZVJlc3VsdHMpOgoKICAgICAgICAgICAgICAgICAgICAgICAgb3V0ICs9IHQuYXNfbGlzdCgpCgogICAgICAgICAgICAgICAgICAgIGVsaWYgaXNpbnN0YW5jZSh0LCBJdGVyYWJsZSkgYW5kIG5vdCBpc2luc3RhbmNlKHQsIHN0cl90eXBlKToKCiAgICAgICAgICAgICAgICAgICAgICAgIG91dC5leHRlbmQodCkKCiAgICAgICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgICAgIG91dC5hcHBlbmQodCkKCiAgICAgICAgICAgICAgICBsYXN0RSA9IGUKCiAgICAgICAgICAgIG91dC5hcHBlbmQoaW5zdHJpbmdbbGFzdEU6XSkKCiAgICAgICAgICAgIG91dCA9IFtvIGZvciBvIGluIG91dCBpZiBvXQoKICAgICAgICAgICAgcmV0dXJuIFwiXCIuam9pbihbc3RyKHMpIGZvciBzIGluIF9mbGF0dGVuKG91dCldKQoKICAgICAgICBleGNlcHQgUGFyc2VCYXNlRXhjZXB0aW9uIGFzIGV4YzoKCiAgICAgICAgICAgIGlmIFBhcnNlckVsZW1lbnQudmVyYm9zZV9zdGFja3RyYWNlOgoKICAgICAgICAgICAgICAgIHJhaXNlCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICMgY2F0Y2ggYW5kIHJlLXJhaXNlIGV4Y2VwdGlvbiBmcm9tIGhlcmUsIGNsZWFycyBvdXQgcHlwYXJzaW5nIGludGVybmFsIHN0YWNrIHRyYWNlCgogICAgICAgICAgICAgICAgcmFpc2UgZXhjLndpdGhfdHJhY2ViYWNrKE5vbmUpCgoKCiAgICBkZWYgc2VhcmNoX3N0cmluZygKCiAgICAgICAgc2VsZiwKCiAgICAgICAgaW5zdHJpbmc6IHN0ciwKCiAgICAgICAgbWF4X21hdGNoZXM6IGludCA9IF9NQVhfSU5ULAoKICAgICAgICAqLAoKICAgICAgICBkZWJ1ZzogYm9vbCA9IEZhbHNlLAoKICAgICAgICBtYXhNYXRjaGVzOiBpbnQgPSBfTUFYX0lOVCwKCiAgICApIC0+IFBhcnNlUmVzdWx0czoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIEFub3RoZXIgZXh0ZW5zaW9uIHRvIDpjbGFzczpgc2Nhbl9zdHJpbmdgLCBzaW1wbGlmeWluZyB0aGUgYWNjZXNzIHRvIHRoZSB0b2tlbnMgZm91bmQKCiAgICAgICAgdG8gbWF0Y2ggdGhlIGdpdmVuIHBhcnNlIGV4cHJlc3Npb24uICBNYXkgYmUgY2FsbGVkIHdpdGggb3B0aW9uYWwKCiAgICAgICAgYGBtYXhfbWF0Y2hlc2BgIGFyZ3VtZW50LCB0byBjbGlwIHNlYXJjaGluZyBhZnRlciAnbicgbWF0Y2hlcyBhcmUgZm91bmQuCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgICMgYSBjYXBpdGFsaXplZCB3b3JkIHN0YXJ0cyB3aXRoIGFuIHVwcGVyY2FzZSBsZXR0ZXIsIGZvbGxvd2VkIGJ5IHplcm8gb3IgbW9yZSBsb3dlcmNhc2UgbGV0dGVycwoKICAgICAgICAgICAgY2FwX3dvcmQgPSBXb3JkKGFscGhhcy51cHBlcigpLCBhbHBoYXMubG93ZXIoKSkKCgoKICAgICAgICAgICAgcHJpbnQoY2FwX3dvcmQuc2VhcmNoX3N0cmluZyhcIk1vcmUgdGhhbiBJcm9uLCBtb3JlIHRoYW4gTGVhZCwgbW9yZSB0aGFuIEdvbGQgSSBuZWVkIEVsZWN0cmljaXR5XCIpKQoKCgogICAgICAgICAgICAjIHRoZSBzdW0oKSBidWlsdGluIGNhbiBiZSB1c2VkIHRvIG1lcmdlIHJlc3VsdHMgaW50byBhIHNpbmdsZSBQYXJzZVJlc3VsdHMgb2JqZWN0CgogICAgICAgICAgICBwcmludChzdW0oY2FwX3dvcmQuc2VhcmNoX3N0cmluZyhcIk1vcmUgdGhhbiBJcm9uLCBtb3JlIHRoYW4gTGVhZCwgbW9yZSB0aGFuIEdvbGQgSSBuZWVkIEVsZWN0cmljaXR5XCIpKSkKCgoKICAgICAgICBwcmludHM6OgoKCgogICAgICAgICAgICBbWydNb3JlJ10sIFsnSXJvbiddLCBbJ0xlYWQnXSwgWydHb2xkJ10sIFsnSSddLCBbJ0VsZWN0cmljaXR5J11dCgogICAgICAgICAgICBbJ01vcmUnLCAnSXJvbicsICdMZWFkJywgJ0dvbGQnLCAnSScsICdFbGVjdHJpY2l0eSddCgogICAgICAgIFwiXCJcIgoKICAgICAgICBtYXhNYXRjaGVzID0gbWluKG1heE1hdGNoZXMsIG1heF9tYXRjaGVzKQoKICAgICAgICB0cnk6CgogICAgICAgICAgICByZXR1cm4gUGFyc2VSZXN1bHRzKAoKICAgICAgICAgICAgICAgIFt0IGZvciB0LCBzLCBlIGluIHNlbGYuc2Nhbl9zdHJpbmcoaW5zdHJpbmcsIG1heE1hdGNoZXMsIGRlYnVnPWRlYnVnKV0KCiAgICAgICAgICAgICkKCiAgICAgICAgZXhjZXB0IFBhcnNlQmFzZUV4Y2VwdGlvbiBhcyBleGM6CgogICAgICAgICAgICBpZiBQYXJzZXJFbGVtZW50LnZlcmJvc2Vfc3RhY2t0cmFjZToKCiAgICAgICAgICAgICAgICByYWlzZQoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAjIGNhdGNoIGFuZCByZS1yYWlzZSBleGNlcHRpb24gZnJvbSBoZXJlLCBjbGVhcnMgb3V0IHB5cGFyc2luZyBpbnRlcm5hbCBzdGFjayB0cmFjZQoKICAgICAgICAgICAgICAgIHJhaXNlIGV4Yy53aXRoX3RyYWNlYmFjayhOb25lKQoKCgogICAgZGVmIHNwbGl0KAoKICAgICAgICBzZWxmLAoKICAgICAgICBpbnN0cmluZzogc3RyLAoKICAgICAgICBtYXhzcGxpdDogaW50ID0gX01BWF9JTlQsCgogICAgICAgIGluY2x1ZGVfc2VwYXJhdG9yczogYm9vbCA9IEZhbHNlLAoKICAgICAgICAqLAoKICAgICAgICBpbmNsdWRlU2VwYXJhdG9ycz1GYWxzZSwKCiAgICApIC0+IEdlbmVyYXRvcltzdHIsIE5vbmUsIE5vbmVdOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgR2VuZXJhdG9yIG1ldGhvZCB0byBzcGxpdCBhIHN0cmluZyB1c2luZyB0aGUgZ2l2ZW4gZXhwcmVzc2lvbiBhcyBhIHNlcGFyYXRvci4KCiAgICAgICAgTWF5IGJlIGNhbGxlZCB3aXRoIG9wdGlvbmFsIGBgbWF4c3BsaXRgYCBhcmd1bWVudCwgdG8gbGltaXQgdGhlIG51bWJlciBvZiBzcGxpdHM7CgogICAgICAgIGFuZCB0aGUgb3B0aW9uYWwgYGBpbmNsdWRlX3NlcGFyYXRvcnNgYCBhcmd1bWVudCAoZGVmYXVsdD0gYGBGYWxzZWBgKSwgaWYgdGhlIHNlcGFyYXRpbmcKCiAgICAgICAgbWF0Y2hpbmcgdGV4dCBzaG91bGQgYmUgaW5jbHVkZWQgaW4gdGhlIHNwbGl0IHJlc3VsdHMuCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIHB1bmMgPSBvbmVfb2YobGlzdChcIi4sOzovLSE/XCIpKQoKICAgICAgICAgICAgcHJpbnQobGlzdChwdW5jLnNwbGl0KFwiVGhpcywgdGhpcz8sIHRoaXMgc2VudGVuY2UsIGlzIGJhZGx5IHB1bmN0dWF0ZWQhXCIpKSkKCgoKICAgICAgICBwcmludHM6OgoKCgogICAgICAgICAgICBbJ1RoaXMnLCAnIHRoaXMnLCAnJywgJyB0aGlzIHNlbnRlbmNlJywgJyBpcyBiYWRseSBwdW5jdHVhdGVkJywgJyddCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpbmNsdWRlU2VwYXJhdG9ycyA9IGluY2x1ZGVTZXBhcmF0b3JzIG9yIGluY2x1ZGVfc2VwYXJhdG9ycwoKICAgICAgICBsYXN0ID0gMAoKICAgICAgICBmb3IgdCwgcywgZSBpbiBzZWxmLnNjYW5fc3RyaW5nKGluc3RyaW5nLCBtYXhfbWF0Y2hlcz1tYXhzcGxpdCk6CgogICAgICAgICAgICB5aWVsZCBpbnN0cmluZ1tsYXN0OnNdCgogICAgICAgICAgICBpZiBpbmNsdWRlU2VwYXJhdG9yczoKCiAgICAgICAgICAgICAgICB5aWVsZCB0WzBdCgogICAgICAgICAgICBsYXN0ID0gZQoKICAgICAgICB5aWVsZCBpbnN0cmluZ1tsYXN0Ol0KCgoKICAgIGRlZiBfX2FkZF9fKHNlbGYsIG90aGVyKSAtPiBcIlBhcnNlckVsZW1lbnRcIjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIEltcGxlbWVudGF0aW9uIG9mIGBgK2BgIG9wZXJhdG9yIC0gcmV0dXJucyA6Y2xhc3M6YEFuZGAuIEFkZGluZyBzdHJpbmdzIHRvIGEgOmNsYXNzOmBQYXJzZXJFbGVtZW50YAoKICAgICAgICBjb252ZXJ0cyB0aGVtIHRvIDpjbGFzczpgTGl0ZXJhbGBzIGJ5IGRlZmF1bHQuCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIGdyZWV0ID0gV29yZChhbHBoYXMpICsgXCIsXCIgKyBXb3JkKGFscGhhcykgKyBcIiFcIgoKICAgICAgICAgICAgaGVsbG8gPSBcIkhlbGxvLCBXb3JsZCFcIgoKICAgICAgICAgICAgcHJpbnQoaGVsbG8sIFwiLT5cIiwgZ3JlZXQucGFyc2Vfc3RyaW5nKGhlbGxvKSkKCgoKICAgICAgICBwcmludHM6OgoKCgogICAgICAgICAgICBIZWxsbywgV29ybGQhIC0+IFsnSGVsbG8nLCAnLCcsICdXb3JsZCcsICchJ10KCgoKICAgICAgICBgYC4uLmBgIG1heSBiZSB1c2VkIGFzIGEgcGFyc2UgZXhwcmVzc2lvbiBhcyBhIHNob3J0IGZvcm0gb2YgOmNsYXNzOmBTa2lwVG9gLgoKCgogICAgICAgICAgICBMaXRlcmFsKCdzdGFydCcpICsgLi4uICsgTGl0ZXJhbCgnZW5kJykKCgoKICAgICAgICBpcyBlcXVpdmFsZW50IHRvOgoKCgogICAgICAgICAgICBMaXRlcmFsKCdzdGFydCcpICsgU2tpcFRvKCdlbmQnKShcIl9za2lwcGVkKlwiKSArIExpdGVyYWwoJ2VuZCcpCgoKCiAgICAgICAgTm90ZSB0aGF0IHRoZSBza2lwcGVkIHRleHQgaXMgcmV0dXJuZWQgd2l0aCAnX3NraXBwZWQnIGFzIGEgcmVzdWx0cyBuYW1lLAoKICAgICAgICBhbmQgdG8gc3VwcG9ydCBoYXZpbmcgbXVsdGlwbGUgc2tpcHMgaW4gdGhlIHNhbWUgcGFyc2VyLCB0aGUgdmFsdWUgcmV0dXJuZWQgaXMKCiAgICAgICAgYSBsaXN0IG9mIGFsbCBza2lwcGVkIHRleHQuCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpZiBvdGhlciBpcyBFbGxpcHNpczoKCiAgICAgICAgICAgIHJldHVybiBfUGVuZGluZ1NraXAoc2VsZikKCgoKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBzdHJfdHlwZSk6CgogICAgICAgICAgICBvdGhlciA9IHNlbGYuX2xpdGVyYWxTdHJpbmdDbGFzcyhvdGhlcikKCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob3RoZXIsIFBhcnNlckVsZW1lbnQpOgoKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKAoKICAgICAgICAgICAgICAgIFwiQ2Fubm90IGNvbWJpbmUgZWxlbWVudCBvZiB0eXBlIHt9IHdpdGggUGFyc2VyRWxlbWVudFwiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICAgICAgdHlwZShvdGhlcikuX19uYW1lX18KCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICApCgogICAgICAgIHJldHVybiBBbmQoW3NlbGYsIG90aGVyXSkKCgoKICAgIGRlZiBfX3JhZGRfXyhzZWxmLCBvdGhlcikgLT4gXCJQYXJzZXJFbGVtZW50XCI6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBJbXBsZW1lbnRhdGlvbiBvZiBgYCtgYCBvcGVyYXRvciB3aGVuIGxlZnQgb3BlcmFuZCBpcyBub3QgYSA6Y2xhc3M6YFBhcnNlckVsZW1lbnRgCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpZiBvdGhlciBpcyBFbGxpcHNpczoKCiAgICAgICAgICAgIHJldHVybiBTa2lwVG8oc2VsZikoXCJfc2tpcHBlZCpcIikgKyBzZWxmCgoKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgc3RyX3R5cGUpOgoKICAgICAgICAgICAgb3RoZXIgPSBzZWxmLl9saXRlcmFsU3RyaW5nQ2xhc3Mob3RoZXIpCgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG90aGVyLCBQYXJzZXJFbGVtZW50KToKCiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigKCiAgICAgICAgICAgICAgICBcIkNhbm5vdCBjb21iaW5lIGVsZW1lbnQgb2YgdHlwZSB7fSB3aXRoIFBhcnNlckVsZW1lbnRcIi5mb3JtYXQoCgogICAgICAgICAgICAgICAgICAgIHR5cGUob3RoZXIpLl9fbmFtZV9fCgogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgKQoKICAgICAgICByZXR1cm4gb3RoZXIgKyBzZWxmCgoKCiAgICBkZWYgX19zdWJfXyhzZWxmLCBvdGhlcikgLT4gXCJQYXJzZXJFbGVtZW50XCI6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBJbXBsZW1lbnRhdGlvbiBvZiBgYC1gYCBvcGVyYXRvciwgcmV0dXJucyA6Y2xhc3M6YEFuZGAgd2l0aCBlcnJvciBzdG9wCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBzdHJfdHlwZSk6CgogICAgICAgICAgICBvdGhlciA9IHNlbGYuX2xpdGVyYWxTdHJpbmdDbGFzcyhvdGhlcikKCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob3RoZXIsIFBhcnNlckVsZW1lbnQpOgoKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKAoKICAgICAgICAgICAgICAgIFwiQ2Fubm90IGNvbWJpbmUgZWxlbWVudCBvZiB0eXBlIHt9IHdpdGggUGFyc2VyRWxlbWVudFwiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICAgICAgdHlwZShvdGhlcikuX19uYW1lX18KCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICApCgogICAgICAgIHJldHVybiBzZWxmICsgQW5kLl9FcnJvclN0b3AoKSArIG90aGVyCgoKCiAgICBkZWYgX19yc3ViX18oc2VsZiwgb3RoZXIpIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgSW1wbGVtZW50YXRpb24gb2YgYGAtYGAgb3BlcmF0b3Igd2hlbiBsZWZ0IG9wZXJhbmQgaXMgbm90IGEgOmNsYXNzOmBQYXJzZXJFbGVtZW50YAoKICAgICAgICBcIlwiXCIKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgc3RyX3R5cGUpOgoKICAgICAgICAgICAgb3RoZXIgPSBzZWxmLl9saXRlcmFsU3RyaW5nQ2xhc3Mob3RoZXIpCgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG90aGVyLCBQYXJzZXJFbGVtZW50KToKCiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigKCiAgICAgICAgICAgICAgICBcIkNhbm5vdCBjb21iaW5lIGVsZW1lbnQgb2YgdHlwZSB7fSB3aXRoIFBhcnNlckVsZW1lbnRcIi5mb3JtYXQoCgogICAgICAgICAgICAgICAgICAgIHR5cGUob3RoZXIpLl9fbmFtZV9fCgogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgKQoKICAgICAgICByZXR1cm4gb3RoZXIgLSBzZWxmCgoKCiAgICBkZWYgX19tdWxfXyhzZWxmLCBvdGhlcikgLT4gXCJQYXJzZXJFbGVtZW50XCI6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBJbXBsZW1lbnRhdGlvbiBvZiBgYCpgYCBvcGVyYXRvciwgYWxsb3dzIHVzZSBvZiBgYGV4cHIgKiAzYGAgaW4gcGxhY2Ugb2YKCiAgICAgICAgYGBleHByICsgZXhwciArIGV4cHJgYC4gIEV4cHJlc3Npb25zIG1heSBhbHNvIGJlIG11bHRpcGxpZWQgYnkgYSAyLWludGVnZXIKCiAgICAgICAgdHVwbGUsIHNpbWlsYXIgdG8gYGB7bWluLCBtYXh9YGAgbXVsdGlwbGllcnMgaW4gcmVndWxhciBleHByZXNzaW9ucy4gIFR1cGxlcwoKICAgICAgICBtYXkgYWxzbyBpbmNsdWRlIGBgTm9uZWBgIGFzIGluOgoKICAgICAgICAtIGBgZXhwcioobiwgTm9uZSlgYCBvciBgYGV4cHIqKG4sIClgYCBpcyBlcXVpdmFsZW50CgogICAgICAgICAgICAgdG8gYGBleHByKm4gKyBaZXJvT3JNb3JlKGV4cHIpYGAKCiAgICAgICAgICAgICAocmVhZCBhcyBcImF0IGxlYXN0IG4gaW5zdGFuY2VzIG9mIGBgZXhwcmBgXCIpCgogICAgICAgIC0gYGBleHByKihOb25lLCBuKWBgIGlzIGVxdWl2YWxlbnQgdG8gYGBleHByKigwLCBuKWBgCgogICAgICAgICAgICAgKHJlYWQgYXMgXCIwIHRvIG4gaW5zdGFuY2VzIG9mIGBgZXhwcmBgXCIpCgogICAgICAgIC0gYGBleHByKihOb25lLCBOb25lKWBgIGlzIGVxdWl2YWxlbnQgdG8gYGBaZXJvT3JNb3JlKGV4cHIpYGAKCiAgICAgICAgLSBgYGV4cHIqKDEsIE5vbmUpYGAgaXMgZXF1aXZhbGVudCB0byBgYE9uZU9yTW9yZShleHByKWBgCgoKCiAgICAgICAgTm90ZSB0aGF0IGBgZXhwciooTm9uZSwgbilgYCBkb2VzIG5vdCByYWlzZSBhbiBleGNlcHRpb24gaWYKCiAgICAgICAgbW9yZSB0aGFuIG4gZXhwcnMgZXhpc3QgaW4gdGhlIGlucHV0IHN0cmVhbTsgdGhhdCBpcywKCiAgICAgICAgYGBleHByKihOb25lLCBuKWBgIGRvZXMgbm90IGVuZm9yY2UgYSBtYXhpbXVtIG51bWJlciBvZiBleHByCgogICAgICAgIG9jY3VycmVuY2VzLiAgSWYgdGhpcyBiZWhhdmlvciBpcyBkZXNpcmVkLCB0aGVuIHdyaXRlCgogICAgICAgIGBgZXhwciooTm9uZSwgbikgKyB+ZXhwcmBgCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpZiBvdGhlciBpcyBFbGxpcHNpczoKCiAgICAgICAgICAgIG90aGVyID0gKDAsIE5vbmUpCgogICAgICAgIGVsaWYgaXNpbnN0YW5jZShvdGhlciwgdHVwbGUpIGFuZCBvdGhlcls6MV0gPT0gKEVsbGlwc2lzLCk6CgogICAgICAgICAgICBvdGhlciA9ICgoMCwpICsgb3RoZXJbMTpdICsgKE5vbmUsKSlbOjJdCgoKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgaW50KToKCiAgICAgICAgICAgIG1pbkVsZW1lbnRzLCBvcHRFbGVtZW50cyA9IG90aGVyLCAwCgogICAgICAgIGVsaWYgaXNpbnN0YW5jZShvdGhlciwgdHVwbGUpOgoKICAgICAgICAgICAgb3RoZXIgPSB0dXBsZShvIGlmIG8gaXMgbm90IEVsbGlwc2lzIGVsc2UgTm9uZSBmb3IgbyBpbiBvdGhlcikKCiAgICAgICAgICAgIG90aGVyID0gKG90aGVyICsgKE5vbmUsIE5vbmUpKVs6Ml0KCiAgICAgICAgICAgIGlmIG90aGVyWzBdIGlzIE5vbmU6CgogICAgICAgICAgICAgICAgb3RoZXIgPSAoMCwgb3RoZXJbMV0pCgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyWzBdLCBpbnQpIGFuZCBvdGhlclsxXSBpcyBOb25lOgoKICAgICAgICAgICAgICAgIGlmIG90aGVyWzBdID09IDA6CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBaZXJvT3JNb3JlKHNlbGYpCgogICAgICAgICAgICAgICAgaWYgb3RoZXJbMF0gPT0gMToKCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE9uZU9yTW9yZShzZWxmKQoKICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmICogb3RoZXJbMF0gKyBaZXJvT3JNb3JlKHNlbGYpCgogICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2Uob3RoZXJbMF0sIGludCkgYW5kIGlzaW5zdGFuY2Uob3RoZXJbMV0sIGludCk6CgogICAgICAgICAgICAgICAgbWluRWxlbWVudHMsIG9wdEVsZW1lbnRzID0gb3RoZXIKCiAgICAgICAgICAgICAgICBvcHRFbGVtZW50cyAtPSBtaW5FbGVtZW50cwoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoCgogICAgICAgICAgICAgICAgICAgIFwiY2Fubm90IG11bHRpcGx5IFBhcnNlckVsZW1lbnQgYW5kICh7fSkgb2JqZWN0c1wiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICAgICAgICAgIFwiLFwiLmpvaW4odHlwZShpdGVtKS5fX25hbWVfXyBmb3IgaXRlbSBpbiBvdGhlcikKCiAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICkKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHJhaXNlIFR5cGVFcnJvcigKCiAgICAgICAgICAgICAgICBcImNhbm5vdCBtdWx0aXBseSBQYXJzZXJFbGVtZW50IGFuZCB7fSBvYmplY3RzXCIuZm9ybWF0KAoKICAgICAgICAgICAgICAgICAgICB0eXBlKG90aGVyKS5fX25hbWVfXwoKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICkKCgoKICAgICAgICBpZiBtaW5FbGVtZW50cyA8IDA6CgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKFwiY2Fubm90IG11bHRpcGx5IFBhcnNlckVsZW1lbnQgYnkgbmVnYXRpdmUgdmFsdWVcIikKCiAgICAgICAgaWYgb3B0RWxlbWVudHMgPCAwOgoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKCiAgICAgICAgICAgICAgICBcInNlY29uZCB0dXBsZSB2YWx1ZSBtdXN0IGJlIGdyZWF0ZXIgb3IgZXF1YWwgdG8gZmlyc3QgdHVwbGUgdmFsdWVcIgoKICAgICAgICAgICAgKQoKICAgICAgICBpZiBtaW5FbGVtZW50cyA9PSBvcHRFbGVtZW50cyA9PSAwOgoKICAgICAgICAgICAgcmV0dXJuIEFuZChbXSkKCgoKICAgICAgICBpZiBvcHRFbGVtZW50czoKCgoKICAgICAgICAgICAgZGVmIG1ha2VPcHRpb25hbExpc3Qobik6CgogICAgICAgICAgICAgICAgaWYgbiA+IDE6CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBPcHQoc2VsZiArIG1ha2VPcHRpb25hbExpc3QobiAtIDEpKQoKICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBPcHQoc2VsZikKCgoKICAgICAgICAgICAgaWYgbWluRWxlbWVudHM6CgogICAgICAgICAgICAgICAgaWYgbWluRWxlbWVudHMgPT0gMToKCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gc2VsZiArIG1ha2VPcHRpb25hbExpc3Qob3B0RWxlbWVudHMpCgogICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gQW5kKFtzZWxmXSAqIG1pbkVsZW1lbnRzKSArIG1ha2VPcHRpb25hbExpc3Qob3B0RWxlbWVudHMpCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIHJldCA9IG1ha2VPcHRpb25hbExpc3Qob3B0RWxlbWVudHMpCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBpZiBtaW5FbGVtZW50cyA9PSAxOgoKICAgICAgICAgICAgICAgIHJldCA9IHNlbGYKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgcmV0ID0gQW5kKFtzZWxmXSAqIG1pbkVsZW1lbnRzKQoKICAgICAgICByZXR1cm4gcmV0CgoKCiAgICBkZWYgX19ybXVsX18oc2VsZiwgb3RoZXIpIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICByZXR1cm4gc2VsZi5fX211bF9fKG90aGVyKQoKCgogICAgZGVmIF9fb3JfXyhzZWxmLCBvdGhlcikgLT4gXCJQYXJzZXJFbGVtZW50XCI6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBJbXBsZW1lbnRhdGlvbiBvZiBgYHxgYCBvcGVyYXRvciAtIHJldHVybnMgOmNsYXNzOmBNYXRjaEZpcnN0YAoKICAgICAgICBcIlwiXCIKCiAgICAgICAgaWYgb3RoZXIgaXMgRWxsaXBzaXM6CgogICAgICAgICAgICByZXR1cm4gX1BlbmRpbmdTa2lwKHNlbGYsIG11c3Rfc2tpcD1UcnVlKQoKCgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIHN0cl90eXBlKToKCiAgICAgICAgICAgIG90aGVyID0gc2VsZi5fbGl0ZXJhbFN0cmluZ0NsYXNzKG90aGVyKQoKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvdGhlciwgUGFyc2VyRWxlbWVudCk6CgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoCgogICAgICAgICAgICAgICAgXCJDYW5ub3QgY29tYmluZSBlbGVtZW50IG9mIHR5cGUge30gd2l0aCBQYXJzZXJFbGVtZW50XCIuZm9ybWF0KAoKICAgICAgICAgICAgICAgICAgICB0eXBlKG90aGVyKS5fX25hbWVfXwoKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICkKCiAgICAgICAgcmV0dXJuIE1hdGNoRmlyc3QoW3NlbGYsIG90aGVyXSkKCgoKICAgIGRlZiBfX3Jvcl9fKHNlbGYsIG90aGVyKSAtPiBcIlBhcnNlckVsZW1lbnRcIjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIEltcGxlbWVudGF0aW9uIG9mIGBgfGBgIG9wZXJhdG9yIHdoZW4gbGVmdCBvcGVyYW5kIGlzIG5vdCBhIDpjbGFzczpgUGFyc2VyRWxlbWVudGAKCiAgICAgICAgXCJcIlwiCgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIHN0cl90eXBlKToKCiAgICAgICAgICAgIG90aGVyID0gc2VsZi5fbGl0ZXJhbFN0cmluZ0NsYXNzKG90aGVyKQoKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvdGhlciwgUGFyc2VyRWxlbWVudCk6CgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoCgogICAgICAgICAgICAgICAgXCJDYW5ub3QgY29tYmluZSBlbGVtZW50IG9mIHR5cGUge30gd2l0aCBQYXJzZXJFbGVtZW50XCIuZm9ybWF0KAoKICAgICAgICAgICAgICAgICAgICB0eXBlKG90aGVyKS5fX25hbWVfXwoKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICkKCiAgICAgICAgcmV0dXJuIG90aGVyIHwgc2VsZgoKCgogICAgZGVmIF9feG9yX18oc2VsZiwgb3RoZXIpIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgSW1wbGVtZW50YXRpb24gb2YgYGBeYGAgb3BlcmF0b3IgLSByZXR1cm5zIDpjbGFzczpgT3JgCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBzdHJfdHlwZSk6CgogICAgICAgICAgICBvdGhlciA9IHNlbGYuX2xpdGVyYWxTdHJpbmdDbGFzcyhvdGhlcikKCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob3RoZXIsIFBhcnNlckVsZW1lbnQpOgoKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKAoKICAgICAgICAgICAgICAgIFwiQ2Fubm90IGNvbWJpbmUgZWxlbWVudCBvZiB0eXBlIHt9IHdpdGggUGFyc2VyRWxlbWVudFwiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICAgICAgdHlwZShvdGhlcikuX19uYW1lX18KCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICApCgogICAgICAgIHJldHVybiBPcihbc2VsZiwgb3RoZXJdKQoKCgogICAgZGVmIF9fcnhvcl9fKHNlbGYsIG90aGVyKSAtPiBcIlBhcnNlckVsZW1lbnRcIjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIEltcGxlbWVudGF0aW9uIG9mIGBgXmBgIG9wZXJhdG9yIHdoZW4gbGVmdCBvcGVyYW5kIGlzIG5vdCBhIDpjbGFzczpgUGFyc2VyRWxlbWVudGAKCiAgICAgICAgXCJcIlwiCgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIHN0cl90eXBlKToKCiAgICAgICAgICAgIG90aGVyID0gc2VsZi5fbGl0ZXJhbFN0cmluZ0NsYXNzKG90aGVyKQoKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvdGhlciwgUGFyc2VyRWxlbWVudCk6CgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoCgogICAgICAgICAgICAgICAgXCJDYW5ub3QgY29tYmluZSBlbGVtZW50IG9mIHR5cGUge30gd2l0aCBQYXJzZXJFbGVtZW50XCIuZm9ybWF0KAoKICAgICAgICAgICAgICAgICAgICB0eXBlKG90aGVyKS5fX25hbWVfXwoKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICkKCiAgICAgICAgcmV0dXJuIG90aGVyIF4gc2VsZgoKCgogICAgZGVmIF9fYW5kX18oc2VsZiwgb3RoZXIpIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgSW1wbGVtZW50YXRpb24gb2YgYGAmYGAgb3BlcmF0b3IgLSByZXR1cm5zIDpjbGFzczpgRWFjaGAKCiAgICAgICAgXCJcIlwiCgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIHN0cl90eXBlKToKCiAgICAgICAgICAgIG90aGVyID0gc2VsZi5fbGl0ZXJhbFN0cmluZ0NsYXNzKG90aGVyKQoKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShvdGhlciwgUGFyc2VyRWxlbWVudCk6CgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoCgogICAgICAgICAgICAgICAgXCJDYW5ub3QgY29tYmluZSBlbGVtZW50IG9mIHR5cGUge30gd2l0aCBQYXJzZXJFbGVtZW50XCIuZm9ybWF0KAoKICAgICAgICAgICAgICAgICAgICB0eXBlKG90aGVyKS5fX25hbWVfXwoKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICkKCiAgICAgICAgcmV0dXJuIEVhY2goW3NlbGYsIG90aGVyXSkKCgoKICAgIGRlZiBfX3JhbmRfXyhzZWxmLCBvdGhlcikgLT4gXCJQYXJzZXJFbGVtZW50XCI6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBJbXBsZW1lbnRhdGlvbiBvZiBgYCZgYCBvcGVyYXRvciB3aGVuIGxlZnQgb3BlcmFuZCBpcyBub3QgYSA6Y2xhc3M6YFBhcnNlckVsZW1lbnRgCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBzdHJfdHlwZSk6CgogICAgICAgICAgICBvdGhlciA9IHNlbGYuX2xpdGVyYWxTdHJpbmdDbGFzcyhvdGhlcikKCiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob3RoZXIsIFBhcnNlckVsZW1lbnQpOgoKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKAoKICAgICAgICAgICAgICAgIFwiQ2Fubm90IGNvbWJpbmUgZWxlbWVudCBvZiB0eXBlIHt9IHdpdGggUGFyc2VyRWxlbWVudFwiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICAgICAgdHlwZShvdGhlcikuX19uYW1lX18KCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICApCgogICAgICAgIHJldHVybiBvdGhlciAmIHNlbGYKCgoKICAgIGRlZiBfX2ludmVydF9fKHNlbGYpIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgSW1wbGVtZW50YXRpb24gb2YgYGB+YGAgb3BlcmF0b3IgLSByZXR1cm5zIDpjbGFzczpgTm90QW55YAoKICAgICAgICBcIlwiXCIKCiAgICAgICAgcmV0dXJuIE5vdEFueShzZWxmKQoKCgogICAgIyBkaXNhYmxlIF9faXRlcl9fIHRvIG92ZXJyaWRlIGxlZ2FjeSB1c2Ugb2Ygc2VxdWVudGlhbCBhY2Nlc3MgdG8gX19nZXRpdGVtX18gdG8KCiAgICAjIGl0ZXJhdGUgb3ZlciBhIHNlcXVlbmNlCgogICAgX19pdGVyX18gPSBOb25lCgoKCiAgICBkZWYgX19nZXRpdGVtX18oc2VsZiwga2V5KToKCiAgICAgICAgXCJcIlwiCgogICAgICAgIHVzZSBgYFtdYGAgaW5kZXhpbmcgbm90YXRpb24gYXMgYSBzaG9ydCBmb3JtIGZvciBleHByZXNzaW9uIHJlcGV0aXRpb246CgoKCiAgICAgICAgLSBgYGV4cHJbbl1gYCBpcyBlcXVpdmFsZW50IHRvIGBgZXhwcipuYGAKCiAgICAgICAgLSBgYGV4cHJbbSwgbl1gYCBpcyBlcXVpdmFsZW50IHRvIGBgZXhwcioobSwgbilgYAoKICAgICAgICAtIGBgZXhwcltuLCAuLi5dYGAgb3IgYGBleHByW24sXWBgIGlzIGVxdWl2YWxlbnQKCiAgICAgICAgICAgICB0byBgYGV4cHIqbiArIFplcm9Pck1vcmUoZXhwcilgYAoKICAgICAgICAgICAgIChyZWFkIGFzIFwiYXQgbGVhc3QgbiBpbnN0YW5jZXMgb2YgYGBleHByYGBcIikKCiAgICAgICAgLSBgYGV4cHJbLi4uLCBuXWBgIGlzIGVxdWl2YWxlbnQgdG8gYGBleHByKigwLCBuKWBgCgogICAgICAgICAgICAgKHJlYWQgYXMgXCIwIHRvIG4gaW5zdGFuY2VzIG9mIGBgZXhwcmBgXCIpCgogICAgICAgIC0gYGBleHByWy4uLl1gYCBhbmQgYGBleHByWzAsIC4uLl1gYCBhcmUgZXF1aXZhbGVudCB0byBgYFplcm9Pck1vcmUoZXhwcilgYAoKICAgICAgICAtIGBgZXhwclsxLCAuLi5dYGAgaXMgZXF1aXZhbGVudCB0byBgYE9uZU9yTW9yZShleHByKWBgCgoKCiAgICAgICAgYGBOb25lYGAgbWF5IGJlIHVzZWQgaW4gcGxhY2Ugb2YgYGAuLi5gYC4KCgoKICAgICAgICBOb3RlIHRoYXQgYGBleHByWy4uLiwgbl1gYCBhbmQgYGBleHByW20sIG5dYGBkbyBub3QgcmFpc2UgYW4gZXhjZXB0aW9uCgogICAgICAgIGlmIG1vcmUgdGhhbiBgYG5gYCBgYGV4cHJgYHMgZXhpc3QgaW4gdGhlIGlucHV0IHN0cmVhbS4gIElmIHRoaXMgYmVoYXZpb3IgaXMKCiAgICAgICAgZGVzaXJlZCwgdGhlbiB3cml0ZSBgYGV4cHJbLi4uLCBuXSArIH5leHByYGAuCgogICAgICAgIFwiXCJcIgoKCgogICAgICAgICMgY29udmVydCBzaW5nbGUgYXJnIGtleXMgdG8gdHVwbGVzCgogICAgICAgIHRyeToKCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoa2V5LCBzdHJfdHlwZSk6CgogICAgICAgICAgICAgICAga2V5ID0gKGtleSwpCgogICAgICAgICAgICBpdGVyKGtleSkKCiAgICAgICAgZXhjZXB0IFR5cGVFcnJvcjoKCiAgICAgICAgICAgIGtleSA9IChrZXksIGtleSkKCgoKICAgICAgICBpZiBsZW4oa2V5KSA+IDI6CgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoCgogICAgICAgICAgICAgICAgXCJvbmx5IDEgb3IgMiBpbmRleCBhcmd1bWVudHMgc3VwcG9ydGVkICh7fXt9KVwiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICAgICAga2V5Wzo1XSwgXCIuLi4gW3t9XVwiLmZvcm1hdChsZW4oa2V5KSkgaWYgbGVuKGtleSkgPiA1IGVsc2UgXCJcIgoKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICkKCgoKICAgICAgICAjIGNsaXAgdG8gMiBlbGVtZW50cwoKICAgICAgICByZXQgPSBzZWxmICogdHVwbGUoa2V5WzoyXSkKCiAgICAgICAgcmV0dXJuIHJldAoKCgogICAgZGVmIF9fY2FsbF9fKHNlbGYsIG5hbWU6IHN0ciA9IE5vbmUpIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgU2hvcnRjdXQgZm9yIDpjbGFzczpgc2V0X3Jlc3VsdHNfbmFtZWAsIHdpdGggYGBsaXN0X2FsbF9tYXRjaGVzPUZhbHNlYGAuCgoKCiAgICAgICAgSWYgYGBuYW1lYGAgaXMgZ2l2ZW4gd2l0aCBhIHRyYWlsaW5nIGBgJyonYGAgY2hhcmFjdGVyLCB0aGVuIGBgbGlzdF9hbGxfbWF0Y2hlc2BgIHdpbGwgYmUKCiAgICAgICAgcGFzc2VkIGFzIGBgVHJ1ZWBgLgoKCgogICAgICAgIElmIGBgbmFtZWAgaXMgb21pdHRlZCwgc2FtZSBhcyBjYWxsaW5nIDpjbGFzczpgY29weWAuCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgICMgdGhlc2UgYXJlIGVxdWl2YWxlbnQKCiAgICAgICAgICAgIHVzZXJkYXRhID0gV29yZChhbHBoYXMpLnNldF9yZXN1bHRzX25hbWUoXCJuYW1lXCIpICsgV29yZChudW1zICsgXCItXCIpLnNldF9yZXN1bHRzX25hbWUoXCJzb2NzZWNub1wiKQoKICAgICAgICAgICAgdXNlcmRhdGEgPSBXb3JkKGFscGhhcykoXCJuYW1lXCIpICsgV29yZChudW1zICsgXCItXCIpKFwic29jc2Vjbm9cIikKCiAgICAgICAgXCJcIlwiCgogICAgICAgIGlmIG5hbWUgaXMgbm90IE5vbmU6CgogICAgICAgICAgICByZXR1cm4gc2VsZi5fc2V0UmVzdWx0c05hbWUobmFtZSkKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvcHkoKQoKCgogICAgZGVmIHN1cHByZXNzKHNlbGYpIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgU3VwcHJlc3NlcyB0aGUgb3V0cHV0IG9mIHRoaXMgOmNsYXNzOmBQYXJzZXJFbGVtZW50YDsgdXNlZnVsIHRvIGtlZXAgcHVuY3R1YXRpb24gZnJvbQoKICAgICAgICBjbHV0dGVyaW5nIHVwIHJldHVybmVkIG91dHB1dC4KCiAgICAgICAgXCJcIlwiCgogICAgICAgIHJldHVybiBTdXBwcmVzcyhzZWxmKQoKCgogICAgZGVmIGlnbm9yZV93aGl0ZXNwYWNlKHNlbGYsIHJlY3Vyc2l2ZTogYm9vbCA9IFRydWUpIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgRW5hYmxlcyB0aGUgc2tpcHBpbmcgb2Ygd2hpdGVzcGFjZSBiZWZvcmUgbWF0Y2hpbmcgdGhlIGNoYXJhY3RlcnMgaW4gdGhlCgogICAgICAgIDpjbGFzczpgUGFyc2VyRWxlbWVudGAncyBkZWZpbmVkIHBhdHRlcm4uCgoKCiAgICAgICAgOnBhcmFtIHJlY3Vyc2l2ZTogSWYgYGBUcnVlYGAgKHRoZSBkZWZhdWx0KSwgYWxzbyBlbmFibGUgd2hpdGVzcGFjZSBza2lwcGluZyBpbiBjaGlsZCBlbGVtZW50cyAoaWYgYW55KQoKICAgICAgICBcIlwiXCIKCiAgICAgICAgc2VsZi5za2lwV2hpdGVzcGFjZSA9IFRydWUKCiAgICAgICAgcmV0dXJuIHNlbGYKCgoKICAgIGRlZiBsZWF2ZV93aGl0ZXNwYWNlKHNlbGYsIHJlY3Vyc2l2ZTogYm9vbCA9IFRydWUpIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgRGlzYWJsZXMgdGhlIHNraXBwaW5nIG9mIHdoaXRlc3BhY2UgYmVmb3JlIG1hdGNoaW5nIHRoZSBjaGFyYWN0ZXJzIGluIHRoZQoKICAgICAgICA6Y2xhc3M6YFBhcnNlckVsZW1lbnRgJ3MgZGVmaW5lZCBwYXR0ZXJuLiAgVGhpcyBpcyBub3JtYWxseSBvbmx5IHVzZWQgaW50ZXJuYWxseSBieQoKICAgICAgICB0aGUgcHlwYXJzaW5nIG1vZHVsZSwgYnV0IG1heSBiZSBuZWVkZWQgaW4gc29tZSB3aGl0ZXNwYWNlLXNlbnNpdGl2ZSBncmFtbWFycy4KCgoKICAgICAgICA6cGFyYW0gcmVjdXJzaXZlOiBJZiB0cnVlICh0aGUgZGVmYXVsdCksIGFsc28gZGlzYWJsZSB3aGl0ZXNwYWNlIHNraXBwaW5nIGluIGNoaWxkIGVsZW1lbnRzIChpZiBhbnkpCgogICAgICAgIFwiXCJcIgoKICAgICAgICBzZWxmLnNraXBXaGl0ZXNwYWNlID0gRmFsc2UKCiAgICAgICAgcmV0dXJuIHNlbGYKCgoKICAgIGRlZiBzZXRfd2hpdGVzcGFjZV9jaGFycygKCiAgICAgICAgc2VsZiwgY2hhcnM6IFVuaW9uW1NldFtzdHJdLCBzdHJdLCBjb3B5X2RlZmF1bHRzOiBib29sID0gRmFsc2UKCiAgICApIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgT3ZlcnJpZGVzIHRoZSBkZWZhdWx0IHdoaXRlc3BhY2UgY2hhcnMKCiAgICAgICAgXCJcIlwiCgogICAgICAgIHNlbGYuc2tpcFdoaXRlc3BhY2UgPSBUcnVlCgogICAgICAgIHNlbGYud2hpdGVDaGFycyA9IHNldChjaGFycykKCiAgICAgICAgc2VsZi5jb3B5RGVmYXVsdFdoaXRlQ2hhcnMgPSBjb3B5X2RlZmF1bHRzCgogICAgICAgIHJldHVybiBzZWxmCgoKCiAgICBkZWYgcGFyc2Vfd2l0aF90YWJzKHNlbGYpIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgT3ZlcnJpZGVzIGRlZmF1bHQgYmVoYXZpb3IgdG8gZXhwYW5kIGBgPFRBQj5gYCBzIHRvIHNwYWNlcyBiZWZvcmUgcGFyc2luZyB0aGUgaW5wdXQgc3RyaW5nLgoKICAgICAgICBNdXN0IGJlIGNhbGxlZCBiZWZvcmUgYGBwYXJzZV9zdHJpbmdgYCB3aGVuIHRoZSBpbnB1dCBncmFtbWFyIGNvbnRhaW5zIGVsZW1lbnRzIHRoYXQKCiAgICAgICAgbWF0Y2ggYGA8VEFCPmBgIGNoYXJhY3RlcnMuCgogICAgICAgIFwiXCJcIgoKICAgICAgICBzZWxmLmtlZXBUYWJzID0gVHJ1ZQoKICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgZGVmIGlnbm9yZShzZWxmLCBvdGhlcjogXCJQYXJzZXJFbGVtZW50XCIpIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgRGVmaW5lIGV4cHJlc3Npb24gdG8gYmUgaWdub3JlZCAoZS5nLiwgY29tbWVudHMpIHdoaWxlIGRvaW5nIHBhdHRlcm4KCiAgICAgICAgbWF0Y2hpbmc7IG1heSBiZSBjYWxsZWQgcmVwZWF0ZWRseSwgdG8gZGVmaW5lIG11bHRpcGxlIGNvbW1lbnQgb3Igb3RoZXIKCiAgICAgICAgaWdub3JhYmxlIHBhdHRlcm5zLgoKCgogICAgICAgIEV4YW1wbGU6OgoKCgogICAgICAgICAgICBwYXR0ID0gV29yZChhbHBoYXMpWzEsIC4uLl0KCiAgICAgICAgICAgIHBhdHQucGFyc2Vfc3RyaW5nKCdhYmxhaiAvKiBjb21tZW50ICovIGxza2pkJykKCiAgICAgICAgICAgICMgLT4gWydhYmxhaiddCgoKCiAgICAgICAgICAgIHBhdHQuaWdub3JlKGNfc3R5bGVfY29tbWVudCkKCiAgICAgICAgICAgIHBhdHQucGFyc2Vfc3RyaW5nKCdhYmxhaiAvKiBjb21tZW50ICovIGxza2pkJykKCiAgICAgICAgICAgICMgLT4gWydhYmxhaicsICdsc2tqZCddCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpbXBvcnQgdHlwaW5nCgoKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgc3RyX3R5cGUpOgoKICAgICAgICAgICAgb3RoZXIgPSBTdXBwcmVzcyhvdGhlcikKCgoKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBTdXBwcmVzcyk6CgogICAgICAgICAgICBpZiBvdGhlciBub3QgaW4gc2VsZi5pZ25vcmVFeHByczoKCiAgICAgICAgICAgICAgICBzZWxmLmlnbm9yZUV4cHJzLmFwcGVuZChvdGhlcikKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHNlbGYuaWdub3JlRXhwcnMuYXBwZW5kKFN1cHByZXNzKG90aGVyLmNvcHkoKSkpCgogICAgICAgIHJldHVybiBzZWxmCgoKCiAgICBkZWYgc2V0X2RlYnVnX2FjdGlvbnMoCgogICAgICAgIHNlbGYsCgogICAgICAgIHN0YXJ0X2FjdGlvbjogRGVidWdTdGFydEFjdGlvbiwKCiAgICAgICAgc3VjY2Vzc19hY3Rpb246IERlYnVnU3VjY2Vzc0FjdGlvbiwKCiAgICAgICAgZXhjZXB0aW9uX2FjdGlvbjogRGVidWdFeGNlcHRpb25BY3Rpb24sCgogICAgKSAtPiBcIlBhcnNlckVsZW1lbnRcIjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIEN1c3RvbWl6ZSBkaXNwbGF5IG9mIGRlYnVnZ2luZyBtZXNzYWdlcyB3aGlsZSBkb2luZyBwYXR0ZXJuIG1hdGNoaW5nOgoKCgogICAgICAgIC0gYGBzdGFydF9hY3Rpb25gYCAtIG1ldGhvZCB0byBiZSBjYWxsZWQgd2hlbiBhbiBleHByZXNzaW9uIGlzIGFib3V0IHRvIGJlIHBhcnNlZDsKCiAgICAgICAgICBzaG91bGQgaGF2ZSB0aGUgc2lnbmF0dXJlIGBgZm4oaW5wdXRfc3RyaW5nOiBzdHIsIGxvY2F0aW9uOiBpbnQsIGV4cHJlc3Npb246IFBhcnNlckVsZW1lbnQsIGNhY2hlX2hpdDogYm9vbClgYAoKCgogICAgICAgIC0gYGBzdWNjZXNzX2FjdGlvbmBgIC0gbWV0aG9kIHRvIGJlIGNhbGxlZCB3aGVuIGFuIGV4cHJlc3Npb24gaGFzIHN1Y2Nlc3NmdWxseSBwYXJzZWQ7CgogICAgICAgICAgc2hvdWxkIGhhdmUgdGhlIHNpZ25hdHVyZSBgYGZuKGlucHV0X3N0cmluZzogc3RyLCBzdGFydF9sb2NhdGlvbjogaW50LCBlbmRfbG9jYXRpb246IGludCwgZXhwcmVzc2lvbjogUGFyc2VyRUxlbWVudCwgcGFyc2VkX3Rva2VuczogUGFyc2VSZXN1bHRzLCBjYWNoZV9oaXQ6IGJvb2wpYGAKCgoKICAgICAgICAtIGBgZXhjZXB0aW9uX2FjdGlvbmBgIC0gbWV0aG9kIHRvIGJlIGNhbGxlZCB3aGVuIGV4cHJlc3Npb24gZmFpbHMgdG8gcGFyc2U7CgogICAgICAgICAgc2hvdWxkIGhhdmUgdGhlIHNpZ25hdHVyZSBgYGZuKGlucHV0X3N0cmluZzogc3RyLCBsb2NhdGlvbjogaW50LCBleHByZXNzaW9uOiBQYXJzZXJFbGVtZW50LCBleGNlcHRpb246IEV4Y2VwdGlvbiwgY2FjaGVfaGl0OiBib29sKWBgCgogICAgICAgIFwiXCJcIgoKICAgICAgICBzZWxmLmRlYnVnQWN0aW9ucyA9IHNlbGYuRGVidWdBY3Rpb25zKAoKICAgICAgICAgICAgc3RhcnRfYWN0aW9uIG9yIF9kZWZhdWx0X3N0YXJ0X2RlYnVnX2FjdGlvbiwKCiAgICAgICAgICAgIHN1Y2Nlc3NfYWN0aW9uIG9yIF9kZWZhdWx0X3N1Y2Nlc3NfZGVidWdfYWN0aW9uLAoKICAgICAgICAgICAgZXhjZXB0aW9uX2FjdGlvbiBvciBfZGVmYXVsdF9leGNlcHRpb25fZGVidWdfYWN0aW9uLAoKICAgICAgICApCgogICAgICAgIHNlbGYuZGVidWcgPSBUcnVlCgogICAgICAgIHJldHVybiBzZWxmCgoKCiAgICBkZWYgc2V0X2RlYnVnKHNlbGYsIGZsYWc6IGJvb2wgPSBUcnVlKSAtPiBcIlBhcnNlckVsZW1lbnRcIjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIEVuYWJsZSBkaXNwbGF5IG9mIGRlYnVnZ2luZyBtZXNzYWdlcyB3aGlsZSBkb2luZyBwYXR0ZXJuIG1hdGNoaW5nLgoKICAgICAgICBTZXQgYGBmbGFnYGAgdG8gYGBUcnVlYGAgdG8gZW5hYmxlLCBgYEZhbHNlYGAgdG8gZGlzYWJsZS4KCgoKICAgICAgICBFeGFtcGxlOjoKCgoKICAgICAgICAgICAgd2QgPSBXb3JkKGFscGhhcykuc2V0X25hbWUoXCJhbHBoYXdvcmRcIikKCiAgICAgICAgICAgIGludGVnZXIgPSBXb3JkKG51bXMpLnNldF9uYW1lKFwibnVtd29yZFwiKQoKICAgICAgICAgICAgdGVybSA9IHdkIHwgaW50ZWdlcgoKCgogICAgICAgICAgICAjIHR1cm4gb24gZGVidWdnaW5nIGZvciB3ZAoKICAgICAgICAgICAgd2Quc2V0X2RlYnVnKCkKCgoKICAgICAgICAgICAgdGVybVsxLCAuLi5dLnBhcnNlX3N0cmluZyhcImFiYyAxMjMgeHl6IDg5MFwiKQoKCgogICAgICAgIHByaW50czo6CgoKCiAgICAgICAgICAgIE1hdGNoIGFscGhhd29yZCBhdCBsb2MgMCgxLDEpCgogICAgICAgICAgICBNYXRjaGVkIGFscGhhd29yZCAtPiBbJ2FiYyddCgogICAgICAgICAgICBNYXRjaCBhbHBoYXdvcmQgYXQgbG9jIDMoMSw0KQoKICAgICAgICAgICAgRXhjZXB0aW9uIHJhaXNlZDpFeHBlY3RlZCBhbHBoYXdvcmQgKGF0IGNoYXIgNCksIChsaW5lOjEsIGNvbDo1KQoKICAgICAgICAgICAgTWF0Y2ggYWxwaGF3b3JkIGF0IGxvYyA3KDEsOCkKCiAgICAgICAgICAgIE1hdGNoZWQgYWxwaGF3b3JkIC0+IFsneHl6J10KCiAgICAgICAgICAgIE1hdGNoIGFscGhhd29yZCBhdCBsb2MgMTEoMSwxMikKCiAgICAgICAgICAgIEV4Y2VwdGlvbiByYWlzZWQ6RXhwZWN0ZWQgYWxwaGF3b3JkIChhdCBjaGFyIDEyKSwgKGxpbmU6MSwgY29sOjEzKQoKICAgICAgICAgICAgTWF0Y2ggYWxwaGF3b3JkIGF0IGxvYyAxNSgxLDE2KQoKICAgICAgICAgICAgRXhjZXB0aW9uIHJhaXNlZDpFeHBlY3RlZCBhbHBoYXdvcmQgKGF0IGNoYXIgMTUpLCAobGluZToxLCBjb2w6MTYpCgoKCiAgICAgICAgVGhlIG91dHB1dCBzaG93biBpcyB0aGF0IHByb2R1Y2VkIGJ5IHRoZSBkZWZhdWx0IGRlYnVnIGFjdGlvbnMgLSBjdXN0b20gZGVidWcgYWN0aW9ucyBjYW4gYmUKCiAgICAgICAgc3BlY2lmaWVkIHVzaW5nIDpjbGFzczpgc2V0X2RlYnVnX2FjdGlvbnNgLiBQcmlvciB0byBhdHRlbXB0aW5nCgogICAgICAgIHRvIG1hdGNoIHRoZSBgYHdkYGAgZXhwcmVzc2lvbiwgdGhlIGRlYnVnZ2luZyBtZXNzYWdlIGBgXCJNYXRjaCA8ZXhwcm5hbWU+IGF0IGxvYyA8bj4oPGxpbmU+LDxjb2w+KVwiYGAKCiAgICAgICAgaXMgc2hvd24uIFRoZW4gaWYgdGhlIHBhcnNlIHN1Y2NlZWRzLCBhIGBgXCJNYXRjaGVkXCJgYCBtZXNzYWdlIGlzIHNob3duLCBvciBhbiBgYFwiRXhjZXB0aW9uIHJhaXNlZFwiYGAKCiAgICAgICAgbWVzc2FnZSBpcyBzaG93bi4gQWxzbyBub3RlIHRoZSB1c2Ugb2YgOmNsYXNzOmBzZXRfbmFtZWAgdG8gYXNzaWduIGEgaHVtYW4tcmVhZGFibGUgbmFtZSB0byB0aGUgZXhwcmVzc2lvbiwKCiAgICAgICAgd2hpY2ggbWFrZXMgZGVidWdnaW5nIGFuZCBleGNlcHRpb24gbWVzc2FnZXMgZWFzaWVyIHRvIHVuZGVyc3RhbmQgLSBmb3IgaW5zdGFuY2UsIHRoZSBkZWZhdWx0CgogICAgICAgIG5hbWUgY3JlYXRlZCBmb3IgdGhlIDpjbGFzczpgV29yZGAgZXhwcmVzc2lvbiB3aXRob3V0IGNhbGxpbmcgYGBzZXRfbmFtZWBgIGlzIGBgXCJXOihBLVphLXopXCJgYC4KCiAgICAgICAgXCJcIlwiCgogICAgICAgIGlmIGZsYWc6CgogICAgICAgICAgICBzZWxmLnNldF9kZWJ1Z19hY3Rpb25zKAoKICAgICAgICAgICAgICAgIF9kZWZhdWx0X3N0YXJ0X2RlYnVnX2FjdGlvbiwKCiAgICAgICAgICAgICAgICBfZGVmYXVsdF9zdWNjZXNzX2RlYnVnX2FjdGlvbiwKCiAgICAgICAgICAgICAgICBfZGVmYXVsdF9leGNlcHRpb25fZGVidWdfYWN0aW9uLAoKICAgICAgICAgICAgKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgc2VsZi5kZWJ1ZyA9IEZhbHNlCgogICAgICAgIHJldHVybiBzZWxmCgoKCiAgICBAcHJvcGVydHkKCiAgICBkZWYgZGVmYXVsdF9uYW1lKHNlbGYpIC0+IHN0cjoKCiAgICAgICAgaWYgc2VsZi5fZGVmYXVsdE5hbWUgaXMgTm9uZToKCiAgICAgICAgICAgIHNlbGYuX2RlZmF1bHROYW1lID0gc2VsZi5fZ2VuZXJhdGVEZWZhdWx0TmFtZSgpCgogICAgICAgIHJldHVybiBzZWxmLl9kZWZhdWx0TmFtZQoKCgogICAgQGFic3RyYWN0bWV0aG9kCgogICAgZGVmIF9nZW5lcmF0ZURlZmF1bHROYW1lKHNlbGYpOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgQ2hpbGQgY2xhc3NlcyBtdXN0IGRlZmluZSB0aGlzIG1ldGhvZCwgd2hpY2ggZGVmaW5lcyBob3cgdGhlIGBgZGVmYXVsdF9uYW1lYGAgaXMgc2V0LgoKICAgICAgICBcIlwiXCIKCgoKICAgIGRlZiBzZXRfbmFtZShzZWxmLCBuYW1lOiBzdHIpIC0+IFwiUGFyc2VyRWxlbWVudFwiOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgRGVmaW5lIG5hbWUgZm9yIHRoaXMgZXhwcmVzc2lvbiwgbWFrZXMgZGVidWdnaW5nIGFuZCBleGNlcHRpb24gbWVzc2FnZXMgY2xlYXJlci4KCiAgICAgICAgRXhhbXBsZTo6CgogICAgICAgICAgICBXb3JkKG51bXMpLnBhcnNlX3N0cmluZyhcIkFCQ1wiKSAgIyAtPiBFeGNlcHRpb246IEV4cGVjdGVkIFc6KDAtOSkgKGF0IGNoYXIgMCksIChsaW5lOjEsIGNvbDoxKQoKICAgICAgICAgICAgV29yZChudW1zKS5zZXRfbmFtZShcImludGVnZXJcIikucGFyc2Vfc3RyaW5nKFwiQUJDXCIpICAjIC0+IEV4Y2VwdGlvbjogRXhwZWN0ZWQgaW50ZWdlciAoYXQgY2hhciAwKSwgKGxpbmU6MSwgY29sOjEpCgogICAgICAgIFwiXCJcIgoKICAgICAgICBzZWxmLmN1c3RvbU5hbWUgPSBuYW1lCgogICAgICAgIHNlbGYuZXJybXNnID0gXCJFeHBlY3RlZCBcIiArIHNlbGYubmFtZQoKICAgICAgICBpZiBfX2RpYWdfXy5lbmFibGVfZGVidWdfb25fbmFtZWRfZXhwcmVzc2lvbnM6CgogICAgICAgICAgICBzZWxmLnNldF9kZWJ1ZygpCgogICAgICAgIHJldHVybiBzZWxmCgoKCiAgICBAcHJvcGVydHkKCiAgICBkZWYgbmFtZShzZWxmKSAtPiBzdHI6CgogICAgICAgICMgVGhpcyB3aWxsIHVzZSBhIHVzZXItZGVmaW5lZCBuYW1lIGlmIGF2YWlsYWJsZSwgYnV0IG90aGVyd2lzZSBkZWZhdWx0cyBiYWNrIHRvIHRoZSBhdXRvLWdlbmVyYXRlZCBuYW1lCgogICAgICAgIHJldHVybiBzZWxmLmN1c3RvbU5hbWUgaWYgc2VsZi5jdXN0b21OYW1lIGlzIG5vdCBOb25lIGVsc2Ugc2VsZi5kZWZhdWx0X25hbWUKCgoKICAgIGRlZiBfX3N0cl9fKHNlbGYpIC0+IHN0cjoKCiAgICAgICAgcmV0dXJuIHNlbGYubmFtZQoKCgogICAgZGVmIF9fcmVwcl9fKHNlbGYpIC0+IHN0cjoKCiAgICAgICAgcmV0dXJuIHN0cihzZWxmKQoKCgogICAgZGVmIHN0cmVhbWxpbmUoc2VsZikgLT4gXCJQYXJzZXJFbGVtZW50XCI6CgogICAgICAgIHNlbGYuc3RyZWFtbGluZWQgPSBUcnVlCgogICAgICAgIHNlbGYuX2RlZmF1bHROYW1lID0gTm9uZQoKICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgZGVmIHJlY3Vyc2Uoc2VsZikgLT4gU2VxdWVuY2VbXCJQYXJzZXJFbGVtZW50XCJdOgoKICAgICAgICByZXR1cm4gW10KCgoKICAgIGRlZiBfY2hlY2tSZWN1cnNpb24oc2VsZiwgcGFyc2VFbGVtZW50TGlzdCk6CgogICAgICAgIHN1YlJlY0NoZWNrTGlzdCA9IHBhcnNlRWxlbWVudExpc3RbOl0gKyBbc2VsZl0KCiAgICAgICAgZm9yIGUgaW4gc2VsZi5yZWN1cnNlKCk6CgogICAgICAgICAgICBlLl9jaGVja1JlY3Vyc2lvbihzdWJSZWNDaGVja0xpc3QpCgoKCiAgICBkZWYgdmFsaWRhdGUoc2VsZiwgdmFsaWRhdGVUcmFjZT1Ob25lKSAtPiBOb25lOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgQ2hlY2sgZGVmaW5lZCBleHByZXNzaW9ucyBmb3IgdmFsaWQgc3RydWN0dXJlLCBjaGVjayBmb3IgaW5maW5pdGUgcmVjdXJzaXZlIGRlZmluaXRpb25zLgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgc2VsZi5fY2hlY2tSZWN1cnNpb24oW10pCgoKCiAgICBkZWYgcGFyc2VfZmlsZSgKCiAgICAgICAgc2VsZiwKCiAgICAgICAgZmlsZV9vcl9maWxlbmFtZTogVW5pb25bc3RyLCBQYXRoLCBUZXh0SU9dLAoKICAgICAgICBlbmNvZGluZzogc3RyID0gXCJ1dGYtOFwiLAoKICAgICAgICBwYXJzZV9hbGw6IGJvb2wgPSBGYWxzZSwKCiAgICAgICAgKiwKCiAgICAgICAgcGFyc2VBbGw6IGJvb2wgPSBGYWxzZSwKCiAgICApIC0+IFBhcnNlUmVzdWx0czoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIEV4ZWN1dGUgdGhlIHBhcnNlIGV4cHJlc3Npb24gb24gdGhlIGdpdmVuIGZpbGUgb3IgZmlsZW5hbWUuCgogICAgICAgIElmIGEgZmlsZW5hbWUgaXMgc3BlY2lmaWVkIChpbnN0ZWFkIG9mIGEgZmlsZSBvYmplY3QpLAoKICAgICAgICB0aGUgZW50aXJlIGZpbGUgaXMgb3BlbmVkLCByZWFkLCBhbmQgY2xvc2VkIGJlZm9yZSBwYXJzaW5nLgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgcGFyc2VBbGwgPSBwYXJzZUFsbCBvciBwYXJzZV9hbGwKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgZmlsZV9jb250ZW50cyA9IGZpbGVfb3JfZmlsZW5hbWUucmVhZCgpCgogICAgICAgIGV4Y2VwdCBBdHRyaWJ1dGVFcnJvcjoKCiAgICAgICAgICAgIHdpdGggb3BlbihmaWxlX29yX2ZpbGVuYW1lLCBcInJcIiwgZW5jb2Rpbmc9ZW5jb2RpbmcpIGFzIGY6CgogICAgICAgICAgICAgICAgZmlsZV9jb250ZW50cyA9IGYucmVhZCgpCgogICAgICAgIHRyeToKCiAgICAgICAgICAgIHJldHVybiBzZWxmLnBhcnNlX3N0cmluZyhmaWxlX2NvbnRlbnRzLCBwYXJzZUFsbCkKCiAgICAgICAgZXhjZXB0IFBhcnNlQmFzZUV4Y2VwdGlvbiBhcyBleGM6CgogICAgICAgICAgICBpZiBQYXJzZXJFbGVtZW50LnZlcmJvc2Vfc3RhY2t0cmFjZToKCiAgICAgICAgICAgICAgICByYWlzZQoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAjIGNhdGNoIGFuZCByZS1yYWlzZSBleGNlcHRpb24gZnJvbSBoZXJlLCBjbGVhcnMgb3V0IHB5cGFyc2luZyBpbnRlcm5hbCBzdGFjayB0cmFjZQoKICAgICAgICAgICAgICAgIHJhaXNlIGV4Yy53aXRoX3RyYWNlYmFjayhOb25lKQoKCgogICAgZGVmIF9fZXFfXyhzZWxmLCBvdGhlcik6CgogICAgICAgIGlmIHNlbGYgaXMgb3RoZXI6CgogICAgICAgICAgICByZXR1cm4gVHJ1ZQoKICAgICAgICBlbGlmIGlzaW5zdGFuY2Uob3RoZXIsIHN0cl90eXBlKToKCiAgICAgICAgICAgIHJldHVybiBzZWxmLm1hdGNoZXMob3RoZXIsIHBhcnNlX2FsbD1UcnVlKQoKICAgICAgICBlbGlmIGlzaW5zdGFuY2Uob3RoZXIsIFBhcnNlckVsZW1lbnQpOgoKICAgICAgICAgICAgcmV0dXJuIHZhcnMoc2VsZikgPT0gdmFycyhvdGhlcikKCiAgICAgICAgcmV0dXJuIEZhbHNlCgoKCiAgICBkZWYgX19oYXNoX18oc2VsZik6CgogICAgICAgIHJldHVybiBpZChzZWxmKQoKCgogICAgZGVmIG1hdGNoZXMoCgogICAgICAgIHNlbGYsIHRlc3Rfc3RyaW5nOiBzdHIsIHBhcnNlX2FsbDogYm9vbCA9IFRydWUsICosIHBhcnNlQWxsOiBib29sID0gVHJ1ZQoKICAgICkgLT4gYm9vbDoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIE1ldGhvZCBmb3IgcXVpY2sgdGVzdGluZyBvZiBhIHBhcnNlciBhZ2FpbnN0IGEgdGVzdCBzdHJpbmcuIEdvb2QgZm9yIHNpbXBsZQoKICAgICAgICBpbmxpbmUgbWljcm90ZXN0cyBvZiBzdWIgZXhwcmVzc2lvbnMgd2hpbGUgYnVpbGRpbmcgdXAgbGFyZ2VyIHBhcnNlci4KCgoKICAgICAgICBQYXJhbWV0ZXJzOgoKICAgICAgICAtIGBgdGVzdF9zdHJpbmdgYCAtIHRvIHRlc3QgYWdhaW5zdCB0aGlzIGV4cHJlc3Npb24gZm9yIGEgbWF0Y2gKCiAgICAgICAgLSBgYHBhcnNlX2FsbGBgIC0gKGRlZmF1bHQ9IGBgVHJ1ZWBgKSAtIGZsYWcgdG8gcGFzcyB0byA6Y2xhc3M6YHBhcnNlX3N0cmluZ2Agd2hlbiBydW5uaW5nIHRlc3RzCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIGV4cHIgPSBXb3JkKG51bXMpCgogICAgICAgICAgICBhc3NlcnQgZXhwci5tYXRjaGVzKFwiMTAwXCIpCgogICAgICAgIFwiXCJcIgoKICAgICAgICBwYXJzZUFsbCA9IHBhcnNlQWxsIGFuZCBwYXJzZV9hbGwKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgc2VsZi5wYXJzZV9zdHJpbmcoc3RyKHRlc3Rfc3RyaW5nKSwgcGFyc2VfYWxsPXBhcnNlQWxsKQoKICAgICAgICAgICAgcmV0dXJuIFRydWUKCiAgICAgICAgZXhjZXB0IFBhcnNlQmFzZUV4Y2VwdGlvbjoKCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKCgogICAgZGVmIHJ1bl90ZXN0cygKCiAgICAgICAgc2VsZiwKCiAgICAgICAgdGVzdHM6IFVuaW9uW3N0ciwgTGlzdFtzdHJdXSwKCiAgICAgICAgcGFyc2VfYWxsOiBib29sID0gVHJ1ZSwKCiAgICAgICAgY29tbWVudDogdHlwaW5nLk9wdGlvbmFsW1VuaW9uW1wiUGFyc2VyRWxlbWVudFwiLCBzdHJdXSA9IFwiI1wiLAoKICAgICAgICBmdWxsX2R1bXA6IGJvb2wgPSBUcnVlLAoKICAgICAgICBwcmludF9yZXN1bHRzOiBib29sID0gVHJ1ZSwKCiAgICAgICAgZmFpbHVyZV90ZXN0czogYm9vbCA9IEZhbHNlLAoKICAgICAgICBwb3N0X3BhcnNlOiBDYWxsYWJsZVtbc3RyLCBQYXJzZVJlc3VsdHNdLCBzdHJdID0gTm9uZSwKCiAgICAgICAgZmlsZTogdHlwaW5nLk9wdGlvbmFsW1RleHRJT10gPSBOb25lLAoKICAgICAgICB3aXRoX2xpbmVfbnVtYmVyczogYm9vbCA9IEZhbHNlLAoKICAgICAgICAqLAoKICAgICAgICBwYXJzZUFsbDogYm9vbCA9IFRydWUsCgogICAgICAgIGZ1bGxEdW1wOiBib29sID0gVHJ1ZSwKCiAgICAgICAgcHJpbnRSZXN1bHRzOiBib29sID0gVHJ1ZSwKCiAgICAgICAgZmFpbHVyZVRlc3RzOiBib29sID0gRmFsc2UsCgogICAgICAgIHBvc3RQYXJzZTogQ2FsbGFibGVbW3N0ciwgUGFyc2VSZXN1bHRzXSwgc3RyXSA9IE5vbmUsCgogICAgKSAtPiBUdXBsZVtib29sLCBMaXN0W1R1cGxlW3N0ciwgVW5pb25bUGFyc2VSZXN1bHRzLCBFeGNlcHRpb25dXV1dOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgRXhlY3V0ZSB0aGUgcGFyc2UgZXhwcmVzc2lvbiBvbiBhIHNlcmllcyBvZiB0ZXN0IHN0cmluZ3MsIHNob3dpbmcgZWFjaAoKICAgICAgICB0ZXN0LCB0aGUgcGFyc2VkIHJlc3VsdHMgb3Igd2hlcmUgdGhlIHBhcnNlIGZhaWxlZC4gUXVpY2sgYW5kIGVhc3kgd2F5IHRvCgogICAgICAgIHJ1biBhIHBhcnNlIGV4cHJlc3Npb24gYWdhaW5zdCBhIGxpc3Qgb2Ygc2FtcGxlIHN0cmluZ3MuCgoKCiAgICAgICAgUGFyYW1ldGVyczoKCiAgICAgICAgLSBgYHRlc3RzYGAgLSBhIGxpc3Qgb2Ygc2VwYXJhdGUgdGVzdCBzdHJpbmdzLCBvciBhIG11bHRpbGluZSBzdHJpbmcgb2YgdGVzdCBzdHJpbmdzCgogICAgICAgIC0gYGBwYXJzZV9hbGxgYCAtIChkZWZhdWx0PSBgYFRydWVgYCkgLSBmbGFnIHRvIHBhc3MgdG8gOmNsYXNzOmBwYXJzZV9zdHJpbmdgIHdoZW4gcnVubmluZyB0ZXN0cwoKICAgICAgICAtIGBgY29tbWVudGBgIC0gKGRlZmF1bHQ9IGBgJyMnYGApIC0gZXhwcmVzc2lvbiBmb3IgaW5kaWNhdGluZyBlbWJlZGRlZCBjb21tZW50cyBpbiB0aGUgdGVzdAoKICAgICAgICAgIHN0cmluZzsgcGFzcyBOb25lIHRvIGRpc2FibGUgY29tbWVudCBmaWx0ZXJpbmcKCiAgICAgICAgLSBgYGZ1bGxfZHVtcGBgIC0gKGRlZmF1bHQ9IGBgVHJ1ZWBgKSAtIGR1bXAgcmVzdWx0cyBhcyBsaXN0IGZvbGxvd2VkIGJ5IHJlc3VsdHMgbmFtZXMgaW4gbmVzdGVkIG91dGxpbmU7CgogICAgICAgICAgaWYgRmFsc2UsIG9ubHkgZHVtcCBuZXN0ZWQgbGlzdAoKICAgICAgICAtIGBgcHJpbnRfcmVzdWx0c2BgIC0gKGRlZmF1bHQ9IGBgVHJ1ZWBgKSBwcmludHMgdGVzdCBvdXRwdXQgdG8gc3Rkb3V0CgogICAgICAgIC0gYGBmYWlsdXJlX3Rlc3RzYGAgLSAoZGVmYXVsdD0gYGBGYWxzZWBgKSBpbmRpY2F0ZXMgaWYgdGhlc2UgdGVzdHMgYXJlIGV4cGVjdGVkIHRvIGZhaWwgcGFyc2luZwoKICAgICAgICAtIGBgcG9zdF9wYXJzZWBgIC0gKGRlZmF1bHQ9IGBgTm9uZWBgKSBvcHRpb25hbCBjYWxsYmFjayBmb3Igc3VjY2Vzc2Z1bCBwYXJzZSByZXN1bHRzOyBjYWxsZWQgYXMKCiAgICAgICAgICBgZm4odGVzdF9zdHJpbmcsIHBhcnNlX3Jlc3VsdHMpYCBhbmQgcmV0dXJucyBhIHN0cmluZyB0byBiZSBhZGRlZCB0byB0aGUgdGVzdCBvdXRwdXQKCiAgICAgICAgLSBgYGZpbGVgYCAtIChkZWZhdWx0PSBgYE5vbmVgYCkgb3B0aW9uYWwgZmlsZS1saWtlIG9iamVjdCB0byB3aGljaCB0ZXN0IG91dHB1dCB3aWxsIGJlIHdyaXR0ZW47CgogICAgICAgICAgaWYgTm9uZSwgd2lsbCBkZWZhdWx0IHRvIGBgc3lzLnN0ZG91dGBgCgogICAgICAgIC0gYGB3aXRoX2xpbmVfbnVtYmVyc2BgIC0gZGVmYXVsdD0gYGBGYWxzZWBgKSBzaG93IHRlc3Qgc3RyaW5ncyB3aXRoIGxpbmUgYW5kIGNvbHVtbiBudW1iZXJzCgoKCiAgICAgICAgUmV0dXJuczogYSAoc3VjY2VzcywgcmVzdWx0cykgdHVwbGUsIHdoZXJlIHN1Y2Nlc3MgaW5kaWNhdGVzIHRoYXQgYWxsIHRlc3RzIHN1Y2NlZWRlZAoKICAgICAgICAob3IgZmFpbGVkIGlmIGBgZmFpbHVyZV90ZXN0c2BgIGlzIFRydWUpLCBhbmQgdGhlIHJlc3VsdHMgY29udGFpbiBhIGxpc3Qgb2YgbGluZXMgb2YgZWFjaAoKICAgICAgICB0ZXN0J3Mgb3V0cHV0CgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIG51bWJlcl9leHByID0gcHlwYXJzaW5nX2NvbW1vbi5udW1iZXIuY29weSgpCgoKCiAgICAgICAgICAgIHJlc3VsdCA9IG51bWJlcl9leHByLnJ1bl90ZXN0cygnJycKCiAgICAgICAgICAgICAgICAjIHVuc2lnbmVkIGludGVnZXIKCiAgICAgICAgICAgICAgICAxMDAKCiAgICAgICAgICAgICAgICAjIG5lZ2F0aXZlIGludGVnZXIKCiAgICAgICAgICAgICAgICAtMTAwCgogICAgICAgICAgICAgICAgIyBmbG9hdCB3aXRoIHNjaWVudGlmaWMgbm90YXRpb24KCiAgICAgICAgICAgICAgICA2LjAyZTIzCgogICAgICAgICAgICAgICAgIyBpbnRlZ2VyIHdpdGggc2NpZW50aWZpYyBub3RhdGlvbgoKICAgICAgICAgICAgICAgIDFlLTEyCgogICAgICAgICAgICAgICAgJycnKQoKICAgICAgICAgICAgcHJpbnQoXCJTdWNjZXNzXCIgaWYgcmVzdWx0WzBdIGVsc2UgXCJGYWlsZWQhXCIpCgoKCiAgICAgICAgICAgIHJlc3VsdCA9IG51bWJlcl9leHByLnJ1bl90ZXN0cygnJycKCiAgICAgICAgICAgICAgICAjIHN0cmF5IGNoYXJhY3RlcgoKICAgICAgICAgICAgICAgIDEwMFoKCiAgICAgICAgICAgICAgICAjIG1pc3NpbmcgbGVhZGluZyBkaWdpdCBiZWZvcmUgJy4nCgogICAgICAgICAgICAgICAgLS4xMDAKCiAgICAgICAgICAgICAgICAjIHRvbyBtYW55ICcuJwoKICAgICAgICAgICAgICAgIDMuMTQuMTU5CgogICAgICAgICAgICAgICAgJycnLCBmYWlsdXJlX3Rlc3RzPVRydWUpCgogICAgICAgICAgICBwcmludChcIlN1Y2Nlc3NcIiBpZiByZXN1bHRbMF0gZWxzZSBcIkZhaWxlZCFcIikKCgoKICAgICAgICBwcmludHM6OgoKCgogICAgICAgICAgICAjIHVuc2lnbmVkIGludGVnZXIKCiAgICAgICAgICAgIDEwMAoKICAgICAgICAgICAgWzEwMF0KCgoKICAgICAgICAgICAgIyBuZWdhdGl2ZSBpbnRlZ2VyCgogICAgICAgICAgICAtMTAwCgogICAgICAgICAgICBbLTEwMF0KCgoKICAgICAgICAgICAgIyBmbG9hdCB3aXRoIHNjaWVudGlmaWMgbm90YXRpb24KCiAgICAgICAgICAgIDYuMDJlMjMKCiAgICAgICAgICAgIFs2LjAyZSsyM10KCgoKICAgICAgICAgICAgIyBpbnRlZ2VyIHdpdGggc2NpZW50aWZpYyBub3RhdGlvbgoKICAgICAgICAgICAgMWUtMTIKCiAgICAgICAgICAgIFsxZS0xMl0KCgoKICAgICAgICAgICAgU3VjY2VzcwoKCgogICAgICAgICAgICAjIHN0cmF5IGNoYXJhY3RlcgoKICAgICAgICAgICAgMTAwWgoKICAgICAgICAgICAgICAgXgoKICAgICAgICAgICAgRkFJTDogRXhwZWN0ZWQgZW5kIG9mIHRleHQgKGF0IGNoYXIgMyksIChsaW5lOjEsIGNvbDo0KQoKCgogICAgICAgICAgICAjIG1pc3NpbmcgbGVhZGluZyBkaWdpdCBiZWZvcmUgJy4nCgogICAgICAgICAgICAtLjEwMAoKICAgICAgICAgICAgXgoKICAgICAgICAgICAgRkFJTDogRXhwZWN0ZWQge3JlYWwgbnVtYmVyIHdpdGggc2NpZW50aWZpYyBub3RhdGlvbiB8IHJlYWwgbnVtYmVyIHwgc2lnbmVkIGludGVnZXJ9IChhdCBjaGFyIDApLCAobGluZToxLCBjb2w6MSkKCgoKICAgICAgICAgICAgIyB0b28gbWFueSAnLicKCiAgICAgICAgICAgIDMuMTQuMTU5CgogICAgICAgICAgICAgICAgXgoKICAgICAgICAgICAgRkFJTDogRXhwZWN0ZWQgZW5kIG9mIHRleHQgKGF0IGNoYXIgNCksIChsaW5lOjEsIGNvbDo1KQoKCgogICAgICAgICAgICBTdWNjZXNzCgoKCiAgICAgICAgRWFjaCB0ZXN0IHN0cmluZyBtdXN0IGJlIG9uIGEgc2luZ2xlIGxpbmUuIElmIHlvdSB3YW50IHRvIHRlc3QgYSBzdHJpbmcgdGhhdCBzcGFucyBtdWx0aXBsZQoKICAgICAgICBsaW5lcywgY3JlYXRlIGEgdGVzdCBsaWtlIHRoaXM6OgoKCgogICAgICAgICAgICBleHByLnJ1bl90ZXN0cyhyXCJ0aGlzIGlzIGEgdGVzdFxcXFxuIG9mIHN0cmluZ3MgdGhhdCBzcGFucyBcXFxcbiAzIGxpbmVzXCIpCgoKCiAgICAgICAgKE5vdGUgdGhhdCB0aGlzIGlzIGEgcmF3IHN0cmluZyBsaXRlcmFsLCB5b3UgbXVzdCBpbmNsdWRlIHRoZSBsZWFkaW5nIGBgJ3InYGAuKQoKICAgICAgICBcIlwiXCIKCiAgICAgICAgZnJvbSAudGVzdGluZyBpbXBvcnQgcHlwYXJzaW5nX3Rlc3QKCgoKICAgICAgICBwYXJzZUFsbCA9IHBhcnNlQWxsIGFuZCBwYXJzZV9hbGwKCiAgICAgICAgZnVsbER1bXAgPSBmdWxsRHVtcCBhbmQgZnVsbF9kdW1wCgogICAgICAgIHByaW50UmVzdWx0cyA9IHByaW50UmVzdWx0cyBhbmQgcHJpbnRfcmVzdWx0cwoKICAgICAgICBmYWlsdXJlVGVzdHMgPSBmYWlsdXJlVGVzdHMgb3IgZmFpbHVyZV90ZXN0cwoKICAgICAgICBwb3N0UGFyc2UgPSBwb3N0UGFyc2Ugb3IgcG9zdF9wYXJzZQoKICAgICAgICBpZiBpc2luc3RhbmNlKHRlc3RzLCBzdHJfdHlwZSk6CgogICAgICAgICAgICBsaW5lX3N0cmlwID0gdHlwZSh0ZXN0cykuc3RyaXAKCiAgICAgICAgICAgIHRlc3RzID0gW2xpbmVfc3RyaXAodGVzdF9saW5lKSBmb3IgdGVzdF9saW5lIGluIHRlc3RzLnJzdHJpcCgpLnNwbGl0bGluZXMoKV0KCiAgICAgICAgaWYgaXNpbnN0YW5jZShjb21tZW50LCBzdHJfdHlwZSk6CgogICAgICAgICAgICBjb21tZW50ID0gTGl0ZXJhbChjb21tZW50KQoKICAgICAgICBpZiBmaWxlIGlzIE5vbmU6CgogICAgICAgICAgICBmaWxlID0gc3lzLnN0ZG91dAoKICAgICAgICBwcmludF8gPSBmaWxlLndyaXRlCgoKCiAgICAgICAgcmVzdWx0OiBVbmlvbltQYXJzZVJlc3VsdHMsIEV4Y2VwdGlvbl0KCiAgICAgICAgYWxsUmVzdWx0cyA9IFtdCgogICAgICAgIGNvbW1lbnRzID0gW10KCiAgICAgICAgc3VjY2VzcyA9IFRydWUKCiAgICAgICAgTkwgPSBMaXRlcmFsKHJcIlxcblwiKS5hZGRfcGFyc2VfYWN0aW9uKHJlcGxhY2Vfd2l0aChcIlxcblwiKSkuaWdub3JlKHF1b3RlZF9zdHJpbmcpCgogICAgICAgIEJPTSA9IFwiXFx1ZmVmZlwiCgogICAgICAgIGZvciB0IGluIHRlc3RzOgoKICAgICAgICAgICAgaWYgY29tbWVudCBpcyBub3QgTm9uZSBhbmQgY29tbWVudC5tYXRjaGVzKHQsIEZhbHNlKSBvciBjb21tZW50cyBhbmQgbm90IHQ6CgogICAgICAgICAgICAgICAgY29tbWVudHMuYXBwZW5kKAoKICAgICAgICAgICAgICAgICAgICBweXBhcnNpbmdfdGVzdC53aXRoX2xpbmVfbnVtYmVycyh0KSBpZiB3aXRoX2xpbmVfbnVtYmVycyBlbHNlIHQKCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGlmIG5vdCB0OgoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBvdXQgPSBbCgogICAgICAgICAgICAgICAgXCJcXG5cIiArIFwiXFxuXCIuam9pbihjb21tZW50cykgaWYgY29tbWVudHMgZWxzZSBcIlwiLAoKICAgICAgICAgICAgICAgIHB5cGFyc2luZ190ZXN0LndpdGhfbGluZV9udW1iZXJzKHQpIGlmIHdpdGhfbGluZV9udW1iZXJzIGVsc2UgdCwKCiAgICAgICAgICAgIF0KCiAgICAgICAgICAgIGNvbW1lbnRzID0gW10KCiAgICAgICAgICAgIHRyeToKCiAgICAgICAgICAgICAgICAjIGNvbnZlcnQgbmV3bGluZSBtYXJrcyB0byBhY3R1YWwgbmV3bGluZXMsIGFuZCBzdHJpcCBsZWFkaW5nIEJPTSBpZiBwcmVzZW50CgogICAgICAgICAgICAgICAgdCA9IE5MLnRyYW5zZm9ybV9zdHJpbmcodC5sc3RyaXAoQk9NKSkKCiAgICAgICAgICAgICAgICByZXN1bHQgPSBzZWxmLnBhcnNlX3N0cmluZyh0LCBwYXJzZV9hbGw9cGFyc2VBbGwpCgogICAgICAgICAgICBleGNlcHQgUGFyc2VCYXNlRXhjZXB0aW9uIGFzIHBlOgoKICAgICAgICAgICAgICAgIGZhdGFsID0gXCIoRkFUQUwpXCIgaWYgaXNpbnN0YW5jZShwZSwgUGFyc2VGYXRhbEV4Y2VwdGlvbikgZWxzZSBcIlwiCgogICAgICAgICAgICAgICAgb3V0LmFwcGVuZChwZS5leHBsYWluKCkpCgogICAgICAgICAgICAgICAgb3V0LmFwcGVuZChcIkZBSUw6IFwiICsgc3RyKHBlKSkKCiAgICAgICAgICAgICAgICBpZiBQYXJzZXJFbGVtZW50LnZlcmJvc2Vfc3RhY2t0cmFjZToKCiAgICAgICAgICAgICAgICAgICAgb3V0LmV4dGVuZCh0cmFjZWJhY2suZm9ybWF0X3RiKHBlLl9fdHJhY2ViYWNrX18pKQoKICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBzdWNjZXNzIGFuZCBmYWlsdXJlVGVzdHMKCiAgICAgICAgICAgICAgICByZXN1bHQgPSBwZQoKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBleGM6CgogICAgICAgICAgICAgICAgb3V0LmFwcGVuZChcIkZBSUwtRVhDRVBUSU9OOiB7fToge31cIi5mb3JtYXQodHlwZShleGMpLl9fbmFtZV9fLCBleGMpKQoKICAgICAgICAgICAgICAgIGlmIFBhcnNlckVsZW1lbnQudmVyYm9zZV9zdGFja3RyYWNlOgoKICAgICAgICAgICAgICAgICAgICBvdXQuZXh0ZW5kKHRyYWNlYmFjay5mb3JtYXRfdGIoZXhjLl9fdHJhY2ViYWNrX18pKQoKICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBzdWNjZXNzIGFuZCBmYWlsdXJlVGVzdHMKCiAgICAgICAgICAgICAgICByZXN1bHQgPSBleGMKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgc3VjY2VzcyA9IHN1Y2Nlc3MgYW5kIG5vdCBmYWlsdXJlVGVzdHMKCiAgICAgICAgICAgICAgICBpZiBwb3N0UGFyc2UgaXMgbm90IE5vbmU6CgogICAgICAgICAgICAgICAgICAgIHRyeToKCiAgICAgICAgICAgICAgICAgICAgICAgIHBwX3ZhbHVlID0gcG9zdFBhcnNlKHQsIHJlc3VsdCkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBwX3ZhbHVlIGlzIG5vdCBOb25lOgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocHBfdmFsdWUsIFBhcnNlUmVzdWx0cyk6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dC5hcHBlbmQocHBfdmFsdWUuZHVtcCgpKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dC5hcHBlbmQoc3RyKHBwX3ZhbHVlKSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0LmFwcGVuZChyZXN1bHQuZHVtcCgpKQoKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CgogICAgICAgICAgICAgICAgICAgICAgICBvdXQuYXBwZW5kKHJlc3VsdC5kdW1wKGZ1bGw9ZnVsbER1bXApKQoKICAgICAgICAgICAgICAgICAgICAgICAgb3V0LmFwcGVuZCgKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInt9IGZhaWxlZDoge306IHt9XCIuZm9ybWF0KAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0UGFyc2UuX19uYW1lX18sIHR5cGUoZSkuX19uYW1lX18sIGUKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgb3V0LmFwcGVuZChyZXN1bHQuZHVtcChmdWxsPWZ1bGxEdW1wKSkKCiAgICAgICAgICAgIG91dC5hcHBlbmQoXCJcIikKCgoKICAgICAgICAgICAgaWYgcHJpbnRSZXN1bHRzOgoKICAgICAgICAgICAgICAgIHByaW50XyhcIlxcblwiLmpvaW4ob3V0KSkKCgoKICAgICAgICAgICAgYWxsUmVzdWx0cy5hcHBlbmQoKHQsIHJlc3VsdCkpCgoKCiAgICAgICAgcmV0dXJuIHN1Y2Nlc3MsIGFsbFJlc3VsdHMKCgoKICAgIGRlZiBjcmVhdGVfZGlhZ3JhbSgKCiAgICAgICAgc2VsZiwKCiAgICAgICAgb3V0cHV0X2h0bWw6IFVuaW9uW1RleHRJTywgUGF0aCwgc3RyXSwKCiAgICAgICAgdmVydGljYWw6IGludCA9IDMsCgogICAgICAgIHNob3dfcmVzdWx0c19uYW1lczogYm9vbCA9IEZhbHNlLAoKICAgICAgICBzaG93X2dyb3VwczogYm9vbCA9IEZhbHNlLAoKICAgICAgICAqKmt3YXJncywKCiAgICApIC0+IE5vbmU6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBDcmVhdGUgYSByYWlscm9hZCBkaWFncmFtIGZvciB0aGUgcGFyc2VyLgoKCgogICAgICAgIFBhcmFtZXRlcnM6CgogICAgICAgIC0gb3V0cHV0X2h0bWwgKHN0ciBvciBmaWxlLWxpa2Ugb2JqZWN0KSAtIG91dHB1dCB0YXJnZXQgZm9yIGdlbmVyYXRlZAoKICAgICAgICAgIGRpYWdyYW0gSFRNTAoKICAgICAgICAtIHZlcnRpY2FsIChpbnQpIC0gdGhyZXNob2xkIGZvciBmb3JtYXR0aW5nIG11bHRpcGxlIGFsdGVybmF0aXZlcyB2ZXJ0aWNhbGx5CgogICAgICAgICAgaW5zdGVhZCBvZiBob3Jpem9udGFsbHkgKGRlZmF1bHQ9MykKCiAgICAgICAgLSBzaG93X3Jlc3VsdHNfbmFtZXMgLSBib29sIGZsYWcgd2hldGhlciBkaWFncmFtIHNob3VsZCBzaG93IGFubm90YXRpb25zIGZvcgoKICAgICAgICAgIGRlZmluZWQgcmVzdWx0cyBuYW1lcwoKICAgICAgICAtIHNob3dfZ3JvdXBzIC0gYm9vbCBmbGFnIHdoZXRoZXIgZ3JvdXBzIHNob3VsZCBiZSBoaWdobGlnaHRlZCB3aXRoIGFuIHVubGFiZWxlZCBzdXJyb3VuZGluZyBib3gKCiAgICAgICAgQWRkaXRpb25hbCBkaWFncmFtLWZvcm1hdHRpbmcga2V5d29yZCBhcmd1bWVudHMgY2FuIGFsc28gYmUgaW5jbHVkZWQ7CgogICAgICAgIHNlZSByYWlscm9hZC5EaWFncmFtIGNsYXNzLgoKICAgICAgICBcIlwiXCIKCgoKICAgICAgICB0cnk6CgogICAgICAgICAgICBmcm9tIC5kaWFncmFtIGltcG9ydCB0b19yYWlscm9hZCwgcmFpbHJvYWRfdG9faHRtbAoKICAgICAgICBleGNlcHQgSW1wb3J0RXJyb3IgYXMgaWU6CgogICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oCgogICAgICAgICAgICAgICAgXCJtdXN0IGBgcGlwIGluc3RhbGwgcHlwYXJzaW5nW2RpYWdyYW1zXWBgIHRvIGdlbmVyYXRlIHBhcnNlciByYWlscm9hZCBkaWFncmFtc1wiCgogICAgICAgICAgICApIGZyb20gaWUKCgoKICAgICAgICBzZWxmLnN0cmVhbWxpbmUoKQoKCgogICAgICAgIHJhaWxyb2FkID0gdG9fcmFpbHJvYWQoCgogICAgICAgICAgICBzZWxmLAoKICAgICAgICAgICAgdmVydGljYWw9dmVydGljYWwsCgogICAgICAgICAgICBzaG93X3Jlc3VsdHNfbmFtZXM9c2hvd19yZXN1bHRzX25hbWVzLAoKICAgICAgICAgICAgc2hvd19ncm91cHM9c2hvd19ncm91cHMsCgogICAgICAgICAgICBkaWFncmFtX2t3YXJncz1rd2FyZ3MsCgogICAgICAgICkKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvdXRwdXRfaHRtbCwgKHN0ciwgUGF0aCkpOgoKICAgICAgICAgICAgd2l0aCBvcGVuKG91dHB1dF9odG1sLCBcIndcIiwgZW5jb2Rpbmc9XCJ1dGYtOFwiKSBhcyBkaWFnX2ZpbGU6CgogICAgICAgICAgICAgICAgZGlhZ19maWxlLndyaXRlKHJhaWxyb2FkX3RvX2h0bWwocmFpbHJvYWQpKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgIyB3ZSB3ZXJlIHBhc3NlZCBhIGZpbGUtbGlrZSBvYmplY3QsIGp1c3Qgd3JpdGUgdG8gaXQKCiAgICAgICAgICAgIG91dHB1dF9odG1sLndyaXRlKHJhaWxyb2FkX3RvX2h0bWwocmFpbHJvYWQpKQoKCgogICAgc2V0RGVmYXVsdFdoaXRlc3BhY2VDaGFycyA9IHNldF9kZWZhdWx0X3doaXRlc3BhY2VfY2hhcnMKCiAgICBpbmxpbmVMaXRlcmFsc1VzaW5nID0gaW5saW5lX2xpdGVyYWxzX3VzaW5nCgogICAgc2V0UmVzdWx0c05hbWUgPSBzZXRfcmVzdWx0c19uYW1lCgogICAgc2V0QnJlYWsgPSBzZXRfYnJlYWsKCiAgICBzZXRQYXJzZUFjdGlvbiA9IHNldF9wYXJzZV9hY3Rpb24KCiAgICBhZGRQYXJzZUFjdGlvbiA9IGFkZF9wYXJzZV9hY3Rpb24KCiAgICBhZGRDb25kaXRpb24gPSBhZGRfY29uZGl0aW9uCgogICAgc2V0RmFpbEFjdGlvbiA9IHNldF9mYWlsX2FjdGlvbgoKICAgIHRyeVBhcnNlID0gdHJ5X3BhcnNlCgogICAgY2FuUGFyc2VOZXh0ID0gY2FuX3BhcnNlX25leHQKCiAgICByZXNldENhY2hlID0gcmVzZXRfY2FjaGUKCiAgICBlbmFibGVMZWZ0UmVjdXJzaW9uID0gZW5hYmxlX2xlZnRfcmVjdXJzaW9uCgogICAgZW5hYmxlUGFja3JhdCA9IGVuYWJsZV9wYWNrcmF0CgogICAgcGFyc2VTdHJpbmcgPSBwYXJzZV9zdHJpbmcKCiAgICBzY2FuU3RyaW5nID0gc2Nhbl9zdHJpbmcKCiAgICBzZWFyY2hTdHJpbmcgPSBzZWFyY2hfc3RyaW5nCgogICAgdHJhbnNmb3JtU3RyaW5nID0gdHJhbnNmb3JtX3N0cmluZwoKICAgIHNldFdoaXRlc3BhY2VDaGFycyA9IHNldF93aGl0ZXNwYWNlX2NoYXJzCgogICAgcGFyc2VXaXRoVGFicyA9IHBhcnNlX3dpdGhfdGFicwoKICAgIHNldERlYnVnQWN0aW9ucyA9IHNldF9kZWJ1Z19hY3Rpb25zCgogICAgc2V0RGVidWcgPSBzZXRfZGVidWcKCiAgICBkZWZhdWx0TmFtZSA9IGRlZmF1bHRfbmFtZQoKICAgIHNldE5hbWUgPSBzZXRfbmFtZQoKICAgIHBhcnNlRmlsZSA9IHBhcnNlX2ZpbGUKCiAgICBydW5UZXN0cyA9IHJ1bl90ZXN0cwoKICAgIGlnbm9yZVdoaXRlc3BhY2UgPSBpZ25vcmVfd2hpdGVzcGFjZQoKICAgIGxlYXZlV2hpdGVzcGFjZSA9IGxlYXZlX3doaXRlc3BhY2UKCgoKCgpjbGFzcyBfUGVuZGluZ1NraXAoUGFyc2VyRWxlbWVudCk6CgogICAgIyBpbnRlcm5hbCBwbGFjZWhvbGRlciBjbGFzcyB0byBob2xkIGEgcGxhY2Ugd2VyZSAnLi4uJyBpcyBhZGRlZCB0byBhIHBhcnNlciBlbGVtZW50LAoKICAgICMgb25jZSBhbm90aGVyIFBhcnNlckVsZW1lbnQgaXMgYWRkZWQsIHRoaXMgcGxhY2Vob2xkZXIgd2lsbCBiZSByZXBsYWNlZCB3aXRoIGEgU2tpcFRvCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGV4cHI6IFBhcnNlckVsZW1lbnQsIG11c3Rfc2tpcDogYm9vbCA9IEZhbHNlKToKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpCgogICAgICAgIHNlbGYuYW5jaG9yID0gZXhwcgoKICAgICAgICBzZWxmLm11c3Rfc2tpcCA9IG11c3Rfc2tpcAoKCgogICAgZGVmIF9nZW5lcmF0ZURlZmF1bHROYW1lKHNlbGYpOgoKICAgICAgICByZXR1cm4gc3RyKHNlbGYuYW5jaG9yICsgRW1wdHkoKSkucmVwbGFjZShcIkVtcHR5XCIsIFwiLi4uXCIpCgoKCiAgICBkZWYgX19hZGRfXyhzZWxmLCBvdGhlcikgLT4gXCJQYXJzZXJFbGVtZW50XCI6CgogICAgICAgIHNraXBwZXIgPSBTa2lwVG8ob3RoZXIpLnNldF9uYW1lKFwiLi4uXCIpKFwiX3NraXBwZWQqXCIpCgogICAgICAgIGlmIHNlbGYubXVzdF9za2lwOgoKCgogICAgICAgICAgICBkZWYgbXVzdF9za2lwKHQpOgoKICAgICAgICAgICAgICAgIGlmIG5vdCB0Ll9za2lwcGVkIG9yIHQuX3NraXBwZWQuYXNfbGlzdCgpID09IFtcIlwiXToKCiAgICAgICAgICAgICAgICAgICAgZGVsIHRbMF0KCiAgICAgICAgICAgICAgICAgICAgdC5wb3AoXCJfc2tpcHBlZFwiLCBOb25lKQoKCgogICAgICAgICAgICBkZWYgc2hvd19za2lwKHQpOgoKICAgICAgICAgICAgICAgIGlmIHQuX3NraXBwZWQuYXNfbGlzdCgpWy0xOl0gPT0gW1wiXCJdOgoKICAgICAgICAgICAgICAgICAgICB0LnBvcChcIl9za2lwcGVkXCIpCgogICAgICAgICAgICAgICAgICAgIHRbXCJfc2tpcHBlZFwiXSA9IFwibWlzc2luZyA8XCIgKyByZXByKHNlbGYuYW5jaG9yKSArIFwiPlwiCgoKCiAgICAgICAgICAgIHJldHVybiAoCgogICAgICAgICAgICAgICAgc2VsZi5hbmNob3IgKyBza2lwcGVyKCkuYWRkX3BhcnNlX2FjdGlvbihtdXN0X3NraXApCgogICAgICAgICAgICAgICAgfCBza2lwcGVyKCkuYWRkX3BhcnNlX2FjdGlvbihzaG93X3NraXApCgogICAgICAgICAgICApICsgb3RoZXIKCgoKICAgICAgICByZXR1cm4gc2VsZi5hbmNob3IgKyBza2lwcGVyICsgb3RoZXIKCgoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToKCiAgICAgICAgcmV0dXJuIHNlbGYuZGVmYXVsdE5hbWUKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgKmFyZ3MpOgoKICAgICAgICByYWlzZSBFeGNlcHRpb24oCgogICAgICAgICAgICBcInVzZSBvZiBgLi4uYCBleHByZXNzaW9uIHdpdGhvdXQgZm9sbG93aW5nIFNraXBUbyB0YXJnZXQgZXhwcmVzc2lvblwiCgogICAgICAgICkKCgoKCgpjbGFzcyBUb2tlbihQYXJzZXJFbGVtZW50KToKCiAgICBcIlwiXCJBYnN0cmFjdCA6Y2xhc3M6YFBhcnNlckVsZW1lbnRgIHN1YmNsYXNzLCBmb3IgZGVmaW5pbmcgYXRvbWljCgogICAgbWF0Y2hpbmcgcGF0dGVybnMuCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oc2VsZik6CgogICAgICAgIHN1cGVyKCkuX19pbml0X18oc2F2ZWxpc3Q9RmFsc2UpCgoKCiAgICBkZWYgX2dlbmVyYXRlRGVmYXVsdE5hbWUoc2VsZik6CgogICAgICAgIHJldHVybiB0eXBlKHNlbGYpLl9fbmFtZV9fCgoKCgoKY2xhc3MgRW1wdHkoVG9rZW4pOgoKICAgIFwiXCJcIgoKICAgIEFuIGVtcHR5IHRva2VuLCB3aWxsIGFsd2F5cyBtYXRjaC4KCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpCgogICAgICAgIHNlbGYubWF5UmV0dXJuRW1wdHkgPSBUcnVlCgogICAgICAgIHNlbGYubWF5SW5kZXhFcnJvciA9IEZhbHNlCgoKCgoKY2xhc3MgTm9NYXRjaChUb2tlbik6CgogICAgXCJcIlwiCgogICAgQSB0b2tlbiB0aGF0IHdpbGwgbmV2ZXIgbWF0Y2guCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oc2VsZik6CgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQoKICAgICAgICBzZWxmLm1heVJldHVybkVtcHR5ID0gVHJ1ZQoKICAgICAgICBzZWxmLm1heUluZGV4RXJyb3IgPSBGYWxzZQoKICAgICAgICBzZWxmLmVycm1zZyA9IFwiVW5tYXRjaGFibGUgdG9rZW5cIgoKCgogICAgZGVmIHBhcnNlSW1wbChzZWxmLCBpbnN0cmluZywgbG9jLCBkb0FjdGlvbnM9VHJ1ZSk6CgogICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsb2MsIHNlbGYuZXJybXNnLCBzZWxmKQoKCgoKCmNsYXNzIExpdGVyYWwoVG9rZW4pOgoKICAgIFwiXCJcIgoKICAgIFRva2VuIHRvIGV4YWN0bHkgbWF0Y2ggYSBzcGVjaWZpZWQgc3RyaW5nLgoKCgogICAgRXhhbXBsZTo6CgoKCiAgICAgICAgTGl0ZXJhbCgnYmxhaCcpLnBhcnNlX3N0cmluZygnYmxhaCcpICAjIC0+IFsnYmxhaCddCgogICAgICAgIExpdGVyYWwoJ2JsYWgnKS5wYXJzZV9zdHJpbmcoJ2JsYWhmb29ibGFoJykgICMgLT4gWydibGFoJ10KCiAgICAgICAgTGl0ZXJhbCgnYmxhaCcpLnBhcnNlX3N0cmluZygnYmxhJykgICMgLT4gRXhjZXB0aW9uOiBFeHBlY3RlZCBcImJsYWhcIgoKCgogICAgRm9yIGNhc2UtaW5zZW5zaXRpdmUgbWF0Y2hpbmcsIHVzZSA6Y2xhc3M6YENhc2VsZXNzTGl0ZXJhbGAuCgoKCiAgICBGb3Iga2V5d29yZCBtYXRjaGluZyAoZm9yY2Ugd29yZCBicmVhayBiZWZvcmUgYW5kIGFmdGVyIHRoZSBtYXRjaGVkIHN0cmluZyksCgogICAgdXNlIDpjbGFzczpgS2V5d29yZGAgb3IgOmNsYXNzOmBDYXNlbGVzc0tleXdvcmRgLgoKICAgIFwiXCJcIgoKCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG1hdGNoX3N0cmluZzogc3RyID0gXCJcIiwgKiwgbWF0Y2hTdHJpbmc6IHN0ciA9IFwiXCIpOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKCiAgICAgICAgbWF0Y2hfc3RyaW5nID0gbWF0Y2hTdHJpbmcgb3IgbWF0Y2hfc3RyaW5nCgogICAgICAgIHNlbGYubWF0Y2ggPSBtYXRjaF9zdHJpbmcKCiAgICAgICAgc2VsZi5tYXRjaExlbiA9IGxlbihtYXRjaF9zdHJpbmcpCgogICAgICAgIHRyeToKCiAgICAgICAgICAgIHNlbGYuZmlyc3RNYXRjaENoYXIgPSBtYXRjaF9zdHJpbmdbMF0KCiAgICAgICAgZXhjZXB0IEluZGV4RXJyb3I6CgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKFwibnVsbCBzdHJpbmcgcGFzc2VkIHRvIExpdGVyYWw7IHVzZSBFbXB0eSgpIGluc3RlYWRcIikKCiAgICAgICAgc2VsZi5lcnJtc2cgPSBcIkV4cGVjdGVkIFwiICsgc2VsZi5uYW1lCgogICAgICAgIHNlbGYubWF5UmV0dXJuRW1wdHkgPSBGYWxzZQoKICAgICAgICBzZWxmLm1heUluZGV4RXJyb3IgPSBGYWxzZQoKCgogICAgICAgICMgUGVyZm9ybWFuY2UgdHVuaW5nOiBtb2RpZnkgX19jbGFzc19fIHRvIHNlbGVjdAoKICAgICAgICAjIGEgcGFyc2VJbXBsIG9wdGltaXplZCBmb3Igc2luZ2xlLWNoYXJhY3RlciBjaGVjawoKICAgICAgICBpZiBzZWxmLm1hdGNoTGVuID09IDEgYW5kIHR5cGUoc2VsZikgaXMgTGl0ZXJhbDoKCiAgICAgICAgICAgIHNlbGYuX19jbGFzc19fID0gX1NpbmdsZUNoYXJMaXRlcmFsCgoKCiAgICBkZWYgX2dlbmVyYXRlRGVmYXVsdE5hbWUoc2VsZik6CgogICAgICAgIHJldHVybiByZXByKHNlbGYubWF0Y2gpCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgaWYgaW5zdHJpbmdbbG9jXSA9PSBzZWxmLmZpcnN0TWF0Y2hDaGFyIGFuZCBpbnN0cmluZy5zdGFydHN3aXRoKAoKICAgICAgICAgICAgc2VsZi5tYXRjaCwgbG9jCgogICAgICAgICk6CgogICAgICAgICAgICByZXR1cm4gbG9jICsgc2VsZi5tYXRjaExlbiwgc2VsZi5tYXRjaAoKICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBzZWxmLmVycm1zZywgc2VsZikKCgoKCgpjbGFzcyBfU2luZ2xlQ2hhckxpdGVyYWwoTGl0ZXJhbCk6CgogICAgZGVmIHBhcnNlSW1wbChzZWxmLCBpbnN0cmluZywgbG9jLCBkb0FjdGlvbnM9VHJ1ZSk6CgogICAgICAgIGlmIGluc3RyaW5nW2xvY10gPT0gc2VsZi5maXJzdE1hdGNoQ2hhcjoKCiAgICAgICAgICAgIHJldHVybiBsb2MgKyAxLCBzZWxmLm1hdGNoCgogICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsb2MsIHNlbGYuZXJybXNnLCBzZWxmKQoKCgoKClBhcnNlckVsZW1lbnQuX2xpdGVyYWxTdHJpbmdDbGFzcyA9IExpdGVyYWwKCgoKCgpjbGFzcyBLZXl3b3JkKFRva2VuKToKCiAgICBcIlwiXCIKCiAgICBUb2tlbiB0byBleGFjdGx5IG1hdGNoIGEgc3BlY2lmaWVkIHN0cmluZyBhcyBhIGtleXdvcmQsIHRoYXQgaXMsCgogICAgaXQgbXVzdCBiZSBpbW1lZGlhdGVseSBmb2xsb3dlZCBieSBhIG5vbi1rZXl3b3JkIGNoYXJhY3Rlci4gIENvbXBhcmUKCiAgICB3aXRoIDpjbGFzczpgTGl0ZXJhbGA6CgoKCiAgICAtIGBgTGl0ZXJhbChcImlmXCIpYGAgd2lsbCBtYXRjaCB0aGUgbGVhZGluZyBgYCdpZidgYCBpbgoKICAgICAgYGAnaWZBbmRPbmx5SWYnYGAuCgogICAgLSBgYEtleXdvcmQoXCJpZlwiKWBgIHdpbGwgbm90OyBpdCB3aWxsIG9ubHkgbWF0Y2ggdGhlIGxlYWRpbmcKCiAgICAgIGBgJ2lmJ2BgIGluIGBgJ2lmIHg9MSdgYCwgb3IgYGAnaWYoeT09MiknYGAKCgoKICAgIEFjY2VwdHMgdHdvIG9wdGlvbmFsIGNvbnN0cnVjdG9yIGFyZ3VtZW50cyBpbiBhZGRpdGlvbiB0byB0aGUKCiAgICBrZXl3b3JkIHN0cmluZzoKCgoKICAgIC0gYGBpZGVudENoYXJzYGAgaXMgYSBzdHJpbmcgb2YgY2hhcmFjdGVycyB0aGF0IHdvdWxkIGJlIHZhbGlkCgogICAgICBpZGVudGlmaWVyIGNoYXJhY3RlcnMsIGRlZmF1bHRpbmcgdG8gYWxsIGFscGhhbnVtZXJpY3MgKyBcIl9cIiBhbmQKCiAgICAgIFwiJFwiCgogICAgLSBgYGNhc2VsZXNzYGAgYWxsb3dzIGNhc2UtaW5zZW5zaXRpdmUgbWF0Y2hpbmcsIGRlZmF1bHQgaXMgYGBGYWxzZWBgLgoKCgogICAgRXhhbXBsZTo6CgoKCiAgICAgICAgS2V5d29yZChcInN0YXJ0XCIpLnBhcnNlX3N0cmluZyhcInN0YXJ0XCIpICAjIC0+IFsnc3RhcnQnXQoKICAgICAgICBLZXl3b3JkKFwic3RhcnRcIikucGFyc2Vfc3RyaW5nKFwic3RhcnRpbmdcIikgICMgLT4gRXhjZXB0aW9uCgoKCiAgICBGb3IgY2FzZS1pbnNlbnNpdGl2ZSBtYXRjaGluZywgdXNlIDpjbGFzczpgQ2FzZWxlc3NLZXl3b3JkYC4KCiAgICBcIlwiXCIKCgoKICAgIERFRkFVTFRfS0VZV09SRF9DSEFSUyA9IGFscGhhbnVtcyArIFwiXyRcIgoKCgogICAgZGVmIF9faW5pdF9fKAoKICAgICAgICBzZWxmLAoKICAgICAgICBtYXRjaF9zdHJpbmc6IHN0ciA9IFwiXCIsCgogICAgICAgIGlkZW50X2NoYXJzOiB0eXBpbmcuT3B0aW9uYWxbc3RyXSA9IE5vbmUsCgogICAgICAgIGNhc2VsZXNzOiBib29sID0gRmFsc2UsCgogICAgICAgICosCgogICAgICAgIG1hdGNoU3RyaW5nOiBzdHIgPSBcIlwiLAoKICAgICAgICBpZGVudENoYXJzOiB0eXBpbmcuT3B0aW9uYWxbc3RyXSA9IE5vbmUsCgogICAgKToKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpCgogICAgICAgIGlkZW50Q2hhcnMgPSBpZGVudENoYXJzIG9yIGlkZW50X2NoYXJzCgogICAgICAgIGlmIGlkZW50Q2hhcnMgaXMgTm9uZToKCiAgICAgICAgICAgIGlkZW50Q2hhcnMgPSBLZXl3b3JkLkRFRkFVTFRfS0VZV09SRF9DSEFSUwoKICAgICAgICBtYXRjaF9zdHJpbmcgPSBtYXRjaFN0cmluZyBvciBtYXRjaF9zdHJpbmcKCiAgICAgICAgc2VsZi5tYXRjaCA9IG1hdGNoX3N0cmluZwoKICAgICAgICBzZWxmLm1hdGNoTGVuID0gbGVuKG1hdGNoX3N0cmluZykKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgc2VsZi5maXJzdE1hdGNoQ2hhciA9IG1hdGNoX3N0cmluZ1swXQoKICAgICAgICBleGNlcHQgSW5kZXhFcnJvcjoKCiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoXCJudWxsIHN0cmluZyBwYXNzZWQgdG8gS2V5d29yZDsgdXNlIEVtcHR5KCkgaW5zdGVhZFwiKQoKICAgICAgICBzZWxmLmVycm1zZyA9IFwiRXhwZWN0ZWQge30ge31cIi5mb3JtYXQodHlwZShzZWxmKS5fX25hbWVfXywgc2VsZi5uYW1lKQoKICAgICAgICBzZWxmLm1heVJldHVybkVtcHR5ID0gRmFsc2UKCiAgICAgICAgc2VsZi5tYXlJbmRleEVycm9yID0gRmFsc2UKCiAgICAgICAgc2VsZi5jYXNlbGVzcyA9IGNhc2VsZXNzCgogICAgICAgIGlmIGNhc2VsZXNzOgoKICAgICAgICAgICAgc2VsZi5jYXNlbGVzc21hdGNoID0gbWF0Y2hfc3RyaW5nLnVwcGVyKCkKCiAgICAgICAgICAgIGlkZW50Q2hhcnMgPSBpZGVudENoYXJzLnVwcGVyKCkKCiAgICAgICAgc2VsZi5pZGVudENoYXJzID0gc2V0KGlkZW50Q2hhcnMpCgoKCiAgICBkZWYgX2dlbmVyYXRlRGVmYXVsdE5hbWUoc2VsZik6CgogICAgICAgIHJldHVybiByZXByKHNlbGYubWF0Y2gpCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgZXJybXNnID0gc2VsZi5lcnJtc2cKCiAgICAgICAgZXJybG9jID0gbG9jCgogICAgICAgIGlmIHNlbGYuY2FzZWxlc3M6CgogICAgICAgICAgICBpZiBpbnN0cmluZ1tsb2MgOiBsb2MgKyBzZWxmLm1hdGNoTGVuXS51cHBlcigpID09IHNlbGYuY2FzZWxlc3NtYXRjaDoKCiAgICAgICAgICAgICAgICBpZiBsb2MgPT0gMCBvciBpbnN0cmluZ1tsb2MgLSAxXS51cHBlcigpIG5vdCBpbiBzZWxmLmlkZW50Q2hhcnM6CgogICAgICAgICAgICAgICAgICAgIGlmICgKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYyA+PSBsZW4oaW5zdHJpbmcpIC0gc2VsZi5tYXRjaExlbgoKICAgICAgICAgICAgICAgICAgICAgICAgb3IgaW5zdHJpbmdbbG9jICsgc2VsZi5tYXRjaExlbl0udXBwZXIoKSBub3QgaW4gc2VsZi5pZGVudENoYXJzCgogICAgICAgICAgICAgICAgICAgICk6CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbG9jICsgc2VsZi5tYXRjaExlbiwgc2VsZi5tYXRjaAoKICAgICAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICAgICAgIyBmb2xsb3dlZCBieSBrZXl3b3JkIGNoYXIKCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm1zZyArPSBcIiwgd2FzIGltbWVkaWF0ZWx5IGZvbGxvd2VkIGJ5IGtleXdvcmQgY2hhcmFjdGVyXCIKCiAgICAgICAgICAgICAgICAgICAgICAgIGVycmxvYyA9IGxvYyArIHNlbGYubWF0Y2hMZW4KCiAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICAjIHByZWNlZGVkIGJ5IGtleXdvcmQgY2hhcgoKICAgICAgICAgICAgICAgICAgICBlcnJtc2cgKz0gXCIsIGtleXdvcmQgd2FzIGltbWVkaWF0ZWx5IHByZWNlZGVkIGJ5IGtleXdvcmQgY2hhcmFjdGVyXCIKCiAgICAgICAgICAgICAgICAgICAgZXJybG9jID0gbG9jIC0gMQoKICAgICAgICAgICAgIyBlbHNlIG5vIG1hdGNoIGp1c3QgcmFpc2UgcGxhaW4gZXhjZXB0aW9uCgoKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIGlmICgKCiAgICAgICAgICAgICAgICBpbnN0cmluZ1tsb2NdID09IHNlbGYuZmlyc3RNYXRjaENoYXIKCiAgICAgICAgICAgICAgICBhbmQgc2VsZi5tYXRjaExlbiA9PSAxCgogICAgICAgICAgICAgICAgb3IgaW5zdHJpbmcuc3RhcnRzd2l0aChzZWxmLm1hdGNoLCBsb2MpCgogICAgICAgICAgICApOgoKICAgICAgICAgICAgICAgIGlmIGxvYyA9PSAwIG9yIGluc3RyaW5nW2xvYyAtIDFdIG5vdCBpbiBzZWxmLmlkZW50Q2hhcnM6CgogICAgICAgICAgICAgICAgICAgIGlmICgKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYyA+PSBsZW4oaW5zdHJpbmcpIC0gc2VsZi5tYXRjaExlbgoKICAgICAgICAgICAgICAgICAgICAgICAgb3IgaW5zdHJpbmdbbG9jICsgc2VsZi5tYXRjaExlbl0gbm90IGluIHNlbGYuaWRlbnRDaGFycwoKICAgICAgICAgICAgICAgICAgICApOgoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvYyArIHNlbGYubWF0Y2hMZW4sIHNlbGYubWF0Y2gKCiAgICAgICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgICAgICMgZm9sbG93ZWQgYnkga2V5d29yZCBjaGFyCgogICAgICAgICAgICAgICAgICAgICAgICBlcnJtc2cgKz0gKAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiLCBrZXl3b3JkIHdhcyBpbW1lZGlhdGVseSBmb2xsb3dlZCBieSBrZXl3b3JkIGNoYXJhY3RlclwiCgogICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgICAgICBlcnJsb2MgPSBsb2MgKyBzZWxmLm1hdGNoTGVuCgogICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgIyBwcmVjZWRlZCBieSBrZXl3b3JkIGNoYXIKCiAgICAgICAgICAgICAgICAgICAgZXJybXNnICs9IFwiLCBrZXl3b3JkIHdhcyBpbW1lZGlhdGVseSBwcmVjZWRlZCBieSBrZXl3b3JkIGNoYXJhY3RlclwiCgogICAgICAgICAgICAgICAgICAgIGVycmxvYyA9IGxvYyAtIDEKCiAgICAgICAgICAgICMgZWxzZSBubyBtYXRjaCBqdXN0IHJhaXNlIHBsYWluIGV4Y2VwdGlvbgoKCgogICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBlcnJsb2MsIGVycm1zZywgc2VsZikKCgoKICAgIEBzdGF0aWNtZXRob2QKCiAgICBkZWYgc2V0X2RlZmF1bHRfa2V5d29yZF9jaGFycyhjaGFycykgLT4gTm9uZToKCiAgICAgICAgXCJcIlwiCgogICAgICAgIE92ZXJyaWRlcyB0aGUgZGVmYXVsdCBjaGFyYWN0ZXJzIHVzZWQgYnkgOmNsYXNzOmBLZXl3b3JkYCBleHByZXNzaW9ucy4KCiAgICAgICAgXCJcIlwiCgogICAgICAgIEtleXdvcmQuREVGQVVMVF9LRVlXT1JEX0NIQVJTID0gY2hhcnMKCgoKICAgIHNldERlZmF1bHRLZXl3b3JkQ2hhcnMgPSBzZXRfZGVmYXVsdF9rZXl3b3JkX2NoYXJzCgoKCgoKY2xhc3MgQ2FzZWxlc3NMaXRlcmFsKExpdGVyYWwpOgoKICAgIFwiXCJcIgoKICAgIFRva2VuIHRvIG1hdGNoIGEgc3BlY2lmaWVkIHN0cmluZywgaWdub3JpbmcgY2FzZSBvZiBsZXR0ZXJzLgoKICAgIE5vdGU6IHRoZSBtYXRjaGVkIHJlc3VsdHMgd2lsbCBhbHdheXMgYmUgaW4gdGhlIGNhc2Ugb2YgdGhlIGdpdmVuCgogICAgbWF0Y2ggc3RyaW5nLCBOT1QgdGhlIGNhc2Ugb2YgdGhlIGlucHV0IHRleHQuCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICBDYXNlbGVzc0xpdGVyYWwoXCJDTURcIilbMSwgLi4uXS5wYXJzZV9zdHJpbmcoXCJjbWQgQ01EIENtZDEwXCIpCgogICAgICAgICMgLT4gWydDTUQnLCAnQ01EJywgJ0NNRCddCgoKCiAgICAoQ29udHJhc3Qgd2l0aCBleGFtcGxlIGZvciA6Y2xhc3M6YENhc2VsZXNzS2V5d29yZGAuKQoKICAgIFwiXCJcIgoKCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIG1hdGNoX3N0cmluZzogc3RyID0gXCJcIiwgKiwgbWF0Y2hTdHJpbmc6IHN0ciA9IFwiXCIpOgoKICAgICAgICBtYXRjaF9zdHJpbmcgPSBtYXRjaFN0cmluZyBvciBtYXRjaF9zdHJpbmcKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhtYXRjaF9zdHJpbmcudXBwZXIoKSkKCiAgICAgICAgIyBQcmVzZXJ2ZSB0aGUgZGVmaW5pbmcgbGl0ZXJhbC4KCiAgICAgICAgc2VsZi5yZXR1cm5TdHJpbmcgPSBtYXRjaF9zdHJpbmcKCiAgICAgICAgc2VsZi5lcnJtc2cgPSBcIkV4cGVjdGVkIFwiICsgc2VsZi5uYW1lCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgaWYgaW5zdHJpbmdbbG9jIDogbG9jICsgc2VsZi5tYXRjaExlbl0udXBwZXIoKSA9PSBzZWxmLm1hdGNoOgoKICAgICAgICAgICAgcmV0dXJuIGxvYyArIHNlbGYubWF0Y2hMZW4sIHNlbGYucmV0dXJuU3RyaW5nCgogICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsb2MsIHNlbGYuZXJybXNnLCBzZWxmKQoKCgoKCmNsYXNzIENhc2VsZXNzS2V5d29yZChLZXl3b3JkKToKCiAgICBcIlwiXCIKCiAgICBDYXNlbGVzcyB2ZXJzaW9uIG9mIDpjbGFzczpgS2V5d29yZGAuCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICBDYXNlbGVzc0tleXdvcmQoXCJDTURcIilbMSwgLi4uXS5wYXJzZV9zdHJpbmcoXCJjbWQgQ01EIENtZDEwXCIpCgogICAgICAgICMgLT4gWydDTUQnLCAnQ01EJ10KCgoKICAgIChDb250cmFzdCB3aXRoIGV4YW1wbGUgZm9yIDpjbGFzczpgQ2FzZWxlc3NMaXRlcmFsYC4pCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oCgogICAgICAgIHNlbGYsCgogICAgICAgIG1hdGNoX3N0cmluZzogc3RyID0gXCJcIiwKCiAgICAgICAgaWRlbnRfY2hhcnM6IHR5cGluZy5PcHRpb25hbFtzdHJdID0gTm9uZSwKCiAgICAgICAgKiwKCiAgICAgICAgbWF0Y2hTdHJpbmc6IHN0ciA9IFwiXCIsCgogICAgICAgIGlkZW50Q2hhcnM6IHR5cGluZy5PcHRpb25hbFtzdHJdID0gTm9uZSwKCiAgICApOgoKICAgICAgICBpZGVudENoYXJzID0gaWRlbnRDaGFycyBvciBpZGVudF9jaGFycwoKICAgICAgICBtYXRjaF9zdHJpbmcgPSBtYXRjaFN0cmluZyBvciBtYXRjaF9zdHJpbmcKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhtYXRjaF9zdHJpbmcsIGlkZW50Q2hhcnMsIGNhc2VsZXNzPVRydWUpCgoKCgoKY2xhc3MgQ2xvc2VNYXRjaChUb2tlbik6CgogICAgXCJcIlwiQSB2YXJpYXRpb24gb24gOmNsYXNzOmBMaXRlcmFsYCB3aGljaCBtYXRjaGVzIFwiY2xvc2VcIiBtYXRjaGVzLAoKICAgIHRoYXQgaXMsIHN0cmluZ3Mgd2l0aCBhdCBtb3N0ICduJyBtaXNtYXRjaGluZyBjaGFyYWN0ZXJzLgoKICAgIDpjbGFzczpgQ2xvc2VNYXRjaGAgdGFrZXMgcGFyYW1ldGVyczoKCgoKICAgIC0gYGBtYXRjaF9zdHJpbmdgYCAtIHN0cmluZyB0byBiZSBtYXRjaGVkCgogICAgLSBgYGNhc2VsZXNzYGAgLSBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRvIGlnbm9yZSBjYXNpbmcgd2hlbiBjb21wYXJpbmcgY2hhcmFjdGVycwoKICAgIC0gYGBtYXhfbWlzbWF0Y2hlc2BgIC0gKGBgZGVmYXVsdD0xYGApIG1heGltdW0gbnVtYmVyIG9mCgogICAgICBtaXNtYXRjaGVzIGFsbG93ZWQgdG8gY291bnQgYXMgYSBtYXRjaAoKCgogICAgVGhlIHJlc3VsdHMgZnJvbSBhIHN1Y2Nlc3NmdWwgcGFyc2Ugd2lsbCBjb250YWluIHRoZSBtYXRjaGVkIHRleHQKCiAgICBmcm9tIHRoZSBpbnB1dCBzdHJpbmcgYW5kIHRoZSBmb2xsb3dpbmcgbmFtZWQgcmVzdWx0czoKCgoKICAgIC0gYGBtaXNtYXRjaGVzYGAgLSBhIGxpc3Qgb2YgdGhlIHBvc2l0aW9ucyB3aXRoaW4gdGhlCgogICAgICBtYXRjaF9zdHJpbmcgd2hlcmUgbWlzbWF0Y2hlcyB3ZXJlIGZvdW5kCgogICAgLSBgYG9yaWdpbmFsYGAgLSB0aGUgb3JpZ2luYWwgbWF0Y2hfc3RyaW5nIHVzZWQgdG8gY29tcGFyZQoKICAgICAgYWdhaW5zdCB0aGUgaW5wdXQgc3RyaW5nCgoKCiAgICBJZiBgYG1pc21hdGNoZXNgYCBpcyBhbiBlbXB0eSBsaXN0LCB0aGVuIHRoZSBtYXRjaCB3YXMgYW4gZXhhY3QKCiAgICBtYXRjaC4KCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgIHBhdHQgPSBDbG9zZU1hdGNoKFwiQVRDQVRDR0FBVEdHQVwiKQoKICAgICAgICBwYXR0LnBhcnNlX3N0cmluZyhcIkFUQ0FUQ0dBQVhHR0FcIikgIyAtPiAoWydBVENBVENHQUFYR0dBJ10sIHsnbWlzbWF0Y2hlcyc6IFtbOV1dLCAnb3JpZ2luYWwnOiBbJ0FUQ0FUQ0dBQVRHR0EnXX0pCgogICAgICAgIHBhdHQucGFyc2Vfc3RyaW5nKFwiQVRDQVhDR0FBWEdHQVwiKSAjIC0+IEV4Y2VwdGlvbjogRXhwZWN0ZWQgJ0FUQ0FUQ0dBQVRHR0EnICh3aXRoIHVwIHRvIDEgbWlzbWF0Y2hlcykgKGF0IGNoYXIgMCksIChsaW5lOjEsIGNvbDoxKQoKCgogICAgICAgICMgZXhhY3QgbWF0Y2gKCiAgICAgICAgcGF0dC5wYXJzZV9zdHJpbmcoXCJBVENBVENHQUFUR0dBXCIpICMgLT4gKFsnQVRDQVRDR0FBVEdHQSddLCB7J21pc21hdGNoZXMnOiBbW11dLCAnb3JpZ2luYWwnOiBbJ0FUQ0FUQ0dBQVRHR0EnXX0pCgoKCiAgICAgICAgIyBjbG9zZSBtYXRjaCBhbGxvd2luZyB1cCB0byAyIG1pc21hdGNoZXMKCiAgICAgICAgcGF0dCA9IENsb3NlTWF0Y2goXCJBVENBVENHQUFUR0dBXCIsIG1heF9taXNtYXRjaGVzPTIpCgogICAgICAgIHBhdHQucGFyc2Vfc3RyaW5nKFwiQVRDQVhDR0FBWEdHQVwiKSAjIC0+IChbJ0FUQ0FYQ0dBQVhHR0EnXSwgeydtaXNtYXRjaGVzJzogW1s0LCA5XV0sICdvcmlnaW5hbCc6IFsnQVRDQVRDR0FBVEdHQSddfSkKCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2luaXRfXygKCiAgICAgICAgc2VsZiwKCiAgICAgICAgbWF0Y2hfc3RyaW5nOiBzdHIsCgogICAgICAgIG1heF9taXNtYXRjaGVzOiBpbnQgPSBOb25lLAoKICAgICAgICAqLAoKICAgICAgICBtYXhNaXNtYXRjaGVzOiBpbnQgPSAxLAoKICAgICAgICBjYXNlbGVzcz1GYWxzZSwKCiAgICApOgoKICAgICAgICBtYXhNaXNtYXRjaGVzID0gbWF4X21pc21hdGNoZXMgaWYgbWF4X21pc21hdGNoZXMgaXMgbm90IE5vbmUgZWxzZSBtYXhNaXNtYXRjaGVzCgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQoKICAgICAgICBzZWxmLm1hdGNoX3N0cmluZyA9IG1hdGNoX3N0cmluZwoKICAgICAgICBzZWxmLm1heE1pc21hdGNoZXMgPSBtYXhNaXNtYXRjaGVzCgogICAgICAgIHNlbGYuZXJybXNnID0gXCJFeHBlY3RlZCB7IXJ9ICh3aXRoIHVwIHRvIHt9IG1pc21hdGNoZXMpXCIuZm9ybWF0KAoKICAgICAgICAgICAgc2VsZi5tYXRjaF9zdHJpbmcsIHNlbGYubWF4TWlzbWF0Y2hlcwoKICAgICAgICApCgogICAgICAgIHNlbGYuY2FzZWxlc3MgPSBjYXNlbGVzcwoKICAgICAgICBzZWxmLm1heUluZGV4RXJyb3IgPSBGYWxzZQoKICAgICAgICBzZWxmLm1heVJldHVybkVtcHR5ID0gRmFsc2UKCgoKICAgIGRlZiBfZ2VuZXJhdGVEZWZhdWx0TmFtZShzZWxmKToKCiAgICAgICAgcmV0dXJuIFwie306eyFyfVwiLmZvcm1hdCh0eXBlKHNlbGYpLl9fbmFtZV9fLCBzZWxmLm1hdGNoX3N0cmluZykKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICBzdGFydCA9IGxvYwoKICAgICAgICBpbnN0cmxlbiA9IGxlbihpbnN0cmluZykKCiAgICAgICAgbWF4bG9jID0gc3RhcnQgKyBsZW4oc2VsZi5tYXRjaF9zdHJpbmcpCgoKCiAgICAgICAgaWYgbWF4bG9jIDw9IGluc3RybGVuOgoKICAgICAgICAgICAgbWF0Y2hfc3RyaW5nID0gc2VsZi5tYXRjaF9zdHJpbmcKCiAgICAgICAgICAgIG1hdGNoX3N0cmluZ2xvYyA9IDAKCiAgICAgICAgICAgIG1pc21hdGNoZXMgPSBbXQoKICAgICAgICAgICAgbWF4TWlzbWF0Y2hlcyA9IHNlbGYubWF4TWlzbWF0Y2hlcwoKCgogICAgICAgICAgICBmb3IgbWF0Y2hfc3RyaW5nbG9jLCBzX20gaW4gZW51bWVyYXRlKAoKICAgICAgICAgICAgICAgIHppcChpbnN0cmluZ1tsb2M6bWF4bG9jXSwgbWF0Y2hfc3RyaW5nKQoKICAgICAgICAgICAgKToKCiAgICAgICAgICAgICAgICBzcmMsIG1hdCA9IHNfbQoKICAgICAgICAgICAgICAgIGlmIHNlbGYuY2FzZWxlc3M6CgogICAgICAgICAgICAgICAgICAgIHNyYywgbWF0ID0gc3JjLmxvd2VyKCksIG1hdC5sb3dlcigpCgoKCiAgICAgICAgICAgICAgICBpZiBzcmMgIT0gbWF0OgoKICAgICAgICAgICAgICAgICAgICBtaXNtYXRjaGVzLmFwcGVuZChtYXRjaF9zdHJpbmdsb2MpCgogICAgICAgICAgICAgICAgICAgIGlmIGxlbihtaXNtYXRjaGVzKSA+IG1heE1pc21hdGNoZXM6CgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICBsb2MgPSBzdGFydCArIG1hdGNoX3N0cmluZ2xvYyArIDEKCiAgICAgICAgICAgICAgICByZXN1bHRzID0gUGFyc2VSZXN1bHRzKFtpbnN0cmluZ1tzdGFydDpsb2NdXSkKCiAgICAgICAgICAgICAgICByZXN1bHRzW1wib3JpZ2luYWxcIl0gPSBtYXRjaF9zdHJpbmcKCiAgICAgICAgICAgICAgICByZXN1bHRzW1wibWlzbWF0Y2hlc1wiXSA9IG1pc21hdGNoZXMKCiAgICAgICAgICAgICAgICByZXR1cm4gbG9jLCByZXN1bHRzCgoKCiAgICAgICAgcmFpc2UgUGFyc2VFeGNlcHRpb24oaW5zdHJpbmcsIGxvYywgc2VsZi5lcnJtc2csIHNlbGYpCgoKCgoKY2xhc3MgV29yZChUb2tlbik6CgogICAgXCJcIlwiVG9rZW4gZm9yIG1hdGNoaW5nIHdvcmRzIGNvbXBvc2VkIG9mIGFsbG93ZWQgY2hhcmFjdGVyIHNldHMuCgogICAgUGFyYW1ldGVyczoKCiAgICAtIGBgaW5pdF9jaGFyc2BgIC0gc3RyaW5nIG9mIGFsbCBjaGFyYWN0ZXJzIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8KCiAgICAgIG1hdGNoIGFzIGEgd29yZDsgXCJBQkNcIiB3aWxsIG1hdGNoIFwiQUFBXCIsIFwiQUJBQlwiLCBcIkNCQUNcIiwgZXRjLjsKCiAgICAgIGlmIGBgYm9keV9jaGFyc2BgIGlzIGFsc28gc3BlY2lmaWVkLCB0aGVuIHRoaXMgaXMgdGhlIHN0cmluZyBvZgoKICAgICAgaW5pdGlhbCBjaGFyYWN0ZXJzCgogICAgLSBgYGJvZHlfY2hhcnNgYCAtIHN0cmluZyBvZiBjaGFyYWN0ZXJzIHRoYXQKCiAgICAgIGNhbiBiZSB1c2VkIGZvciBtYXRjaGluZyBhZnRlciBhIG1hdGNoZWQgaW5pdGlhbCBjaGFyYWN0ZXIgYXMKCiAgICAgIGdpdmVuIGluIGBgaW5pdF9jaGFyc2BgOyBpZiBvbWl0dGVkLCBzYW1lIGFzIHRoZSBpbml0aWFsIGNoYXJhY3RlcnMKCiAgICAgIChkZWZhdWx0PWBgTm9uZWBgKQoKICAgIC0gYGBtaW5gYCAtIG1pbmltdW0gbnVtYmVyIG9mIGNoYXJhY3RlcnMgdG8gbWF0Y2ggKGRlZmF1bHQ9MSkKCiAgICAtIGBgbWF4YGAgLSBtYXhpbXVtIG51bWJlciBvZiBjaGFyYWN0ZXJzIHRvIG1hdGNoIChkZWZhdWx0PTApCgogICAgLSBgYGV4YWN0YGAgLSBleGFjdCBudW1iZXIgb2YgY2hhcmFjdGVycyB0byBtYXRjaCAoZGVmYXVsdD0wKQoKICAgIC0gYGBhc19rZXl3b3JkYGAgLSBtYXRjaCBhcyBhIGtleXdvcmQgKGRlZmF1bHQ9YGBGYWxzZWBgKQoKICAgIC0gYGBleGNsdWRlX2NoYXJzYGAgLSBjaGFyYWN0ZXJzIHRoYXQgbWlnaHQgYmUKCiAgICAgIGZvdW5kIGluIHRoZSBpbnB1dCBgYGJvZHlfY2hhcnNgYCBzdHJpbmcgYnV0IHdoaWNoIHNob3VsZCBub3QgYmUKCiAgICAgIGFjY2VwdGVkIGZvciBtYXRjaGluZyA7dXNlZnVsIHRvIGRlZmluZSBhIHdvcmQgb2YgYWxsCgogICAgICBwcmludGFibGVzIGV4Y2VwdCBmb3Igb25lIG9yIHR3byBjaGFyYWN0ZXJzLCBmb3IgaW5zdGFuY2UKCiAgICAgIChkZWZhdWx0PWBgTm9uZWBgKQoKCgogICAgOmNsYXNzOmBzcmFuZ2VgIGlzIHVzZWZ1bCBmb3IgZGVmaW5pbmcgY3VzdG9tIGNoYXJhY3RlciBzZXQgc3RyaW5ncwoKICAgIGZvciBkZWZpbmluZyA6Y2xhc3M6YFdvcmRgIGV4cHJlc3Npb25zLCB1c2luZyByYW5nZSBub3RhdGlvbiBmcm9tCgogICAgcmVndWxhciBleHByZXNzaW9uIGNoYXJhY3RlciBzZXRzLgoKCgogICAgQSBjb21tb24gbWlzdGFrZSBpcyB0byB1c2UgOmNsYXNzOmBXb3JkYCB0byBtYXRjaCBhIHNwZWNpZmljIGxpdGVyYWwKCiAgICBzdHJpbmcsIGFzIGluIGBgV29yZChcIkFkZHJlc3NcIilgYC4gUmVtZW1iZXIgdGhhdCA6Y2xhc3M6YFdvcmRgCgogICAgdXNlcyB0aGUgc3RyaW5nIGFyZ3VtZW50IHRvIGRlZmluZSAqc2V0cyogb2YgbWF0Y2hhYmxlIGNoYXJhY3RlcnMuCgogICAgVGhpcyBleHByZXNzaW9uIHdvdWxkIG1hdGNoIFwiQWRkXCIsIFwiQUFBXCIsIFwiZEFyZWRcIiwgb3IgYW55IG90aGVyIHdvcmQKCiAgICBtYWRlIHVwIG9mIHRoZSBjaGFyYWN0ZXJzICdBJywgJ2QnLCAncicsICdlJywgYW5kICdzJy4gVG8gbWF0Y2ggYW4KCiAgICBleGFjdCBsaXRlcmFsIHN0cmluZywgdXNlIDpjbGFzczpgTGl0ZXJhbGAgb3IgOmNsYXNzOmBLZXl3b3JkYC4KCgoKICAgIHB5cGFyc2luZyBpbmNsdWRlcyBoZWxwZXIgc3RyaW5ncyBmb3IgYnVpbGRpbmcgV29yZHM6CgoKCiAgICAtIDpjbGFzczpgYWxwaGFzYAoKICAgIC0gOmNsYXNzOmBudW1zYAoKICAgIC0gOmNsYXNzOmBhbHBoYW51bXNgCgogICAgLSA6Y2xhc3M6YGhleG51bXNgCgogICAgLSA6Y2xhc3M6YGFscGhhczhiaXRgIChhbHBoYWJldGljIGNoYXJhY3RlcnMgaW4gQVNDSUkgcmFuZ2UgMTI4LTI1NQoKICAgICAgLSBhY2NlbnRlZCwgdGlsZGVkLCB1bWxhdXRlZCwgZXRjLikKCiAgICAtIDpjbGFzczpgcHVuYzhiaXRgIChub24tYWxwaGFiZXRpYyBjaGFyYWN0ZXJzIGluIEFTQ0lJIHJhbmdlCgogICAgICAxMjgtMjU1IC0gY3VycmVuY3ksIHN5bWJvbHMsIHN1cGVyc2NyaXB0cywgZGlhY3JpdGljYWxzLCBldGMuKQoKICAgIC0gOmNsYXNzOmBwcmludGFibGVzYCAoYW55IG5vbi13aGl0ZXNwYWNlIGNoYXJhY3RlcikKCgoKICAgIGBgYWxwaGFzYGAsIGBgbnVtc2BgLCBhbmQgYGBwcmludGFibGVzYGAgYXJlIGFsc28gZGVmaW5lZCBpbiBzZXZlcmFsCgogICAgVW5pY29kZSBzZXRzIC0gc2VlIDpjbGFzczpgcHlwYXJzaW5nX3VuaWNvZGVgYC4KCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgICMgYSB3b3JkIGNvbXBvc2VkIG9mIGRpZ2l0cwoKICAgICAgICBpbnRlZ2VyID0gV29yZChudW1zKSAjIGVxdWl2YWxlbnQgdG8gV29yZChcIjAxMjM0NTY3ODlcIikgb3IgV29yZChzcmFuZ2UoXCIwLTlcIikpCgoKCiAgICAgICAgIyBhIHdvcmQgd2l0aCBhIGxlYWRpbmcgY2FwaXRhbCwgYW5kIHplcm8gb3IgbW9yZSBsb3dlcmNhc2UKCiAgICAgICAgY2FwaXRhbF93b3JkID0gV29yZChhbHBoYXMudXBwZXIoKSwgYWxwaGFzLmxvd2VyKCkpCgoKCiAgICAgICAgIyBob3N0bmFtZXMgYXJlIGFscGhhbnVtZXJpYywgd2l0aCBsZWFkaW5nIGFscGhhLCBhbmQgJy0nCgogICAgICAgIGhvc3RuYW1lID0gV29yZChhbHBoYXMsIGFscGhhbnVtcyArICctJykKCgoKICAgICAgICAjIHJvbWFuIG51bWVyYWwgKG5vdCBhIHN0cmljdCBwYXJzZXIsIGFjY2VwdHMgaW52YWxpZCBtaXggb2YgY2hhcmFjdGVycykKCiAgICAgICAgcm9tYW4gPSBXb3JkKFwiSVZYTENETVwiKQoKCgogICAgICAgICMgYW55IHN0cmluZyBvZiBub24td2hpdGVzcGFjZSBjaGFyYWN0ZXJzLCBleGNlcHQgZm9yICcsJwoKICAgICAgICBjc3ZfdmFsdWUgPSBXb3JkKHByaW50YWJsZXMsIGV4Y2x1ZGVfY2hhcnM9XCIsXCIpCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oCgogICAgICAgIHNlbGYsCgogICAgICAgIGluaXRfY2hhcnM6IHN0ciA9IFwiXCIsCgogICAgICAgIGJvZHlfY2hhcnM6IHR5cGluZy5PcHRpb25hbFtzdHJdID0gTm9uZSwKCiAgICAgICAgbWluOiBpbnQgPSAxLAoKICAgICAgICBtYXg6IGludCA9IDAsCgogICAgICAgIGV4YWN0OiBpbnQgPSAwLAoKICAgICAgICBhc19rZXl3b3JkOiBib29sID0gRmFsc2UsCgogICAgICAgIGV4Y2x1ZGVfY2hhcnM6IHR5cGluZy5PcHRpb25hbFtzdHJdID0gTm9uZSwKCiAgICAgICAgKiwKCiAgICAgICAgaW5pdENoYXJzOiB0eXBpbmcuT3B0aW9uYWxbc3RyXSA9IE5vbmUsCgogICAgICAgIGJvZHlDaGFyczogdHlwaW5nLk9wdGlvbmFsW3N0cl0gPSBOb25lLAoKICAgICAgICBhc0tleXdvcmQ6IGJvb2wgPSBGYWxzZSwKCiAgICAgICAgZXhjbHVkZUNoYXJzOiB0eXBpbmcuT3B0aW9uYWxbc3RyXSA9IE5vbmUsCgogICAgKToKCiAgICAgICAgaW5pdENoYXJzID0gaW5pdENoYXJzIG9yIGluaXRfY2hhcnMKCiAgICAgICAgYm9keUNoYXJzID0gYm9keUNoYXJzIG9yIGJvZHlfY2hhcnMKCiAgICAgICAgYXNLZXl3b3JkID0gYXNLZXl3b3JkIG9yIGFzX2tleXdvcmQKCiAgICAgICAgZXhjbHVkZUNoYXJzID0gZXhjbHVkZUNoYXJzIG9yIGV4Y2x1ZGVfY2hhcnMKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpCgogICAgICAgIGlmIG5vdCBpbml0Q2hhcnM6CgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKAoKICAgICAgICAgICAgICAgIFwiaW52YWxpZCB7fSwgaW5pdENoYXJzIGNhbm5vdCBiZSBlbXB0eSBzdHJpbmdcIi5mb3JtYXQoCgogICAgICAgICAgICAgICAgICAgIHR5cGUoc2VsZikuX19uYW1lX18KCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICApCgoKCiAgICAgICAgaW5pdENoYXJzID0gc2V0KGluaXRDaGFycykKCiAgICAgICAgc2VsZi5pbml0Q2hhcnMgPSBpbml0Q2hhcnMKCiAgICAgICAgaWYgZXhjbHVkZUNoYXJzOgoKICAgICAgICAgICAgZXhjbHVkZUNoYXJzID0gc2V0KGV4Y2x1ZGVDaGFycykKCiAgICAgICAgICAgIGluaXRDaGFycyAtPSBleGNsdWRlQ2hhcnMKCiAgICAgICAgICAgIGlmIGJvZHlDaGFyczoKCiAgICAgICAgICAgICAgICBib2R5Q2hhcnMgPSBzZXQoYm9keUNoYXJzKSAtIGV4Y2x1ZGVDaGFycwoKICAgICAgICBzZWxmLmluaXRDaGFyc09yaWcgPSBcIlwiLmpvaW4oc29ydGVkKGluaXRDaGFycykpCgoKCiAgICAgICAgaWYgYm9keUNoYXJzOgoKICAgICAgICAgICAgc2VsZi5ib2R5Q2hhcnNPcmlnID0gXCJcIi5qb2luKHNvcnRlZChib2R5Q2hhcnMpKQoKICAgICAgICAgICAgc2VsZi5ib2R5Q2hhcnMgPSBzZXQoYm9keUNoYXJzKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgc2VsZi5ib2R5Q2hhcnNPcmlnID0gXCJcIi5qb2luKHNvcnRlZChpbml0Q2hhcnMpKQoKICAgICAgICAgICAgc2VsZi5ib2R5Q2hhcnMgPSBzZXQoaW5pdENoYXJzKQoKCgogICAgICAgIHNlbGYubWF4U3BlY2lmaWVkID0gbWF4ID4gMAoKCgogICAgICAgIGlmIG1pbiA8IDE6CgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKAoKICAgICAgICAgICAgICAgIFwiY2Fubm90IHNwZWNpZnkgYSBtaW5pbXVtIGxlbmd0aCA8IDE7IHVzZSBPcHQoV29yZCgpKSBpZiB6ZXJvLWxlbmd0aCB3b3JkIGlzIHBlcm1pdHRlZFwiCgogICAgICAgICAgICApCgoKCiAgICAgICAgc2VsZi5taW5MZW4gPSBtaW4KCgoKICAgICAgICBpZiBtYXggPiAwOgoKICAgICAgICAgICAgc2VsZi5tYXhMZW4gPSBtYXgKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHNlbGYubWF4TGVuID0gX01BWF9JTlQKCgoKICAgICAgICBpZiBleGFjdCA+IDA6CgogICAgICAgICAgICBzZWxmLm1heExlbiA9IGV4YWN0CgogICAgICAgICAgICBzZWxmLm1pbkxlbiA9IGV4YWN0CgoKCiAgICAgICAgc2VsZi5lcnJtc2cgPSBcIkV4cGVjdGVkIFwiICsgc2VsZi5uYW1lCgogICAgICAgIHNlbGYubWF5SW5kZXhFcnJvciA9IEZhbHNlCgogICAgICAgIHNlbGYuYXNLZXl3b3JkID0gYXNLZXl3b3JkCgoKCiAgICAgICAgIyBzZWUgaWYgd2UgY2FuIG1ha2UgYSByZWdleCBmb3IgdGhpcyBXb3JkCgogICAgICAgIGlmIFwiIFwiIG5vdCBpbiBzZWxmLmluaXRDaGFycyB8IHNlbGYuYm9keUNoYXJzIGFuZCAobWluID09IDEgYW5kIGV4YWN0ID09IDApOgoKICAgICAgICAgICAgaWYgc2VsZi5ib2R5Q2hhcnMgPT0gc2VsZi5pbml0Q2hhcnM6CgogICAgICAgICAgICAgICAgaWYgbWF4ID09IDA6CgogICAgICAgICAgICAgICAgICAgIHJlcGVhdCA9IFwiK1wiCgogICAgICAgICAgICAgICAgZWxpZiBtYXggPT0gMToKCiAgICAgICAgICAgICAgICAgICAgcmVwZWF0ID0gXCJcIgoKICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgIHJlcGVhdCA9IFwie3t7fSx7fX19XCIuZm9ybWF0KAoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5taW5MZW4sIFwiXCIgaWYgc2VsZi5tYXhMZW4gPT0gX01BWF9JTlQgZWxzZSBzZWxmLm1heExlbgoKICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgc2VsZi5yZVN0cmluZyA9IFwiW3t9XXt9XCIuZm9ybWF0KAoKICAgICAgICAgICAgICAgICAgICBfY29sbGFwc2Vfc3RyaW5nX3RvX3JhbmdlcyhzZWxmLmluaXRDaGFycyksCgogICAgICAgICAgICAgICAgICAgIHJlcGVhdCwKCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICBlbGlmIGxlbihzZWxmLmluaXRDaGFycykgPT0gMToKCiAgICAgICAgICAgICAgICBpZiBtYXggPT0gMDoKCiAgICAgICAgICAgICAgICAgICAgcmVwZWF0ID0gXCIqXCIKCiAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICByZXBlYXQgPSBcInt7MCx7fX19XCIuZm9ybWF0KG1heCAtIDEpCgogICAgICAgICAgICAgICAgc2VsZi5yZVN0cmluZyA9IFwie31be31de31cIi5mb3JtYXQoCgogICAgICAgICAgICAgICAgICAgIHJlLmVzY2FwZShzZWxmLmluaXRDaGFyc09yaWcpLAoKICAgICAgICAgICAgICAgICAgICBfY29sbGFwc2Vfc3RyaW5nX3RvX3JhbmdlcyhzZWxmLmJvZHlDaGFycyksCgogICAgICAgICAgICAgICAgICAgIHJlcGVhdCwKCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIGlmIG1heCA9PSAwOgoKICAgICAgICAgICAgICAgICAgICByZXBlYXQgPSBcIipcIgoKICAgICAgICAgICAgICAgIGVsaWYgbWF4ID09IDI6CgogICAgICAgICAgICAgICAgICAgIHJlcGVhdCA9IFwiXCIKCiAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICByZXBlYXQgPSBcInt7MCx7fX19XCIuZm9ybWF0KG1heCAtIDEpCgogICAgICAgICAgICAgICAgc2VsZi5yZVN0cmluZyA9IFwiW3t9XVt7fV17fVwiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICAgICAgX2NvbGxhcHNlX3N0cmluZ190b19yYW5nZXMoc2VsZi5pbml0Q2hhcnMpLAoKICAgICAgICAgICAgICAgICAgICBfY29sbGFwc2Vfc3RyaW5nX3RvX3JhbmdlcyhzZWxmLmJvZHlDaGFycyksCgogICAgICAgICAgICAgICAgICAgIHJlcGVhdCwKCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICBpZiBzZWxmLmFzS2V5d29yZDoKCiAgICAgICAgICAgICAgICBzZWxmLnJlU3RyaW5nID0gclwiXFxiXCIgKyBzZWxmLnJlU3RyaW5nICsgclwiXFxiXCIKCgoKICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgIHNlbGYucmUgPSByZS5jb21waWxlKHNlbGYucmVTdHJpbmcpCgogICAgICAgICAgICBleGNlcHQgcmUuZXJyb3I6CgogICAgICAgICAgICAgICAgc2VsZi5yZSA9IE5vbmUKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgc2VsZi5yZV9tYXRjaCA9IHNlbGYucmUubWF0Y2gKCiAgICAgICAgICAgICAgICBzZWxmLl9fY2xhc3NfXyA9IF9Xb3JkUmVnZXgKCgoKICAgIGRlZiBfZ2VuZXJhdGVEZWZhdWx0TmFtZShzZWxmKToKCiAgICAgICAgZGVmIGNoYXJzQXNTdHIocyk6CgogICAgICAgICAgICBtYXhfcmVwcl9sZW4gPSAxNgoKICAgICAgICAgICAgcyA9IF9jb2xsYXBzZV9zdHJpbmdfdG9fcmFuZ2VzKHMsIHJlX2VzY2FwZT1GYWxzZSkKCiAgICAgICAgICAgIGlmIGxlbihzKSA+IG1heF9yZXByX2xlbjoKCiAgICAgICAgICAgICAgICByZXR1cm4gc1s6IG1heF9yZXByX2xlbiAtIDNdICsgXCIuLi5cIgoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICByZXR1cm4gcwoKCgogICAgICAgIGlmIHNlbGYuaW5pdENoYXJzICE9IHNlbGYuYm9keUNoYXJzOgoKICAgICAgICAgICAgYmFzZSA9IFwiVzooe30sIHt9KVwiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICBjaGFyc0FzU3RyKHNlbGYuaW5pdENoYXJzKSwgY2hhcnNBc1N0cihzZWxmLmJvZHlDaGFycykKCiAgICAgICAgICAgICkKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIGJhc2UgPSBcIlc6KHt9KVwiLmZvcm1hdChjaGFyc0FzU3RyKHNlbGYuaW5pdENoYXJzKSkKCgoKICAgICAgICAjIGFkZCBsZW5ndGggc3BlY2lmaWNhdGlvbgoKICAgICAgICBpZiBzZWxmLm1pbkxlbiA+IDEgb3Igc2VsZi5tYXhMZW4gIT0gX01BWF9JTlQ6CgogICAgICAgICAgICBpZiBzZWxmLm1pbkxlbiA9PSBzZWxmLm1heExlbjoKCiAgICAgICAgICAgICAgICBpZiBzZWxmLm1pbkxlbiA9PSAxOgoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYmFzZVsyOl0KCiAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYmFzZSArIFwie3t7fX19XCIuZm9ybWF0KHNlbGYubWluTGVuKQoKICAgICAgICAgICAgZWxpZiBzZWxmLm1heExlbiA9PSBfTUFYX0lOVDoKCiAgICAgICAgICAgICAgICByZXR1cm4gYmFzZSArIFwie3t7fSwuLi59fVwiLmZvcm1hdChzZWxmLm1pbkxlbikKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgcmV0dXJuIGJhc2UgKyBcInt7e30se319fVwiLmZvcm1hdChzZWxmLm1pbkxlbiwgc2VsZi5tYXhMZW4pCgogICAgICAgIHJldHVybiBiYXNlCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgaWYgaW5zdHJpbmdbbG9jXSBub3QgaW4gc2VsZi5pbml0Q2hhcnM6CgogICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBzZWxmLmVycm1zZywgc2VsZikKCgoKICAgICAgICBzdGFydCA9IGxvYwoKICAgICAgICBsb2MgKz0gMQoKICAgICAgICBpbnN0cmxlbiA9IGxlbihpbnN0cmluZykKCiAgICAgICAgYm9keWNoYXJzID0gc2VsZi5ib2R5Q2hhcnMKCiAgICAgICAgbWF4bG9jID0gc3RhcnQgKyBzZWxmLm1heExlbgoKICAgICAgICBtYXhsb2MgPSBtaW4obWF4bG9jLCBpbnN0cmxlbikKCiAgICAgICAgd2hpbGUgbG9jIDwgbWF4bG9jIGFuZCBpbnN0cmluZ1tsb2NdIGluIGJvZHljaGFyczoKCiAgICAgICAgICAgIGxvYyArPSAxCgoKCiAgICAgICAgdGhyb3dFeGNlcHRpb24gPSBGYWxzZQoKICAgICAgICBpZiBsb2MgLSBzdGFydCA8IHNlbGYubWluTGVuOgoKICAgICAgICAgICAgdGhyb3dFeGNlcHRpb24gPSBUcnVlCgogICAgICAgIGVsaWYgc2VsZi5tYXhTcGVjaWZpZWQgYW5kIGxvYyA8IGluc3RybGVuIGFuZCBpbnN0cmluZ1tsb2NdIGluIGJvZHljaGFyczoKCiAgICAgICAgICAgIHRocm93RXhjZXB0aW9uID0gVHJ1ZQoKICAgICAgICBlbGlmIHNlbGYuYXNLZXl3b3JkOgoKICAgICAgICAgICAgaWYgKAoKICAgICAgICAgICAgICAgIHN0YXJ0ID4gMAoKICAgICAgICAgICAgICAgIGFuZCBpbnN0cmluZ1tzdGFydCAtIDFdIGluIGJvZHljaGFycwoKICAgICAgICAgICAgICAgIG9yIGxvYyA8IGluc3RybGVuCgogICAgICAgICAgICAgICAgYW5kIGluc3RyaW5nW2xvY10gaW4gYm9keWNoYXJzCgogICAgICAgICAgICApOgoKICAgICAgICAgICAgICAgIHRocm93RXhjZXB0aW9uID0gVHJ1ZQoKCgogICAgICAgIGlmIHRocm93RXhjZXB0aW9uOgoKICAgICAgICAgICAgcmFpc2UgUGFyc2VFeGNlcHRpb24oaW5zdHJpbmcsIGxvYywgc2VsZi5lcnJtc2csIHNlbGYpCgoKCiAgICAgICAgcmV0dXJuIGxvYywgaW5zdHJpbmdbc3RhcnQ6bG9jXQoKCgoKCmNsYXNzIF9Xb3JkUmVnZXgoV29yZCk6CgogICAgZGVmIHBhcnNlSW1wbChzZWxmLCBpbnN0cmluZywgbG9jLCBkb0FjdGlvbnM9VHJ1ZSk6CgogICAgICAgIHJlc3VsdCA9IHNlbGYucmVfbWF0Y2goaW5zdHJpbmcsIGxvYykKCiAgICAgICAgaWYgbm90IHJlc3VsdDoKCiAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsb2MsIHNlbGYuZXJybXNnLCBzZWxmKQoKCgogICAgICAgIGxvYyA9IHJlc3VsdC5lbmQoKQoKICAgICAgICByZXR1cm4gbG9jLCByZXN1bHQuZ3JvdXAoKQoKCgoKCmNsYXNzIENoYXIoX1dvcmRSZWdleCk6CgogICAgXCJcIlwiQSBzaG9ydC1jdXQgY2xhc3MgZm9yIGRlZmluaW5nIDpjbGFzczpgV29yZGAgYGAoY2hhcmFjdGVycywgZXhhY3Q9MSlgYCwKCiAgICB3aGVuIGRlZmluaW5nIGEgbWF0Y2ggb2YgYW55IHNpbmdsZSBjaGFyYWN0ZXIgaW4gYSBzdHJpbmcgb2YKCiAgICBjaGFyYWN0ZXJzLgoKICAgIFwiXCJcIgoKCgogICAgZGVmIF9faW5pdF9fKAoKICAgICAgICBzZWxmLAoKICAgICAgICBjaGFyc2V0OiBzdHIsCgogICAgICAgIGFzX2tleXdvcmQ6IGJvb2wgPSBGYWxzZSwKCiAgICAgICAgZXhjbHVkZV9jaGFyczogdHlwaW5nLk9wdGlvbmFsW3N0cl0gPSBOb25lLAoKICAgICAgICAqLAoKICAgICAgICBhc0tleXdvcmQ6IGJvb2wgPSBGYWxzZSwKCiAgICAgICAgZXhjbHVkZUNoYXJzOiB0eXBpbmcuT3B0aW9uYWxbc3RyXSA9IE5vbmUsCgogICAgKToKCiAgICAgICAgYXNLZXl3b3JkID0gYXNLZXl3b3JkIG9yIGFzX2tleXdvcmQKCiAgICAgICAgZXhjbHVkZUNoYXJzID0gZXhjbHVkZUNoYXJzIG9yIGV4Y2x1ZGVfY2hhcnMKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygKCiAgICAgICAgICAgIGNoYXJzZXQsIGV4YWN0PTEsIGFzS2V5d29yZD1hc0tleXdvcmQsIGV4Y2x1ZGVDaGFycz1leGNsdWRlQ2hhcnMKCiAgICAgICAgKQoKICAgICAgICBzZWxmLnJlU3RyaW5nID0gXCJbe31dXCIuZm9ybWF0KF9jb2xsYXBzZV9zdHJpbmdfdG9fcmFuZ2VzKHNlbGYuaW5pdENoYXJzKSkKCiAgICAgICAgaWYgYXNLZXl3b3JkOgoKICAgICAgICAgICAgc2VsZi5yZVN0cmluZyA9IHJcIlxcYnt9XFxiXCIuZm9ybWF0KHNlbGYucmVTdHJpbmcpCgogICAgICAgIHNlbGYucmUgPSByZS5jb21waWxlKHNlbGYucmVTdHJpbmcpCgogICAgICAgIHNlbGYucmVfbWF0Y2ggPSBzZWxmLnJlLm1hdGNoCgoKCgoKY2xhc3MgUmVnZXgoVG9rZW4pOgoKICAgIHJcIlwiXCJUb2tlbiBmb3IgbWF0Y2hpbmcgc3RyaW5ncyB0aGF0IG1hdGNoIGEgZ2l2ZW4gcmVndWxhcgoKICAgIGV4cHJlc3Npb24uIERlZmluZWQgd2l0aCBzdHJpbmcgc3BlY2lmeWluZyB0aGUgcmVndWxhciBleHByZXNzaW9uIGluCgogICAgYSBmb3JtIHJlY29nbml6ZWQgYnkgdGhlIHN0ZGxpYiBQeXRob24gIGByZSBtb2R1bGUgPGh0dHBzOi8vZG9jcy5weXRob24ub3JnLzMvbGlicmFyeS9yZS5odG1sPmBfLgoKICAgIElmIHRoZSBnaXZlbiByZWdleCBjb250YWlucyBuYW1lZCBncm91cHMgKGRlZmluZWQgdXNpbmcgYGAoP1A8bmFtZT4uLi4pYGApLAoKICAgIHRoZXNlIHdpbGwgYmUgcHJlc2VydmVkIGFzIG5hbWVkIDpjbGFzczpgUGFyc2VSZXN1bHRzYC4KCgoKICAgIElmIGluc3RlYWQgb2YgdGhlIFB5dGhvbiBzdGRsaWIgYGByZWBgIG1vZHVsZSB5b3Ugd2lzaCB0byB1c2UgYSBkaWZmZXJlbnQgUkUgbW9kdWxlCgogICAgKHN1Y2ggYXMgdGhlIGBgcmVnZXhgYCBtb2R1bGUpLCB5b3UgY2FuIGRvIHNvIGJ5IGJ1aWxkaW5nIHlvdXIgYGBSZWdleGBgIG9iamVjdCB3aXRoCgogICAgYSBjb21waWxlZCBSRSB0aGF0IHdhcyBjb21waWxlZCB1c2luZyBgYHJlZ2V4YGAuCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICByZWFsbnVtID0gUmVnZXgoclwiWystXT9cXGQrXFwuXFxkKlwiKQoKICAgICAgICAjIHJlZjogaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjY3Mzk5L2hvdy1kby15b3UtbWF0Y2gtb25seS12YWxpZC1yb21hbi1udW1lcmFscy13aXRoLWEtcmVndWxhci1leHByZXNzaW9uCgogICAgICAgIHJvbWFuID0gUmVnZXgoclwiTXswLDR9KENNfENEfEQ/ezAsM30pKFhDfFhMfEw/WHswLDN9KShJWHxJVnxWP0l7MCwzfSlcIikKCgoKICAgICAgICAjIG5hbWVkIGZpZWxkcyBpbiBhIHJlZ2V4IHdpbGwgYmUgcmV0dXJuZWQgYXMgbmFtZWQgcmVzdWx0cwoKICAgICAgICBkYXRlID0gUmVnZXgocicoP1A8eWVhcj5cXGR7NH0pLSg/UDxtb250aD5cXGRcXGQ/KS0oP1A8ZGF5PlxcZFxcZD8pJykKCgoKICAgICAgICAjIHRoZSBSZWdleCBjbGFzcyB3aWxsIGFjY2VwdCByZSdzIGNvbXBpbGVkIHVzaW5nIHRoZSByZWdleCBtb2R1bGUKCiAgICAgICAgaW1wb3J0IHJlZ2V4CgogICAgICAgIHBhcnNlciA9IHBwLlJlZ2V4KHJlZ2V4LmNvbXBpbGUocidbMC05XScpKQoKICAgIFwiXCJcIgoKCgogICAgZGVmIF9faW5pdF9fKAoKICAgICAgICBzZWxmLAoKICAgICAgICBwYXR0ZXJuOiBBbnksCgogICAgICAgIGZsYWdzOiBVbmlvbltyZS5SZWdleEZsYWcsIGludF0gPSAwLAoKICAgICAgICBhc19ncm91cF9saXN0OiBib29sID0gRmFsc2UsCgogICAgICAgIGFzX21hdGNoOiBib29sID0gRmFsc2UsCgogICAgICAgICosCgogICAgICAgIGFzR3JvdXBMaXN0OiBib29sID0gRmFsc2UsCgogICAgICAgIGFzTWF0Y2g6IGJvb2wgPSBGYWxzZSwKCiAgICApOgoKICAgICAgICBcIlwiXCJUaGUgcGFyYW1ldGVycyBgYHBhdHRlcm5gYCBhbmQgYGBmbGFnc2BgIGFyZSBwYXNzZWQKCiAgICAgICAgdG8gdGhlIGBgcmUuY29tcGlsZSgpYGAgZnVuY3Rpb24gYXMtaXMuIFNlZSB0aGUgUHl0aG9uCgogICAgICAgIGByZSBtb2R1bGUgPGh0dHBzOi8vZG9jcy5weXRob24ub3JnLzMvbGlicmFyeS9yZS5odG1sPmBfIG1vZHVsZSBmb3IgYW4KCiAgICAgICAgZXhwbGFuYXRpb24gb2YgdGhlIGFjY2VwdGFibGUgcGF0dGVybnMgYW5kIGZsYWdzLgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpCgogICAgICAgIGFzR3JvdXBMaXN0ID0gYXNHcm91cExpc3Qgb3IgYXNfZ3JvdXBfbGlzdAoKICAgICAgICBhc01hdGNoID0gYXNNYXRjaCBvciBhc19tYXRjaAoKCgogICAgICAgIGlmIGlzaW5zdGFuY2UocGF0dGVybiwgc3RyX3R5cGUpOgoKICAgICAgICAgICAgaWYgbm90IHBhdHRlcm46CgogICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihcIm51bGwgc3RyaW5nIHBhc3NlZCB0byBSZWdleDsgdXNlIEVtcHR5KCkgaW5zdGVhZFwiKQoKCgogICAgICAgICAgICBzZWxmLl9yZSA9IE5vbmUKCiAgICAgICAgICAgIHNlbGYucmVTdHJpbmcgPSBzZWxmLnBhdHRlcm4gPSBwYXR0ZXJuCgogICAgICAgICAgICBzZWxmLmZsYWdzID0gZmxhZ3MKCgoKICAgICAgICBlbGlmIGhhc2F0dHIocGF0dGVybiwgXCJwYXR0ZXJuXCIpIGFuZCBoYXNhdHRyKHBhdHRlcm4sIFwibWF0Y2hcIik6CgogICAgICAgICAgICBzZWxmLl9yZSA9IHBhdHRlcm4KCiAgICAgICAgICAgIHNlbGYucGF0dGVybiA9IHNlbGYucmVTdHJpbmcgPSBwYXR0ZXJuLnBhdHRlcm4KCiAgICAgICAgICAgIHNlbGYuZmxhZ3MgPSBmbGFncwoKCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoCgogICAgICAgICAgICAgICAgXCJSZWdleCBtYXkgb25seSBiZSBjb25zdHJ1Y3RlZCB3aXRoIGEgc3RyaW5nIG9yIGEgY29tcGlsZWQgUkUgb2JqZWN0XCIKCiAgICAgICAgICAgICkKCgoKICAgICAgICBzZWxmLmVycm1zZyA9IFwiRXhwZWN0ZWQgXCIgKyBzZWxmLm5hbWUKCiAgICAgICAgc2VsZi5tYXlJbmRleEVycm9yID0gRmFsc2UKCiAgICAgICAgc2VsZi5hc0dyb3VwTGlzdCA9IGFzR3JvdXBMaXN0CgogICAgICAgIHNlbGYuYXNNYXRjaCA9IGFzTWF0Y2gKCiAgICAgICAgaWYgc2VsZi5hc0dyb3VwTGlzdDoKCiAgICAgICAgICAgIHNlbGYucGFyc2VJbXBsID0gc2VsZi5wYXJzZUltcGxBc0dyb3VwTGlzdAoKICAgICAgICBpZiBzZWxmLmFzTWF0Y2g6CgogICAgICAgICAgICBzZWxmLnBhcnNlSW1wbCA9IHNlbGYucGFyc2VJbXBsQXNNYXRjaAoKCgogICAgQGNhY2hlZF9wcm9wZXJ0eQoKICAgIGRlZiByZShzZWxmKToKCiAgICAgICAgaWYgc2VsZi5fcmU6CgogICAgICAgICAgICByZXR1cm4gc2VsZi5fcmUKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHRyeToKCiAgICAgICAgICAgICAgICByZXR1cm4gcmUuY29tcGlsZShzZWxmLnBhdHRlcm4sIHNlbGYuZmxhZ3MpCgogICAgICAgICAgICBleGNlcHQgcmUuZXJyb3I6CgogICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKCiAgICAgICAgICAgICAgICAgICAgXCJpbnZhbGlkIHBhdHRlcm4gKHshcn0pIHBhc3NlZCB0byBSZWdleFwiLmZvcm1hdChzZWxmLnBhdHRlcm4pCgogICAgICAgICAgICAgICAgKQoKCgogICAgQGNhY2hlZF9wcm9wZXJ0eQoKICAgIGRlZiByZV9tYXRjaChzZWxmKToKCiAgICAgICAgcmV0dXJuIHNlbGYucmUubWF0Y2gKCgoKICAgIEBjYWNoZWRfcHJvcGVydHkKCiAgICBkZWYgbWF5UmV0dXJuRW1wdHkoc2VsZik6CgogICAgICAgIHJldHVybiBzZWxmLnJlX21hdGNoKFwiXCIpIGlzIG5vdCBOb25lCgoKCiAgICBkZWYgX2dlbmVyYXRlRGVmYXVsdE5hbWUoc2VsZik6CgogICAgICAgIHJldHVybiBcIlJlOih7fSlcIi5mb3JtYXQocmVwcihzZWxmLnBhdHRlcm4pLnJlcGxhY2UoXCJcXFxcXFxcXFwiLCBcIlxcXFxcIikpCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgcmVzdWx0ID0gc2VsZi5yZV9tYXRjaChpbnN0cmluZywgbG9jKQoKICAgICAgICBpZiBub3QgcmVzdWx0OgoKICAgICAgICAgICAgcmFpc2UgUGFyc2VFeGNlcHRpb24oaW5zdHJpbmcsIGxvYywgc2VsZi5lcnJtc2csIHNlbGYpCgoKCiAgICAgICAgbG9jID0gcmVzdWx0LmVuZCgpCgogICAgICAgIHJldCA9IFBhcnNlUmVzdWx0cyhyZXN1bHQuZ3JvdXAoKSkKCiAgICAgICAgZCA9IHJlc3VsdC5ncm91cGRpY3QoKQoKICAgICAgICBpZiBkOgoKICAgICAgICAgICAgZm9yIGssIHYgaW4gZC5pdGVtcygpOgoKICAgICAgICAgICAgICAgIHJldFtrXSA9IHYKCiAgICAgICAgcmV0dXJuIGxvYywgcmV0CgoKCiAgICBkZWYgcGFyc2VJbXBsQXNHcm91cExpc3Qoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICByZXN1bHQgPSBzZWxmLnJlX21hdGNoKGluc3RyaW5nLCBsb2MpCgogICAgICAgIGlmIG5vdCByZXN1bHQ6CgogICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBzZWxmLmVycm1zZywgc2VsZikKCgoKICAgICAgICBsb2MgPSByZXN1bHQuZW5kKCkKCiAgICAgICAgcmV0ID0gcmVzdWx0Lmdyb3VwcygpCgogICAgICAgIHJldHVybiBsb2MsIHJldAoKCgogICAgZGVmIHBhcnNlSW1wbEFzTWF0Y2goc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICByZXN1bHQgPSBzZWxmLnJlX21hdGNoKGluc3RyaW5nLCBsb2MpCgogICAgICAgIGlmIG5vdCByZXN1bHQ6CgogICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBzZWxmLmVycm1zZywgc2VsZikKCgoKICAgICAgICBsb2MgPSByZXN1bHQuZW5kKCkKCiAgICAgICAgcmV0ID0gcmVzdWx0CgogICAgICAgIHJldHVybiBsb2MsIHJldAoKCgogICAgZGVmIHN1YihzZWxmLCByZXBsOiBzdHIpIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgICAgIHJcIlwiXCIKCiAgICAgICAgUmV0dXJuIDpjbGFzczpgUmVnZXhgIHdpdGggYW4gYXR0YWNoZWQgcGFyc2UgYWN0aW9uIHRvIHRyYW5zZm9ybSB0aGUgcGFyc2VkCgogICAgICAgIHJlc3VsdCBhcyBpZiBjYWxsZWQgdXNpbmcgYHJlLnN1YihleHByLCByZXBsLCBzdHJpbmcpIDxodHRwczovL2RvY3MucHl0aG9uLm9yZy8zL2xpYnJhcnkvcmUuaHRtbCNyZS5zdWI+YF8uCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIG1ha2VfaHRtbCA9IFJlZ2V4KHJcIihcXHcrKTooLio/KTpcIikuc3ViKHJcIjxcXDE+XFwyPC9cXDE+XCIpCgogICAgICAgICAgICBwcmludChtYWtlX2h0bWwudHJhbnNmb3JtX3N0cmluZyhcImgxOm1haW4gdGl0bGU6XCIpKQoKICAgICAgICAgICAgIyBwcmludHMgXCI8aDE+bWFpbiB0aXRsZTwvaDE+XCIKCiAgICAgICAgXCJcIlwiCgogICAgICAgIGlmIHNlbGYuYXNHcm91cExpc3Q6CgogICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoXCJjYW5ub3QgdXNlIHN1YigpIHdpdGggUmVnZXgoYXNHcm91cExpc3Q9VHJ1ZSlcIikKCgoKICAgICAgICBpZiBzZWxmLmFzTWF0Y2ggYW5kIGNhbGxhYmxlKHJlcGwpOgoKICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKFwiY2Fubm90IHVzZSBzdWIoKSB3aXRoIGEgY2FsbGFibGUgd2l0aCBSZWdleChhc01hdGNoPVRydWUpXCIpCgoKCiAgICAgICAgaWYgc2VsZi5hc01hdGNoOgoKCgogICAgICAgICAgICBkZWYgcGEodG9rZW5zKToKCiAgICAgICAgICAgICAgICByZXR1cm4gdG9rZW5zWzBdLmV4cGFuZChyZXBsKQoKCgogICAgICAgIGVsc2U6CgoKCiAgICAgICAgICAgIGRlZiBwYSh0b2tlbnMpOgoKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnJlLnN1YihyZXBsLCB0b2tlbnNbMF0pCgoKCiAgICAgICAgcmV0dXJuIHNlbGYuYWRkX3BhcnNlX2FjdGlvbihwYSkKCgoKCgpjbGFzcyBRdW90ZWRTdHJpbmcoVG9rZW4pOgoKICAgIHJcIlwiXCIKCiAgICBUb2tlbiBmb3IgbWF0Y2hpbmcgc3RyaW5ncyB0aGF0IGFyZSBkZWxpbWl0ZWQgYnkgcXVvdGluZyBjaGFyYWN0ZXJzLgoKCgogICAgRGVmaW5lZCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVyczoKCgoKICAgIC0gYGBxdW90ZV9jaGFyYGAgLSBzdHJpbmcgb2Ygb25lIG9yIG1vcmUgY2hhcmFjdGVycyBkZWZpbmluZyB0aGUKCiAgICAgIHF1b3RlIGRlbGltaXRpbmcgc3RyaW5nCgogICAgLSBgYGVzY19jaGFyYGAgLSBjaGFyYWN0ZXIgdG8gcmVfZXNjYXBlIHF1b3RlcywgdHlwaWNhbGx5IGJhY2tzbGFzaAoKICAgICAgKGRlZmF1bHQ9IGBgTm9uZWBgKQoKICAgIC0gYGBlc2NfcXVvdGVgYCAtIHNwZWNpYWwgcXVvdGUgc2VxdWVuY2UgdG8gcmVfZXNjYXBlIGFuIGVtYmVkZGVkIHF1b3RlCgogICAgICBzdHJpbmcgKHN1Y2ggYXMgU1FMJ3MgYGBcIlwiYGAgdG8gcmVfZXNjYXBlIGFuIGVtYmVkZGVkIGBgXCJgYCkKCiAgICAgIChkZWZhdWx0PSBgYE5vbmVgYCkKCiAgICAtIGBgbXVsdGlsaW5lYGAgLSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciBxdW90ZXMgY2FuIHNwYW4KCiAgICAgIG11bHRpcGxlIGxpbmVzIChkZWZhdWx0PSBgYEZhbHNlYGApCgogICAgLSBgYHVucXVvdGVfcmVzdWx0c2BgIC0gYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIG1hdGNoZWQgdGV4dAoKICAgICAgc2hvdWxkIGJlIHVucXVvdGVkIChkZWZhdWx0PSBgYFRydWVgYCkKCiAgICAtIGBgZW5kX3F1b3RlX2NoYXJgYCAtIHN0cmluZyBvZiBvbmUgb3IgbW9yZSBjaGFyYWN0ZXJzIGRlZmluaW5nIHRoZQoKICAgICAgZW5kIG9mIHRoZSBxdW90ZSBkZWxpbWl0ZWQgc3RyaW5nIChkZWZhdWx0PSBgYE5vbmVgYCAgPT4gc2FtZSBhcwoKICAgICAgcXVvdGVfY2hhcikKCiAgICAtIGBgY29udmVydF93aGl0ZXNwYWNlX2VzY2FwZXNgYCAtIGNvbnZlcnQgZXNjYXBlZCB3aGl0ZXNwYWNlCgogICAgICAoYGAnXFx0J2BgLCBgYCdcXG4nYGAsIGV0Yy4pIHRvIGFjdHVhbCB3aGl0ZXNwYWNlCgogICAgICAoZGVmYXVsdD0gYGBUcnVlYGApCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICBxcyA9IFF1b3RlZFN0cmluZygnXCInKQoKICAgICAgICBwcmludChxcy5zZWFyY2hfc3RyaW5nKCdsc2pkZiBcIlRoaXMgaXMgdGhlIHF1b3RlXCIgc2xkamYnKSkKCiAgICAgICAgY29tcGxleF9xcyA9IFF1b3RlZFN0cmluZygne3snLCBlbmRfcXVvdGVfY2hhcj0nfX0nKQoKICAgICAgICBwcmludChjb21wbGV4X3FzLnNlYXJjaF9zdHJpbmcoJ2xzamRmIHt7VGhpcyBpcyB0aGUgXCJxdW90ZVwifX0gc2xkamYnKSkKCiAgICAgICAgc3FsX3FzID0gUXVvdGVkU3RyaW5nKCdcIicsIGVzY19xdW90ZT0nXCJcIicpCgogICAgICAgIHByaW50KHNxbF9xcy5zZWFyY2hfc3RyaW5nKCdsc2pkZiBcIlRoaXMgaXMgdGhlIHF1b3RlIHdpdGggXCJcImVtYmVkZGVkXCJcIiBxdW90ZXNcIiBzbGRqZicpKQoKCgogICAgcHJpbnRzOjoKCgoKICAgICAgICBbWydUaGlzIGlzIHRoZSBxdW90ZSddXQoKICAgICAgICBbWydUaGlzIGlzIHRoZSBcInF1b3RlXCInXV0KCiAgICAgICAgW1snVGhpcyBpcyB0aGUgcXVvdGUgd2l0aCBcImVtYmVkZGVkXCIgcXVvdGVzJ11dCgogICAgXCJcIlwiCgogICAgd3NfbWFwID0gKChyXCJcXHRcIiwgXCJcXHRcIiksIChyXCJcXG5cIiwgXCJcXG5cIiksIChyXCJcXGZcIiwgXCJcXGZcIiksIChyXCJcXHJcIiwgXCJcXHJcIikpCgoKCiAgICBkZWYgX19pbml0X18oCgogICAgICAgIHNlbGYsCgogICAgICAgIHF1b3RlX2NoYXI6IHN0ciA9IFwiXCIsCgogICAgICAgIGVzY19jaGFyOiB0eXBpbmcuT3B0aW9uYWxbc3RyXSA9IE5vbmUsCgogICAgICAgIGVzY19xdW90ZTogdHlwaW5nLk9wdGlvbmFsW3N0cl0gPSBOb25lLAoKICAgICAgICBtdWx0aWxpbmU6IGJvb2wgPSBGYWxzZSwKCiAgICAgICAgdW5xdW90ZV9yZXN1bHRzOiBib29sID0gVHJ1ZSwKCiAgICAgICAgZW5kX3F1b3RlX2NoYXI6IHR5cGluZy5PcHRpb25hbFtzdHJdID0gTm9uZSwKCiAgICAgICAgY29udmVydF93aGl0ZXNwYWNlX2VzY2FwZXM6IGJvb2wgPSBUcnVlLAoKICAgICAgICAqLAoKICAgICAgICBxdW90ZUNoYXI6IHN0ciA9IFwiXCIsCgogICAgICAgIGVzY0NoYXI6IHR5cGluZy5PcHRpb25hbFtzdHJdID0gTm9uZSwKCiAgICAgICAgZXNjUXVvdGU6IHR5cGluZy5PcHRpb25hbFtzdHJdID0gTm9uZSwKCiAgICAgICAgdW5xdW90ZVJlc3VsdHM6IGJvb2wgPSBUcnVlLAoKICAgICAgICBlbmRRdW90ZUNoYXI6IHR5cGluZy5PcHRpb25hbFtzdHJdID0gTm9uZSwKCiAgICAgICAgY29udmVydFdoaXRlc3BhY2VFc2NhcGVzOiBib29sID0gVHJ1ZSwKCiAgICApOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKCiAgICAgICAgZXNjQ2hhciA9IGVzY0NoYXIgb3IgZXNjX2NoYXIKCiAgICAgICAgZXNjUXVvdGUgPSBlc2NRdW90ZSBvciBlc2NfcXVvdGUKCiAgICAgICAgdW5xdW90ZVJlc3VsdHMgPSB1bnF1b3RlUmVzdWx0cyBhbmQgdW5xdW90ZV9yZXN1bHRzCgogICAgICAgIGVuZFF1b3RlQ2hhciA9IGVuZFF1b3RlQ2hhciBvciBlbmRfcXVvdGVfY2hhcgoKICAgICAgICBjb252ZXJ0V2hpdGVzcGFjZUVzY2FwZXMgPSAoCgogICAgICAgICAgICBjb252ZXJ0V2hpdGVzcGFjZUVzY2FwZXMgYW5kIGNvbnZlcnRfd2hpdGVzcGFjZV9lc2NhcGVzCgogICAgICAgICkKCiAgICAgICAgcXVvdGVfY2hhciA9IHF1b3RlQ2hhciBvciBxdW90ZV9jaGFyCgoKCiAgICAgICAgIyByZW1vdmUgd2hpdGUgc3BhY2UgZnJvbSBxdW90ZSBjaGFycyAtIHdvbnQgd29yayBhbnl3YXkKCiAgICAgICAgcXVvdGVfY2hhciA9IHF1b3RlX2NoYXIuc3RyaXAoKQoKICAgICAgICBpZiBub3QgcXVvdGVfY2hhcjoKCiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoXCJxdW90ZV9jaGFyIGNhbm5vdCBiZSB0aGUgZW1wdHkgc3RyaW5nXCIpCgoKCiAgICAgICAgaWYgZW5kUXVvdGVDaGFyIGlzIE5vbmU6CgogICAgICAgICAgICBlbmRRdW90ZUNoYXIgPSBxdW90ZV9jaGFyCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBlbmRRdW90ZUNoYXIgPSBlbmRRdW90ZUNoYXIuc3RyaXAoKQoKICAgICAgICAgICAgaWYgbm90IGVuZFF1b3RlQ2hhcjoKCiAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKFwiZW5kUXVvdGVDaGFyIGNhbm5vdCBiZSB0aGUgZW1wdHkgc3RyaW5nXCIpCgoKCiAgICAgICAgc2VsZi5xdW90ZUNoYXIgPSBxdW90ZV9jaGFyCgogICAgICAgIHNlbGYucXVvdGVDaGFyTGVuID0gbGVuKHF1b3RlX2NoYXIpCgogICAgICAgIHNlbGYuZmlyc3RRdW90ZUNoYXIgPSBxdW90ZV9jaGFyWzBdCgogICAgICAgIHNlbGYuZW5kUXVvdGVDaGFyID0gZW5kUXVvdGVDaGFyCgogICAgICAgIHNlbGYuZW5kUXVvdGVDaGFyTGVuID0gbGVuKGVuZFF1b3RlQ2hhcikKCiAgICAgICAgc2VsZi5lc2NDaGFyID0gZXNjQ2hhcgoKICAgICAgICBzZWxmLmVzY1F1b3RlID0gZXNjUXVvdGUKCiAgICAgICAgc2VsZi51bnF1b3RlUmVzdWx0cyA9IHVucXVvdGVSZXN1bHRzCgogICAgICAgIHNlbGYuY29udmVydFdoaXRlc3BhY2VFc2NhcGVzID0gY29udmVydFdoaXRlc3BhY2VFc2NhcGVzCgoKCiAgICAgICAgc2VwID0gXCJcIgoKICAgICAgICBpbm5lcl9wYXR0ZXJuID0gXCJcIgoKCgogICAgICAgIGlmIGVzY1F1b3RlOgoKICAgICAgICAgICAgaW5uZXJfcGF0dGVybiArPSByXCJ7fSg/Ont9KVwiLmZvcm1hdChzZXAsIHJlLmVzY2FwZShlc2NRdW90ZSkpCgogICAgICAgICAgICBzZXAgPSBcInxcIgoKCgogICAgICAgIGlmIGVzY0NoYXI6CgogICAgICAgICAgICBpbm5lcl9wYXR0ZXJuICs9IHJcInt9KD86e30uKVwiLmZvcm1hdChzZXAsIHJlLmVzY2FwZShlc2NDaGFyKSkKCiAgICAgICAgICAgIHNlcCA9IFwifFwiCgogICAgICAgICAgICBzZWxmLmVzY0NoYXJSZXBsYWNlUGF0dGVybiA9IHJlLmVzY2FwZShzZWxmLmVzY0NoYXIpICsgXCIoLilcIgoKCgogICAgICAgIGlmIGxlbihzZWxmLmVuZFF1b3RlQ2hhcikgPiAxOgoKICAgICAgICAgICAgaW5uZXJfcGF0dGVybiArPSAoCgogICAgICAgICAgICAgICAgXCJ7fSg/OlwiLmZvcm1hdChzZXApCgogICAgICAgICAgICAgICAgKyBcInxcIi5qb2luKAoKICAgICAgICAgICAgICAgICAgICBcIig/Ont9KD8he30pKVwiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlLmVzY2FwZShzZWxmLmVuZFF1b3RlQ2hhcls6aV0pLAoKICAgICAgICAgICAgICAgICAgICAgICAgcmUuZXNjYXBlKHNlbGYuZW5kUXVvdGVDaGFyW2k6XSksCgogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKHNlbGYuZW5kUXVvdGVDaGFyKSAtIDEsIDAsIC0xKQoKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICArIFwiKVwiCgogICAgICAgICAgICApCgogICAgICAgICAgICBzZXAgPSBcInxcIgoKCgogICAgICAgIGlmIG11bHRpbGluZToKCiAgICAgICAgICAgIHNlbGYuZmxhZ3MgPSByZS5NVUxUSUxJTkUgfCByZS5ET1RBTEwKCiAgICAgICAgICAgIGlubmVyX3BhdHRlcm4gKz0gclwie30oPzpbXnt9e31dKVwiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICBzZXAsCgogICAgICAgICAgICAgICAgX2VzY2FwZV9yZWdleF9yYW5nZV9jaGFycyhzZWxmLmVuZFF1b3RlQ2hhclswXSksCgogICAgICAgICAgICAgICAgKF9lc2NhcGVfcmVnZXhfcmFuZ2VfY2hhcnMoZXNjQ2hhcikgaWYgZXNjQ2hhciBpcyBub3QgTm9uZSBlbHNlIFwiXCIpLAoKICAgICAgICAgICAgKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgc2VsZi5mbGFncyA9IDAKCiAgICAgICAgICAgIGlubmVyX3BhdHRlcm4gKz0gclwie30oPzpbXnt9XFxuXFxye31dKVwiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICBzZXAsCgogICAgICAgICAgICAgICAgX2VzY2FwZV9yZWdleF9yYW5nZV9jaGFycyhzZWxmLmVuZFF1b3RlQ2hhclswXSksCgogICAgICAgICAgICAgICAgKF9lc2NhcGVfcmVnZXhfcmFuZ2VfY2hhcnMoZXNjQ2hhcikgaWYgZXNjQ2hhciBpcyBub3QgTm9uZSBlbHNlIFwiXCIpLAoKICAgICAgICAgICAgKQoKCgogICAgICAgIHNlbGYucGF0dGVybiA9IFwiXCIuam9pbigKCiAgICAgICAgICAgIFsKCiAgICAgICAgICAgICAgICByZS5lc2NhcGUoc2VsZi5xdW90ZUNoYXIpLAoKICAgICAgICAgICAgICAgIFwiKD86XCIsCgogICAgICAgICAgICAgICAgaW5uZXJfcGF0dGVybiwKCiAgICAgICAgICAgICAgICBcIikqXCIsCgogICAgICAgICAgICAgICAgcmUuZXNjYXBlKHNlbGYuZW5kUXVvdGVDaGFyKSwKCiAgICAgICAgICAgIF0KCiAgICAgICAgKQoKCgogICAgICAgIHRyeToKCiAgICAgICAgICAgIHNlbGYucmUgPSByZS5jb21waWxlKHNlbGYucGF0dGVybiwgc2VsZi5mbGFncykKCiAgICAgICAgICAgIHNlbGYucmVTdHJpbmcgPSBzZWxmLnBhdHRlcm4KCiAgICAgICAgICAgIHNlbGYucmVfbWF0Y2ggPSBzZWxmLnJlLm1hdGNoCgogICAgICAgIGV4Y2VwdCByZS5lcnJvcjoKCiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCgogICAgICAgICAgICAgICAgXCJpbnZhbGlkIHBhdHRlcm4geyFyfSBwYXNzZWQgdG8gUmVnZXhcIi5mb3JtYXQoc2VsZi5wYXR0ZXJuKQoKICAgICAgICAgICAgKQoKCgogICAgICAgIHNlbGYuZXJybXNnID0gXCJFeHBlY3RlZCBcIiArIHNlbGYubmFtZQoKICAgICAgICBzZWxmLm1heUluZGV4RXJyb3IgPSBGYWxzZQoKICAgICAgICBzZWxmLm1heVJldHVybkVtcHR5ID0gVHJ1ZQoKCgogICAgZGVmIF9nZW5lcmF0ZURlZmF1bHROYW1lKHNlbGYpOgoKICAgICAgICBpZiBzZWxmLnF1b3RlQ2hhciA9PSBzZWxmLmVuZFF1b3RlQ2hhciBhbmQgaXNpbnN0YW5jZShzZWxmLnF1b3RlQ2hhciwgc3RyX3R5cGUpOgoKICAgICAgICAgICAgcmV0dXJuIFwic3RyaW5nIGVuY2xvc2VkIGluIHshcn1cIi5mb3JtYXQoc2VsZi5xdW90ZUNoYXIpCgoKCiAgICAgICAgcmV0dXJuIFwicXVvdGVkIHN0cmluZywgc3RhcnRpbmcgd2l0aCB7fSBlbmRpbmcgd2l0aCB7fVwiLmZvcm1hdCgKCiAgICAgICAgICAgIHNlbGYucXVvdGVDaGFyLCBzZWxmLmVuZFF1b3RlQ2hhcgoKICAgICAgICApCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgcmVzdWx0ID0gKAoKICAgICAgICAgICAgaW5zdHJpbmdbbG9jXSA9PSBzZWxmLmZpcnN0UXVvdGVDaGFyCgogICAgICAgICAgICBhbmQgc2VsZi5yZV9tYXRjaChpbnN0cmluZywgbG9jKQoKICAgICAgICAgICAgb3IgTm9uZQoKICAgICAgICApCgogICAgICAgIGlmIG5vdCByZXN1bHQ6CgogICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBzZWxmLmVycm1zZywgc2VsZikKCgoKICAgICAgICBsb2MgPSByZXN1bHQuZW5kKCkKCiAgICAgICAgcmV0ID0gcmVzdWx0Lmdyb3VwKCkKCgoKICAgICAgICBpZiBzZWxmLnVucXVvdGVSZXN1bHRzOgoKCgogICAgICAgICAgICAjIHN0cmlwIG9mZiBxdW90ZXMKCiAgICAgICAgICAgIHJldCA9IHJldFtzZWxmLnF1b3RlQ2hhckxlbiA6IC1zZWxmLmVuZFF1b3RlQ2hhckxlbl0KCgoKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXQsIHN0cl90eXBlKToKCiAgICAgICAgICAgICAgICAjIHJlcGxhY2UgZXNjYXBlZCB3aGl0ZXNwYWNlCgogICAgICAgICAgICAgICAgaWYgXCJcXFxcXCIgaW4gcmV0IGFuZCBzZWxmLmNvbnZlcnRXaGl0ZXNwYWNlRXNjYXBlczoKCiAgICAgICAgICAgICAgICAgICAgZm9yIHdzbGl0LCB3c2NoYXIgaW4gc2VsZi53c19tYXA6CgogICAgICAgICAgICAgICAgICAgICAgICByZXQgPSByZXQucmVwbGFjZSh3c2xpdCwgd3NjaGFyKQoKCgogICAgICAgICAgICAgICAgIyByZXBsYWNlIGVzY2FwZWQgY2hhcmFjdGVycwoKICAgICAgICAgICAgICAgIGlmIHNlbGYuZXNjQ2hhcjoKCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gcmUuc3ViKHNlbGYuZXNjQ2hhclJlcGxhY2VQYXR0ZXJuLCByXCJcXGc8MT5cIiwgcmV0KQoKCgogICAgICAgICAgICAgICAgIyByZXBsYWNlIGVzY2FwZWQgcXVvdGVzCgogICAgICAgICAgICAgICAgaWYgc2VsZi5lc2NRdW90ZToKCiAgICAgICAgICAgICAgICAgICAgcmV0ID0gcmV0LnJlcGxhY2Uoc2VsZi5lc2NRdW90ZSwgc2VsZi5lbmRRdW90ZUNoYXIpCgoKCiAgICAgICAgcmV0dXJuIGxvYywgcmV0CgoKCgoKY2xhc3MgQ2hhcnNOb3RJbihUb2tlbik6CgogICAgXCJcIlwiVG9rZW4gZm9yIG1hdGNoaW5nIHdvcmRzIGNvbXBvc2VkIG9mIGNoYXJhY3RlcnMgKm5vdCogaW4gYSBnaXZlbgoKICAgIHNldCAod2lsbCBpbmNsdWRlIHdoaXRlc3BhY2UgaW4gbWF0Y2hlZCBjaGFyYWN0ZXJzIGlmIG5vdCBsaXN0ZWQgaW4KCiAgICB0aGUgcHJvdmlkZWQgZXhjbHVzaW9uIHNldCAtIHNlZSBleGFtcGxlKS4gRGVmaW5lZCB3aXRoIHN0cmluZwoKICAgIGNvbnRhaW5pbmcgYWxsIGRpc2FsbG93ZWQgY2hhcmFjdGVycywgYW5kIGFuIG9wdGlvbmFsIG1pbmltdW0sCgogICAgbWF4aW11bSwgYW5kL29yIGV4YWN0IGxlbmd0aC4gIFRoZSBkZWZhdWx0IHZhbHVlIGZvciBgYG1pbmBgIGlzCgogICAgMSAoYSBtaW5pbXVtIHZhbHVlIDwgMSBpcyBub3QgdmFsaWQpOyB0aGUgZGVmYXVsdCB2YWx1ZXMgZm9yCgogICAgYGBtYXhgYCBhbmQgYGBleGFjdGBgIGFyZSAwLCBtZWFuaW5nIG5vIG1heGltdW0gb3IgZXhhY3QKCiAgICBsZW5ndGggcmVzdHJpY3Rpb24uCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICAjIGRlZmluZSBhIGNvbW1hLXNlcGFyYXRlZC12YWx1ZSBhcyBhbnl0aGluZyB0aGF0IGlzIG5vdCBhICcsJwoKICAgICAgICBjc3ZfdmFsdWUgPSBDaGFyc05vdEluKCcsJykKCiAgICAgICAgcHJpbnQoZGVsaW1pdGVkX2xpc3QoY3N2X3ZhbHVlKS5wYXJzZV9zdHJpbmcoXCJka2xzLGxzZGtqZixzMTIgMzQsQCEjLDIxM1wiKSkKCgoKICAgIHByaW50czo6CgoKCiAgICAgICAgWydka2xzJywgJ2xzZGtqZicsICdzMTIgMzQnLCAnQCEjJywgJzIxMyddCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oCgogICAgICAgIHNlbGYsCgogICAgICAgIG5vdF9jaGFyczogc3RyID0gXCJcIiwKCiAgICAgICAgbWluOiBpbnQgPSAxLAoKICAgICAgICBtYXg6IGludCA9IDAsCgogICAgICAgIGV4YWN0OiBpbnQgPSAwLAoKICAgICAgICAqLAoKICAgICAgICBub3RDaGFyczogc3RyID0gXCJcIiwKCiAgICApOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKCiAgICAgICAgc2VsZi5za2lwV2hpdGVzcGFjZSA9IEZhbHNlCgogICAgICAgIHNlbGYubm90Q2hhcnMgPSBub3RfY2hhcnMgb3Igbm90Q2hhcnMKCiAgICAgICAgc2VsZi5ub3RDaGFyc1NldCA9IHNldChzZWxmLm5vdENoYXJzKQoKCgogICAgICAgIGlmIG1pbiA8IDE6CgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKAoKICAgICAgICAgICAgICAgIFwiY2Fubm90IHNwZWNpZnkgYSBtaW5pbXVtIGxlbmd0aCA8IDE7IHVzZSBcIgoKICAgICAgICAgICAgICAgIFwiT3B0KENoYXJzTm90SW4oKSkgaWYgemVyby1sZW5ndGggY2hhciBncm91cCBpcyBwZXJtaXR0ZWRcIgoKICAgICAgICAgICAgKQoKCgogICAgICAgIHNlbGYubWluTGVuID0gbWluCgoKCiAgICAgICAgaWYgbWF4ID4gMDoKCiAgICAgICAgICAgIHNlbGYubWF4TGVuID0gbWF4CgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBzZWxmLm1heExlbiA9IF9NQVhfSU5UCgoKCiAgICAgICAgaWYgZXhhY3QgPiAwOgoKICAgICAgICAgICAgc2VsZi5tYXhMZW4gPSBleGFjdAoKICAgICAgICAgICAgc2VsZi5taW5MZW4gPSBleGFjdAoKCgogICAgICAgIHNlbGYuZXJybXNnID0gXCJFeHBlY3RlZCBcIiArIHNlbGYubmFtZQoKICAgICAgICBzZWxmLm1heVJldHVybkVtcHR5ID0gc2VsZi5taW5MZW4gPT0gMAoKICAgICAgICBzZWxmLm1heUluZGV4RXJyb3IgPSBGYWxzZQoKCgogICAgZGVmIF9nZW5lcmF0ZURlZmF1bHROYW1lKHNlbGYpOgoKICAgICAgICBub3RfY2hhcnNfc3RyID0gX2NvbGxhcHNlX3N0cmluZ190b19yYW5nZXMoc2VsZi5ub3RDaGFycykKCiAgICAgICAgaWYgbGVuKG5vdF9jaGFyc19zdHIpID4gMTY6CgogICAgICAgICAgICByZXR1cm4gXCIhVzooe30uLi4pXCIuZm9ybWF0KHNlbGYubm90Q2hhcnNbOiAxNiAtIDNdKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgcmV0dXJuIFwiIVc6KHt9KVwiLmZvcm1hdChzZWxmLm5vdENoYXJzKQoKCgogICAgZGVmIHBhcnNlSW1wbChzZWxmLCBpbnN0cmluZywgbG9jLCBkb0FjdGlvbnM9VHJ1ZSk6CgogICAgICAgIG5vdGNoYXJzID0gc2VsZi5ub3RDaGFyc1NldAoKICAgICAgICBpZiBpbnN0cmluZ1tsb2NdIGluIG5vdGNoYXJzOgoKICAgICAgICAgICAgcmFpc2UgUGFyc2VFeGNlcHRpb24oaW5zdHJpbmcsIGxvYywgc2VsZi5lcnJtc2csIHNlbGYpCgoKCiAgICAgICAgc3RhcnQgPSBsb2MKCiAgICAgICAgbG9jICs9IDEKCiAgICAgICAgbWF4bGVuID0gbWluKHN0YXJ0ICsgc2VsZi5tYXhMZW4sIGxlbihpbnN0cmluZykpCgogICAgICAgIHdoaWxlIGxvYyA8IG1heGxlbiBhbmQgaW5zdHJpbmdbbG9jXSBub3QgaW4gbm90Y2hhcnM6CgogICAgICAgICAgICBsb2MgKz0gMQoKCgogICAgICAgIGlmIGxvYyAtIHN0YXJ0IDwgc2VsZi5taW5MZW46CgogICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBzZWxmLmVycm1zZywgc2VsZikKCgoKICAgICAgICByZXR1cm4gbG9jLCBpbnN0cmluZ1tzdGFydDpsb2NdCgoKCgoKY2xhc3MgV2hpdGUoVG9rZW4pOgoKICAgIFwiXCJcIlNwZWNpYWwgbWF0Y2hpbmcgY2xhc3MgZm9yIG1hdGNoaW5nIHdoaXRlc3BhY2UuICBOb3JtYWxseSwKCiAgICB3aGl0ZXNwYWNlIGlzIGlnbm9yZWQgYnkgcHlwYXJzaW5nIGdyYW1tYXJzLiAgVGhpcyBjbGFzcyBpcyBpbmNsdWRlZAoKICAgIHdoZW4gc29tZSB3aGl0ZXNwYWNlIHN0cnVjdHVyZXMgYXJlIHNpZ25pZmljYW50LiAgRGVmaW5lIHdpdGgKCiAgICBhIHN0cmluZyBjb250YWluaW5nIHRoZSB3aGl0ZXNwYWNlIGNoYXJhY3RlcnMgdG8gYmUgbWF0Y2hlZDsgZGVmYXVsdAoKICAgIGlzIGBgXCIgXFxcXHRcXFxcclxcXFxuXCJgYC4gIEFsc28gdGFrZXMgb3B0aW9uYWwgYGBtaW5gYCwKCiAgICBgYG1heGBgLCBhbmQgYGBleGFjdGBgIGFyZ3VtZW50cywgYXMgZGVmaW5lZCBmb3IgdGhlCgogICAgOmNsYXNzOmBXb3JkYCBjbGFzcy4KCiAgICBcIlwiXCIKCgoKICAgIHdoaXRlU3RycyA9IHsKCiAgICAgICAgXCIgXCI6IFwiPFNQPlwiLAoKICAgICAgICBcIlxcdFwiOiBcIjxUQUI+XCIsCgogICAgICAgIFwiXFxuXCI6IFwiPExGPlwiLAoKICAgICAgICBcIlxcclwiOiBcIjxDUj5cIiwKCiAgICAgICAgXCJcXGZcIjogXCI8RkY+XCIsCgogICAgICAgIFwiXFx1MDBBMFwiOiBcIjxOQlNQPlwiLAoKICAgICAgICBcIlxcdTE2ODBcIjogXCI8T0dIQU1fU1BBQ0VfTUFSSz5cIiwKCiAgICAgICAgXCJcXHUxODBFXCI6IFwiPE1PTkdPTElBTl9WT1dFTF9TRVBBUkFUT1I+XCIsCgogICAgICAgIFwiXFx1MjAwMFwiOiBcIjxFTl9RVUFEPlwiLAoKICAgICAgICBcIlxcdTIwMDFcIjogXCI8RU1fUVVBRD5cIiwKCiAgICAgICAgXCJcXHUyMDAyXCI6IFwiPEVOX1NQQUNFPlwiLAoKICAgICAgICBcIlxcdTIwMDNcIjogXCI8RU1fU1BBQ0U+XCIsCgogICAgICAgIFwiXFx1MjAwNFwiOiBcIjxUSFJFRS1QRVItRU1fU1BBQ0U+XCIsCgogICAgICAgIFwiXFx1MjAwNVwiOiBcIjxGT1VSLVBFUi1FTV9TUEFDRT5cIiwKCiAgICAgICAgXCJcXHUyMDA2XCI6IFwiPFNJWC1QRVItRU1fU1BBQ0U+XCIsCgogICAgICAgIFwiXFx1MjAwN1wiOiBcIjxGSUdVUkVfU1BBQ0U+XCIsCgogICAgICAgIFwiXFx1MjAwOFwiOiBcIjxQVU5DVFVBVElPTl9TUEFDRT5cIiwKCiAgICAgICAgXCJcXHUyMDA5XCI6IFwiPFRISU5fU1BBQ0U+XCIsCgogICAgICAgIFwiXFx1MjAwQVwiOiBcIjxIQUlSX1NQQUNFPlwiLAoKICAgICAgICBcIlxcdTIwMEJcIjogXCI8WkVST19XSURUSF9TUEFDRT5cIiwKCiAgICAgICAgXCJcXHUyMDJGXCI6IFwiPE5OQlNQPlwiLAoKICAgICAgICBcIlxcdTIwNUZcIjogXCI8TU1TUD5cIiwKCiAgICAgICAgXCJcXHUzMDAwXCI6IFwiPElERU9HUkFQSElDX1NQQUNFPlwiLAoKICAgIH0KCgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB3czogc3RyID0gXCIgXFx0XFxyXFxuXCIsIG1pbjogaW50ID0gMSwgbWF4OiBpbnQgPSAwLCBleGFjdDogaW50ID0gMCk6CgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQoKICAgICAgICBzZWxmLm1hdGNoV2hpdGUgPSB3cwoKICAgICAgICBzZWxmLnNldF93aGl0ZXNwYWNlX2NoYXJzKAoKICAgICAgICAgICAgXCJcIi5qb2luKGMgZm9yIGMgaW4gc2VsZi53aGl0ZVN0cnMgaWYgYyBub3QgaW4gc2VsZi5tYXRjaFdoaXRlKSwKCiAgICAgICAgICAgIGNvcHlfZGVmYXVsdHM9VHJ1ZSwKCiAgICAgICAgKQoKICAgICAgICAjIHNlbGYubGVhdmVfd2hpdGVzcGFjZSgpCgogICAgICAgIHNlbGYubWF5UmV0dXJuRW1wdHkgPSBUcnVlCgogICAgICAgIHNlbGYuZXJybXNnID0gXCJFeHBlY3RlZCBcIiArIHNlbGYubmFtZQoKCgogICAgICAgIHNlbGYubWluTGVuID0gbWluCgoKCiAgICAgICAgaWYgbWF4ID4gMDoKCiAgICAgICAgICAgIHNlbGYubWF4TGVuID0gbWF4CgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBzZWxmLm1heExlbiA9IF9NQVhfSU5UCgoKCiAgICAgICAgaWYgZXhhY3QgPiAwOgoKICAgICAgICAgICAgc2VsZi5tYXhMZW4gPSBleGFjdAoKICAgICAgICAgICAgc2VsZi5taW5MZW4gPSBleGFjdAoKCgogICAgZGVmIF9nZW5lcmF0ZURlZmF1bHROYW1lKHNlbGYpOgoKICAgICAgICByZXR1cm4gXCJcIi5qb2luKFdoaXRlLndoaXRlU3Ryc1tjXSBmb3IgYyBpbiBzZWxmLm1hdGNoV2hpdGUpCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgaWYgaW5zdHJpbmdbbG9jXSBub3QgaW4gc2VsZi5tYXRjaFdoaXRlOgoKICAgICAgICAgICAgcmFpc2UgUGFyc2VFeGNlcHRpb24oaW5zdHJpbmcsIGxvYywgc2VsZi5lcnJtc2csIHNlbGYpCgogICAgICAgIHN0YXJ0ID0gbG9jCgogICAgICAgIGxvYyArPSAxCgogICAgICAgIG1heGxvYyA9IHN0YXJ0ICsgc2VsZi5tYXhMZW4KCiAgICAgICAgbWF4bG9jID0gbWluKG1heGxvYywgbGVuKGluc3RyaW5nKSkKCiAgICAgICAgd2hpbGUgbG9jIDwgbWF4bG9jIGFuZCBpbnN0cmluZ1tsb2NdIGluIHNlbGYubWF0Y2hXaGl0ZToKCiAgICAgICAgICAgIGxvYyArPSAxCgoKCiAgICAgICAgaWYgbG9jIC0gc3RhcnQgPCBzZWxmLm1pbkxlbjoKCiAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsb2MsIHNlbGYuZXJybXNnLCBzZWxmKQoKCgogICAgICAgIHJldHVybiBsb2MsIGluc3RyaW5nW3N0YXJ0OmxvY10KCgoKCgpjbGFzcyBQb3NpdGlvblRva2VuKFRva2VuKToKCiAgICBkZWYgX19pbml0X18oc2VsZik6CgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQoKICAgICAgICBzZWxmLm1heVJldHVybkVtcHR5ID0gVHJ1ZQoKICAgICAgICBzZWxmLm1heUluZGV4RXJyb3IgPSBGYWxzZQoKCgoKCmNsYXNzIEdvVG9Db2x1bW4oUG9zaXRpb25Ub2tlbik6CgogICAgXCJcIlwiVG9rZW4gdG8gYWR2YW5jZSB0byBhIHNwZWNpZmljIGNvbHVtbiBvZiBpbnB1dCB0ZXh0OyB1c2VmdWwgZm9yCgogICAgdGFidWxhciByZXBvcnQgc2NyYXBpbmcuCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oc2VsZiwgY29sbm86IGludCk6CgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQoKICAgICAgICBzZWxmLmNvbCA9IGNvbG5vCgoKCiAgICBkZWYgcHJlUGFyc2Uoc2VsZiwgaW5zdHJpbmcsIGxvYyk6CgogICAgICAgIGlmIGNvbChsb2MsIGluc3RyaW5nKSAhPSBzZWxmLmNvbDoKCiAgICAgICAgICAgIGluc3RybGVuID0gbGVuKGluc3RyaW5nKQoKICAgICAgICAgICAgaWYgc2VsZi5pZ25vcmVFeHByczoKCiAgICAgICAgICAgICAgICBsb2MgPSBzZWxmLl9za2lwSWdub3JhYmxlcyhpbnN0cmluZywgbG9jKQoKICAgICAgICAgICAgd2hpbGUgKAoKICAgICAgICAgICAgICAgIGxvYyA8IGluc3RybGVuCgogICAgICAgICAgICAgICAgYW5kIGluc3RyaW5nW2xvY10uaXNzcGFjZSgpCgogICAgICAgICAgICAgICAgYW5kIGNvbChsb2MsIGluc3RyaW5nKSAhPSBzZWxmLmNvbAoKICAgICAgICAgICAgKToKCiAgICAgICAgICAgICAgICBsb2MgKz0gMQoKICAgICAgICByZXR1cm4gbG9jCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgdGhpc2NvbCA9IGNvbChsb2MsIGluc3RyaW5nKQoKICAgICAgICBpZiB0aGlzY29sID4gc2VsZi5jb2w6CgogICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBcIlRleHQgbm90IGluIGV4cGVjdGVkIGNvbHVtblwiLCBzZWxmKQoKICAgICAgICBuZXdsb2MgPSBsb2MgKyBzZWxmLmNvbCAtIHRoaXNjb2wKCiAgICAgICAgcmV0ID0gaW5zdHJpbmdbbG9jOm5ld2xvY10KCiAgICAgICAgcmV0dXJuIG5ld2xvYywgcmV0CgoKCgoKY2xhc3MgTGluZVN0YXJ0KFBvc2l0aW9uVG9rZW4pOgoKICAgIHJcIlwiXCJNYXRjaGVzIGlmIGN1cnJlbnQgcG9zaXRpb24gaXMgYXQgdGhlIGJlZ2lubmluZyBvZiBhIGxpbmUgd2l0aGluCgogICAgdGhlIHBhcnNlIHN0cmluZwoKCgogICAgRXhhbXBsZTo6CgoKCiAgICAgICAgdGVzdCA9ICcnJ1xcCgogICAgICAgIEFBQSB0aGlzIGxpbmUKCiAgICAgICAgQUFBIGFuZCB0aGlzIGxpbmUKCiAgICAgICAgICBBQUEgYnV0IG5vdCB0aGlzIG9uZQoKICAgICAgICBCIEFBQSBhbmQgZGVmaW5pdGVseSBub3QgdGhpcyBvbmUKCiAgICAgICAgJycnCgoKCiAgICAgICAgZm9yIHQgaW4gKExpbmVTdGFydCgpICsgJ0FBQScgKyByZXN0T2ZMaW5lKS5zZWFyY2hfc3RyaW5nKHRlc3QpOgoKICAgICAgICAgICAgcHJpbnQodCkKCgoKICAgIHByaW50czo6CgoKCiAgICAgICAgWydBQUEnLCAnIHRoaXMgbGluZSddCgogICAgICAgIFsnQUFBJywgJyBhbmQgdGhpcyBsaW5lJ10KCgoKICAgIFwiXCJcIgoKCgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKCiAgICAgICAgc2VsZi5sZWF2ZV93aGl0ZXNwYWNlKCkKCiAgICAgICAgc2VsZi5vcmlnX3doaXRlQ2hhcnMgPSBzZXQoKSB8IHNlbGYud2hpdGVDaGFycwoKICAgICAgICBzZWxmLndoaXRlQ2hhcnMuZGlzY2FyZChcIlxcblwiKQoKICAgICAgICBzZWxmLnNraXBwZXIgPSBFbXB0eSgpLnNldF93aGl0ZXNwYWNlX2NoYXJzKHNlbGYud2hpdGVDaGFycykKCiAgICAgICAgc2VsZi5lcnJtc2cgPSBcIkV4cGVjdGVkIHN0YXJ0IG9mIGxpbmVcIgoKCgogICAgZGVmIHByZVBhcnNlKHNlbGYsIGluc3RyaW5nLCBsb2MpOgoKICAgICAgICBpZiBsb2MgPT0gMDoKCiAgICAgICAgICAgIHJldHVybiBsb2MKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHJldCA9IHNlbGYuc2tpcHBlci5wcmVQYXJzZShpbnN0cmluZywgbG9jKQoKICAgICAgICAgICAgaWYgXCJcXG5cIiBpbiBzZWxmLm9yaWdfd2hpdGVDaGFyczoKCiAgICAgICAgICAgICAgICB3aGlsZSBpbnN0cmluZ1tyZXQgOiByZXQgKyAxXSA9PSBcIlxcblwiOgoKICAgICAgICAgICAgICAgICAgICByZXQgPSBzZWxmLnNraXBwZXIucHJlUGFyc2UoaW5zdHJpbmcsIHJldCArIDEpCgogICAgICAgICAgICByZXR1cm4gcmV0CgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgaWYgY29sKGxvYywgaW5zdHJpbmcpID09IDE6CgogICAgICAgICAgICByZXR1cm4gbG9jLCBbXQoKICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBzZWxmLmVycm1zZywgc2VsZikKCgoKCgpjbGFzcyBMaW5lRW5kKFBvc2l0aW9uVG9rZW4pOgoKICAgIFwiXCJcIk1hdGNoZXMgaWYgY3VycmVudCBwb3NpdGlvbiBpcyBhdCB0aGUgZW5kIG9mIGEgbGluZSB3aXRoaW4gdGhlCgogICAgcGFyc2Ugc3RyaW5nCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oc2VsZik6CgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQoKICAgICAgICBzZWxmLndoaXRlQ2hhcnMuZGlzY2FyZChcIlxcblwiKQoKICAgICAgICBzZWxmLnNldF93aGl0ZXNwYWNlX2NoYXJzKHNlbGYud2hpdGVDaGFycywgY29weV9kZWZhdWx0cz1GYWxzZSkKCiAgICAgICAgc2VsZi5lcnJtc2cgPSBcIkV4cGVjdGVkIGVuZCBvZiBsaW5lXCIKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICBpZiBsb2MgPCBsZW4oaW5zdHJpbmcpOgoKICAgICAgICAgICAgaWYgaW5zdHJpbmdbbG9jXSA9PSBcIlxcblwiOgoKICAgICAgICAgICAgICAgIHJldHVybiBsb2MgKyAxLCBcIlxcblwiCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsb2MsIHNlbGYuZXJybXNnLCBzZWxmKQoKICAgICAgICBlbGlmIGxvYyA9PSBsZW4oaW5zdHJpbmcpOgoKICAgICAgICAgICAgcmV0dXJuIGxvYyArIDEsIFtdCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBzZWxmLmVycm1zZywgc2VsZikKCgoKCgpjbGFzcyBTdHJpbmdTdGFydChQb3NpdGlvblRva2VuKToKCiAgICBcIlwiXCJNYXRjaGVzIGlmIGN1cnJlbnQgcG9zaXRpb24gaXMgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgcGFyc2UKCiAgICBzdHJpbmcKCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpCgogICAgICAgIHNlbGYuZXJybXNnID0gXCJFeHBlY3RlZCBzdGFydCBvZiB0ZXh0XCIKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICBpZiBsb2MgIT0gMDoKCiAgICAgICAgICAgICMgc2VlIGlmIGVudGlyZSBzdHJpbmcgdXAgdG8gaGVyZSBpcyBqdXN0IHdoaXRlc3BhY2UgYW5kIGlnbm9yZWFibGVzCgogICAgICAgICAgICBpZiBsb2MgIT0gc2VsZi5wcmVQYXJzZShpbnN0cmluZywgMCk6CgogICAgICAgICAgICAgICAgcmFpc2UgUGFyc2VFeGNlcHRpb24oaW5zdHJpbmcsIGxvYywgc2VsZi5lcnJtc2csIHNlbGYpCgogICAgICAgIHJldHVybiBsb2MsIFtdCgoKCgoKY2xhc3MgU3RyaW5nRW5kKFBvc2l0aW9uVG9rZW4pOgoKICAgIFwiXCJcIgoKICAgIE1hdGNoZXMgaWYgY3VycmVudCBwb3NpdGlvbiBpcyBhdCB0aGUgZW5kIG9mIHRoZSBwYXJzZSBzdHJpbmcKCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpCgogICAgICAgIHNlbGYuZXJybXNnID0gXCJFeHBlY3RlZCBlbmQgb2YgdGV4dFwiCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgaWYgbG9jIDwgbGVuKGluc3RyaW5nKToKCiAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsb2MsIHNlbGYuZXJybXNnLCBzZWxmKQoKICAgICAgICBlbGlmIGxvYyA9PSBsZW4oaW5zdHJpbmcpOgoKICAgICAgICAgICAgcmV0dXJuIGxvYyArIDEsIFtdCgogICAgICAgIGVsaWYgbG9jID4gbGVuKGluc3RyaW5nKToKCiAgICAgICAgICAgIHJldHVybiBsb2MsIFtdCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBzZWxmLmVycm1zZywgc2VsZikKCgoKCgpjbGFzcyBXb3JkU3RhcnQoUG9zaXRpb25Ub2tlbik6CgogICAgXCJcIlwiTWF0Y2hlcyBpZiB0aGUgY3VycmVudCBwb3NpdGlvbiBpcyBhdCB0aGUgYmVnaW5uaW5nIG9mIGEKCiAgICA6Y2xhc3M6YFdvcmRgLCBhbmQgaXMgbm90IHByZWNlZGVkIGJ5IGFueSBjaGFyYWN0ZXIgaW4gYSBnaXZlbgoKICAgIHNldCBvZiBgYHdvcmRfY2hhcnNgYCAoZGVmYXVsdD0gYGBwcmludGFibGVzYGApLiBUbyBlbXVsYXRlIHRoZQoKICAgIGBgXFxiYGAgYmVoYXZpb3Igb2YgcmVndWxhciBleHByZXNzaW9ucywgdXNlCgogICAgYGBXb3JkU3RhcnQoYWxwaGFudW1zKWBgLiBgYFdvcmRTdGFydGBgIHdpbGwgYWxzbyBtYXRjaCBhdAoKICAgIHRoZSBiZWdpbm5pbmcgb2YgdGhlIHN0cmluZyBiZWluZyBwYXJzZWQsIG9yIGF0IHRoZSBiZWdpbm5pbmcgb2YKCiAgICBhIGxpbmUuCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oc2VsZiwgd29yZF9jaGFyczogc3RyID0gcHJpbnRhYmxlcywgKiwgd29yZENoYXJzOiBzdHIgPSBwcmludGFibGVzKToKCiAgICAgICAgd29yZENoYXJzID0gd29yZF9jaGFycyBpZiB3b3JkQ2hhcnMgPT0gcHJpbnRhYmxlcyBlbHNlIHdvcmRDaGFycwoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKCiAgICAgICAgc2VsZi53b3JkQ2hhcnMgPSBzZXQod29yZENoYXJzKQoKICAgICAgICBzZWxmLmVycm1zZyA9IFwiTm90IGF0IHRoZSBzdGFydCBvZiBhIHdvcmRcIgoKCgogICAgZGVmIHBhcnNlSW1wbChzZWxmLCBpbnN0cmluZywgbG9jLCBkb0FjdGlvbnM9VHJ1ZSk6CgogICAgICAgIGlmIGxvYyAhPSAwOgoKICAgICAgICAgICAgaWYgKAoKICAgICAgICAgICAgICAgIGluc3RyaW5nW2xvYyAtIDFdIGluIHNlbGYud29yZENoYXJzCgogICAgICAgICAgICAgICAgb3IgaW5zdHJpbmdbbG9jXSBub3QgaW4gc2VsZi53b3JkQ2hhcnMKCiAgICAgICAgICAgICk6CgogICAgICAgICAgICAgICAgcmFpc2UgUGFyc2VFeGNlcHRpb24oaW5zdHJpbmcsIGxvYywgc2VsZi5lcnJtc2csIHNlbGYpCgogICAgICAgIHJldHVybiBsb2MsIFtdCgoKCgoKY2xhc3MgV29yZEVuZChQb3NpdGlvblRva2VuKToKCiAgICBcIlwiXCJNYXRjaGVzIGlmIHRoZSBjdXJyZW50IHBvc2l0aW9uIGlzIGF0IHRoZSBlbmQgb2YgYSA6Y2xhc3M6YFdvcmRgLAoKICAgIGFuZCBpcyBub3QgZm9sbG93ZWQgYnkgYW55IGNoYXJhY3RlciBpbiBhIGdpdmVuIHNldCBvZiBgYHdvcmRfY2hhcnNgYAoKICAgIChkZWZhdWx0PSBgYHByaW50YWJsZXNgYCkuIFRvIGVtdWxhdGUgdGhlIGBgXFxiYGAgYmVoYXZpb3Igb2YKCiAgICByZWd1bGFyIGV4cHJlc3Npb25zLCB1c2UgYGBXb3JkRW5kKGFscGhhbnVtcylgYC4gYGBXb3JkRW5kYGAKCiAgICB3aWxsIGFsc28gbWF0Y2ggYXQgdGhlIGVuZCBvZiB0aGUgc3RyaW5nIGJlaW5nIHBhcnNlZCwgb3IgYXQgdGhlIGVuZAoKICAgIG9mIGEgbGluZS4KCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB3b3JkX2NoYXJzOiBzdHIgPSBwcmludGFibGVzLCAqLCB3b3JkQ2hhcnM6IHN0ciA9IHByaW50YWJsZXMpOgoKICAgICAgICB3b3JkQ2hhcnMgPSB3b3JkX2NoYXJzIGlmIHdvcmRDaGFycyA9PSBwcmludGFibGVzIGVsc2Ugd29yZENoYXJzCgogICAgICAgIHN1cGVyKCkuX19pbml0X18oKQoKICAgICAgICBzZWxmLndvcmRDaGFycyA9IHNldCh3b3JkQ2hhcnMpCgogICAgICAgIHNlbGYuc2tpcFdoaXRlc3BhY2UgPSBGYWxzZQoKICAgICAgICBzZWxmLmVycm1zZyA9IFwiTm90IGF0IHRoZSBlbmQgb2YgYSB3b3JkXCIKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICBpbnN0cmxlbiA9IGxlbihpbnN0cmluZykKCiAgICAgICAgaWYgaW5zdHJsZW4gPiAwIGFuZCBsb2MgPCBpbnN0cmxlbjoKCiAgICAgICAgICAgIGlmICgKCiAgICAgICAgICAgICAgICBpbnN0cmluZ1tsb2NdIGluIHNlbGYud29yZENoYXJzCgogICAgICAgICAgICAgICAgb3IgaW5zdHJpbmdbbG9jIC0gMV0gbm90IGluIHNlbGYud29yZENoYXJzCgogICAgICAgICAgICApOgoKICAgICAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsb2MsIHNlbGYuZXJybXNnLCBzZWxmKQoKICAgICAgICByZXR1cm4gbG9jLCBbXQoKCgoKCmNsYXNzIFBhcnNlRXhwcmVzc2lvbihQYXJzZXJFbGVtZW50KToKCiAgICBcIlwiXCJBYnN0cmFjdCBzdWJjbGFzcyBvZiBQYXJzZXJFbGVtZW50LCBmb3IgY29tYmluaW5nIGFuZAoKICAgIHBvc3QtcHJvY2Vzc2luZyBwYXJzZWQgdG9rZW5zLgoKICAgIFwiXCJcIgoKCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGV4cHJzOiB0eXBpbmcuSXRlcmFibGVbUGFyc2VyRWxlbWVudF0sIHNhdmVsaXN0OiBib29sID0gRmFsc2UpOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKHNhdmVsaXN0KQoKICAgICAgICBzZWxmLmV4cHJzOiBMaXN0W1BhcnNlckVsZW1lbnRdCgogICAgICAgIGlmIGlzaW5zdGFuY2UoZXhwcnMsIF9nZW5lcmF0b3JUeXBlKToKCiAgICAgICAgICAgIGV4cHJzID0gbGlzdChleHBycykKCgoKICAgICAgICBpZiBpc2luc3RhbmNlKGV4cHJzLCBzdHJfdHlwZSk6CgogICAgICAgICAgICBzZWxmLmV4cHJzID0gW3NlbGYuX2xpdGVyYWxTdHJpbmdDbGFzcyhleHBycyldCgogICAgICAgIGVsaWYgaXNpbnN0YW5jZShleHBycywgUGFyc2VyRWxlbWVudCk6CgogICAgICAgICAgICBzZWxmLmV4cHJzID0gW2V4cHJzXQoKICAgICAgICBlbGlmIGlzaW5zdGFuY2UoZXhwcnMsIEl0ZXJhYmxlKToKCiAgICAgICAgICAgIGV4cHJzID0gbGlzdChleHBycykKCiAgICAgICAgICAgICMgaWYgc2VxdWVuY2Ugb2Ygc3RyaW5ncyBwcm92aWRlZCwgd3JhcCB3aXRoIExpdGVyYWwKCiAgICAgICAgICAgIGlmIGFueShpc2luc3RhbmNlKGV4cHIsIHN0cl90eXBlKSBmb3IgZXhwciBpbiBleHBycyk6CgogICAgICAgICAgICAgICAgZXhwcnMgPSAoCgogICAgICAgICAgICAgICAgICAgIHNlbGYuX2xpdGVyYWxTdHJpbmdDbGFzcyhlKSBpZiBpc2luc3RhbmNlKGUsIHN0cl90eXBlKSBlbHNlIGUKCiAgICAgICAgICAgICAgICAgICAgZm9yIGUgaW4gZXhwcnMKCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICBzZWxmLmV4cHJzID0gbGlzdChleHBycykKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHRyeToKCiAgICAgICAgICAgICAgICBzZWxmLmV4cHJzID0gbGlzdChleHBycykKCiAgICAgICAgICAgIGV4Y2VwdCBUeXBlRXJyb3I6CgogICAgICAgICAgICAgICAgc2VsZi5leHBycyA9IFtleHByc10KCiAgICAgICAgc2VsZi5jYWxsUHJlcGFyc2UgPSBGYWxzZQoKCgogICAgZGVmIHJlY3Vyc2Uoc2VsZikgLT4gU2VxdWVuY2VbUGFyc2VyRWxlbWVudF06CgogICAgICAgIHJldHVybiBzZWxmLmV4cHJzWzpdCgoKCiAgICBkZWYgYXBwZW5kKHNlbGYsIG90aGVyKSAtPiBQYXJzZXJFbGVtZW50OgoKICAgICAgICBzZWxmLmV4cHJzLmFwcGVuZChvdGhlcikKCiAgICAgICAgc2VsZi5fZGVmYXVsdE5hbWUgPSBOb25lCgogICAgICAgIHJldHVybiBzZWxmCgoKCiAgICBkZWYgbGVhdmVfd2hpdGVzcGFjZShzZWxmLCByZWN1cnNpdmU6IGJvb2wgPSBUcnVlKSAtPiBQYXJzZXJFbGVtZW50OgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgRXh0ZW5kcyBgYGxlYXZlX3doaXRlc3BhY2VgYCBkZWZpbmVkIGluIGJhc2UgY2xhc3MsIGFuZCBhbHNvIGludm9rZXMgYGBsZWF2ZV93aGl0ZXNwYWNlYGAgb24KCiAgICAgICAgICAgYWxsIGNvbnRhaW5lZCBleHByZXNzaW9ucy4KCiAgICAgICAgXCJcIlwiCgogICAgICAgIHN1cGVyKCkubGVhdmVfd2hpdGVzcGFjZShyZWN1cnNpdmUpCgoKCiAgICAgICAgaWYgcmVjdXJzaXZlOgoKICAgICAgICAgICAgc2VsZi5leHBycyA9IFtlLmNvcHkoKSBmb3IgZSBpbiBzZWxmLmV4cHJzXQoKICAgICAgICAgICAgZm9yIGUgaW4gc2VsZi5leHByczoKCiAgICAgICAgICAgICAgICBlLmxlYXZlX3doaXRlc3BhY2UocmVjdXJzaXZlKQoKICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgZGVmIGlnbm9yZV93aGl0ZXNwYWNlKHNlbGYsIHJlY3Vyc2l2ZTogYm9vbCA9IFRydWUpIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBFeHRlbmRzIGBgaWdub3JlX3doaXRlc3BhY2VgYCBkZWZpbmVkIGluIGJhc2UgY2xhc3MsIGFuZCBhbHNvIGludm9rZXMgYGBsZWF2ZV93aGl0ZXNwYWNlYGAgb24KCiAgICAgICAgICAgYWxsIGNvbnRhaW5lZCBleHByZXNzaW9ucy4KCiAgICAgICAgXCJcIlwiCgogICAgICAgIHN1cGVyKCkuaWdub3JlX3doaXRlc3BhY2UocmVjdXJzaXZlKQoKICAgICAgICBpZiByZWN1cnNpdmU6CgogICAgICAgICAgICBzZWxmLmV4cHJzID0gW2UuY29weSgpIGZvciBlIGluIHNlbGYuZXhwcnNdCgogICAgICAgICAgICBmb3IgZSBpbiBzZWxmLmV4cHJzOgoKICAgICAgICAgICAgICAgIGUuaWdub3JlX3doaXRlc3BhY2UocmVjdXJzaXZlKQoKICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgZGVmIGlnbm9yZShzZWxmLCBvdGhlcikgLT4gUGFyc2VyRWxlbWVudDoKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgU3VwcHJlc3MpOgoKICAgICAgICAgICAgaWYgb3RoZXIgbm90IGluIHNlbGYuaWdub3JlRXhwcnM6CgogICAgICAgICAgICAgICAgc3VwZXIoKS5pZ25vcmUob3RoZXIpCgogICAgICAgICAgICAgICAgZm9yIGUgaW4gc2VsZi5leHByczoKCiAgICAgICAgICAgICAgICAgICAgZS5pZ25vcmUoc2VsZi5pZ25vcmVFeHByc1stMV0pCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBzdXBlcigpLmlnbm9yZShvdGhlcikKCiAgICAgICAgICAgIGZvciBlIGluIHNlbGYuZXhwcnM6CgogICAgICAgICAgICAgICAgZS5pZ25vcmUoc2VsZi5pZ25vcmVFeHByc1stMV0pCgogICAgICAgIHJldHVybiBzZWxmCgoKCiAgICBkZWYgX2dlbmVyYXRlRGVmYXVsdE5hbWUoc2VsZik6CgogICAgICAgIHJldHVybiBcInt9Oih7fSlcIi5mb3JtYXQoc2VsZi5fX2NsYXNzX18uX19uYW1lX18sIHN0cihzZWxmLmV4cHJzKSkKCgoKICAgIGRlZiBzdHJlYW1saW5lKHNlbGYpIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgICAgIGlmIHNlbGYuc3RyZWFtbGluZWQ6CgogICAgICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgICAgIHN1cGVyKCkuc3RyZWFtbGluZSgpCgoKCiAgICAgICAgZm9yIGUgaW4gc2VsZi5leHByczoKCiAgICAgICAgICAgIGUuc3RyZWFtbGluZSgpCgoKCiAgICAgICAgIyBjb2xsYXBzZSBuZXN0ZWQgOmNsYXNzOmBBbmRgJ3Mgb2YgdGhlIGZvcm0gYGBBbmQoQW5kKEFuZChhLCBiKSwgYyksIGQpYGAgdG8gYGBBbmQoYSwgYiwgYywgZClgYAoKICAgICAgICAjIGJ1dCBvbmx5IGlmIHRoZXJlIGFyZSBubyBwYXJzZSBhY3Rpb25zIG9yIHJlc3VsdHNOYW1lcyBvbiB0aGUgbmVzdGVkIEFuZCdzCgogICAgICAgICMgKGxpa2V3aXNlIGZvciA6Y2xhc3M6YE9yYCdzIGFuZCA6Y2xhc3M6YE1hdGNoRmlyc3RgJ3MpCgogICAgICAgIGlmIGxlbihzZWxmLmV4cHJzKSA9PSAyOgoKICAgICAgICAgICAgb3RoZXIgPSBzZWxmLmV4cHJzWzBdCgogICAgICAgICAgICBpZiAoCgogICAgICAgICAgICAgICAgaXNpbnN0YW5jZShvdGhlciwgc2VsZi5fX2NsYXNzX18pCgogICAgICAgICAgICAgICAgYW5kIG5vdCBvdGhlci5wYXJzZUFjdGlvbgoKICAgICAgICAgICAgICAgIGFuZCBvdGhlci5yZXN1bHRzTmFtZSBpcyBOb25lCgogICAgICAgICAgICAgICAgYW5kIG5vdCBvdGhlci5kZWJ1ZwoKICAgICAgICAgICAgKToKCiAgICAgICAgICAgICAgICBzZWxmLmV4cHJzID0gb3RoZXIuZXhwcnNbOl0gKyBbc2VsZi5leHByc1sxXV0KCiAgICAgICAgICAgICAgICBzZWxmLl9kZWZhdWx0TmFtZSA9IE5vbmUKCiAgICAgICAgICAgICAgICBzZWxmLm1heVJldHVybkVtcHR5IHw9IG90aGVyLm1heVJldHVybkVtcHR5CgogICAgICAgICAgICAgICAgc2VsZi5tYXlJbmRleEVycm9yIHw9IG90aGVyLm1heUluZGV4RXJyb3IKCgoKICAgICAgICAgICAgb3RoZXIgPSBzZWxmLmV4cHJzWy0xXQoKICAgICAgICAgICAgaWYgKAoKICAgICAgICAgICAgICAgIGlzaW5zdGFuY2Uob3RoZXIsIHNlbGYuX19jbGFzc19fKQoKICAgICAgICAgICAgICAgIGFuZCBub3Qgb3RoZXIucGFyc2VBY3Rpb24KCiAgICAgICAgICAgICAgICBhbmQgb3RoZXIucmVzdWx0c05hbWUgaXMgTm9uZQoKICAgICAgICAgICAgICAgIGFuZCBub3Qgb3RoZXIuZGVidWcKCiAgICAgICAgICAgICk6CgogICAgICAgICAgICAgICAgc2VsZi5leHBycyA9IHNlbGYuZXhwcnNbOi0xXSArIG90aGVyLmV4cHJzWzpdCgogICAgICAgICAgICAgICAgc2VsZi5fZGVmYXVsdE5hbWUgPSBOb25lCgogICAgICAgICAgICAgICAgc2VsZi5tYXlSZXR1cm5FbXB0eSB8PSBvdGhlci5tYXlSZXR1cm5FbXB0eQoKICAgICAgICAgICAgICAgIHNlbGYubWF5SW5kZXhFcnJvciB8PSBvdGhlci5tYXlJbmRleEVycm9yCgoKCiAgICAgICAgc2VsZi5lcnJtc2cgPSBcIkV4cGVjdGVkIFwiICsgc3RyKHNlbGYpCgoKCiAgICAgICAgcmV0dXJuIHNlbGYKCgoKICAgIGRlZiB2YWxpZGF0ZShzZWxmLCB2YWxpZGF0ZVRyYWNlPU5vbmUpIC0+IE5vbmU6CgogICAgICAgIHRtcCA9ICh2YWxpZGF0ZVRyYWNlIGlmIHZhbGlkYXRlVHJhY2UgaXMgbm90IE5vbmUgZWxzZSBbXSlbOl0gKyBbc2VsZl0KCiAgICAgICAgZm9yIGUgaW4gc2VsZi5leHByczoKCiAgICAgICAgICAgIGUudmFsaWRhdGUodG1wKQoKICAgICAgICBzZWxmLl9jaGVja1JlY3Vyc2lvbihbXSkKCgoKICAgIGRlZiBjb3B5KHNlbGYpIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgICAgIHJldCA9IHN1cGVyKCkuY29weSgpCgogICAgICAgIHJldC5leHBycyA9IFtlLmNvcHkoKSBmb3IgZSBpbiBzZWxmLmV4cHJzXQoKICAgICAgICByZXR1cm4gcmV0CgoKCiAgICBkZWYgX3NldFJlc3VsdHNOYW1lKHNlbGYsIG5hbWUsIGxpc3RBbGxNYXRjaGVzPUZhbHNlKToKCiAgICAgICAgaWYgKAoKICAgICAgICAgICAgX19kaWFnX18ud2Fybl91bmdyb3VwZWRfbmFtZWRfdG9rZW5zX2luX2NvbGxlY3Rpb24KCiAgICAgICAgICAgIGFuZCBEaWFnbm9zdGljcy53YXJuX3VuZ3JvdXBlZF9uYW1lZF90b2tlbnNfaW5fY29sbGVjdGlvbgoKICAgICAgICAgICAgbm90IGluIHNlbGYuc3VwcHJlc3Nfd2FybmluZ3NfCgogICAgICAgICk6CgogICAgICAgICAgICBmb3IgZSBpbiBzZWxmLmV4cHJzOgoKICAgICAgICAgICAgICAgIGlmICgKCiAgICAgICAgICAgICAgICAgICAgaXNpbnN0YW5jZShlLCBQYXJzZXJFbGVtZW50KQoKICAgICAgICAgICAgICAgICAgICBhbmQgZS5yZXN1bHRzTmFtZQoKICAgICAgICAgICAgICAgICAgICBhbmQgRGlhZ25vc3RpY3Mud2Fybl91bmdyb3VwZWRfbmFtZWRfdG9rZW5zX2luX2NvbGxlY3Rpb24KCiAgICAgICAgICAgICAgICAgICAgbm90IGluIGUuc3VwcHJlc3Nfd2FybmluZ3NfCgogICAgICAgICAgICAgICAgKToKCiAgICAgICAgICAgICAgICAgICAgd2FybmluZ3Mud2FybigKCiAgICAgICAgICAgICAgICAgICAgICAgIFwie306IHNldHRpbmcgcmVzdWx0cyBuYW1lIHshcn0gb24ge30gZXhwcmVzc2lvbiBcIgoKICAgICAgICAgICAgICAgICAgICAgICAgXCJjb2xsaWRlcyB3aXRoIHshcn0gb24gY29udGFpbmVkIGV4cHJlc3Npb25cIi5mb3JtYXQoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ3YXJuX3VuZ3JvdXBlZF9uYW1lZF90b2tlbnNfaW5fY29sbGVjdGlvblwiLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZShzZWxmKS5fX25hbWVfXywKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnJlc3VsdHNOYW1lLAoKICAgICAgICAgICAgICAgICAgICAgICAgKSwKCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrbGV2ZWw9MywKCiAgICAgICAgICAgICAgICAgICAgKQoKCgogICAgICAgIHJldHVybiBzdXBlcigpLl9zZXRSZXN1bHRzTmFtZShuYW1lLCBsaXN0QWxsTWF0Y2hlcykKCgoKICAgIGlnbm9yZVdoaXRlc3BhY2UgPSBpZ25vcmVfd2hpdGVzcGFjZQoKICAgIGxlYXZlV2hpdGVzcGFjZSA9IGxlYXZlX3doaXRlc3BhY2UKCgoKCgpjbGFzcyBBbmQoUGFyc2VFeHByZXNzaW9uKToKCiAgICBcIlwiXCIKCiAgICBSZXF1aXJlcyBhbGwgZ2l2ZW4gOmNsYXNzOmBQYXJzZUV4cHJlc3Npb25gIHMgdG8gYmUgZm91bmQgaW4gdGhlIGdpdmVuIG9yZGVyLgoKICAgIEV4cHJlc3Npb25zIG1heSBiZSBzZXBhcmF0ZWQgYnkgd2hpdGVzcGFjZS4KCiAgICBNYXkgYmUgY29uc3RydWN0ZWQgdXNpbmcgdGhlIGBgJysnYGAgb3BlcmF0b3IuCgogICAgTWF5IGFsc28gYmUgY29uc3RydWN0ZWQgdXNpbmcgdGhlIGBgJy0nYGAgb3BlcmF0b3IsIHdoaWNoIHdpbGwKCiAgICBzdXBwcmVzcyBiYWNrdHJhY2tpbmcuCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICBpbnRlZ2VyID0gV29yZChudW1zKQoKICAgICAgICBuYW1lX2V4cHIgPSBXb3JkKGFscGhhcylbMSwgLi4uXQoKCgogICAgICAgIGV4cHIgPSBBbmQoW2ludGVnZXIoXCJpZFwiKSwgbmFtZV9leHByKFwibmFtZVwiKSwgaW50ZWdlcihcImFnZVwiKV0pCgogICAgICAgICMgbW9yZSBlYXNpbHkgd3JpdHRlbiBhczoKCiAgICAgICAgZXhwciA9IGludGVnZXIoXCJpZFwiKSArIG5hbWVfZXhwcihcIm5hbWVcIikgKyBpbnRlZ2VyKFwiYWdlXCIpCgogICAgXCJcIlwiCgoKCiAgICBjbGFzcyBfRXJyb3JTdG9wKEVtcHR5KToKCiAgICAgICAgZGVmIF9faW5pdF9fKHNlbGYsICphcmdzLCAqKmt3YXJncyk6CgogICAgICAgICAgICBzdXBlcigpLl9faW5pdF9fKCphcmdzLCAqKmt3YXJncykKCiAgICAgICAgICAgIHNlbGYubGVhdmVfd2hpdGVzcGFjZSgpCgoKCiAgICAgICAgZGVmIF9nZW5lcmF0ZURlZmF1bHROYW1lKHNlbGYpOgoKICAgICAgICAgICAgcmV0dXJuIFwiLVwiCgoKCiAgICBkZWYgX19pbml0X18oCgogICAgICAgIHNlbGYsIGV4cHJzX2FyZzogdHlwaW5nLkl0ZXJhYmxlW1BhcnNlckVsZW1lbnRdLCBzYXZlbGlzdDogYm9vbCA9IFRydWUKCiAgICApOgoKICAgICAgICBleHByczogTGlzdFtQYXJzZXJFbGVtZW50XSA9IGxpc3QoZXhwcnNfYXJnKQoKICAgICAgICBpZiBleHBycyBhbmQgRWxsaXBzaXMgaW4gZXhwcnM6CgogICAgICAgICAgICB0bXAgPSBbXQoKICAgICAgICAgICAgZm9yIGksIGV4cHIgaW4gZW51bWVyYXRlKGV4cHJzKToKCiAgICAgICAgICAgICAgICBpZiBleHByIGlzIEVsbGlwc2lzOgoKICAgICAgICAgICAgICAgICAgICBpZiBpIDwgbGVuKGV4cHJzKSAtIDE6CgogICAgICAgICAgICAgICAgICAgICAgICBza2lwdG9fYXJnOiBQYXJzZXJFbGVtZW50ID0gKEVtcHR5KCkgKyBleHByc1tpICsgMV0pLmV4cHJzWy0xXQoKICAgICAgICAgICAgICAgICAgICAgICAgdG1wLmFwcGVuZChTa2lwVG8oc2tpcHRvX2FyZykoXCJfc2tpcHBlZCpcIikpCgogICAgICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJjYW5ub3QgY29uc3RydWN0IEFuZCB3aXRoIHNlcXVlbmNlIGVuZGluZyBpbiAuLi5cIgoKICAgICAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgIHRtcC5hcHBlbmQoZXhwcikKCiAgICAgICAgICAgIGV4cHJzWzpdID0gdG1wCgogICAgICAgIHN1cGVyKCkuX19pbml0X18oZXhwcnMsIHNhdmVsaXN0KQoKICAgICAgICBpZiBzZWxmLmV4cHJzOgoKICAgICAgICAgICAgc2VsZi5tYXlSZXR1cm5FbXB0eSA9IGFsbChlLm1heVJldHVybkVtcHR5IGZvciBlIGluIHNlbGYuZXhwcnMpCgogICAgICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShzZWxmLmV4cHJzWzBdLCBXaGl0ZSk6CgogICAgICAgICAgICAgICAgc2VsZi5zZXRfd2hpdGVzcGFjZV9jaGFycygKCiAgICAgICAgICAgICAgICAgICAgc2VsZi5leHByc1swXS53aGl0ZUNoYXJzLAoKICAgICAgICAgICAgICAgICAgICBjb3B5X2RlZmF1bHRzPXNlbGYuZXhwcnNbMF0uY29weURlZmF1bHRXaGl0ZUNoYXJzLAoKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICBzZWxmLnNraXBXaGl0ZXNwYWNlID0gc2VsZi5leHByc1swXS5za2lwV2hpdGVzcGFjZQoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICBzZWxmLnNraXBXaGl0ZXNwYWNlID0gRmFsc2UKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHNlbGYubWF5UmV0dXJuRW1wdHkgPSBUcnVlCgogICAgICAgIHNlbGYuY2FsbFByZXBhcnNlID0gVHJ1ZQoKCgogICAgZGVmIHN0cmVhbWxpbmUoc2VsZikgLT4gUGFyc2VyRWxlbWVudDoKCiAgICAgICAgIyBjb2xsYXBzZSBhbnkgX1BlbmRpbmdTa2lwJ3MKCiAgICAgICAgaWYgc2VsZi5leHByczoKCiAgICAgICAgICAgIGlmIGFueSgKCiAgICAgICAgICAgICAgICBpc2luc3RhbmNlKGUsIFBhcnNlRXhwcmVzc2lvbikKCiAgICAgICAgICAgICAgICBhbmQgZS5leHBycwoKICAgICAgICAgICAgICAgIGFuZCBpc2luc3RhbmNlKGUuZXhwcnNbLTFdLCBfUGVuZGluZ1NraXApCgogICAgICAgICAgICAgICAgZm9yIGUgaW4gc2VsZi5leHByc1s6LTFdCgogICAgICAgICAgICApOgoKICAgICAgICAgICAgICAgIGZvciBpLCBlIGluIGVudW1lcmF0ZShzZWxmLmV4cHJzWzotMV0pOgoKICAgICAgICAgICAgICAgICAgICBpZiBlIGlzIE5vbmU6CgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgICAgICAgICBpZiAoCgogICAgICAgICAgICAgICAgICAgICAgICBpc2luc3RhbmNlKGUsIFBhcnNlRXhwcmVzc2lvbikKCiAgICAgICAgICAgICAgICAgICAgICAgIGFuZCBlLmV4cHJzCgogICAgICAgICAgICAgICAgICAgICAgICBhbmQgaXNpbnN0YW5jZShlLmV4cHJzWy0xXSwgX1BlbmRpbmdTa2lwKQoKICAgICAgICAgICAgICAgICAgICApOgoKICAgICAgICAgICAgICAgICAgICAgICAgZS5leHByc1stMV0gPSBlLmV4cHJzWy0xXSArIHNlbGYuZXhwcnNbaSArIDFdCgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmV4cHJzW2kgKyAxXSA9IE5vbmUKCiAgICAgICAgICAgICAgICBzZWxmLmV4cHJzID0gW2UgZm9yIGUgaW4gc2VsZi5leHBycyBpZiBlIGlzIG5vdCBOb25lXQoKCgogICAgICAgIHN1cGVyKCkuc3RyZWFtbGluZSgpCgoKCiAgICAgICAgIyBsaW5rIGFueSBJbmRlbnRlZEJsb2NrcyB0byB0aGUgcHJpb3IgZXhwcmVzc2lvbgoKICAgICAgICBmb3IgcHJldiwgY3VyIGluIHppcChzZWxmLmV4cHJzLCBzZWxmLmV4cHJzWzE6XSk6CgogICAgICAgICAgICAjIHRyYXZlcnNlIGN1ciBvciBhbnkgZmlyc3QgZW1iZWRkZWQgZXhwciBvZiBjdXIgbG9va2luZyBmb3IgYW4gSW5kZW50ZWRCbG9jawoKICAgICAgICAgICAgIyAoYnV0IHdhdGNoIG91dCBmb3IgcmVjdXJzaXZlIGdyYW1tYXIpCgogICAgICAgICAgICBzZWVuID0gc2V0KCkKCiAgICAgICAgICAgIHdoaWxlIGN1cjoKCiAgICAgICAgICAgICAgICBpZiBpZChjdXIpIGluIHNlZW46CgogICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICAgICAgc2Vlbi5hZGQoaWQoY3VyKSkKCiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGN1ciwgSW5kZW50ZWRCbG9jayk6CgogICAgICAgICAgICAgICAgICAgIHByZXYuYWRkX3BhcnNlX2FjdGlvbigKCiAgICAgICAgICAgICAgICAgICAgICAgIGxhbWJkYSBzLCBsLCB0LCBjdXJfPWN1cjogc2V0YXR0cigKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJfLCBcInBhcmVudF9hbmNob3JcIiwgY29sKGwsIHMpCgogICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgICAgICBzdWJzID0gY3VyLnJlY3Vyc2UoKQoKICAgICAgICAgICAgICAgIGN1ciA9IG5leHQoaXRlcihzdWJzKSwgTm9uZSkKCgoKICAgICAgICBzZWxmLm1heVJldHVybkVtcHR5ID0gYWxsKGUubWF5UmV0dXJuRW1wdHkgZm9yIGUgaW4gc2VsZi5leHBycykKCiAgICAgICAgcmV0dXJuIHNlbGYKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICAjIHBhc3MgRmFsc2UgYXMgY2FsbFByZVBhcnNlIGFyZyB0byBfcGFyc2UgZm9yIGZpcnN0IGVsZW1lbnQsIHNpbmNlIHdlIGFscmVhZHkKCiAgICAgICAgIyBwcmUtcGFyc2VkIHRoZSBzdHJpbmcgYXMgcGFydCBvZiBvdXIgQW5kIHByZS1wYXJzaW5nCgogICAgICAgIGxvYywgcmVzdWx0bGlzdCA9IHNlbGYuZXhwcnNbMF0uX3BhcnNlKAoKICAgICAgICAgICAgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zLCBjYWxsUHJlUGFyc2U9RmFsc2UKCiAgICAgICAgKQoKICAgICAgICBlcnJvclN0b3AgPSBGYWxzZQoKICAgICAgICBmb3IgZSBpbiBzZWxmLmV4cHJzWzE6XToKCiAgICAgICAgICAgICMgaWYgaXNpbnN0YW5jZShlLCBBbmQuX0Vycm9yU3RvcCk6CgogICAgICAgICAgICBpZiB0eXBlKGUpIGlzIEFuZC5fRXJyb3JTdG9wOgoKICAgICAgICAgICAgICAgIGVycm9yU3RvcCA9IFRydWUKCiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgaWYgZXJyb3JTdG9wOgoKICAgICAgICAgICAgICAgIHRyeToKCiAgICAgICAgICAgICAgICAgICAgbG9jLCBleHBydG9rZW5zID0gZS5fcGFyc2UoaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zKQoKICAgICAgICAgICAgICAgIGV4Y2VwdCBQYXJzZVN5bnRheEV4Y2VwdGlvbjoKCiAgICAgICAgICAgICAgICAgICAgcmFpc2UKCiAgICAgICAgICAgICAgICBleGNlcHQgUGFyc2VCYXNlRXhjZXB0aW9uIGFzIHBlOgoKICAgICAgICAgICAgICAgICAgICBwZS5fX3RyYWNlYmFja19fID0gTm9uZQoKICAgICAgICAgICAgICAgICAgICByYWlzZSBQYXJzZVN5bnRheEV4Y2VwdGlvbi5fZnJvbV9leGNlcHRpb24ocGUpCgogICAgICAgICAgICAgICAgZXhjZXB0IEluZGV4RXJyb3I6CgogICAgICAgICAgICAgICAgICAgIHJhaXNlIFBhcnNlU3ludGF4RXhjZXB0aW9uKAoKICAgICAgICAgICAgICAgICAgICAgICAgaW5zdHJpbmcsIGxlbihpbnN0cmluZyksIHNlbGYuZXJybXNnLCBzZWxmCgogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgbG9jLCBleHBydG9rZW5zID0gZS5fcGFyc2UoaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zKQoKICAgICAgICAgICAgaWYgZXhwcnRva2VucyBvciBleHBydG9rZW5zLmhhc2tleXMoKToKCiAgICAgICAgICAgICAgICByZXN1bHRsaXN0ICs9IGV4cHJ0b2tlbnMKCiAgICAgICAgcmV0dXJuIGxvYywgcmVzdWx0bGlzdAoKCgogICAgZGVmIF9faWFkZF9fKHNlbGYsIG90aGVyKToKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgc3RyX3R5cGUpOgoKICAgICAgICAgICAgb3RoZXIgPSBzZWxmLl9saXRlcmFsU3RyaW5nQ2xhc3Mob3RoZXIpCgogICAgICAgIHJldHVybiBzZWxmLmFwcGVuZChvdGhlcikgICMgQW5kKFtzZWxmLCBvdGhlcl0pCgoKCiAgICBkZWYgX2NoZWNrUmVjdXJzaW9uKHNlbGYsIHBhcnNlRWxlbWVudExpc3QpOgoKICAgICAgICBzdWJSZWNDaGVja0xpc3QgPSBwYXJzZUVsZW1lbnRMaXN0WzpdICsgW3NlbGZdCgogICAgICAgIGZvciBlIGluIHNlbGYuZXhwcnM6CgogICAgICAgICAgICBlLl9jaGVja1JlY3Vyc2lvbihzdWJSZWNDaGVja0xpc3QpCgogICAgICAgICAgICBpZiBub3QgZS5tYXlSZXR1cm5FbXB0eToKCiAgICAgICAgICAgICAgICBicmVhawoKCgogICAgZGVmIF9nZW5lcmF0ZURlZmF1bHROYW1lKHNlbGYpOgoKICAgICAgICBpbm5lciA9IFwiIFwiLmpvaW4oc3RyKGUpIGZvciBlIGluIHNlbGYuZXhwcnMpCgogICAgICAgICMgc3RyaXAgb2ZmIHJlZHVuZGFudCBpbm5lciB7fSdzCgogICAgICAgIHdoaWxlIGxlbihpbm5lcikgPiAxIGFuZCBpbm5lclswIDo6IGxlbihpbm5lcikgLSAxXSA9PSBcInt9XCI6CgogICAgICAgICAgICBpbm5lciA9IGlubmVyWzE6LTFdCgogICAgICAgIHJldHVybiBcIntcIiArIGlubmVyICsgXCJ9XCIKCgoKCgpjbGFzcyBPcihQYXJzZUV4cHJlc3Npb24pOgoKICAgIFwiXCJcIlJlcXVpcmVzIHRoYXQgYXQgbGVhc3Qgb25lIDpjbGFzczpgUGFyc2VFeHByZXNzaW9uYCBpcyBmb3VuZC4gSWYKCiAgICB0d28gZXhwcmVzc2lvbnMgbWF0Y2gsIHRoZSBleHByZXNzaW9uIHRoYXQgbWF0Y2hlcyB0aGUgbG9uZ2VzdAoKICAgIHN0cmluZyB3aWxsIGJlIHVzZWQuIE1heSBiZSBjb25zdHJ1Y3RlZCB1c2luZyB0aGUgYGAnXidgYAoKICAgIG9wZXJhdG9yLgoKCgogICAgRXhhbXBsZTo6CgoKCiAgICAgICAgIyBjb25zdHJ1Y3QgT3IgdXNpbmcgJ14nIG9wZXJhdG9yCgoKCiAgICAgICAgbnVtYmVyID0gV29yZChudW1zKSBeIENvbWJpbmUoV29yZChudW1zKSArICcuJyArIFdvcmQobnVtcykpCgogICAgICAgIHByaW50KG51bWJlci5zZWFyY2hfc3RyaW5nKFwiMTIzIDMuMTQxNiA3ODlcIikpCgoKCiAgICBwcmludHM6OgoKCgogICAgICAgIFtbJzEyMyddLCBbJzMuMTQxNiddLCBbJzc4OSddXQoKICAgIFwiXCJcIgoKCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGV4cHJzOiB0eXBpbmcuSXRlcmFibGVbUGFyc2VyRWxlbWVudF0sIHNhdmVsaXN0OiBib29sID0gRmFsc2UpOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGV4cHJzLCBzYXZlbGlzdCkKCiAgICAgICAgaWYgc2VsZi5leHByczoKCiAgICAgICAgICAgIHNlbGYubWF5UmV0dXJuRW1wdHkgPSBhbnkoZS5tYXlSZXR1cm5FbXB0eSBmb3IgZSBpbiBzZWxmLmV4cHJzKQoKICAgICAgICAgICAgc2VsZi5za2lwV2hpdGVzcGFjZSA9IGFsbChlLnNraXBXaGl0ZXNwYWNlIGZvciBlIGluIHNlbGYuZXhwcnMpCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBzZWxmLm1heVJldHVybkVtcHR5ID0gVHJ1ZQoKCgogICAgZGVmIHN0cmVhbWxpbmUoc2VsZikgLT4gUGFyc2VyRWxlbWVudDoKCiAgICAgICAgc3VwZXIoKS5zdHJlYW1saW5lKCkKCiAgICAgICAgaWYgc2VsZi5leHByczoKCiAgICAgICAgICAgIHNlbGYubWF5UmV0dXJuRW1wdHkgPSBhbnkoZS5tYXlSZXR1cm5FbXB0eSBmb3IgZSBpbiBzZWxmLmV4cHJzKQoKICAgICAgICAgICAgc2VsZi5zYXZlQXNMaXN0ID0gYW55KGUuc2F2ZUFzTGlzdCBmb3IgZSBpbiBzZWxmLmV4cHJzKQoKICAgICAgICAgICAgc2VsZi5za2lwV2hpdGVzcGFjZSA9IGFsbCgKCiAgICAgICAgICAgICAgICBlLnNraXBXaGl0ZXNwYWNlIGFuZCBub3QgaXNpbnN0YW5jZShlLCBXaGl0ZSkgZm9yIGUgaW4gc2VsZi5leHBycwoKICAgICAgICAgICAgKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgc2VsZi5zYXZlQXNMaXN0ID0gRmFsc2UKCiAgICAgICAgcmV0dXJuIHNlbGYKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICBtYXhFeGNMb2MgPSAtMQoKICAgICAgICBtYXhFeGNlcHRpb24gPSBOb25lCgogICAgICAgIG1hdGNoZXMgPSBbXQoKICAgICAgICBmYXRhbHMgPSBbXQoKICAgICAgICBpZiBhbGwoZS5jYWxsUHJlcGFyc2UgZm9yIGUgaW4gc2VsZi5leHBycyk6CgogICAgICAgICAgICBsb2MgPSBzZWxmLnByZVBhcnNlKGluc3RyaW5nLCBsb2MpCgogICAgICAgIGZvciBlIGluIHNlbGYuZXhwcnM6CgogICAgICAgICAgICB0cnk6CgogICAgICAgICAgICAgICAgbG9jMiA9IGUudHJ5X3BhcnNlKGluc3RyaW5nLCBsb2MsIHJhaXNlX2ZhdGFsPVRydWUpCgogICAgICAgICAgICBleGNlcHQgUGFyc2VGYXRhbEV4Y2VwdGlvbiBhcyBwZmU6CgogICAgICAgICAgICAgICAgcGZlLl9fdHJhY2ViYWNrX18gPSBOb25lCgogICAgICAgICAgICAgICAgcGZlLnBhcnNlckVsZW1lbnQgPSBlCgogICAgICAgICAgICAgICAgZmF0YWxzLmFwcGVuZChwZmUpCgogICAgICAgICAgICAgICAgbWF4RXhjZXB0aW9uID0gTm9uZQoKICAgICAgICAgICAgICAgIG1heEV4Y0xvYyA9IC0xCgogICAgICAgICAgICBleGNlcHQgUGFyc2VFeGNlcHRpb24gYXMgZXJyOgoKICAgICAgICAgICAgICAgIGlmIG5vdCBmYXRhbHM6CgogICAgICAgICAgICAgICAgICAgIGVyci5fX3RyYWNlYmFja19fID0gTm9uZQoKICAgICAgICAgICAgICAgICAgICBpZiBlcnIubG9jID4gbWF4RXhjTG9jOgoKICAgICAgICAgICAgICAgICAgICAgICAgbWF4RXhjZXB0aW9uID0gZXJyCgogICAgICAgICAgICAgICAgICAgICAgICBtYXhFeGNMb2MgPSBlcnIubG9jCgogICAgICAgICAgICBleGNlcHQgSW5kZXhFcnJvcjoKCiAgICAgICAgICAgICAgICBpZiBsZW4oaW5zdHJpbmcpID4gbWF4RXhjTG9jOgoKICAgICAgICAgICAgICAgICAgICBtYXhFeGNlcHRpb24gPSBQYXJzZUV4Y2VwdGlvbigKCiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RyaW5nLCBsZW4oaW5zdHJpbmcpLCBlLmVycm1zZywgc2VsZgoKICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgIG1heEV4Y0xvYyA9IGxlbihpbnN0cmluZykKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgIyBzYXZlIG1hdGNoIGFtb25nIGFsbCBtYXRjaGVzLCB0byByZXRyeSBsb25nZXN0IHRvIHNob3J0ZXN0CgogICAgICAgICAgICAgICAgbWF0Y2hlcy5hcHBlbmQoKGxvYzIsIGUpKQoKCgogICAgICAgIGlmIG1hdGNoZXM6CgogICAgICAgICAgICAjIHJlLWV2YWx1YXRlIGFsbCBtYXRjaGVzIGluIGRlc2NlbmRpbmcgb3JkZXIgb2YgbGVuZ3RoIG9mIG1hdGNoLCBpbiBjYXNlIGF0dGFjaGVkIGFjdGlvbnMKCiAgICAgICAgICAgICMgbWlnaHQgY2hhbmdlIHdoZXRoZXIgb3IgaG93IG11Y2ggdGhleSBtYXRjaCBvZiB0aGUgaW5wdXQuCgogICAgICAgICAgICBtYXRjaGVzLnNvcnQoa2V5PWl0ZW1nZXR0ZXIoMCksIHJldmVyc2U9VHJ1ZSkKCgoKICAgICAgICAgICAgaWYgbm90IGRvQWN0aW9uczoKCiAgICAgICAgICAgICAgICAjIG5vIGZ1cnRoZXIgY29uZGl0aW9ucyBvciBwYXJzZSBhY3Rpb25zIHRvIGNoYW5nZSB0aGUgc2VsZWN0aW9uIG9mCgogICAgICAgICAgICAgICAgIyBhbHRlcm5hdGl2ZSwgc28gdGhlIGZpcnN0IG1hdGNoIHdpbGwgYmUgdGhlIGJlc3QgbWF0Y2gKCiAgICAgICAgICAgICAgICBiZXN0X2V4cHIgPSBtYXRjaGVzWzBdWzFdCgogICAgICAgICAgICAgICAgcmV0dXJuIGJlc3RfZXhwci5fcGFyc2UoaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zKQoKCgogICAgICAgICAgICBsb25nZXN0ID0gLTEsIE5vbmUKCiAgICAgICAgICAgIGZvciBsb2MxLCBleHByMSBpbiBtYXRjaGVzOgoKICAgICAgICAgICAgICAgIGlmIGxvYzEgPD0gbG9uZ2VzdFswXToKCiAgICAgICAgICAgICAgICAgICAgIyBhbHJlYWR5IGhhdmUgYSBsb25nZXIgbWF0Y2ggdGhhbiB0aGlzIG9uZSB3aWxsIGRlbGl2ZXIsIHdlIGFyZSBkb25lCgogICAgICAgICAgICAgICAgICAgIHJldHVybiBsb25nZXN0CgoKCiAgICAgICAgICAgICAgICB0cnk6CgogICAgICAgICAgICAgICAgICAgIGxvYzIsIHRva3MgPSBleHByMS5fcGFyc2UoaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zKQoKICAgICAgICAgICAgICAgIGV4Y2VwdCBQYXJzZUV4Y2VwdGlvbiBhcyBlcnI6CgogICAgICAgICAgICAgICAgICAgIGVyci5fX3RyYWNlYmFja19fID0gTm9uZQoKICAgICAgICAgICAgICAgICAgICBpZiBlcnIubG9jID4gbWF4RXhjTG9jOgoKICAgICAgICAgICAgICAgICAgICAgICAgbWF4RXhjZXB0aW9uID0gZXJyCgogICAgICAgICAgICAgICAgICAgICAgICBtYXhFeGNMb2MgPSBlcnIubG9jCgogICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgaWYgbG9jMiA+PSBsb2MxOgoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvYzIsIHRva3MKCiAgICAgICAgICAgICAgICAgICAgIyBkaWRuJ3QgbWF0Y2ggYXMgbXVjaCBhcyBiZWZvcmUKCiAgICAgICAgICAgICAgICAgICAgZWxpZiBsb2MyID4gbG9uZ2VzdFswXToKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvbmdlc3QgPSBsb2MyLCB0b2tzCgoKCiAgICAgICAgICAgIGlmIGxvbmdlc3QgIT0gKC0xLCBOb25lKToKCiAgICAgICAgICAgICAgICByZXR1cm4gbG9uZ2VzdAoKCgogICAgICAgIGlmIGZhdGFsczoKCiAgICAgICAgICAgIGlmIGxlbihmYXRhbHMpID4gMToKCiAgICAgICAgICAgICAgICBmYXRhbHMuc29ydChrZXk9bGFtYmRhIGU6IC1lLmxvYykKCiAgICAgICAgICAgICAgICBpZiBmYXRhbHNbMF0ubG9jID09IGZhdGFsc1sxXS5sb2M6CgogICAgICAgICAgICAgICAgICAgIGZhdGFscy5zb3J0KGtleT1sYW1iZGEgZTogKC1lLmxvYywgLWxlbihzdHIoZS5wYXJzZXJFbGVtZW50KSkpKQoKICAgICAgICAgICAgbWF4X2ZhdGFsID0gZmF0YWxzWzBdCgogICAgICAgICAgICByYWlzZSBtYXhfZmF0YWwKCgoKICAgICAgICBpZiBtYXhFeGNlcHRpb24gaXMgbm90IE5vbmU6CgogICAgICAgICAgICBtYXhFeGNlcHRpb24ubXNnID0gc2VsZi5lcnJtc2cKCiAgICAgICAgICAgIHJhaXNlIG1heEV4Y2VwdGlvbgoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgcmFpc2UgUGFyc2VFeGNlcHRpb24oCgogICAgICAgICAgICAgICAgaW5zdHJpbmcsIGxvYywgXCJubyBkZWZpbmVkIGFsdGVybmF0aXZlcyB0byBtYXRjaFwiLCBzZWxmCgogICAgICAgICAgICApCgoKCiAgICBkZWYgX19peG9yX18oc2VsZiwgb3RoZXIpOgoKICAgICAgICBpZiBpc2luc3RhbmNlKG90aGVyLCBzdHJfdHlwZSk6CgogICAgICAgICAgICBvdGhlciA9IHNlbGYuX2xpdGVyYWxTdHJpbmdDbGFzcyhvdGhlcikKCiAgICAgICAgcmV0dXJuIHNlbGYuYXBwZW5kKG90aGVyKSAgIyBPcihbc2VsZiwgb3RoZXJdKQoKCgogICAgZGVmIF9nZW5lcmF0ZURlZmF1bHROYW1lKHNlbGYpOgoKICAgICAgICByZXR1cm4gXCJ7XCIgKyBcIiBeIFwiLmpvaW4oc3RyKGUpIGZvciBlIGluIHNlbGYuZXhwcnMpICsgXCJ9XCIKCgoKICAgIGRlZiBfc2V0UmVzdWx0c05hbWUoc2VsZiwgbmFtZSwgbGlzdEFsbE1hdGNoZXM9RmFsc2UpOgoKICAgICAgICBpZiAoCgogICAgICAgICAgICBfX2RpYWdfXy53YXJuX211bHRpcGxlX3Rva2Vuc19pbl9uYW1lZF9hbHRlcm5hdGlvbgoKICAgICAgICAgICAgYW5kIERpYWdub3N0aWNzLndhcm5fbXVsdGlwbGVfdG9rZW5zX2luX25hbWVkX2FsdGVybmF0aW9uCgogICAgICAgICAgICBub3QgaW4gc2VsZi5zdXBwcmVzc193YXJuaW5nc18KCiAgICAgICAgKToKCiAgICAgICAgICAgIGlmIGFueSgKCiAgICAgICAgICAgICAgICBpc2luc3RhbmNlKGUsIEFuZCkKCiAgICAgICAgICAgICAgICBhbmQgRGlhZ25vc3RpY3Mud2Fybl9tdWx0aXBsZV90b2tlbnNfaW5fbmFtZWRfYWx0ZXJuYXRpb24KCiAgICAgICAgICAgICAgICBub3QgaW4gZS5zdXBwcmVzc193YXJuaW5nc18KCiAgICAgICAgICAgICAgICBmb3IgZSBpbiBzZWxmLmV4cHJzCgogICAgICAgICAgICApOgoKICAgICAgICAgICAgICAgIHdhcm5pbmdzLndhcm4oCgogICAgICAgICAgICAgICAgICAgIFwie306IHNldHRpbmcgcmVzdWx0cyBuYW1lIHshcn0gb24ge30gZXhwcmVzc2lvbiBcIgoKICAgICAgICAgICAgICAgICAgICBcIndpbGwgcmV0dXJuIGEgbGlzdCBvZiBhbGwgcGFyc2VkIHRva2VucyBpbiBhbiBBbmQgYWx0ZXJuYXRpdmUsIFwiCgogICAgICAgICAgICAgICAgICAgIFwiaW4gcHJpb3IgdmVyc2lvbnMgb25seSB0aGUgZmlyc3QgdG9rZW4gd2FzIHJldHVybmVkOyBlbmNsb3NlIFwiCgogICAgICAgICAgICAgICAgICAgIFwiY29udGFpbmVkIGFyZ3VtZW50IGluIEdyb3VwXCIuZm9ybWF0KAoKICAgICAgICAgICAgICAgICAgICAgICAgXCJ3YXJuX211bHRpcGxlX3Rva2Vuc19pbl9uYW1lZF9hbHRlcm5hdGlvblwiLAoKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSwKCiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUoc2VsZikuX19uYW1lX18sCgogICAgICAgICAgICAgICAgICAgICksCgogICAgICAgICAgICAgICAgICAgIHN0YWNrbGV2ZWw9MywKCiAgICAgICAgICAgICAgICApCgoKCiAgICAgICAgcmV0dXJuIHN1cGVyKCkuX3NldFJlc3VsdHNOYW1lKG5hbWUsIGxpc3RBbGxNYXRjaGVzKQoKCgoKCmNsYXNzIE1hdGNoRmlyc3QoUGFyc2VFeHByZXNzaW9uKToKCiAgICBcIlwiXCJSZXF1aXJlcyB0aGF0IGF0IGxlYXN0IG9uZSA6Y2xhc3M6YFBhcnNlRXhwcmVzc2lvbmAgaXMgZm91bmQuIElmCgogICAgbW9yZSB0aGFuIG9uZSBleHByZXNzaW9uIG1hdGNoZXMsIHRoZSBmaXJzdCBvbmUgbGlzdGVkIGlzIHRoZSBvbmUgdGhhdCB3aWxsCgogICAgbWF0Y2guIE1heSBiZSBjb25zdHJ1Y3RlZCB1c2luZyB0aGUgYGAnfCdgYCBvcGVyYXRvci4KCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgICMgY29uc3RydWN0IE1hdGNoRmlyc3QgdXNpbmcgJ3wnIG9wZXJhdG9yCgoKCiAgICAgICAgIyB3YXRjaCB0aGUgb3JkZXIgb2YgZXhwcmVzc2lvbnMgdG8gbWF0Y2gKCiAgICAgICAgbnVtYmVyID0gV29yZChudW1zKSB8IENvbWJpbmUoV29yZChudW1zKSArICcuJyArIFdvcmQobnVtcykpCgogICAgICAgIHByaW50KG51bWJlci5zZWFyY2hfc3RyaW5nKFwiMTIzIDMuMTQxNiA3ODlcIikpICMgIEZhaWwhIC0+IFtbJzEyMyddLCBbJzMnXSwgWycxNDE2J10sIFsnNzg5J11dCgoKCiAgICAgICAgIyBwdXQgbW9yZSBzZWxlY3RpdmUgZXhwcmVzc2lvbiBmaXJzdAoKICAgICAgICBudW1iZXIgPSBDb21iaW5lKFdvcmQobnVtcykgKyAnLicgKyBXb3JkKG51bXMpKSB8IFdvcmQobnVtcykKCiAgICAgICAgcHJpbnQobnVtYmVyLnNlYXJjaF9zdHJpbmcoXCIxMjMgMy4xNDE2IDc4OVwiKSkgIyAgQmV0dGVyIC0+IFtbJzEyMyddLCBbJzMuMTQxNiddLCBbJzc4OSddXQoKICAgIFwiXCJcIgoKCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGV4cHJzOiB0eXBpbmcuSXRlcmFibGVbUGFyc2VyRWxlbWVudF0sIHNhdmVsaXN0OiBib29sID0gRmFsc2UpOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGV4cHJzLCBzYXZlbGlzdCkKCiAgICAgICAgaWYgc2VsZi5leHByczoKCiAgICAgICAgICAgIHNlbGYubWF5UmV0dXJuRW1wdHkgPSBhbnkoZS5tYXlSZXR1cm5FbXB0eSBmb3IgZSBpbiBzZWxmLmV4cHJzKQoKICAgICAgICAgICAgc2VsZi5za2lwV2hpdGVzcGFjZSA9IGFsbChlLnNraXBXaGl0ZXNwYWNlIGZvciBlIGluIHNlbGYuZXhwcnMpCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBzZWxmLm1heVJldHVybkVtcHR5ID0gVHJ1ZQoKCgogICAgZGVmIHN0cmVhbWxpbmUoc2VsZikgLT4gUGFyc2VyRWxlbWVudDoKCiAgICAgICAgaWYgc2VsZi5zdHJlYW1saW5lZDoKCiAgICAgICAgICAgIHJldHVybiBzZWxmCgoKCiAgICAgICAgc3VwZXIoKS5zdHJlYW1saW5lKCkKCiAgICAgICAgaWYgc2VsZi5leHByczoKCiAgICAgICAgICAgIHNlbGYuc2F2ZUFzTGlzdCA9IGFueShlLnNhdmVBc0xpc3QgZm9yIGUgaW4gc2VsZi5leHBycykKCiAgICAgICAgICAgIHNlbGYubWF5UmV0dXJuRW1wdHkgPSBhbnkoZS5tYXlSZXR1cm5FbXB0eSBmb3IgZSBpbiBzZWxmLmV4cHJzKQoKICAgICAgICAgICAgc2VsZi5za2lwV2hpdGVzcGFjZSA9IGFsbCgKCiAgICAgICAgICAgICAgICBlLnNraXBXaGl0ZXNwYWNlIGFuZCBub3QgaXNpbnN0YW5jZShlLCBXaGl0ZSkgZm9yIGUgaW4gc2VsZi5leHBycwoKICAgICAgICAgICAgKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgc2VsZi5zYXZlQXNMaXN0ID0gRmFsc2UKCiAgICAgICAgICAgIHNlbGYubWF5UmV0dXJuRW1wdHkgPSBUcnVlCgogICAgICAgIHJldHVybiBzZWxmCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgbWF4RXhjTG9jID0gLTEKCiAgICAgICAgbWF4RXhjZXB0aW9uID0gTm9uZQoKCgogICAgICAgIGZvciBlIGluIHNlbGYuZXhwcnM6CgogICAgICAgICAgICB0cnk6CgogICAgICAgICAgICAgICAgcmV0dXJuIGUuX3BhcnNlKAoKICAgICAgICAgICAgICAgICAgICBpbnN0cmluZywKCiAgICAgICAgICAgICAgICAgICAgbG9jLAoKICAgICAgICAgICAgICAgICAgICBkb0FjdGlvbnMsCgogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgZXhjZXB0IFBhcnNlRmF0YWxFeGNlcHRpb24gYXMgcGZlOgoKICAgICAgICAgICAgICAgIHBmZS5fX3RyYWNlYmFja19fID0gTm9uZQoKICAgICAgICAgICAgICAgIHBmZS5wYXJzZXJFbGVtZW50ID0gZQoKICAgICAgICAgICAgICAgIHJhaXNlCgogICAgICAgICAgICBleGNlcHQgUGFyc2VFeGNlcHRpb24gYXMgZXJyOgoKICAgICAgICAgICAgICAgIGlmIGVyci5sb2MgPiBtYXhFeGNMb2M6CgogICAgICAgICAgICAgICAgICAgIG1heEV4Y2VwdGlvbiA9IGVycgoKICAgICAgICAgICAgICAgICAgICBtYXhFeGNMb2MgPSBlcnIubG9jCgogICAgICAgICAgICBleGNlcHQgSW5kZXhFcnJvcjoKCiAgICAgICAgICAgICAgICBpZiBsZW4oaW5zdHJpbmcpID4gbWF4RXhjTG9jOgoKICAgICAgICAgICAgICAgICAgICBtYXhFeGNlcHRpb24gPSBQYXJzZUV4Y2VwdGlvbigKCiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RyaW5nLCBsZW4oaW5zdHJpbmcpLCBlLmVycm1zZywgc2VsZgoKICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgIG1heEV4Y0xvYyA9IGxlbihpbnN0cmluZykKCgoKICAgICAgICBpZiBtYXhFeGNlcHRpb24gaXMgbm90IE5vbmU6CgogICAgICAgICAgICBtYXhFeGNlcHRpb24ubXNnID0gc2VsZi5lcnJtc2cKCiAgICAgICAgICAgIHJhaXNlIG1heEV4Y2VwdGlvbgoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgcmFpc2UgUGFyc2VFeGNlcHRpb24oCgogICAgICAgICAgICAgICAgaW5zdHJpbmcsIGxvYywgXCJubyBkZWZpbmVkIGFsdGVybmF0aXZlcyB0byBtYXRjaFwiLCBzZWxmCgogICAgICAgICAgICApCgoKCiAgICBkZWYgX19pb3JfXyhzZWxmLCBvdGhlcik6CgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3RoZXIsIHN0cl90eXBlKToKCiAgICAgICAgICAgIG90aGVyID0gc2VsZi5fbGl0ZXJhbFN0cmluZ0NsYXNzKG90aGVyKQoKICAgICAgICByZXR1cm4gc2VsZi5hcHBlbmQob3RoZXIpICAjIE1hdGNoRmlyc3QoW3NlbGYsIG90aGVyXSkKCgoKICAgIGRlZiBfZ2VuZXJhdGVEZWZhdWx0TmFtZShzZWxmKToKCiAgICAgICAgcmV0dXJuIFwie1wiICsgXCIgfCBcIi5qb2luKHN0cihlKSBmb3IgZSBpbiBzZWxmLmV4cHJzKSArIFwifVwiCgoKCiAgICBkZWYgX3NldFJlc3VsdHNOYW1lKHNlbGYsIG5hbWUsIGxpc3RBbGxNYXRjaGVzPUZhbHNlKToKCiAgICAgICAgaWYgKAoKICAgICAgICAgICAgX19kaWFnX18ud2Fybl9tdWx0aXBsZV90b2tlbnNfaW5fbmFtZWRfYWx0ZXJuYXRpb24KCiAgICAgICAgICAgIGFuZCBEaWFnbm9zdGljcy53YXJuX211bHRpcGxlX3Rva2Vuc19pbl9uYW1lZF9hbHRlcm5hdGlvbgoKICAgICAgICAgICAgbm90IGluIHNlbGYuc3VwcHJlc3Nfd2FybmluZ3NfCgogICAgICAgICk6CgogICAgICAgICAgICBpZiBhbnkoCgogICAgICAgICAgICAgICAgaXNpbnN0YW5jZShlLCBBbmQpCgogICAgICAgICAgICAgICAgYW5kIERpYWdub3N0aWNzLndhcm5fbXVsdGlwbGVfdG9rZW5zX2luX25hbWVkX2FsdGVybmF0aW9uCgogICAgICAgICAgICAgICAgbm90IGluIGUuc3VwcHJlc3Nfd2FybmluZ3NfCgogICAgICAgICAgICAgICAgZm9yIGUgaW4gc2VsZi5leHBycwoKICAgICAgICAgICAgKToKCiAgICAgICAgICAgICAgICB3YXJuaW5ncy53YXJuKAoKICAgICAgICAgICAgICAgICAgICBcInt9OiBzZXR0aW5nIHJlc3VsdHMgbmFtZSB7IXJ9IG9uIHt9IGV4cHJlc3Npb24gXCIKCiAgICAgICAgICAgICAgICAgICAgXCJ3aWxsIHJldHVybiBhIGxpc3Qgb2YgYWxsIHBhcnNlZCB0b2tlbnMgaW4gYW4gQW5kIGFsdGVybmF0aXZlLCBcIgoKICAgICAgICAgICAgICAgICAgICBcImluIHByaW9yIHZlcnNpb25zIG9ubHkgdGhlIGZpcnN0IHRva2VuIHdhcyByZXR1cm5lZDsgZW5jbG9zZSBcIgoKICAgICAgICAgICAgICAgICAgICBcImNvbnRhaW5lZCBhcmd1bWVudCBpbiBHcm91cFwiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICAgICAgICAgIFwid2Fybl9tdWx0aXBsZV90b2tlbnNfaW5fbmFtZWRfYWx0ZXJuYXRpb25cIiwKCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUsCgogICAgICAgICAgICAgICAgICAgICAgICB0eXBlKHNlbGYpLl9fbmFtZV9fLAoKICAgICAgICAgICAgICAgICAgICApLAoKICAgICAgICAgICAgICAgICAgICBzdGFja2xldmVsPTMsCgogICAgICAgICAgICAgICAgKQoKCgogICAgICAgIHJldHVybiBzdXBlcigpLl9zZXRSZXN1bHRzTmFtZShuYW1lLCBsaXN0QWxsTWF0Y2hlcykKCgoKCgpjbGFzcyBFYWNoKFBhcnNlRXhwcmVzc2lvbik6CgogICAgXCJcIlwiUmVxdWlyZXMgYWxsIGdpdmVuIDpjbGFzczpgUGFyc2VFeHByZXNzaW9uYCBzIHRvIGJlIGZvdW5kLCBidXQgaW4KCiAgICBhbnkgb3JkZXIuIEV4cHJlc3Npb25zIG1heSBiZSBzZXBhcmF0ZWQgYnkgd2hpdGVzcGFjZS4KCgoKICAgIE1heSBiZSBjb25zdHJ1Y3RlZCB1c2luZyB0aGUgYGAnJidgYCBvcGVyYXRvci4KCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgIGNvbG9yID0gb25lX29mKFwiUkVEIE9SQU5HRSBZRUxMT1cgR1JFRU4gQkxVRSBQVVJQTEUgQkxBQ0sgV0hJVEUgQlJPV05cIikKCiAgICAgICAgc2hhcGVfdHlwZSA9IG9uZV9vZihcIlNRVUFSRSBDSVJDTEUgVFJJQU5HTEUgU1RBUiBIRVhBR09OIE9DVEFHT05cIikKCiAgICAgICAgaW50ZWdlciA9IFdvcmQobnVtcykKCiAgICAgICAgc2hhcGVfYXR0ciA9IFwic2hhcGU6XCIgKyBzaGFwZV90eXBlKFwic2hhcGVcIikKCiAgICAgICAgcG9zbl9hdHRyID0gXCJwb3NuOlwiICsgR3JvdXAoaW50ZWdlcihcInhcIikgKyAnLCcgKyBpbnRlZ2VyKFwieVwiKSkoXCJwb3NuXCIpCgogICAgICAgIGNvbG9yX2F0dHIgPSBcImNvbG9yOlwiICsgY29sb3IoXCJjb2xvclwiKQoKICAgICAgICBzaXplX2F0dHIgPSBcInNpemU6XCIgKyBpbnRlZ2VyKFwic2l6ZVwiKQoKCgogICAgICAgICMgdXNlIEVhY2ggKHVzaW5nIG9wZXJhdG9yICcmJykgdG8gYWNjZXB0IGF0dHJpYnV0ZXMgaW4gYW55IG9yZGVyCgogICAgICAgICMgKHNoYXBlIGFuZCBwb3NuIGFyZSByZXF1aXJlZCwgY29sb3IgYW5kIHNpemUgYXJlIG9wdGlvbmFsKQoKICAgICAgICBzaGFwZV9zcGVjID0gc2hhcGVfYXR0ciAmIHBvc25fYXR0ciAmIE9wdChjb2xvcl9hdHRyKSAmIE9wdChzaXplX2F0dHIpCgoKCiAgICAgICAgc2hhcGVfc3BlYy5ydW5fdGVzdHMoJycnCgogICAgICAgICAgICBzaGFwZTogU1FVQVJFIGNvbG9yOiBCTEFDSyBwb3NuOiAxMDAsIDEyMAoKICAgICAgICAgICAgc2hhcGU6IENJUkNMRSBzaXplOiA1MCBjb2xvcjogQkxVRSBwb3NuOiA1MCw4MAoKICAgICAgICAgICAgY29sb3I6R1JFRU4gc2l6ZToyMCBzaGFwZTpUUklBTkdMRSBwb3NuOjIwLDQwCgogICAgICAgICAgICAnJycKCiAgICAgICAgICAgICkKCgoKICAgIHByaW50czo6CgoKCiAgICAgICAgc2hhcGU6IFNRVUFSRSBjb2xvcjogQkxBQ0sgcG9zbjogMTAwLCAxMjAKCiAgICAgICAgWydzaGFwZTonLCAnU1FVQVJFJywgJ2NvbG9yOicsICdCTEFDSycsICdwb3NuOicsIFsnMTAwJywgJywnLCAnMTIwJ11dCgogICAgICAgIC0gY29sb3I6IEJMQUNLCgogICAgICAgIC0gcG9zbjogWycxMDAnLCAnLCcsICcxMjAnXQoKICAgICAgICAgIC0geDogMTAwCgogICAgICAgICAgLSB5OiAxMjAKCiAgICAgICAgLSBzaGFwZTogU1FVQVJFCgoKCgoKICAgICAgICBzaGFwZTogQ0lSQ0xFIHNpemU6IDUwIGNvbG9yOiBCTFVFIHBvc246IDUwLDgwCgogICAgICAgIFsnc2hhcGU6JywgJ0NJUkNMRScsICdzaXplOicsICc1MCcsICdjb2xvcjonLCAnQkxVRScsICdwb3NuOicsIFsnNTAnLCAnLCcsICc4MCddXQoKICAgICAgICAtIGNvbG9yOiBCTFVFCgogICAgICAgIC0gcG9zbjogWyc1MCcsICcsJywgJzgwJ10KCiAgICAgICAgICAtIHg6IDUwCgogICAgICAgICAgLSB5OiA4MAoKICAgICAgICAtIHNoYXBlOiBDSVJDTEUKCiAgICAgICAgLSBzaXplOiA1MAoKCgoKCiAgICAgICAgY29sb3I6IEdSRUVOIHNpemU6IDIwIHNoYXBlOiBUUklBTkdMRSBwb3NuOiAyMCw0MAoKICAgICAgICBbJ2NvbG9yOicsICdHUkVFTicsICdzaXplOicsICcyMCcsICdzaGFwZTonLCAnVFJJQU5HTEUnLCAncG9zbjonLCBbJzIwJywgJywnLCAnNDAnXV0KCiAgICAgICAgLSBjb2xvcjogR1JFRU4KCiAgICAgICAgLSBwb3NuOiBbJzIwJywgJywnLCAnNDAnXQoKICAgICAgICAgIC0geDogMjAKCiAgICAgICAgICAtIHk6IDQwCgogICAgICAgIC0gc2hhcGU6IFRSSUFOR0xFCgogICAgICAgIC0gc2l6ZTogMjAKCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBleHByczogdHlwaW5nLkl0ZXJhYmxlW1BhcnNlckVsZW1lbnRdLCBzYXZlbGlzdDogYm9vbCA9IFRydWUpOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGV4cHJzLCBzYXZlbGlzdCkKCiAgICAgICAgaWYgc2VsZi5leHByczoKCiAgICAgICAgICAgIHNlbGYubWF5UmV0dXJuRW1wdHkgPSBhbGwoZS5tYXlSZXR1cm5FbXB0eSBmb3IgZSBpbiBzZWxmLmV4cHJzKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgc2VsZi5tYXlSZXR1cm5FbXB0eSA9IFRydWUKCiAgICAgICAgc2VsZi5za2lwV2hpdGVzcGFjZSA9IFRydWUKCiAgICAgICAgc2VsZi5pbml0RXhwckdyb3VwcyA9IFRydWUKCiAgICAgICAgc2VsZi5zYXZlQXNMaXN0ID0gVHJ1ZQoKCgogICAgZGVmIHN0cmVhbWxpbmUoc2VsZikgLT4gUGFyc2VyRWxlbWVudDoKCiAgICAgICAgc3VwZXIoKS5zdHJlYW1saW5lKCkKCiAgICAgICAgaWYgc2VsZi5leHByczoKCiAgICAgICAgICAgIHNlbGYubWF5UmV0dXJuRW1wdHkgPSBhbGwoZS5tYXlSZXR1cm5FbXB0eSBmb3IgZSBpbiBzZWxmLmV4cHJzKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgc2VsZi5tYXlSZXR1cm5FbXB0eSA9IFRydWUKCiAgICAgICAgcmV0dXJuIHNlbGYKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICBpZiBzZWxmLmluaXRFeHByR3JvdXBzOgoKICAgICAgICAgICAgc2VsZi5vcHQxbWFwID0gZGljdCgKCiAgICAgICAgICAgICAgICAoaWQoZS5leHByKSwgZSkgZm9yIGUgaW4gc2VsZi5leHBycyBpZiBpc2luc3RhbmNlKGUsIE9wdCkKCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIG9wdDEgPSBbZS5leHByIGZvciBlIGluIHNlbGYuZXhwcnMgaWYgaXNpbnN0YW5jZShlLCBPcHQpXQoKICAgICAgICAgICAgb3B0MiA9IFsKCiAgICAgICAgICAgICAgICBlCgogICAgICAgICAgICAgICAgZm9yIGUgaW4gc2VsZi5leHBycwoKICAgICAgICAgICAgICAgIGlmIGUubWF5UmV0dXJuRW1wdHkgYW5kIG5vdCBpc2luc3RhbmNlKGUsIChPcHQsIFJlZ2V4LCBaZXJvT3JNb3JlKSkKCiAgICAgICAgICAgIF0KCiAgICAgICAgICAgIHNlbGYub3B0aW9uYWxzID0gb3B0MSArIG9wdDIKCiAgICAgICAgICAgIHNlbGYubXVsdGlvcHRpb25hbHMgPSBbCgogICAgICAgICAgICAgICAgZS5leHByLnNldF9yZXN1bHRzX25hbWUoZS5yZXN1bHRzTmFtZSwgbGlzdF9hbGxfbWF0Y2hlcz1UcnVlKQoKICAgICAgICAgICAgICAgIGZvciBlIGluIHNlbGYuZXhwcnMKCiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGUsIF9NdWx0aXBsZU1hdGNoKQoKICAgICAgICAgICAgXQoKICAgICAgICAgICAgc2VsZi5tdWx0aXJlcXVpcmVkID0gWwoKICAgICAgICAgICAgICAgIGUuZXhwci5zZXRfcmVzdWx0c19uYW1lKGUucmVzdWx0c05hbWUsIGxpc3RfYWxsX21hdGNoZXM9VHJ1ZSkKCiAgICAgICAgICAgICAgICBmb3IgZSBpbiBzZWxmLmV4cHJzCgogICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShlLCBPbmVPck1vcmUpCgogICAgICAgICAgICBdCgogICAgICAgICAgICBzZWxmLnJlcXVpcmVkID0gWwoKICAgICAgICAgICAgICAgIGUgZm9yIGUgaW4gc2VsZi5leHBycyBpZiBub3QgaXNpbnN0YW5jZShlLCAoT3B0LCBaZXJvT3JNb3JlLCBPbmVPck1vcmUpKQoKICAgICAgICAgICAgXQoKICAgICAgICAgICAgc2VsZi5yZXF1aXJlZCArPSBzZWxmLm11bHRpcmVxdWlyZWQKCiAgICAgICAgICAgIHNlbGYuaW5pdEV4cHJHcm91cHMgPSBGYWxzZQoKCgogICAgICAgIHRtcExvYyA9IGxvYwoKICAgICAgICB0bXBSZXFkID0gc2VsZi5yZXF1aXJlZFs6XQoKICAgICAgICB0bXBPcHQgPSBzZWxmLm9wdGlvbmFsc1s6XQoKICAgICAgICBtdWx0aXMgPSBzZWxmLm11bHRpb3B0aW9uYWxzWzpdCgogICAgICAgIG1hdGNoT3JkZXIgPSBbXQoKCgogICAgICAgIGtlZXBNYXRjaGluZyA9IFRydWUKCiAgICAgICAgZmFpbGVkID0gW10KCiAgICAgICAgZmF0YWxzID0gW10KCiAgICAgICAgd2hpbGUga2VlcE1hdGNoaW5nOgoKICAgICAgICAgICAgdG1wRXhwcnMgPSB0bXBSZXFkICsgdG1wT3B0ICsgbXVsdGlzCgogICAgICAgICAgICBmYWlsZWQuY2xlYXIoKQoKICAgICAgICAgICAgZmF0YWxzLmNsZWFyKCkKCiAgICAgICAgICAgIGZvciBlIGluIHRtcEV4cHJzOgoKICAgICAgICAgICAgICAgIHRyeToKCiAgICAgICAgICAgICAgICAgICAgdG1wTG9jID0gZS50cnlfcGFyc2UoaW5zdHJpbmcsIHRtcExvYywgcmFpc2VfZmF0YWw9VHJ1ZSkKCiAgICAgICAgICAgICAgICBleGNlcHQgUGFyc2VGYXRhbEV4Y2VwdGlvbiBhcyBwZmU6CgogICAgICAgICAgICAgICAgICAgIHBmZS5fX3RyYWNlYmFja19fID0gTm9uZQoKICAgICAgICAgICAgICAgICAgICBwZmUucGFyc2VyRWxlbWVudCA9IGUKCiAgICAgICAgICAgICAgICAgICAgZmF0YWxzLmFwcGVuZChwZmUpCgogICAgICAgICAgICAgICAgICAgIGZhaWxlZC5hcHBlbmQoZSkKCiAgICAgICAgICAgICAgICBleGNlcHQgUGFyc2VFeGNlcHRpb246CgogICAgICAgICAgICAgICAgICAgIGZhaWxlZC5hcHBlbmQoZSkKCiAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICBtYXRjaE9yZGVyLmFwcGVuZChzZWxmLm9wdDFtYXAuZ2V0KGlkKGUpLCBlKSkKCiAgICAgICAgICAgICAgICAgICAgaWYgZSBpbiB0bXBSZXFkOgoKICAgICAgICAgICAgICAgICAgICAgICAgdG1wUmVxZC5yZW1vdmUoZSkKCiAgICAgICAgICAgICAgICAgICAgZWxpZiBlIGluIHRtcE9wdDoKCiAgICAgICAgICAgICAgICAgICAgICAgIHRtcE9wdC5yZW1vdmUoZSkKCiAgICAgICAgICAgIGlmIGxlbihmYWlsZWQpID09IGxlbih0bXBFeHBycyk6CgogICAgICAgICAgICAgICAga2VlcE1hdGNoaW5nID0gRmFsc2UKCgoKICAgICAgICAjIGxvb2sgZm9yIGFueSBQYXJzZUZhdGFsRXhjZXB0aW9ucwoKICAgICAgICBpZiBmYXRhbHM6CgogICAgICAgICAgICBpZiBsZW4oZmF0YWxzKSA+IDE6CgogICAgICAgICAgICAgICAgZmF0YWxzLnNvcnQoa2V5PWxhbWJkYSBlOiAtZS5sb2MpCgogICAgICAgICAgICAgICAgaWYgZmF0YWxzWzBdLmxvYyA9PSBmYXRhbHNbMV0ubG9jOgoKICAgICAgICAgICAgICAgICAgICBmYXRhbHMuc29ydChrZXk9bGFtYmRhIGU6ICgtZS5sb2MsIC1sZW4oc3RyKGUucGFyc2VyRWxlbWVudCkpKSkKCiAgICAgICAgICAgIG1heF9mYXRhbCA9IGZhdGFsc1swXQoKICAgICAgICAgICAgcmFpc2UgbWF4X2ZhdGFsCgoKCiAgICAgICAgaWYgdG1wUmVxZDoKCiAgICAgICAgICAgIG1pc3NpbmcgPSBcIiwgXCIuam9pbihbc3RyKGUpIGZvciBlIGluIHRtcFJlcWRdKQoKICAgICAgICAgICAgcmFpc2UgUGFyc2VFeGNlcHRpb24oCgogICAgICAgICAgICAgICAgaW5zdHJpbmcsCgogICAgICAgICAgICAgICAgbG9jLAoKICAgICAgICAgICAgICAgIFwiTWlzc2luZyBvbmUgb3IgbW9yZSByZXF1aXJlZCBlbGVtZW50cyAoe30pXCIuZm9ybWF0KG1pc3NpbmcpLAoKICAgICAgICAgICAgKQoKCgogICAgICAgICMgYWRkIGFueSB1bm1hdGNoZWQgT3B0cywgaW4gY2FzZSB0aGV5IGhhdmUgZGVmYXVsdCB2YWx1ZXMgZGVmaW5lZAoKICAgICAgICBtYXRjaE9yZGVyICs9IFtlIGZvciBlIGluIHNlbGYuZXhwcnMgaWYgaXNpbnN0YW5jZShlLCBPcHQpIGFuZCBlLmV4cHIgaW4gdG1wT3B0XQoKCgogICAgICAgIHRvdGFsX3Jlc3VsdHMgPSBQYXJzZVJlc3VsdHMoW10pCgogICAgICAgIGZvciBlIGluIG1hdGNoT3JkZXI6CgogICAgICAgICAgICBsb2MsIHJlc3VsdHMgPSBlLl9wYXJzZShpbnN0cmluZywgbG9jLCBkb0FjdGlvbnMpCgogICAgICAgICAgICB0b3RhbF9yZXN1bHRzICs9IHJlc3VsdHMKCgoKICAgICAgICByZXR1cm4gbG9jLCB0b3RhbF9yZXN1bHRzCgoKCiAgICBkZWYgX2dlbmVyYXRlRGVmYXVsdE5hbWUoc2VsZik6CgogICAgICAgIHJldHVybiBcIntcIiArIFwiICYgXCIuam9pbihzdHIoZSkgZm9yIGUgaW4gc2VsZi5leHBycykgKyBcIn1cIgoKCgoKCmNsYXNzIFBhcnNlRWxlbWVudEVuaGFuY2UoUGFyc2VyRWxlbWVudCk6CgogICAgXCJcIlwiQWJzdHJhY3Qgc3ViY2xhc3Mgb2YgOmNsYXNzOmBQYXJzZXJFbGVtZW50YCwgZm9yIGNvbWJpbmluZyBhbmQKCiAgICBwb3N0LXByb2Nlc3NpbmcgcGFyc2VkIHRva2Vucy4KCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBleHByOiBVbmlvbltQYXJzZXJFbGVtZW50LCBzdHJdLCBzYXZlbGlzdDogYm9vbCA9IEZhbHNlKToKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhzYXZlbGlzdCkKCiAgICAgICAgaWYgaXNpbnN0YW5jZShleHByLCBzdHJfdHlwZSk6CgogICAgICAgICAgICBpZiBpc3N1YmNsYXNzKHNlbGYuX2xpdGVyYWxTdHJpbmdDbGFzcywgVG9rZW4pOgoKICAgICAgICAgICAgICAgIGV4cHIgPSBzZWxmLl9saXRlcmFsU3RyaW5nQ2xhc3MoZXhwcikKCiAgICAgICAgICAgIGVsaWYgaXNzdWJjbGFzcyh0eXBlKHNlbGYpLCBzZWxmLl9saXRlcmFsU3RyaW5nQ2xhc3MpOgoKICAgICAgICAgICAgICAgIGV4cHIgPSBMaXRlcmFsKGV4cHIpCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIGV4cHIgPSBzZWxmLl9saXRlcmFsU3RyaW5nQ2xhc3MoTGl0ZXJhbChleHByKSkKCiAgICAgICAgc2VsZi5leHByID0gZXhwcgoKICAgICAgICBpZiBleHByIGlzIG5vdCBOb25lOgoKICAgICAgICAgICAgc2VsZi5tYXlJbmRleEVycm9yID0gZXhwci5tYXlJbmRleEVycm9yCgogICAgICAgICAgICBzZWxmLm1heVJldHVybkVtcHR5ID0gZXhwci5tYXlSZXR1cm5FbXB0eQoKICAgICAgICAgICAgc2VsZi5zZXRfd2hpdGVzcGFjZV9jaGFycygKCiAgICAgICAgICAgICAgICBleHByLndoaXRlQ2hhcnMsIGNvcHlfZGVmYXVsdHM9ZXhwci5jb3B5RGVmYXVsdFdoaXRlQ2hhcnMKCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIHNlbGYuc2tpcFdoaXRlc3BhY2UgPSBleHByLnNraXBXaGl0ZXNwYWNlCgogICAgICAgICAgICBzZWxmLnNhdmVBc0xpc3QgPSBleHByLnNhdmVBc0xpc3QKCiAgICAgICAgICAgIHNlbGYuY2FsbFByZXBhcnNlID0gZXhwci5jYWxsUHJlcGFyc2UKCiAgICAgICAgICAgIHNlbGYuaWdub3JlRXhwcnMuZXh0ZW5kKGV4cHIuaWdub3JlRXhwcnMpCgoKCiAgICBkZWYgcmVjdXJzZShzZWxmKSAtPiBTZXF1ZW5jZVtQYXJzZXJFbGVtZW50XToKCiAgICAgICAgcmV0dXJuIFtzZWxmLmV4cHJdIGlmIHNlbGYuZXhwciBpcyBub3QgTm9uZSBlbHNlIFtdCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgaWYgc2VsZi5leHByIGlzIG5vdCBOb25lOgoKICAgICAgICAgICAgcmV0dXJuIHNlbGYuZXhwci5fcGFyc2UoaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zLCBjYWxsUHJlUGFyc2U9RmFsc2UpCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBcIk5vIGV4cHJlc3Npb24gZGVmaW5lZFwiLCBzZWxmKQoKCgogICAgZGVmIGxlYXZlX3doaXRlc3BhY2Uoc2VsZiwgcmVjdXJzaXZlOiBib29sID0gVHJ1ZSkgLT4gUGFyc2VyRWxlbWVudDoKCiAgICAgICAgc3VwZXIoKS5sZWF2ZV93aGl0ZXNwYWNlKHJlY3Vyc2l2ZSkKCgoKICAgICAgICBpZiByZWN1cnNpdmU6CgogICAgICAgICAgICBzZWxmLmV4cHIgPSBzZWxmLmV4cHIuY29weSgpCgogICAgICAgICAgICBpZiBzZWxmLmV4cHIgaXMgbm90IE5vbmU6CgogICAgICAgICAgICAgICAgc2VsZi5leHByLmxlYXZlX3doaXRlc3BhY2UocmVjdXJzaXZlKQoKICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgZGVmIGlnbm9yZV93aGl0ZXNwYWNlKHNlbGYsIHJlY3Vyc2l2ZTogYm9vbCA9IFRydWUpIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgICAgIHN1cGVyKCkuaWdub3JlX3doaXRlc3BhY2UocmVjdXJzaXZlKQoKCgogICAgICAgIGlmIHJlY3Vyc2l2ZToKCiAgICAgICAgICAgIHNlbGYuZXhwciA9IHNlbGYuZXhwci5jb3B5KCkKCiAgICAgICAgICAgIGlmIHNlbGYuZXhwciBpcyBub3QgTm9uZToKCiAgICAgICAgICAgICAgICBzZWxmLmV4cHIuaWdub3JlX3doaXRlc3BhY2UocmVjdXJzaXZlKQoKICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgZGVmIGlnbm9yZShzZWxmLCBvdGhlcikgLT4gUGFyc2VyRWxlbWVudDoKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgU3VwcHJlc3MpOgoKICAgICAgICAgICAgaWYgb3RoZXIgbm90IGluIHNlbGYuaWdub3JlRXhwcnM6CgogICAgICAgICAgICAgICAgc3VwZXIoKS5pZ25vcmUob3RoZXIpCgogICAgICAgICAgICAgICAgaWYgc2VsZi5leHByIGlzIG5vdCBOb25lOgoKICAgICAgICAgICAgICAgICAgICBzZWxmLmV4cHIuaWdub3JlKHNlbGYuaWdub3JlRXhwcnNbLTFdKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgc3VwZXIoKS5pZ25vcmUob3RoZXIpCgogICAgICAgICAgICBpZiBzZWxmLmV4cHIgaXMgbm90IE5vbmU6CgogICAgICAgICAgICAgICAgc2VsZi5leHByLmlnbm9yZShzZWxmLmlnbm9yZUV4cHJzWy0xXSkKCiAgICAgICAgcmV0dXJuIHNlbGYKCgoKICAgIGRlZiBzdHJlYW1saW5lKHNlbGYpIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgICAgIHN1cGVyKCkuc3RyZWFtbGluZSgpCgogICAgICAgIGlmIHNlbGYuZXhwciBpcyBub3QgTm9uZToKCiAgICAgICAgICAgIHNlbGYuZXhwci5zdHJlYW1saW5lKCkKCiAgICAgICAgcmV0dXJuIHNlbGYKCgoKICAgIGRlZiBfY2hlY2tSZWN1cnNpb24oc2VsZiwgcGFyc2VFbGVtZW50TGlzdCk6CgogICAgICAgIGlmIHNlbGYgaW4gcGFyc2VFbGVtZW50TGlzdDoKCiAgICAgICAgICAgIHJhaXNlIFJlY3Vyc2l2ZUdyYW1tYXJFeGNlcHRpb24ocGFyc2VFbGVtZW50TGlzdCArIFtzZWxmXSkKCiAgICAgICAgc3ViUmVjQ2hlY2tMaXN0ID0gcGFyc2VFbGVtZW50TGlzdFs6XSArIFtzZWxmXQoKICAgICAgICBpZiBzZWxmLmV4cHIgaXMgbm90IE5vbmU6CgogICAgICAgICAgICBzZWxmLmV4cHIuX2NoZWNrUmVjdXJzaW9uKHN1YlJlY0NoZWNrTGlzdCkKCgoKICAgIGRlZiB2YWxpZGF0ZShzZWxmLCB2YWxpZGF0ZVRyYWNlPU5vbmUpIC0+IE5vbmU6CgogICAgICAgIGlmIHZhbGlkYXRlVHJhY2UgaXMgTm9uZToKCiAgICAgICAgICAgIHZhbGlkYXRlVHJhY2UgPSBbXQoKICAgICAgICB0bXAgPSB2YWxpZGF0ZVRyYWNlWzpdICsgW3NlbGZdCgogICAgICAgIGlmIHNlbGYuZXhwciBpcyBub3QgTm9uZToKCiAgICAgICAgICAgIHNlbGYuZXhwci52YWxpZGF0ZSh0bXApCgogICAgICAgIHNlbGYuX2NoZWNrUmVjdXJzaW9uKFtdKQoKCgogICAgZGVmIF9nZW5lcmF0ZURlZmF1bHROYW1lKHNlbGYpOgoKICAgICAgICByZXR1cm4gXCJ7fTooe30pXCIuZm9ybWF0KHNlbGYuX19jbGFzc19fLl9fbmFtZV9fLCBzdHIoc2VsZi5leHByKSkKCgoKICAgIGlnbm9yZVdoaXRlc3BhY2UgPSBpZ25vcmVfd2hpdGVzcGFjZQoKICAgIGxlYXZlV2hpdGVzcGFjZSA9IGxlYXZlX3doaXRlc3BhY2UKCgoKCgpjbGFzcyBJbmRlbnRlZEJsb2NrKFBhcnNlRWxlbWVudEVuaGFuY2UpOgoKICAgIFwiXCJcIgoKICAgIEV4cHJlc3Npb24gdG8gbWF0Y2ggb25lIG9yIG1vcmUgZXhwcmVzc2lvbnMgYXQgYSBnaXZlbiBpbmRlbnRhdGlvbiBsZXZlbC4KCiAgICBVc2VmdWwgZm9yIHBhcnNpbmcgdGV4dCB3aGVyZSBzdHJ1Y3R1cmUgaXMgaW1wbGllZCBieSBpbmRlbnRhdGlvbiAobGlrZSBQeXRob24gc291cmNlIGNvZGUpLgoKICAgIFwiXCJcIgoKCgogICAgY2xhc3MgX0luZGVudChFbXB0eSk6CgogICAgICAgIGRlZiBfX2luaXRfXyhzZWxmLCByZWZfY29sOiBpbnQpOgoKICAgICAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpCgogICAgICAgICAgICBzZWxmLmVycm1zZyA9IFwiZXhwZWN0ZWQgaW5kZW50IGF0IGNvbHVtbiB7fVwiLmZvcm1hdChyZWZfY29sKQoKICAgICAgICAgICAgc2VsZi5hZGRfY29uZGl0aW9uKGxhbWJkYSBzLCBsLCB0OiBjb2wobCwgcykgPT0gcmVmX2NvbCkKCgoKICAgIGNsYXNzIF9JbmRlbnRHcmVhdGVyKEVtcHR5KToKCiAgICAgICAgZGVmIF9faW5pdF9fKHNlbGYsIHJlZl9jb2w6IGludCk6CgogICAgICAgICAgICBzdXBlcigpLl9faW5pdF9fKCkKCiAgICAgICAgICAgIHNlbGYuZXJybXNnID0gXCJleHBlY3RlZCBpbmRlbnQgYXQgY29sdW1uIGdyZWF0ZXIgdGhhbiB7fVwiLmZvcm1hdChyZWZfY29sKQoKICAgICAgICAgICAgc2VsZi5hZGRfY29uZGl0aW9uKGxhbWJkYSBzLCBsLCB0OiBjb2wobCwgcykgPiByZWZfY29sKQoKCgogICAgZGVmIF9faW5pdF9fKAoKICAgICAgICBzZWxmLCBleHByOiBQYXJzZXJFbGVtZW50LCAqLCByZWN1cnNpdmU6IGJvb2wgPSBGYWxzZSwgZ3JvdXBlZDogYm9vbCA9IFRydWUKCiAgICApOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGV4cHIsIHNhdmVsaXN0PVRydWUpCgogICAgICAgICMgaWYgcmVjdXJzaXZlOgoKICAgICAgICAjICAgICByYWlzZSBOb3RJbXBsZW1lbnRlZEVycm9yKFwiSW5kZW50ZWRCbG9jayB3aXRoIHJlY3Vyc2l2ZSBpcyBub3QgaW1wbGVtZW50ZWRcIikKCiAgICAgICAgc2VsZi5fcmVjdXJzaXZlID0gcmVjdXJzaXZlCgogICAgICAgIHNlbGYuX2dyb3VwZWQgPSBncm91cGVkCgogICAgICAgIHNlbGYucGFyZW50X2FuY2hvciA9IDEKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICAjIGFkdmFuY2UgcGFyc2UgcG9zaXRpb24gdG8gbm9uLXdoaXRlc3BhY2UgYnkgdXNpbmcgYW4gRW1wdHkoKQoKICAgICAgICAjIHRoaXMgc2hvdWxkIGJlIHRoZSBjb2x1bW4gdG8gYmUgdXNlZCBmb3IgYWxsIHN1YnNlcXVlbnQgaW5kZW50ZWQgbGluZXMKCiAgICAgICAgYW5jaG9yX2xvYyA9IEVtcHR5KCkucHJlUGFyc2UoaW5zdHJpbmcsIGxvYykKCgoKICAgICAgICAjIHNlZSBpZiBzZWxmLmV4cHIgbWF0Y2hlcyBhdCB0aGUgY3VycmVudCBsb2NhdGlvbiAtIGlmIG5vdCBpdCB3aWxsIHJhaXNlIGFuIGV4Y2VwdGlvbgoKICAgICAgICAjIGFuZCBubyBmdXJ0aGVyIHdvcmsgaXMgbmVjZXNzYXJ5CgogICAgICAgIHNlbGYuZXhwci50cnlfcGFyc2UoaW5zdHJpbmcsIGFuY2hvcl9sb2MsIGRvQWN0aW9ucykKCgoKICAgICAgICBpbmRlbnRfY29sID0gY29sKGFuY2hvcl9sb2MsIGluc3RyaW5nKQoKICAgICAgICBwZWVyX2RldGVjdF9leHByID0gc2VsZi5fSW5kZW50KGluZGVudF9jb2wpCgoKCiAgICAgICAgaW5uZXJfZXhwciA9IEVtcHR5KCkgKyBwZWVyX2RldGVjdF9leHByICsgc2VsZi5leHByCgogICAgICAgIGlmIHNlbGYuX3JlY3Vyc2l2ZToKCiAgICAgICAgICAgIHN1Yl9pbmRlbnQgPSBzZWxmLl9JbmRlbnRHcmVhdGVyKGluZGVudF9jb2wpCgogICAgICAgICAgICBuZXN0ZWRfYmxvY2sgPSBJbmRlbnRlZEJsb2NrKAoKICAgICAgICAgICAgICAgIHNlbGYuZXhwciwgcmVjdXJzaXZlPXNlbGYuX3JlY3Vyc2l2ZSwgZ3JvdXBlZD1zZWxmLl9ncm91cGVkCgogICAgICAgICAgICApCgogICAgICAgICAgICBuZXN0ZWRfYmxvY2suc2V0X2RlYnVnKHNlbGYuZGVidWcpCgogICAgICAgICAgICBuZXN0ZWRfYmxvY2sucGFyZW50X2FuY2hvciA9IGluZGVudF9jb2wKCiAgICAgICAgICAgIGlubmVyX2V4cHIgKz0gT3B0KHN1Yl9pbmRlbnQgKyBuZXN0ZWRfYmxvY2spCgoKCiAgICAgICAgaW5uZXJfZXhwci5zZXRfbmFtZShmXCJpbm5lciB7aGV4KGlkKGlubmVyX2V4cHIpKVstNDpdLnVwcGVyKCl9QHtpbmRlbnRfY29sfVwiKQoKICAgICAgICBibG9jayA9IE9uZU9yTW9yZShpbm5lcl9leHByKQoKCgogICAgICAgIHRyYWlsaW5nX3VuZGVudCA9IHNlbGYuX0luZGVudChzZWxmLnBhcmVudF9hbmNob3IpIHwgU3RyaW5nRW5kKCkKCgoKICAgICAgICBpZiBzZWxmLl9ncm91cGVkOgoKICAgICAgICAgICAgd3JhcHBlciA9IEdyb3VwCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICB3cmFwcGVyID0gbGFtYmRhIGV4cHI6IGV4cHIKCiAgICAgICAgcmV0dXJuICh3cmFwcGVyKGJsb2NrKSArIE9wdGlvbmFsKHRyYWlsaW5nX3VuZGVudCkpLnBhcnNlSW1wbCgKCiAgICAgICAgICAgIGluc3RyaW5nLCBhbmNob3JfbG9jLCBkb0FjdGlvbnMKCiAgICAgICAgKQoKCgoKCmNsYXNzIEF0U3RyaW5nU3RhcnQoUGFyc2VFbGVtZW50RW5oYW5jZSk6CgogICAgXCJcIlwiTWF0Y2hlcyBpZiBleHByZXNzaW9uIG1hdGNoZXMgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgcGFyc2UKCiAgICBzdHJpbmc6OgoKCgogICAgICAgIEF0U3RyaW5nU3RhcnQoV29yZChudW1zKSkucGFyc2Vfc3RyaW5nKFwiMTIzXCIpCgogICAgICAgICMgcHJpbnRzIFtcIjEyM1wiXQoKCgogICAgICAgIEF0U3RyaW5nU3RhcnQoV29yZChudW1zKSkucGFyc2Vfc3RyaW5nKFwiICAgIDEyM1wiKQoKICAgICAgICAjIHJhaXNlcyBQYXJzZUV4Y2VwdGlvbgoKICAgIFwiXCJcIgoKCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGV4cHI6IFVuaW9uW1BhcnNlckVsZW1lbnQsIHN0cl0pOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGV4cHIpCgogICAgICAgIHNlbGYuY2FsbFByZXBhcnNlID0gRmFsc2UKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICBpZiBsb2MgIT0gMDoKCiAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsb2MsIFwibm90IGZvdW5kIGF0IHN0cmluZyBzdGFydFwiKQoKICAgICAgICByZXR1cm4gc3VwZXIoKS5wYXJzZUltcGwoaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zKQoKCgoKCmNsYXNzIEF0TGluZVN0YXJ0KFBhcnNlRWxlbWVudEVuaGFuY2UpOgoKICAgIHJcIlwiXCJNYXRjaGVzIGlmIGFuIGV4cHJlc3Npb24gbWF0Y2hlcyBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgbGluZSB3aXRoaW4KCiAgICB0aGUgcGFyc2Ugc3RyaW5nCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICB0ZXN0ID0gJycnXFwKCiAgICAgICAgQUFBIHRoaXMgbGluZQoKICAgICAgICBBQUEgYW5kIHRoaXMgbGluZQoKICAgICAgICAgIEFBQSBidXQgbm90IHRoaXMgb25lCgogICAgICAgIEIgQUFBIGFuZCBkZWZpbml0ZWx5IG5vdCB0aGlzIG9uZQoKICAgICAgICAnJycKCgoKICAgICAgICBmb3IgdCBpbiAoQXRMaW5lU3RhcnQoJ0FBQScpICsgcmVzdE9mTGluZSkuc2VhcmNoX3N0cmluZyh0ZXN0KToKCiAgICAgICAgICAgIHByaW50KHQpCgoKCiAgICBwcmludHM6OgoKCgogICAgICAgIFsnQUFBJywgJyB0aGlzIGxpbmUnXQoKICAgICAgICBbJ0FBQScsICcgYW5kIHRoaXMgbGluZSddCgoKCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBleHByOiBVbmlvbltQYXJzZXJFbGVtZW50LCBzdHJdKToKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhleHByKQoKICAgICAgICBzZWxmLmNhbGxQcmVwYXJzZSA9IEZhbHNlCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgaWYgY29sKGxvYywgaW5zdHJpbmcpICE9IDE6CgogICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBcIm5vdCBmb3VuZCBhdCBsaW5lIHN0YXJ0XCIpCgogICAgICAgIHJldHVybiBzdXBlcigpLnBhcnNlSW1wbChpbnN0cmluZywgbG9jLCBkb0FjdGlvbnMpCgoKCgoKY2xhc3MgRm9sbG93ZWRCeShQYXJzZUVsZW1lbnRFbmhhbmNlKToKCiAgICBcIlwiXCJMb29rYWhlYWQgbWF0Y2hpbmcgb2YgdGhlIGdpdmVuIHBhcnNlIGV4cHJlc3Npb24uCgogICAgYGBGb2xsb3dlZEJ5YGAgZG9lcyAqbm90KiBhZHZhbmNlIHRoZSBwYXJzaW5nIHBvc2l0aW9uIHdpdGhpbgoKICAgIHRoZSBpbnB1dCBzdHJpbmcsIGl0IG9ubHkgdmVyaWZpZXMgdGhhdCB0aGUgc3BlY2lmaWVkIHBhcnNlCgogICAgZXhwcmVzc2lvbiBtYXRjaGVzIGF0IHRoZSBjdXJyZW50IHBvc2l0aW9uLiAgYGBGb2xsb3dlZEJ5YGAKCiAgICBhbHdheXMgcmV0dXJucyBhIG51bGwgdG9rZW4gbGlzdC4gSWYgYW55IHJlc3VsdHMgbmFtZXMgYXJlIGRlZmluZWQKCiAgICBpbiB0aGUgbG9va2FoZWFkIGV4cHJlc3Npb24sIHRob3NlICp3aWxsKiBiZSByZXR1cm5lZCBmb3IgYWNjZXNzIGJ5CgogICAgbmFtZS4KCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgICMgdXNlIEZvbGxvd2VkQnkgdG8gbWF0Y2ggYSBsYWJlbCBvbmx5IGlmIGl0IGlzIGZvbGxvd2VkIGJ5IGEgJzonCgogICAgICAgIGRhdGFfd29yZCA9IFdvcmQoYWxwaGFzKQoKICAgICAgICBsYWJlbCA9IGRhdGFfd29yZCArIEZvbGxvd2VkQnkoJzonKQoKICAgICAgICBhdHRyX2V4cHIgPSBHcm91cChsYWJlbCArIFN1cHByZXNzKCc6JykgKyBPbmVPck1vcmUoZGF0YV93b3JkLCBzdG9wX29uPWxhYmVsKS5zZXRfcGFyc2VfYWN0aW9uKCcgJy5qb2luKSkKCgoKICAgICAgICBhdHRyX2V4cHJbMSwgLi4uXS5wYXJzZV9zdHJpbmcoXCJzaGFwZTogU1FVQVJFIGNvbG9yOiBCTEFDSyBwb3NuOiB1cHBlciBsZWZ0XCIpLnBwcmludCgpCgoKCiAgICBwcmludHM6OgoKCgogICAgICAgIFtbJ3NoYXBlJywgJ1NRVUFSRSddLCBbJ2NvbG9yJywgJ0JMQUNLJ10sIFsncG9zbicsICd1cHBlciBsZWZ0J11dCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oc2VsZiwgZXhwcjogVW5pb25bUGFyc2VyRWxlbWVudCwgc3RyXSk6CgogICAgICAgIHN1cGVyKCkuX19pbml0X18oZXhwcikKCiAgICAgICAgc2VsZi5tYXlSZXR1cm5FbXB0eSA9IFRydWUKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICAjIGJ5IHVzaW5nIHNlbGYuX2V4cHIucGFyc2UgYW5kIGRlbGV0aW5nIHRoZSBjb250ZW50cyBvZiB0aGUgcmV0dXJuZWQgUGFyc2VSZXN1bHRzIGxpc3QKCiAgICAgICAgIyB3ZSBrZWVwIGFueSBuYW1lZCByZXN1bHRzIHRoYXQgd2VyZSBkZWZpbmVkIGluIHRoZSBGb2xsb3dlZEJ5IGV4cHJlc3Npb24KCiAgICAgICAgXywgcmV0ID0gc2VsZi5leHByLl9wYXJzZShpbnN0cmluZywgbG9jLCBkb0FjdGlvbnM9ZG9BY3Rpb25zKQoKICAgICAgICBkZWwgcmV0WzpdCgoKCiAgICAgICAgcmV0dXJuIGxvYywgcmV0CgoKCgoKY2xhc3MgUHJlY2VkZWRCeShQYXJzZUVsZW1lbnRFbmhhbmNlKToKCiAgICBcIlwiXCJMb29rYmVoaW5kIG1hdGNoaW5nIG9mIHRoZSBnaXZlbiBwYXJzZSBleHByZXNzaW9uLgoKICAgIGBgUHJlY2VkZWRCeWBgIGRvZXMgbm90IGFkdmFuY2UgdGhlIHBhcnNpbmcgcG9zaXRpb24gd2l0aGluIHRoZQoKICAgIGlucHV0IHN0cmluZywgaXQgb25seSB2ZXJpZmllcyB0aGF0IHRoZSBzcGVjaWZpZWQgcGFyc2UgZXhwcmVzc2lvbgoKICAgIG1hdGNoZXMgcHJpb3IgdG8gdGhlIGN1cnJlbnQgcG9zaXRpb24uICBgYFByZWNlZGVkQnlgYCBhbHdheXMKCiAgICByZXR1cm5zIGEgbnVsbCB0b2tlbiBsaXN0LCBidXQgaWYgYSByZXN1bHRzIG5hbWUgaXMgZGVmaW5lZCBvbiB0aGUKCiAgICBnaXZlbiBleHByZXNzaW9uLCBpdCBpcyByZXR1cm5lZC4KCgoKICAgIFBhcmFtZXRlcnM6CgoKCiAgICAtIGV4cHIgLSBleHByZXNzaW9uIHRoYXQgbXVzdCBtYXRjaCBwcmlvciB0byB0aGUgY3VycmVudCBwYXJzZQoKICAgICAgbG9jYXRpb24KCiAgICAtIHJldHJlYXQgLSAoZGVmYXVsdD0gYGBOb25lYGApIC0gKGludCkgbWF4aW11bSBudW1iZXIgb2YgY2hhcmFjdGVycwoKICAgICAgdG8gbG9va2JlaGluZCBwcmlvciB0byB0aGUgY3VycmVudCBwYXJzZSBsb2NhdGlvbgoKCgogICAgSWYgdGhlIGxvb2tiZWhpbmQgZXhwcmVzc2lvbiBpcyBhIHN0cmluZywgOmNsYXNzOmBMaXRlcmFsYCwKCiAgICA6Y2xhc3M6YEtleXdvcmRgLCBvciBhIDpjbGFzczpgV29yZGAgb3IgOmNsYXNzOmBDaGFyc05vdEluYAoKICAgIHdpdGggYSBzcGVjaWZpZWQgZXhhY3Qgb3IgbWF4aW11bSBsZW5ndGgsIHRoZW4gdGhlIHJldHJlYXQKCiAgICBwYXJhbWV0ZXIgaXMgbm90IHJlcXVpcmVkLiBPdGhlcndpc2UsIHJldHJlYXQgbXVzdCBiZSBzcGVjaWZpZWQgdG8KCiAgICBnaXZlIGEgbWF4aW11bSBudW1iZXIgb2YgY2hhcmFjdGVycyB0byBsb29rIGJhY2sgZnJvbQoKICAgIHRoZSBjdXJyZW50IHBhcnNlIHBvc2l0aW9uIGZvciBhIGxvb2tiZWhpbmQgbWF0Y2guCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICAjIFZCLXN0eWxlIHZhcmlhYmxlIG5hbWVzIHdpdGggdHlwZSBwcmVmaXhlcwoKICAgICAgICBpbnRfdmFyID0gUHJlY2VkZWRCeShcIiNcIikgKyBweXBhcnNpbmdfY29tbW9uLmlkZW50aWZpZXIKCiAgICAgICAgc3RyX3ZhciA9IFByZWNlZGVkQnkoXCIkXCIpICsgcHlwYXJzaW5nX2NvbW1vbi5pZGVudGlmaWVyCgoKCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2luaXRfXygKCiAgICAgICAgc2VsZiwgZXhwcjogVW5pb25bUGFyc2VyRWxlbWVudCwgc3RyXSwgcmV0cmVhdDogdHlwaW5nLk9wdGlvbmFsW2ludF0gPSBOb25lCgogICAgKToKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhleHByKQoKICAgICAgICBzZWxmLmV4cHIgPSBzZWxmLmV4cHIoKS5sZWF2ZV93aGl0ZXNwYWNlKCkKCiAgICAgICAgc2VsZi5tYXlSZXR1cm5FbXB0eSA9IFRydWUKCiAgICAgICAgc2VsZi5tYXlJbmRleEVycm9yID0gRmFsc2UKCiAgICAgICAgc2VsZi5leGFjdCA9IEZhbHNlCgogICAgICAgIGlmIGlzaW5zdGFuY2UoZXhwciwgc3RyX3R5cGUpOgoKICAgICAgICAgICAgcmV0cmVhdCA9IGxlbihleHByKQoKICAgICAgICAgICAgc2VsZi5leGFjdCA9IFRydWUKCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKGV4cHIsIChMaXRlcmFsLCBLZXl3b3JkKSk6CgogICAgICAgICAgICByZXRyZWF0ID0gZXhwci5tYXRjaExlbgoKICAgICAgICAgICAgc2VsZi5leGFjdCA9IFRydWUKCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKGV4cHIsIChXb3JkLCBDaGFyc05vdEluKSkgYW5kIGV4cHIubWF4TGVuICE9IF9NQVhfSU5UOgoKICAgICAgICAgICAgcmV0cmVhdCA9IGV4cHIubWF4TGVuCgogICAgICAgICAgICBzZWxmLmV4YWN0ID0gVHJ1ZQoKICAgICAgICBlbGlmIGlzaW5zdGFuY2UoZXhwciwgUG9zaXRpb25Ub2tlbik6CgogICAgICAgICAgICByZXRyZWF0ID0gMAoKICAgICAgICAgICAgc2VsZi5leGFjdCA9IFRydWUKCiAgICAgICAgc2VsZi5yZXRyZWF0ID0gcmV0cmVhdAoKICAgICAgICBzZWxmLmVycm1zZyA9IFwibm90IHByZWNlZGVkIGJ5IFwiICsgc3RyKGV4cHIpCgogICAgICAgIHNlbGYuc2tpcFdoaXRlc3BhY2UgPSBGYWxzZQoKICAgICAgICBzZWxmLnBhcnNlQWN0aW9uLmFwcGVuZChsYW1iZGEgcywgbCwgdDogdC5fX2RlbGl0ZW1fXyhzbGljZShOb25lLCBOb25lKSkpCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2M9MCwgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICBpZiBzZWxmLmV4YWN0OgoKICAgICAgICAgICAgaWYgbG9jIDwgc2VsZi5yZXRyZWF0OgoKICAgICAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsb2MsIHNlbGYuZXJybXNnKQoKICAgICAgICAgICAgc3RhcnQgPSBsb2MgLSBzZWxmLnJldHJlYXQKCiAgICAgICAgICAgIF8sIHJldCA9IHNlbGYuZXhwci5fcGFyc2UoaW5zdHJpbmcsIHN0YXJ0KQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgIyByZXRyZWF0IHNwZWNpZmllZCBhIG1heGltdW0gbG9va2JlaGluZCB3aW5kb3csIGl0ZXJhdGUKCiAgICAgICAgICAgIHRlc3RfZXhwciA9IHNlbGYuZXhwciArIFN0cmluZ0VuZCgpCgogICAgICAgICAgICBpbnN0cmluZ19zbGljZSA9IGluc3RyaW5nW21heCgwLCBsb2MgLSBzZWxmLnJldHJlYXQpIDogbG9jXQoKICAgICAgICAgICAgbGFzdF9leHByID0gUGFyc2VFeGNlcHRpb24oaW5zdHJpbmcsIGxvYywgc2VsZi5lcnJtc2cpCgogICAgICAgICAgICBmb3Igb2Zmc2V0IGluIHJhbmdlKDEsIG1pbihsb2MsIHNlbGYucmV0cmVhdCArIDEpICsgMSk6CgogICAgICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgICAgICAjIHByaW50KCd0cnlpbmcnLCBvZmZzZXQsIGluc3RyaW5nX3NsaWNlLCByZXByKGluc3RyaW5nX3NsaWNlW2xvYyAtIG9mZnNldDpdKSkKCiAgICAgICAgICAgICAgICAgICAgXywgcmV0ID0gdGVzdF9leHByLl9wYXJzZSgKCiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RyaW5nX3NsaWNlLCBsZW4oaW5zdHJpbmdfc2xpY2UpIC0gb2Zmc2V0CgogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICBleGNlcHQgUGFyc2VCYXNlRXhjZXB0aW9uIGFzIHBiZToKCiAgICAgICAgICAgICAgICAgICAgbGFzdF9leHByID0gcGJlCgogICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgcmFpc2UgbGFzdF9leHByCgogICAgICAgIHJldHVybiBsb2MsIHJldAoKCgoKCmNsYXNzIExvY2F0ZWQoUGFyc2VFbGVtZW50RW5oYW5jZSk6CgogICAgXCJcIlwiCgogICAgRGVjb3JhdGVzIGEgcmV0dXJuZWQgdG9rZW4gd2l0aCBpdHMgc3RhcnRpbmcgYW5kIGVuZGluZwoKICAgIGxvY2F0aW9ucyBpbiB0aGUgaW5wdXQgc3RyaW5nLgoKCgogICAgVGhpcyBoZWxwZXIgYWRkcyB0aGUgZm9sbG93aW5nIHJlc3VsdHMgbmFtZXM6CgoKCiAgICAtIGBgbG9jbl9zdGFydGBgIC0gbG9jYXRpb24gd2hlcmUgbWF0Y2hlZCBleHByZXNzaW9uIGJlZ2lucwoKICAgIC0gYGBsb2NuX2VuZGBgIC0gbG9jYXRpb24gd2hlcmUgbWF0Y2hlZCBleHByZXNzaW9uIGVuZHMKCiAgICAtIGBgdmFsdWVgYCAtIHRoZSBhY3R1YWwgcGFyc2VkIHJlc3VsdHMKCgoKICAgIEJlIGNhcmVmdWwgaWYgdGhlIGlucHV0IHRleHQgY29udGFpbnMgYGA8VEFCPmBgIGNoYXJhY3RlcnMsIHlvdQoKICAgIG1heSB3YW50IHRvIGNhbGwgOmNsYXNzOmBQYXJzZXJFbGVtZW50LnBhcnNlX3dpdGhfdGFic2AKCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgIHdkID0gV29yZChhbHBoYXMpCgogICAgICAgIGZvciBtYXRjaCBpbiBMb2NhdGVkKHdkKS5zZWFyY2hfc3RyaW5nKFwibGpzZGYxMjNsa3NkampmMTIzbGtramoxMjIyXCIpOgoKICAgICAgICAgICAgcHJpbnQobWF0Y2gpCgoKCiAgICBwcmludHM6OgoKCgogICAgICAgIFswLCBbJ2xqc2RmJ10sIDVdCgogICAgICAgIFs4LCBbJ2xrc2RqamYnXSwgMTVdCgogICAgICAgIFsxOCwgWydsa2tqaiddLCAyM10KCgoKICAgIFwiXCJcIgoKCgogICAgZGVmIHBhcnNlSW1wbChzZWxmLCBpbnN0cmluZywgbG9jLCBkb0FjdGlvbnM9VHJ1ZSk6CgogICAgICAgIHN0YXJ0ID0gbG9jCgogICAgICAgIGxvYywgdG9rZW5zID0gc2VsZi5leHByLl9wYXJzZShpbnN0cmluZywgc3RhcnQsIGRvQWN0aW9ucywgY2FsbFByZVBhcnNlPUZhbHNlKQoKICAgICAgICByZXRfdG9rZW5zID0gUGFyc2VSZXN1bHRzKFtzdGFydCwgdG9rZW5zLCBsb2NdKQoKICAgICAgICByZXRfdG9rZW5zW1wibG9jbl9zdGFydFwiXSA9IHN0YXJ0CgogICAgICAgIHJldF90b2tlbnNbXCJ2YWx1ZVwiXSA9IHRva2VucwoKICAgICAgICByZXRfdG9rZW5zW1wibG9jbl9lbmRcIl0gPSBsb2MKCiAgICAgICAgaWYgc2VsZi5yZXN1bHRzTmFtZToKCiAgICAgICAgICAgICMgbXVzdCByZXR1cm4gYXMgYSBsaXN0LCBzbyB0aGF0IHRoZSBuYW1lIHdpbGwgYmUgYXR0YWNoZWQgdG8gdGhlIGNvbXBsZXRlIGdyb3VwCgogICAgICAgICAgICByZXR1cm4gbG9jLCBbcmV0X3Rva2Vuc10KCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHJldHVybiBsb2MsIHJldF90b2tlbnMKCgoKCgpjbGFzcyBOb3RBbnkoUGFyc2VFbGVtZW50RW5oYW5jZSk6CgogICAgXCJcIlwiCgogICAgTG9va2FoZWFkIHRvIGRpc2FsbG93IG1hdGNoaW5nIHdpdGggdGhlIGdpdmVuIHBhcnNlIGV4cHJlc3Npb24uCgogICAgYGBOb3RBbnlgYCBkb2VzICpub3QqIGFkdmFuY2UgdGhlIHBhcnNpbmcgcG9zaXRpb24gd2l0aGluIHRoZQoKICAgIGlucHV0IHN0cmluZywgaXQgb25seSB2ZXJpZmllcyB0aGF0IHRoZSBzcGVjaWZpZWQgcGFyc2UgZXhwcmVzc2lvbgoKICAgIGRvZXMgKm5vdCogbWF0Y2ggYXQgdGhlIGN1cnJlbnQgcG9zaXRpb24uICBBbHNvLCBgYE5vdEFueWBgIGRvZXMKCiAgICAqbm90KiBza2lwIG92ZXIgbGVhZGluZyB3aGl0ZXNwYWNlLiBgYE5vdEFueWBgIGFsd2F5cyByZXR1cm5zCgogICAgYSBudWxsIHRva2VuIGxpc3QuICBNYXkgYmUgY29uc3RydWN0ZWQgdXNpbmcgdGhlIGBgJ34nYGAgb3BlcmF0b3IuCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICBBTkQsIE9SLCBOT1QgPSBtYXAoQ2FzZWxlc3NLZXl3b3JkLCBcIkFORCBPUiBOT1RcIi5zcGxpdCgpKQoKCgogICAgICAgICMgdGFrZSBjYXJlIG5vdCB0byBtaXN0YWtlIGtleXdvcmRzIGZvciBpZGVudGlmaWVycwoKICAgICAgICBpZGVudCA9IH4oQU5EIHwgT1IgfCBOT1QpICsgV29yZChhbHBoYXMpCgogICAgICAgIGJvb2xlYW5fdGVybSA9IE9wdChOT1QpICsgaWRlbnQKCgoKICAgICAgICAjIHZlcnkgY3J1ZGUgYm9vbGVhbiBleHByZXNzaW9uIC0gdG8gc3VwcG9ydCBwYXJlbnRoZXNpcyBncm91cHMgYW5kCgogICAgICAgICMgb3BlcmF0aW9uIGhpZXJhcmNoeSwgdXNlIGluZml4X25vdGF0aW9uCgogICAgICAgIGJvb2xlYW5fZXhwciA9IGJvb2xlYW5fdGVybSArICgoQU5EIHwgT1IpICsgYm9vbGVhbl90ZXJtKVsuLi5dCgoKCiAgICAgICAgIyBpbnRlZ2VycyB0aGF0IGFyZSBmb2xsb3dlZCBieSBcIi5cIiBhcmUgYWN0dWFsbHkgZmxvYXRzCgogICAgICAgIGludGVnZXIgPSBXb3JkKG51bXMpICsgfkNoYXIoXCIuXCIpCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oc2VsZiwgZXhwcjogVW5pb25bUGFyc2VyRWxlbWVudCwgc3RyXSk6CgogICAgICAgIHN1cGVyKCkuX19pbml0X18oZXhwcikKCiAgICAgICAgIyBkbyBOT1QgdXNlIHNlbGYubGVhdmVfd2hpdGVzcGFjZSgpLCBkb24ndCB3YW50IHRvIHByb3BhZ2F0ZSB0byBleHBycwoKICAgICAgICAjIHNlbGYubGVhdmVfd2hpdGVzcGFjZSgpCgogICAgICAgIHNlbGYuc2tpcFdoaXRlc3BhY2UgPSBGYWxzZQoKCgogICAgICAgIHNlbGYubWF5UmV0dXJuRW1wdHkgPSBUcnVlCgogICAgICAgIHNlbGYuZXJybXNnID0gXCJGb3VuZCB1bndhbnRlZCB0b2tlbiwgXCIgKyBzdHIoc2VsZi5leHByKQoKCgogICAgZGVmIHBhcnNlSW1wbChzZWxmLCBpbnN0cmluZywgbG9jLCBkb0FjdGlvbnM9VHJ1ZSk6CgogICAgICAgIGlmIHNlbGYuZXhwci5jYW5fcGFyc2VfbmV4dChpbnN0cmluZywgbG9jKToKCiAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKGluc3RyaW5nLCBsb2MsIHNlbGYuZXJybXNnLCBzZWxmKQoKICAgICAgICByZXR1cm4gbG9jLCBbXQoKCgogICAgZGVmIF9nZW5lcmF0ZURlZmF1bHROYW1lKHNlbGYpOgoKICAgICAgICByZXR1cm4gXCJ+e1wiICsgc3RyKHNlbGYuZXhwcikgKyBcIn1cIgoKCgoKCmNsYXNzIF9NdWx0aXBsZU1hdGNoKFBhcnNlRWxlbWVudEVuaGFuY2UpOgoKICAgIGRlZiBfX2luaXRfXygKCiAgICAgICAgc2VsZiwKCiAgICAgICAgZXhwcjogUGFyc2VyRWxlbWVudCwKCiAgICAgICAgc3RvcF9vbjogdHlwaW5nLk9wdGlvbmFsW1VuaW9uW1BhcnNlckVsZW1lbnQsIHN0cl1dID0gTm9uZSwKCiAgICAgICAgKiwKCiAgICAgICAgc3RvcE9uOiB0eXBpbmcuT3B0aW9uYWxbVW5pb25bUGFyc2VyRWxlbWVudCwgc3RyXV0gPSBOb25lLAoKICAgICk6CgogICAgICAgIHN1cGVyKCkuX19pbml0X18oZXhwcikKCiAgICAgICAgc3RvcE9uID0gc3RvcE9uIG9yIHN0b3Bfb24KCiAgICAgICAgc2VsZi5zYXZlQXNMaXN0ID0gVHJ1ZQoKICAgICAgICBlbmRlciA9IHN0b3BPbgoKICAgICAgICBpZiBpc2luc3RhbmNlKGVuZGVyLCBzdHJfdHlwZSk6CgogICAgICAgICAgICBlbmRlciA9IHNlbGYuX2xpdGVyYWxTdHJpbmdDbGFzcyhlbmRlcikKCiAgICAgICAgc2VsZi5zdG9wT24oZW5kZXIpCgoKCiAgICBkZWYgc3RvcE9uKHNlbGYsIGVuZGVyKSAtPiBQYXJzZXJFbGVtZW50OgoKICAgICAgICBpZiBpc2luc3RhbmNlKGVuZGVyLCBzdHJfdHlwZSk6CgogICAgICAgICAgICBlbmRlciA9IHNlbGYuX2xpdGVyYWxTdHJpbmdDbGFzcyhlbmRlcikKCiAgICAgICAgc2VsZi5ub3RfZW5kZXIgPSB+ZW5kZXIgaWYgZW5kZXIgaXMgbm90IE5vbmUgZWxzZSBOb25lCgogICAgICAgIHJldHVybiBzZWxmCgoKCiAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgc2VsZl9leHByX3BhcnNlID0gc2VsZi5leHByLl9wYXJzZQoKICAgICAgICBzZWxmX3NraXBfaWdub3JhYmxlcyA9IHNlbGYuX3NraXBJZ25vcmFibGVzCgogICAgICAgIGNoZWNrX2VuZGVyID0gc2VsZi5ub3RfZW5kZXIgaXMgbm90IE5vbmUKCiAgICAgICAgaWYgY2hlY2tfZW5kZXI6CgogICAgICAgICAgICB0cnlfbm90X2VuZGVyID0gc2VsZi5ub3RfZW5kZXIudHJ5UGFyc2UKCgoKICAgICAgICAjIG11c3QgYmUgYXQgbGVhc3Qgb25lIChidXQgZmlyc3Qgc2VlIGlmIHdlIGFyZSB0aGUgc3RvcE9uIHNlbnRpbmVsOwoKICAgICAgICAjIGlmIHNvLCBmYWlsKQoKICAgICAgICBpZiBjaGVja19lbmRlcjoKCiAgICAgICAgICAgIHRyeV9ub3RfZW5kZXIoaW5zdHJpbmcsIGxvYykKCiAgICAgICAgbG9jLCB0b2tlbnMgPSBzZWxmX2V4cHJfcGFyc2UoaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zKQoKICAgICAgICB0cnk6CgogICAgICAgICAgICBoYXNJZ25vcmVFeHBycyA9IG5vdCBub3Qgc2VsZi5pZ25vcmVFeHBycwoKICAgICAgICAgICAgd2hpbGUgMToKCiAgICAgICAgICAgICAgICBpZiBjaGVja19lbmRlcjoKCiAgICAgICAgICAgICAgICAgICAgdHJ5X25vdF9lbmRlcihpbnN0cmluZywgbG9jKQoKICAgICAgICAgICAgICAgIGlmIGhhc0lnbm9yZUV4cHJzOgoKICAgICAgICAgICAgICAgICAgICBwcmVsb2MgPSBzZWxmX3NraXBfaWdub3JhYmxlcyhpbnN0cmluZywgbG9jKQoKICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgIHByZWxvYyA9IGxvYwoKICAgICAgICAgICAgICAgIGxvYywgdG1wdG9rZW5zID0gc2VsZl9leHByX3BhcnNlKGluc3RyaW5nLCBwcmVsb2MsIGRvQWN0aW9ucykKCiAgICAgICAgICAgICAgICBpZiB0bXB0b2tlbnMgb3IgdG1wdG9rZW5zLmhhc2tleXMoKToKCiAgICAgICAgICAgICAgICAgICAgdG9rZW5zICs9IHRtcHRva2VucwoKICAgICAgICBleGNlcHQgKFBhcnNlRXhjZXB0aW9uLCBJbmRleEVycm9yKToKCiAgICAgICAgICAgIHBhc3MKCgoKICAgICAgICByZXR1cm4gbG9jLCB0b2tlbnMKCgoKICAgIGRlZiBfc2V0UmVzdWx0c05hbWUoc2VsZiwgbmFtZSwgbGlzdEFsbE1hdGNoZXM9RmFsc2UpOgoKICAgICAgICBpZiAoCgogICAgICAgICAgICBfX2RpYWdfXy53YXJuX3VuZ3JvdXBlZF9uYW1lZF90b2tlbnNfaW5fY29sbGVjdGlvbgoKICAgICAgICAgICAgYW5kIERpYWdub3N0aWNzLndhcm5fdW5ncm91cGVkX25hbWVkX3Rva2Vuc19pbl9jb2xsZWN0aW9uCgogICAgICAgICAgICBub3QgaW4gc2VsZi5zdXBwcmVzc193YXJuaW5nc18KCiAgICAgICAgKToKCiAgICAgICAgICAgIGZvciBlIGluIFtzZWxmLmV4cHJdICsgc2VsZi5leHByLnJlY3Vyc2UoKToKCiAgICAgICAgICAgICAgICBpZiAoCgogICAgICAgICAgICAgICAgICAgIGlzaW5zdGFuY2UoZSwgUGFyc2VyRWxlbWVudCkKCiAgICAgICAgICAgICAgICAgICAgYW5kIGUucmVzdWx0c05hbWUKCiAgICAgICAgICAgICAgICAgICAgYW5kIERpYWdub3N0aWNzLndhcm5fdW5ncm91cGVkX25hbWVkX3Rva2Vuc19pbl9jb2xsZWN0aW9uCgogICAgICAgICAgICAgICAgICAgIG5vdCBpbiBlLnN1cHByZXNzX3dhcm5pbmdzXwoKICAgICAgICAgICAgICAgICk6CgogICAgICAgICAgICAgICAgICAgIHdhcm5pbmdzLndhcm4oCgogICAgICAgICAgICAgICAgICAgICAgICBcInt9OiBzZXR0aW5nIHJlc3VsdHMgbmFtZSB7IXJ9IG9uIHt9IGV4cHJlc3Npb24gXCIKCiAgICAgICAgICAgICAgICAgICAgICAgIFwiY29sbGlkZXMgd2l0aCB7IXJ9IG9uIGNvbnRhaW5lZCBleHByZXNzaW9uXCIuZm9ybWF0KAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwid2Fybl91bmdyb3VwZWRfbmFtZWRfdG9rZW5zX2luX2NvbGxlY3Rpb25cIiwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUoc2VsZikuX19uYW1lX18sCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5yZXN1bHRzTmFtZSwKCiAgICAgICAgICAgICAgICAgICAgICAgICksCgogICAgICAgICAgICAgICAgICAgICAgICBzdGFja2xldmVsPTMsCgogICAgICAgICAgICAgICAgICAgICkKCgoKICAgICAgICByZXR1cm4gc3VwZXIoKS5fc2V0UmVzdWx0c05hbWUobmFtZSwgbGlzdEFsbE1hdGNoZXMpCgoKCgoKY2xhc3MgT25lT3JNb3JlKF9NdWx0aXBsZU1hdGNoKToKCiAgICBcIlwiXCIKCiAgICBSZXBldGl0aW9uIG9mIG9uZSBvciBtb3JlIG9mIHRoZSBnaXZlbiBleHByZXNzaW9uLgoKCgogICAgUGFyYW1ldGVyczoKCiAgICAtIGV4cHIgLSBleHByZXNzaW9uIHRoYXQgbXVzdCBtYXRjaCBvbmUgb3IgbW9yZSB0aW1lcwoKICAgIC0gc3RvcF9vbiAtIChkZWZhdWx0PSBgYE5vbmVgYCkgLSBleHByZXNzaW9uIGZvciBhIHRlcm1pbmF0aW5nIHNlbnRpbmVsCgogICAgICAgICAob25seSByZXF1aXJlZCBpZiB0aGUgc2VudGluZWwgd291bGQgb3JkaW5hcmlseSBtYXRjaCB0aGUgcmVwZXRpdGlvbgoKICAgICAgICAgZXhwcmVzc2lvbikKCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgIGRhdGFfd29yZCA9IFdvcmQoYWxwaGFzKQoKICAgICAgICBsYWJlbCA9IGRhdGFfd29yZCArIEZvbGxvd2VkQnkoJzonKQoKICAgICAgICBhdHRyX2V4cHIgPSBHcm91cChsYWJlbCArIFN1cHByZXNzKCc6JykgKyBPbmVPck1vcmUoZGF0YV93b3JkKS5zZXRfcGFyc2VfYWN0aW9uKCcgJy5qb2luKSkKCgoKICAgICAgICB0ZXh0ID0gXCJzaGFwZTogU1FVQVJFIHBvc246IHVwcGVyIGxlZnQgY29sb3I6IEJMQUNLXCIKCiAgICAgICAgYXR0cl9leHByWzEsIC4uLl0ucGFyc2Vfc3RyaW5nKHRleHQpLnBwcmludCgpICAjIEZhaWwhIHJlYWQgJ2NvbG9yJyBhcyBkYXRhIGluc3RlYWQgb2YgbmV4dCBsYWJlbCAtPiBbWydzaGFwZScsICdTUVVBUkUgY29sb3InXV0KCgoKICAgICAgICAjIHVzZSBzdG9wX29uIGF0dHJpYnV0ZSBmb3IgT25lT3JNb3JlIHRvIGF2b2lkIHJlYWRpbmcgbGFiZWwgc3RyaW5nIGFzIHBhcnQgb2YgdGhlIGRhdGEKCiAgICAgICAgYXR0cl9leHByID0gR3JvdXAobGFiZWwgKyBTdXBwcmVzcygnOicpICsgT25lT3JNb3JlKGRhdGFfd29yZCwgc3RvcF9vbj1sYWJlbCkuc2V0X3BhcnNlX2FjdGlvbignICcuam9pbikpCgogICAgICAgIE9uZU9yTW9yZShhdHRyX2V4cHIpLnBhcnNlX3N0cmluZyh0ZXh0KS5wcHJpbnQoKSAjIEJldHRlciAtPiBbWydzaGFwZScsICdTUVVBUkUnXSwgWydwb3NuJywgJ3VwcGVyIGxlZnQnXSwgWydjb2xvcicsICdCTEFDSyddXQoKCgogICAgICAgICMgY291bGQgYWxzbyBiZSB3cml0dGVuIGFzCgogICAgICAgIChhdHRyX2V4cHIgKiAoMSwpKS5wYXJzZV9zdHJpbmcodGV4dCkucHByaW50KCkKCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfZ2VuZXJhdGVEZWZhdWx0TmFtZShzZWxmKToKCiAgICAgICAgcmV0dXJuIFwie1wiICsgc3RyKHNlbGYuZXhwcikgKyBcIn0uLi5cIgoKCgoKCmNsYXNzIFplcm9Pck1vcmUoX011bHRpcGxlTWF0Y2gpOgoKICAgIFwiXCJcIgoKICAgIE9wdGlvbmFsIHJlcGV0aXRpb24gb2YgemVybyBvciBtb3JlIG9mIHRoZSBnaXZlbiBleHByZXNzaW9uLgoKCgogICAgUGFyYW1ldGVyczoKCiAgICAtIGBgZXhwcmBgIC0gZXhwcmVzc2lvbiB0aGF0IG11c3QgbWF0Y2ggemVybyBvciBtb3JlIHRpbWVzCgogICAgLSBgYHN0b3Bfb25gYCAtIGV4cHJlc3Npb24gZm9yIGEgdGVybWluYXRpbmcgc2VudGluZWwKCiAgICAgIChvbmx5IHJlcXVpcmVkIGlmIHRoZSBzZW50aW5lbCB3b3VsZCBvcmRpbmFyaWx5IG1hdGNoIHRoZSByZXBldGl0aW9uCgogICAgICBleHByZXNzaW9uKSAtIChkZWZhdWx0PSBgYE5vbmVgYCkKCgoKICAgIEV4YW1wbGU6IHNpbWlsYXIgdG8gOmNsYXNzOmBPbmVPck1vcmVgCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oCgogICAgICAgIHNlbGYsCgogICAgICAgIGV4cHI6IFBhcnNlckVsZW1lbnQsCgogICAgICAgIHN0b3Bfb246IHR5cGluZy5PcHRpb25hbFtVbmlvbltQYXJzZXJFbGVtZW50LCBzdHJdXSA9IE5vbmUsCgogICAgICAgICosCgogICAgICAgIHN0b3BPbjogdHlwaW5nLk9wdGlvbmFsW1VuaW9uW1BhcnNlckVsZW1lbnQsIHN0cl1dID0gTm9uZSwKCiAgICApOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGV4cHIsIHN0b3BPbj1zdG9wT24gb3Igc3RvcF9vbikKCiAgICAgICAgc2VsZi5tYXlSZXR1cm5FbXB0eSA9IFRydWUKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICB0cnk6CgogICAgICAgICAgICByZXR1cm4gc3VwZXIoKS5wYXJzZUltcGwoaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zKQoKICAgICAgICBleGNlcHQgKFBhcnNlRXhjZXB0aW9uLCBJbmRleEVycm9yKToKCiAgICAgICAgICAgIHJldHVybiBsb2MsIFBhcnNlUmVzdWx0cyhbXSwgbmFtZT1zZWxmLnJlc3VsdHNOYW1lKQoKCgogICAgZGVmIF9nZW5lcmF0ZURlZmF1bHROYW1lKHNlbGYpOgoKICAgICAgICByZXR1cm4gXCJbXCIgKyBzdHIoc2VsZi5leHByKSArIFwiXS4uLlwiCgoKCgoKY2xhc3MgX051bGxUb2tlbjoKCiAgICBkZWYgX19ib29sX18oc2VsZik6CgogICAgICAgIHJldHVybiBGYWxzZQoKCgogICAgZGVmIF9fc3RyX18oc2VsZik6CgogICAgICAgIHJldHVybiBcIlwiCgoKCgoKY2xhc3MgT3B0KFBhcnNlRWxlbWVudEVuaGFuY2UpOgoKICAgIFwiXCJcIgoKICAgIE9wdGlvbmFsIG1hdGNoaW5nIG9mIHRoZSBnaXZlbiBleHByZXNzaW9uLgoKCgogICAgUGFyYW1ldGVyczoKCiAgICAtIGBgZXhwcmBgIC0gZXhwcmVzc2lvbiB0aGF0IG11c3QgbWF0Y2ggemVybyBvciBtb3JlIHRpbWVzCgogICAgLSBgYGRlZmF1bHRgYCAob3B0aW9uYWwpIC0gdmFsdWUgdG8gYmUgcmV0dXJuZWQgaWYgdGhlIG9wdGlvbmFsIGV4cHJlc3Npb24gaXMgbm90IGZvdW5kLgoKCgogICAgRXhhbXBsZTo6CgoKCiAgICAgICAgIyBVUyBwb3N0YWwgY29kZSBjYW4gYmUgYSA1LWRpZ2l0IHppcCwgcGx1cyBvcHRpb25hbCA0LWRpZ2l0IHF1YWxpZmllcgoKICAgICAgICB6aXAgPSBDb21iaW5lKFdvcmQobnVtcywgZXhhY3Q9NSkgKyBPcHQoJy0nICsgV29yZChudW1zLCBleGFjdD00KSkpCgogICAgICAgIHppcC5ydW5fdGVzdHMoJycnCgogICAgICAgICAgICAjIHRyYWRpdGlvbmFsIFpJUCBjb2RlCgogICAgICAgICAgICAxMjM0NQoKCgogICAgICAgICAgICAjIFpJUCs0IGZvcm0KCiAgICAgICAgICAgIDEyMTAxLTAwMDEKCgoKICAgICAgICAgICAgIyBpbnZhbGlkIFpJUAoKICAgICAgICAgICAgOTg3NjUtCgogICAgICAgICAgICAnJycpCgoKCiAgICBwcmludHM6OgoKCgogICAgICAgICMgdHJhZGl0aW9uYWwgWklQIGNvZGUKCiAgICAgICAgMTIzNDUKCiAgICAgICAgWycxMjM0NSddCgoKCiAgICAgICAgIyBaSVArNCBmb3JtCgogICAgICAgIDEyMTAxLTAwMDEKCiAgICAgICAgWycxMjEwMS0wMDAxJ10KCgoKICAgICAgICAjIGludmFsaWQgWklQCgogICAgICAgIDk4NzY1LQoKICAgICAgICAgICAgIF4KCiAgICAgICAgRkFJTDogRXhwZWN0ZWQgZW5kIG9mIHRleHQgKGF0IGNoYXIgNSksIChsaW5lOjEsIGNvbDo2KQoKICAgIFwiXCJcIgoKCgogICAgX19vcHRpb25hbE5vdE1hdGNoZWQgPSBfTnVsbFRva2VuKCkKCgoKICAgIGRlZiBfX2luaXRfXygKCiAgICAgICAgc2VsZiwgZXhwcjogVW5pb25bUGFyc2VyRWxlbWVudCwgc3RyXSwgZGVmYXVsdDogQW55ID0gX19vcHRpb25hbE5vdE1hdGNoZWQKCiAgICApOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGV4cHIsIHNhdmVsaXN0PUZhbHNlKQoKICAgICAgICBzZWxmLnNhdmVBc0xpc3QgPSBzZWxmLmV4cHIuc2F2ZUFzTGlzdAoKICAgICAgICBzZWxmLmRlZmF1bHRWYWx1ZSA9IGRlZmF1bHQKCiAgICAgICAgc2VsZi5tYXlSZXR1cm5FbXB0eSA9IFRydWUKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICBzZWxmX2V4cHIgPSBzZWxmLmV4cHIKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgbG9jLCB0b2tlbnMgPSBzZWxmX2V4cHIuX3BhcnNlKGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucywgY2FsbFByZVBhcnNlPUZhbHNlKQoKICAgICAgICBleGNlcHQgKFBhcnNlRXhjZXB0aW9uLCBJbmRleEVycm9yKToKCiAgICAgICAgICAgIGRlZmF1bHRfdmFsdWUgPSBzZWxmLmRlZmF1bHRWYWx1ZQoKICAgICAgICAgICAgaWYgZGVmYXVsdF92YWx1ZSBpcyBub3Qgc2VsZi5fX29wdGlvbmFsTm90TWF0Y2hlZDoKCiAgICAgICAgICAgICAgICBpZiBzZWxmX2V4cHIucmVzdWx0c05hbWU6CgogICAgICAgICAgICAgICAgICAgIHRva2VucyA9IFBhcnNlUmVzdWx0cyhbZGVmYXVsdF92YWx1ZV0pCgogICAgICAgICAgICAgICAgICAgIHRva2Vuc1tzZWxmX2V4cHIucmVzdWx0c05hbWVdID0gZGVmYXVsdF92YWx1ZQoKICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgIHRva2VucyA9IFtkZWZhdWx0X3ZhbHVlXQoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICB0b2tlbnMgPSBbXQoKICAgICAgICByZXR1cm4gbG9jLCB0b2tlbnMKCgoKICAgIGRlZiBfZ2VuZXJhdGVEZWZhdWx0TmFtZShzZWxmKToKCiAgICAgICAgaW5uZXIgPSBzdHIoc2VsZi5leHByKQoKICAgICAgICAjIHN0cmlwIG9mZiByZWR1bmRhbnQgaW5uZXIge30ncwoKICAgICAgICB3aGlsZSBsZW4oaW5uZXIpID4gMSBhbmQgaW5uZXJbMCA6OiBsZW4oaW5uZXIpIC0gMV0gPT0gXCJ7fVwiOgoKICAgICAgICAgICAgaW5uZXIgPSBpbm5lclsxOi0xXQoKICAgICAgICByZXR1cm4gXCJbXCIgKyBpbm5lciArIFwiXVwiCgoKCgoKT3B0aW9uYWwgPSBPcHQKCgoKCgpjbGFzcyBTa2lwVG8oUGFyc2VFbGVtZW50RW5oYW5jZSk6CgogICAgXCJcIlwiCgogICAgVG9rZW4gZm9yIHNraXBwaW5nIG92ZXIgYWxsIHVuZGVmaW5lZCB0ZXh0IHVudGlsIHRoZSBtYXRjaGVkCgogICAgZXhwcmVzc2lvbiBpcyBmb3VuZC4KCgoKICAgIFBhcmFtZXRlcnM6CgogICAgLSBgYGV4cHJgYCAtIHRhcmdldCBleHByZXNzaW9uIG1hcmtpbmcgdGhlIGVuZCBvZiB0aGUgZGF0YSB0byBiZSBza2lwcGVkCgogICAgLSBgYGluY2x1ZGVgYCAtIGlmIGBgVHJ1ZWBgLCB0aGUgdGFyZ2V0IGV4cHJlc3Npb24gaXMgYWxzbyBwYXJzZWQKCiAgICAgICh0aGUgc2tpcHBlZCB0ZXh0IGFuZCB0YXJnZXQgZXhwcmVzc2lvbiBhcmUgcmV0dXJuZWQgYXMgYSAyLWVsZW1lbnQKCiAgICAgIGxpc3QpIChkZWZhdWx0PSBgYEZhbHNlYGApLgoKICAgIC0gYGBpZ25vcmVgYCAtIChkZWZhdWx0PSBgYE5vbmVgYCkgdXNlZCB0byBkZWZpbmUgZ3JhbW1hcnMgKHR5cGljYWxseSBxdW90ZWQgc3RyaW5ncyBhbmQKCiAgICAgIGNvbW1lbnRzKSB0aGF0IG1pZ2h0IGNvbnRhaW4gZmFsc2UgbWF0Y2hlcyB0byB0aGUgdGFyZ2V0IGV4cHJlc3Npb24KCiAgICAtIGBgZmFpbF9vbmBgIC0gKGRlZmF1bHQ9IGBgTm9uZWBgKSBkZWZpbmUgZXhwcmVzc2lvbnMgdGhhdCBhcmUgbm90IGFsbG93ZWQgdG8gYmUKCiAgICAgIGluY2x1ZGVkIGluIHRoZSBza2lwcGVkIHRlc3Q7IGlmIGZvdW5kIGJlZm9yZSB0aGUgdGFyZ2V0IGV4cHJlc3Npb24gaXMgZm91bmQsCgogICAgICB0aGUgOmNsYXNzOmBTa2lwVG9gIGlzIG5vdCBhIG1hdGNoCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICByZXBvcnQgPSAnJycKCiAgICAgICAgICAgIE91dHN0YW5kaW5nIElzc3VlcyBSZXBvcnQgLSAxIEphbiAyMDAwCgoKCiAgICAgICAgICAgICAgICMgfCBTZXZlcml0eSB8IERlc2NyaXB0aW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgIERheXMgT3BlbgoKICAgICAgICAgICAgLS0tLS0rLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tCgogICAgICAgICAgICAgMTAxIHwgQ3JpdGljYWwgfCBJbnRlcm1pdHRlbnQgc3lzdGVtIGNyYXNoICAgICAgICAgICAgICAgICB8ICAgICAgICAgIDYKCiAgICAgICAgICAgICAgOTQgfCBDb3NtZXRpYyB8IFNwZWxsaW5nIGVycm9yIG9uIExvZ2luICgnbG9nfG4nKSAgICAgICAgIHwgICAgICAgICAxNAoKICAgICAgICAgICAgICA3OSB8IE1pbm9yICAgIHwgU3lzdGVtIHNsb3cgd2hlbiBydW5uaW5nIHRvbyBtYW55IHJlcG9ydHMgfCAgICAgICAgIDQ3CgogICAgICAgICAgICAnJycKCiAgICAgICAgaW50ZWdlciA9IFdvcmQobnVtcykKCiAgICAgICAgU0VQID0gU3VwcHJlc3MoJ3wnKQoKICAgICAgICAjIHVzZSBTa2lwVG8gdG8gc2ltcGx5IG1hdGNoIGV2ZXJ5dGhpbmcgdXAgdW50aWwgdGhlIG5leHQgU0VQCgogICAgICAgICMgLSBpZ25vcmUgcXVvdGVkIHN0cmluZ3MsIHNvIHRoYXQgYSAnfCcgY2hhcmFjdGVyIGluc2lkZSBhIHF1b3RlZCBzdHJpbmcgZG9lcyBub3QgbWF0Y2gKCiAgICAgICAgIyAtIHBhcnNlIGFjdGlvbiB3aWxsIGNhbGwgdG9rZW4uc3RyaXAoKSBmb3IgZWFjaCBtYXRjaGVkIHRva2VuLCBpLmUuLCB0aGUgZGVzY3JpcHRpb24gYm9keQoKICAgICAgICBzdHJpbmdfZGF0YSA9IFNraXBUbyhTRVAsIGlnbm9yZT1xdW90ZWRfc3RyaW5nKQoKICAgICAgICBzdHJpbmdfZGF0YS5zZXRfcGFyc2VfYWN0aW9uKHRva2VuX21hcChzdHIuc3RyaXApKQoKICAgICAgICB0aWNrZXRfZXhwciA9IChpbnRlZ2VyKFwiaXNzdWVfbnVtXCIpICsgU0VQCgogICAgICAgICAgICAgICAgICAgICAgKyBzdHJpbmdfZGF0YShcInNldlwiKSArIFNFUAoKICAgICAgICAgICAgICAgICAgICAgICsgc3RyaW5nX2RhdGEoXCJkZXNjXCIpICsgU0VQCgogICAgICAgICAgICAgICAgICAgICAgKyBpbnRlZ2VyKFwiZGF5c19vcGVuXCIpKQoKCgogICAgICAgIGZvciB0a3QgaW4gdGlja2V0X2V4cHIuc2VhcmNoX3N0cmluZyhyZXBvcnQpOgoKICAgICAgICAgICAgcHJpbnQgdGt0LmR1bXAoKQoKCgogICAgcHJpbnRzOjoKCgoKICAgICAgICBbJzEwMScsICdDcml0aWNhbCcsICdJbnRlcm1pdHRlbnQgc3lzdGVtIGNyYXNoJywgJzYnXQoKICAgICAgICAtIGRheXNfb3BlbjogJzYnCgogICAgICAgIC0gZGVzYzogJ0ludGVybWl0dGVudCBzeXN0ZW0gY3Jhc2gnCgogICAgICAgIC0gaXNzdWVfbnVtOiAnMTAxJwoKICAgICAgICAtIHNldjogJ0NyaXRpY2FsJwoKICAgICAgICBbJzk0JywgJ0Nvc21ldGljJywgXCJTcGVsbGluZyBlcnJvciBvbiBMb2dpbiAoJ2xvZ3xuJylcIiwgJzE0J10KCiAgICAgICAgLSBkYXlzX29wZW46ICcxNCcKCiAgICAgICAgLSBkZXNjOiBcIlNwZWxsaW5nIGVycm9yIG9uIExvZ2luICgnbG9nfG4nKVwiCgogICAgICAgIC0gaXNzdWVfbnVtOiAnOTQnCgogICAgICAgIC0gc2V2OiAnQ29zbWV0aWMnCgogICAgICAgIFsnNzknLCAnTWlub3InLCAnU3lzdGVtIHNsb3cgd2hlbiBydW5uaW5nIHRvbyBtYW55IHJlcG9ydHMnLCAnNDcnXQoKICAgICAgICAtIGRheXNfb3BlbjogJzQ3JwoKICAgICAgICAtIGRlc2M6ICdTeXN0ZW0gc2xvdyB3aGVuIHJ1bm5pbmcgdG9vIG1hbnkgcmVwb3J0cycKCiAgICAgICAgLSBpc3N1ZV9udW06ICc3OScKCiAgICAgICAgLSBzZXY6ICdNaW5vcicKCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2luaXRfXygKCiAgICAgICAgc2VsZiwKCiAgICAgICAgb3RoZXI6IFVuaW9uW1BhcnNlckVsZW1lbnQsIHN0cl0sCgogICAgICAgIGluY2x1ZGU6IGJvb2wgPSBGYWxzZSwKCiAgICAgICAgaWdub3JlOiBib29sID0gTm9uZSwKCiAgICAgICAgZmFpbF9vbjogdHlwaW5nLk9wdGlvbmFsW1VuaW9uW1BhcnNlckVsZW1lbnQsIHN0cl1dID0gTm9uZSwKCiAgICAgICAgKiwKCiAgICAgICAgZmFpbE9uOiBVbmlvbltQYXJzZXJFbGVtZW50LCBzdHJdID0gTm9uZSwKCiAgICApOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKG90aGVyKQoKICAgICAgICBmYWlsT24gPSBmYWlsT24gb3IgZmFpbF9vbgoKICAgICAgICBzZWxmLmlnbm9yZUV4cHIgPSBpZ25vcmUKCiAgICAgICAgc2VsZi5tYXlSZXR1cm5FbXB0eSA9IFRydWUKCiAgICAgICAgc2VsZi5tYXlJbmRleEVycm9yID0gRmFsc2UKCiAgICAgICAgc2VsZi5pbmNsdWRlTWF0Y2ggPSBpbmNsdWRlCgogICAgICAgIHNlbGYuc2F2ZUFzTGlzdCA9IEZhbHNlCgogICAgICAgIGlmIGlzaW5zdGFuY2UoZmFpbE9uLCBzdHJfdHlwZSk6CgogICAgICAgICAgICBzZWxmLmZhaWxPbiA9IHNlbGYuX2xpdGVyYWxTdHJpbmdDbGFzcyhmYWlsT24pCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBzZWxmLmZhaWxPbiA9IGZhaWxPbgoKICAgICAgICBzZWxmLmVycm1zZyA9IFwiTm8gbWF0Y2ggZm91bmQgZm9yIFwiICsgc3RyKHNlbGYuZXhwcikKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICBzdGFydGxvYyA9IGxvYwoKICAgICAgICBpbnN0cmxlbiA9IGxlbihpbnN0cmluZykKCiAgICAgICAgc2VsZl9leHByX3BhcnNlID0gc2VsZi5leHByLl9wYXJzZQoKICAgICAgICBzZWxmX2ZhaWxPbl9jYW5QYXJzZU5leHQgPSAoCgogICAgICAgICAgICBzZWxmLmZhaWxPbi5jYW5QYXJzZU5leHQgaWYgc2VsZi5mYWlsT24gaXMgbm90IE5vbmUgZWxzZSBOb25lCgogICAgICAgICkKCiAgICAgICAgc2VsZl9pZ25vcmVFeHByX3RyeVBhcnNlID0gKAoKICAgICAgICAgICAgc2VsZi5pZ25vcmVFeHByLnRyeVBhcnNlIGlmIHNlbGYuaWdub3JlRXhwciBpcyBub3QgTm9uZSBlbHNlIE5vbmUKCiAgICAgICAgKQoKCgogICAgICAgIHRtcGxvYyA9IGxvYwoKICAgICAgICB3aGlsZSB0bXBsb2MgPD0gaW5zdHJsZW46CgogICAgICAgICAgICBpZiBzZWxmX2ZhaWxPbl9jYW5QYXJzZU5leHQgaXMgbm90IE5vbmU6CgogICAgICAgICAgICAgICAgIyBicmVhayBpZiBmYWlsT24gZXhwcmVzc2lvbiBtYXRjaGVzCgogICAgICAgICAgICAgICAgaWYgc2VsZl9mYWlsT25fY2FuUGFyc2VOZXh0KGluc3RyaW5nLCB0bXBsb2MpOgoKICAgICAgICAgICAgICAgICAgICBicmVhawoKCgogICAgICAgICAgICBpZiBzZWxmX2lnbm9yZUV4cHJfdHJ5UGFyc2UgaXMgbm90IE5vbmU6CgogICAgICAgICAgICAgICAgIyBhZHZhbmNlIHBhc3QgaWdub3JlIGV4cHJlc3Npb25zCgogICAgICAgICAgICAgICAgd2hpbGUgMToKCiAgICAgICAgICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgICAgICAgICAgdG1wbG9jID0gc2VsZl9pZ25vcmVFeHByX3RyeVBhcnNlKGluc3RyaW5nLCB0bXBsb2MpCgogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBQYXJzZUJhc2VFeGNlcHRpb246CgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawoKCgogICAgICAgICAgICB0cnk6CgogICAgICAgICAgICAgICAgc2VsZl9leHByX3BhcnNlKGluc3RyaW5nLCB0bXBsb2MsIGRvQWN0aW9ucz1GYWxzZSwgY2FsbFByZVBhcnNlPUZhbHNlKQoKICAgICAgICAgICAgZXhjZXB0IChQYXJzZUV4Y2VwdGlvbiwgSW5kZXhFcnJvcik6CgogICAgICAgICAgICAgICAgIyBubyBtYXRjaCwgYWR2YW5jZSBsb2MgaW4gc3RyaW5nCgogICAgICAgICAgICAgICAgdG1wbG9jICs9IDEKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgIyBtYXRjaGVkIHNraXB0byBleHByLCBkb25lCgogICAgICAgICAgICAgICAgYnJlYWsKCgoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgIyByYW4gb2ZmIHRoZSBlbmQgb2YgdGhlIGlucHV0IHN0cmluZyB3aXRob3V0IG1hdGNoaW5nIHNraXB0byBleHByLCBmYWlsCgogICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihpbnN0cmluZywgbG9jLCBzZWxmLmVycm1zZywgc2VsZikKCgoKICAgICAgICAjIGJ1aWxkIHVwIHJldHVybiB2YWx1ZXMKCiAgICAgICAgbG9jID0gdG1wbG9jCgogICAgICAgIHNraXB0ZXh0ID0gaW5zdHJpbmdbc3RhcnRsb2M6bG9jXQoKICAgICAgICBza2lwcmVzdWx0ID0gUGFyc2VSZXN1bHRzKHNraXB0ZXh0KQoKCgogICAgICAgIGlmIHNlbGYuaW5jbHVkZU1hdGNoOgoKICAgICAgICAgICAgbG9jLCBtYXQgPSBzZWxmX2V4cHJfcGFyc2UoaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zLCBjYWxsUHJlUGFyc2U9RmFsc2UpCgogICAgICAgICAgICBza2lwcmVzdWx0ICs9IG1hdAoKCgogICAgICAgIHJldHVybiBsb2MsIHNraXByZXN1bHQKCgoKCgpjbGFzcyBGb3J3YXJkKFBhcnNlRWxlbWVudEVuaGFuY2UpOgoKICAgIFwiXCJcIgoKICAgIEZvcndhcmQgZGVjbGFyYXRpb24gb2YgYW4gZXhwcmVzc2lvbiB0byBiZSBkZWZpbmVkIGxhdGVyIC0KCiAgICB1c2VkIGZvciByZWN1cnNpdmUgZ3JhbW1hcnMsIHN1Y2ggYXMgYWxnZWJyYWljIGluZml4IG5vdGF0aW9uLgoKICAgIFdoZW4gdGhlIGV4cHJlc3Npb24gaXMga25vd24sIGl0IGlzIGFzc2lnbmVkIHRvIHRoZSBgYEZvcndhcmRgYAoKICAgIHZhcmlhYmxlIHVzaW5nIHRoZSBgYCc8PCdgYCBvcGVyYXRvci4KCgoKICAgIE5vdGU6IHRha2UgY2FyZSB3aGVuIGFzc2lnbmluZyB0byBgYEZvcndhcmRgYCBub3QgdG8gb3Zlcmxvb2sKCiAgICBwcmVjZWRlbmNlIG9mIG9wZXJhdG9ycy4KCgoKICAgIFNwZWNpZmljYWxseSwgYGAnfCdgYCBoYXMgYSBsb3dlciBwcmVjZWRlbmNlIHRoYW4gYGAnPDwnYGAsIHNvIHRoYXQ6OgoKCgogICAgICAgIGZ3ZF9leHByIDw8IGEgfCBiIHwgYwoKCgogICAgd2lsbCBhY3R1YWxseSBiZSBldmFsdWF0ZWQgYXM6OgoKCgogICAgICAgIChmd2RfZXhwciA8PCBhKSB8IGIgfCBjCgoKCiAgICB0aGVyZWJ5IGxlYXZpbmcgYiBhbmQgYyBvdXQgYXMgcGFyc2VhYmxlIGFsdGVybmF0aXZlcy4gIEl0IGlzIHJlY29tbWVuZGVkIHRoYXQgeW91CgogICAgZXhwbGljaXRseSBncm91cCB0aGUgdmFsdWVzIGluc2VydGVkIGludG8gdGhlIGBgRm9yd2FyZGBgOjoKCgoKICAgICAgICBmd2RfZXhwciA8PCAoYSB8IGIgfCBjKQoKCgogICAgQ29udmVydGluZyB0byB1c2UgdGhlIGBgJzw8PSdgYCBvcGVyYXRvciBpbnN0ZWFkIHdpbGwgYXZvaWQgdGhpcyBwcm9ibGVtLgoKCgogICAgU2VlIDpjbGFzczpgUGFyc2VSZXN1bHRzLnBwcmludGAgZm9yIGFuIGV4YW1wbGUgb2YgYSByZWN1cnNpdmUKCiAgICBwYXJzZXIgY3JlYXRlZCB1c2luZyBgYEZvcndhcmRgYC4KCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBvdGhlcjogdHlwaW5nLk9wdGlvbmFsW1VuaW9uW1BhcnNlckVsZW1lbnQsIHN0cl1dID0gTm9uZSk6CgogICAgICAgIHNlbGYuY2FsbGVyX2ZyYW1lID0gdHJhY2ViYWNrLmV4dHJhY3Rfc3RhY2sobGltaXQ9MilbMF0KCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhvdGhlciwgc2F2ZWxpc3Q9RmFsc2UpCgogICAgICAgIHNlbGYubHNoaWZ0X2xpbmUgPSBOb25lCgoKCiAgICBkZWYgX19sc2hpZnRfXyhzZWxmLCBvdGhlcik6CgogICAgICAgIGlmIGhhc2F0dHIoc2VsZiwgXCJjYWxsZXJfZnJhbWVcIik6CgogICAgICAgICAgICBkZWwgc2VsZi5jYWxsZXJfZnJhbWUKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgc3RyX3R5cGUpOgoKICAgICAgICAgICAgb3RoZXIgPSBzZWxmLl9saXRlcmFsU3RyaW5nQ2xhc3Mob3RoZXIpCgogICAgICAgIHNlbGYuZXhwciA9IG90aGVyCgogICAgICAgIHNlbGYubWF5SW5kZXhFcnJvciA9IHNlbGYuZXhwci5tYXlJbmRleEVycm9yCgogICAgICAgIHNlbGYubWF5UmV0dXJuRW1wdHkgPSBzZWxmLmV4cHIubWF5UmV0dXJuRW1wdHkKCiAgICAgICAgc2VsZi5zZXRfd2hpdGVzcGFjZV9jaGFycygKCiAgICAgICAgICAgIHNlbGYuZXhwci53aGl0ZUNoYXJzLCBjb3B5X2RlZmF1bHRzPXNlbGYuZXhwci5jb3B5RGVmYXVsdFdoaXRlQ2hhcnMKCiAgICAgICAgKQoKICAgICAgICBzZWxmLnNraXBXaGl0ZXNwYWNlID0gc2VsZi5leHByLnNraXBXaGl0ZXNwYWNlCgogICAgICAgIHNlbGYuc2F2ZUFzTGlzdCA9IHNlbGYuZXhwci5zYXZlQXNMaXN0CgogICAgICAgIHNlbGYuaWdub3JlRXhwcnMuZXh0ZW5kKHNlbGYuZXhwci5pZ25vcmVFeHBycykKCiAgICAgICAgc2VsZi5sc2hpZnRfbGluZSA9IHRyYWNlYmFjay5leHRyYWN0X3N0YWNrKGxpbWl0PTIpWy0yXQoKICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgZGVmIF9faWxzaGlmdF9fKHNlbGYsIG90aGVyKToKCiAgICAgICAgcmV0dXJuIHNlbGYgPDwgb3RoZXIKCgoKICAgIGRlZiBfX29yX18oc2VsZiwgb3RoZXIpOgoKICAgICAgICBjYWxsZXJfbGluZSA9IHRyYWNlYmFjay5leHRyYWN0X3N0YWNrKGxpbWl0PTIpWy0yXQoKICAgICAgICBpZiAoCgogICAgICAgICAgICBfX2RpYWdfXy53YXJuX29uX21hdGNoX2ZpcnN0X3dpdGhfbHNoaWZ0X29wZXJhdG9yCgogICAgICAgICAgICBhbmQgY2FsbGVyX2xpbmUgPT0gc2VsZi5sc2hpZnRfbGluZQoKICAgICAgICAgICAgYW5kIERpYWdub3N0aWNzLndhcm5fb25fbWF0Y2hfZmlyc3Rfd2l0aF9sc2hpZnRfb3BlcmF0b3IKCiAgICAgICAgICAgIG5vdCBpbiBzZWxmLnN1cHByZXNzX3dhcm5pbmdzXwoKICAgICAgICApOgoKICAgICAgICAgICAgd2FybmluZ3Mud2FybigKCiAgICAgICAgICAgICAgICBcInVzaW5nICc8PCcgb3BlcmF0b3Igd2l0aCAnfCcgaXMgcHJvYmFibHkgYW4gZXJyb3IsIHVzZSAnPDw9J1wiLAoKICAgICAgICAgICAgICAgIHN0YWNrbGV2ZWw9MiwKCiAgICAgICAgICAgICkKCiAgICAgICAgcmV0ID0gc3VwZXIoKS5fX29yX18ob3RoZXIpCgogICAgICAgIHJldHVybiByZXQKCgoKICAgIGRlZiBfX2RlbF9fKHNlbGYpOgoKICAgICAgICAjIHNlZSBpZiB3ZSBhcmUgZ2V0dGluZyBkcm9wcGVkIGJlY2F1c2Ugb2YgJz0nIHJlYXNzaWdubWVudCBvZiB2YXIgaW5zdGVhZCBvZiAnPDw9JyBvciAnPDwnCgogICAgICAgIGlmICgKCiAgICAgICAgICAgIHNlbGYuZXhwciBpcyBOb25lCgogICAgICAgICAgICBhbmQgX19kaWFnX18ud2Fybl9vbl9hc3NpZ25tZW50X3RvX0ZvcndhcmQKCiAgICAgICAgICAgIGFuZCBEaWFnbm9zdGljcy53YXJuX29uX2Fzc2lnbm1lbnRfdG9fRm9yd2FyZCBub3QgaW4gc2VsZi5zdXBwcmVzc193YXJuaW5nc18KCiAgICAgICAgKToKCiAgICAgICAgICAgIHdhcm5pbmdzLndhcm5fZXhwbGljaXQoCgogICAgICAgICAgICAgICAgXCJGb3J3YXJkIGRlZmluZWQgaGVyZSBidXQgbm8gZXhwcmVzc2lvbiBhdHRhY2hlZCBsYXRlciB1c2luZyAnPDw9JyBvciAnPDwnXCIsCgogICAgICAgICAgICAgICAgVXNlcldhcm5pbmcsCgogICAgICAgICAgICAgICAgZmlsZW5hbWU9c2VsZi5jYWxsZXJfZnJhbWUuZmlsZW5hbWUsCgogICAgICAgICAgICAgICAgbGluZW5vPXNlbGYuY2FsbGVyX2ZyYW1lLmxpbmVubywKCiAgICAgICAgICAgICkKCgoKICAgIGRlZiBwYXJzZUltcGwoc2VsZiwgaW5zdHJpbmcsIGxvYywgZG9BY3Rpb25zPVRydWUpOgoKICAgICAgICBpZiAoCgogICAgICAgICAgICBzZWxmLmV4cHIgaXMgTm9uZQoKICAgICAgICAgICAgYW5kIF9fZGlhZ19fLndhcm5fb25fcGFyc2VfdXNpbmdfZW1wdHlfRm9yd2FyZAoKICAgICAgICAgICAgYW5kIERpYWdub3N0aWNzLndhcm5fb25fcGFyc2VfdXNpbmdfZW1wdHlfRm9yd2FyZAoKICAgICAgICAgICAgbm90IGluIHNlbGYuc3VwcHJlc3Nfd2FybmluZ3NfCgogICAgICAgICk6CgogICAgICAgICAgICAjIHdhbGsgc3RhY2sgdW50aWwgcGFyc2Vfc3RyaW5nLCBzY2FuX3N0cmluZywgc2VhcmNoX3N0cmluZywgb3IgdHJhbnNmb3JtX3N0cmluZyBpcyBmb3VuZAoKICAgICAgICAgICAgcGFyc2VfZm5zID0gWwoKICAgICAgICAgICAgICAgIFwicGFyc2Vfc3RyaW5nXCIsCgogICAgICAgICAgICAgICAgXCJzY2FuX3N0cmluZ1wiLAoKICAgICAgICAgICAgICAgIFwic2VhcmNoX3N0cmluZ1wiLAoKICAgICAgICAgICAgICAgIFwidHJhbnNmb3JtX3N0cmluZ1wiLAoKICAgICAgICAgICAgXQoKICAgICAgICAgICAgdGIgPSB0cmFjZWJhY2suZXh0cmFjdF9zdGFjayhsaW1pdD0yMDApCgogICAgICAgICAgICBmb3IgaSwgZnJtIGluIGVudW1lcmF0ZShyZXZlcnNlZCh0YiksIHN0YXJ0PTEpOgoKICAgICAgICAgICAgICAgIGlmIGZybS5uYW1lIGluIHBhcnNlX2ZuczoKCiAgICAgICAgICAgICAgICAgICAgc3RhY2tsZXZlbCA9IGkgKyAxCgogICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIHN0YWNrbGV2ZWwgPSAyCgogICAgICAgICAgICB3YXJuaW5ncy53YXJuKAoKICAgICAgICAgICAgICAgIFwiRm9yd2FyZCBleHByZXNzaW9uIHdhcyBuZXZlciBhc3NpZ25lZCBhIHZhbHVlLCB3aWxsIG5vdCBwYXJzZSBhbnkgaW5wdXRcIiwKCiAgICAgICAgICAgICAgICBzdGFja2xldmVsPXN0YWNrbGV2ZWwsCgogICAgICAgICAgICApCgogICAgICAgIGlmIG5vdCBQYXJzZXJFbGVtZW50Ll9sZWZ0X3JlY3Vyc2lvbl9lbmFibGVkOgoKICAgICAgICAgICAgcmV0dXJuIHN1cGVyKCkucGFyc2VJbXBsKGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucykKCiAgICAgICAgIyAjIyBCb3VuZGVkIFJlY3Vyc2lvbiBhbGdvcml0aG0gIyMKCiAgICAgICAgIyBSZWN1cnNpb24gb25seSBuZWVkcyB0byBiZSBwcm9jZXNzZWQgYXQgYGBGb3J3YXJkYGAgZWxlbWVudHMsIHNpbmNlIHRoZXkgYXJlCgogICAgICAgICMgdGhlIG9ubHkgb25lcyB0aGF0IGNhbiBhY3R1YWxseSByZWZlciB0byB0aGVtc2VsdmVzLiBUaGUgZ2VuZXJhbCBpZGVhIGlzCgogICAgICAgICMgdG8gaGFuZGxlIHJlY3Vyc2lvbiBzdGVwd2lzZTogV2Ugc3RhcnQgYXQgbm8gcmVjdXJzaW9uLCB0aGVuIHJlY3Vyc2Ugb25jZSwKCiAgICAgICAgIyByZWN1cnNlIHR3aWNlLCAuLi4sIHVudGlsIG1vcmUgcmVjdXJzaW9uIG9mZmVycyBubyBiZW5lZml0ICh3ZSBoaXQgdGhlIGJvdW5kKS4KCiAgICAgICAgIwoKICAgICAgICAjIFRoZSBcInRyaWNrXCIgaGVyZSBpcyB0aGF0IGVhY2ggYGBGb3J3YXJkYGAgZ2V0cyBldmFsdWF0ZWQgaW4gdHdvIGNvbnRleHRzCgogICAgICAgICMgLSB0byAqbWF0Y2gqIGEgc3BlY2lmaWMgcmVjdXJzaW9uIGxldmVsLCBhbmQKCiAgICAgICAgIyAtIHRvICpzZWFyY2gqIHRoZSBib3VuZGVkIHJlY3Vyc2lvbiBsZXZlbAoKICAgICAgICAjIGFuZCB0aGUgdHdvIHJ1biBjb25jdXJyZW50bHkuIFRoZSAqc2VhcmNoKiBtdXN0ICptYXRjaCogZWFjaCByZWN1cnNpb24gbGV2ZWwKCiAgICAgICAgIyB0byBmaW5kIHRoZSBiZXN0IHBvc3NpYmxlIG1hdGNoLiBUaGlzIGlzIGhhbmRsZWQgYnkgYSBtZW1vIHRhYmxlLCB3aGljaAoKICAgICAgICAjIHByb3ZpZGVzIHRoZSBwcmV2aW91cyBtYXRjaCB0byB0aGUgbmV4dCBsZXZlbCBtYXRjaCBhdHRlbXB0LgoKICAgICAgICAjCgogICAgICAgICMgU2VlIGFsc28gXCJMZWZ0IFJlY3Vyc2lvbiBpbiBQYXJzaW5nIEV4cHJlc3Npb24gR3JhbW1hcnNcIiwgTWVkZWlyb3MgZXQgYWwuCgogICAgICAgICMKCiAgICAgICAgIyBUaGVyZSBpcyBhIGNvbXBsaWNhdGlvbiBzaW5jZSB3ZSBub3Qgb25seSAqcGFyc2UqIGJ1dCBhbHNvICp0cmFuc2Zvcm0qIHZpYQoKICAgICAgICAjIGFjdGlvbnM6IFdlIGRvIG5vdCB3YW50IHRvIHJ1biB0aGUgYWN0aW9ucyB0b28gb2Z0ZW4gd2hpbGUgZXhwYW5kaW5nLiBUaHVzLAoKICAgICAgICAjIHdlIGV4cGFuZCB1c2luZyBgZG9BY3Rpb25zPUZhbHNlYCBhbmQgb25seSBydW4gYGRvQWN0aW9ucz1UcnVlYCBpZiB0aGUgbmV4dAoKICAgICAgICAjIHJlY3Vyc2lvbiBsZXZlbCBpcyBhY2NlcHRhYmxlLgoKICAgICAgICB3aXRoIFBhcnNlckVsZW1lbnQucmVjdXJzaW9uX2xvY2s6CgogICAgICAgICAgICBtZW1vID0gUGFyc2VyRWxlbWVudC5yZWN1cnNpb25fbWVtb3MKCiAgICAgICAgICAgIHRyeToKCiAgICAgICAgICAgICAgICAjIHdlIGFyZSBwYXJzaW5nIGF0IGEgc3BlY2lmaWMgcmVjdXJzaW9uIGV4cGFuc2lvbiAtIHVzZSBpdCBhcy1pcwoKICAgICAgICAgICAgICAgIHByZXZfbG9jLCBwcmV2X3Jlc3VsdCA9IG1lbW9bbG9jLCBzZWxmLCBkb0FjdGlvbnNdCgogICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShwcmV2X3Jlc3VsdCwgRXhjZXB0aW9uKToKCiAgICAgICAgICAgICAgICAgICAgcmFpc2UgcHJldl9yZXN1bHQKCiAgICAgICAgICAgICAgICByZXR1cm4gcHJldl9sb2MsIHByZXZfcmVzdWx0LmNvcHkoKQoKICAgICAgICAgICAgZXhjZXB0IEtleUVycm9yOgoKICAgICAgICAgICAgICAgIGFjdF9rZXkgPSAobG9jLCBzZWxmLCBUcnVlKQoKICAgICAgICAgICAgICAgIHBlZWtfa2V5ID0gKGxvYywgc2VsZiwgRmFsc2UpCgogICAgICAgICAgICAgICAgIyB3ZSBhcmUgc2VhcmNoaW5nIGZvciB0aGUgYmVzdCByZWN1cnNpb24gZXhwYW5zaW9uIC0ga2VlcCBvbiBpbXByb3ZpbmcKCiAgICAgICAgICAgICAgICAjIGJvdGggYGRvQWN0aW9uc2AgY2FzZXMgbXVzdCBiZSB0cmFja2VkIHNlcGFyYXRlbHkgaGVyZSEKCiAgICAgICAgICAgICAgICBwcmV2X2xvYywgcHJldl9wZWVrID0gbWVtb1twZWVrX2tleV0gPSAoCgogICAgICAgICAgICAgICAgICAgIGxvYyAtIDEsCgogICAgICAgICAgICAgICAgICAgIFBhcnNlRXhjZXB0aW9uKAoKICAgICAgICAgICAgICAgICAgICAgICAgaW5zdHJpbmcsIGxvYywgXCJGb3J3YXJkIHJlY3Vyc2lvbiB3aXRob3V0IGJhc2UgY2FzZVwiLCBzZWxmCgogICAgICAgICAgICAgICAgICAgICksCgogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGlmIGRvQWN0aW9uczoKCiAgICAgICAgICAgICAgICAgICAgbWVtb1thY3Rfa2V5XSA9IG1lbW9bcGVla19rZXldCgogICAgICAgICAgICAgICAgd2hpbGUgVHJ1ZToKCiAgICAgICAgICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgICAgICAgICAgbmV3X2xvYywgbmV3X3BlZWsgPSBzdXBlcigpLnBhcnNlSW1wbChpbnN0cmluZywgbG9jLCBGYWxzZSkKCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IFBhcnNlRXhjZXB0aW9uOgoKICAgICAgICAgICAgICAgICAgICAgICAgIyB3ZSBmYWlsZWQgYmVmb3JlIGdldHRpbmcgYW55IG1hdGNoIOKAkyBkbyBub3QgaGlkZSB0aGUgZXJyb3IKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocHJldl9wZWVrLCBFeGNlcHRpb24pOgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCgogICAgICAgICAgICAgICAgICAgICAgICBuZXdfbG9jLCBuZXdfcGVlayA9IHByZXZfbG9jLCBwcmV2X3BlZWsKCiAgICAgICAgICAgICAgICAgICAgIyB0aGUgbWF0Y2ggZGlkIG5vdCBnZXQgYmV0dGVyOiB3ZSBhcmUgZG9uZQoKICAgICAgICAgICAgICAgICAgICBpZiBuZXdfbG9jIDw9IHByZXZfbG9jOgoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZG9BY3Rpb25zOgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcmVwbGFjZSB0aGUgbWF0Y2ggZm9yIGRvQWN0aW9ucz1GYWxzZSBhcyB3ZWxsLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgaW4gY2FzZSB0aGUgYWN0aW9uIGRpZCBiYWNrdHJhY2sKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2X2xvYywgcHJldl9yZXN1bHQgPSBtZW1vW3BlZWtfa2V5XSA9IG1lbW9bYWN0X2tleV0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWwgbWVtb1twZWVrX2tleV0sIG1lbW9bYWN0X2tleV0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJldl9sb2MsIHByZXZfcmVzdWx0LmNvcHkoKQoKICAgICAgICAgICAgICAgICAgICAgICAgZGVsIG1lbW9bcGVla19rZXldCgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJldl9sb2MsIHByZXZfcGVlay5jb3B5KCkKCiAgICAgICAgICAgICAgICAgICAgIyB0aGUgbWF0Y2ggZGlkIGdldCBiZXR0ZXI6IHNlZSBpZiB3ZSBjYW4gaW1wcm92ZSBmdXJ0aGVyCgogICAgICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgICAgICBpZiBkb0FjdGlvbnM6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW1vW2FjdF9rZXldID0gc3VwZXIoKS5wYXJzZUltcGwoaW5zdHJpbmcsIGxvYywgVHJ1ZSkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgUGFyc2VFeGNlcHRpb24gYXMgZToKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVtb1twZWVrX2tleV0gPSBtZW1vW2FjdF9rZXldID0gKG5ld19sb2MsIGUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCgogICAgICAgICAgICAgICAgICAgICAgICBwcmV2X2xvYywgcHJldl9wZWVrID0gbWVtb1twZWVrX2tleV0gPSBuZXdfbG9jLCBuZXdfcGVlawoKCgogICAgZGVmIGxlYXZlX3doaXRlc3BhY2Uoc2VsZiwgcmVjdXJzaXZlOiBib29sID0gVHJ1ZSkgLT4gUGFyc2VyRWxlbWVudDoKCiAgICAgICAgc2VsZi5za2lwV2hpdGVzcGFjZSA9IEZhbHNlCgogICAgICAgIHJldHVybiBzZWxmCgoKCiAgICBkZWYgaWdub3JlX3doaXRlc3BhY2Uoc2VsZiwgcmVjdXJzaXZlOiBib29sID0gVHJ1ZSkgLT4gUGFyc2VyRWxlbWVudDoKCiAgICAgICAgc2VsZi5za2lwV2hpdGVzcGFjZSA9IFRydWUKCiAgICAgICAgcmV0dXJuIHNlbGYKCgoKICAgIGRlZiBzdHJlYW1saW5lKHNlbGYpIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgICAgIGlmIG5vdCBzZWxmLnN0cmVhbWxpbmVkOgoKICAgICAgICAgICAgc2VsZi5zdHJlYW1saW5lZCA9IFRydWUKCiAgICAgICAgICAgIGlmIHNlbGYuZXhwciBpcyBub3QgTm9uZToKCiAgICAgICAgICAgICAgICBzZWxmLmV4cHIuc3RyZWFtbGluZSgpCgogICAgICAgIHJldHVybiBzZWxmCgoKCiAgICBkZWYgdmFsaWRhdGUoc2VsZiwgdmFsaWRhdGVUcmFjZT1Ob25lKSAtPiBOb25lOgoKICAgICAgICBpZiB2YWxpZGF0ZVRyYWNlIGlzIE5vbmU6CgogICAgICAgICAgICB2YWxpZGF0ZVRyYWNlID0gW10KCgoKICAgICAgICBpZiBzZWxmIG5vdCBpbiB2YWxpZGF0ZVRyYWNlOgoKICAgICAgICAgICAgdG1wID0gdmFsaWRhdGVUcmFjZVs6XSArIFtzZWxmXQoKICAgICAgICAgICAgaWYgc2VsZi5leHByIGlzIG5vdCBOb25lOgoKICAgICAgICAgICAgICAgIHNlbGYuZXhwci52YWxpZGF0ZSh0bXApCgogICAgICAgIHNlbGYuX2NoZWNrUmVjdXJzaW9uKFtdKQoKCgogICAgZGVmIF9nZW5lcmF0ZURlZmF1bHROYW1lKHNlbGYpOgoKICAgICAgICAjIEF2b2lkIGluZmluaXRlIHJlY3Vyc2lvbiBieSBzZXR0aW5nIGEgdGVtcG9yYXJ5IF9kZWZhdWx0TmFtZQoKICAgICAgICBzZWxmLl9kZWZhdWx0TmFtZSA9IFwiOiAuLi5cIgoKCgogICAgICAgICMgVXNlIHRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgbWFpbiBleHByZXNzaW9uLgoKICAgICAgICByZXRTdHJpbmcgPSBcIi4uLlwiCgogICAgICAgIHRyeToKCiAgICAgICAgICAgIGlmIHNlbGYuZXhwciBpcyBub3QgTm9uZToKCiAgICAgICAgICAgICAgICByZXRTdHJpbmcgPSBzdHIoc2VsZi5leHByKVs6MTAwMF0KCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgcmV0U3RyaW5nID0gXCJOb25lXCIKCiAgICAgICAgZmluYWxseToKCiAgICAgICAgICAgIHJldHVybiBzZWxmLl9fY2xhc3NfXy5fX25hbWVfXyArIFwiOiBcIiArIHJldFN0cmluZwoKCgogICAgZGVmIGNvcHkoc2VsZikgLT4gUGFyc2VyRWxlbWVudDoKCiAgICAgICAgaWYgc2VsZi5leHByIGlzIG5vdCBOb25lOgoKICAgICAgICAgICAgcmV0dXJuIHN1cGVyKCkuY29weSgpCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICByZXQgPSBGb3J3YXJkKCkKCiAgICAgICAgICAgIHJldCA8PD0gc2VsZgoKICAgICAgICAgICAgcmV0dXJuIHJldAoKCgogICAgZGVmIF9zZXRSZXN1bHRzTmFtZShzZWxmLCBuYW1lLCBsaXN0X2FsbF9tYXRjaGVzPUZhbHNlKToKCiAgICAgICAgaWYgKAoKICAgICAgICAgICAgX19kaWFnX18ud2Fybl9uYW1lX3NldF9vbl9lbXB0eV9Gb3J3YXJkCgogICAgICAgICAgICBhbmQgRGlhZ25vc3RpY3Mud2Fybl9uYW1lX3NldF9vbl9lbXB0eV9Gb3J3YXJkCgogICAgICAgICAgICBub3QgaW4gc2VsZi5zdXBwcmVzc193YXJuaW5nc18KCiAgICAgICAgKToKCiAgICAgICAgICAgIGlmIHNlbGYuZXhwciBpcyBOb25lOgoKICAgICAgICAgICAgICAgIHdhcm5pbmdzLndhcm4oCgogICAgICAgICAgICAgICAgICAgIFwie306IHNldHRpbmcgcmVzdWx0cyBuYW1lIHshcn0gb24ge30gZXhwcmVzc2lvbiBcIgoKICAgICAgICAgICAgICAgICAgICBcInRoYXQgaGFzIG5vIGNvbnRhaW5lZCBleHByZXNzaW9uXCIuZm9ybWF0KAoKICAgICAgICAgICAgICAgICAgICAgICAgXCJ3YXJuX25hbWVfc2V0X29uX2VtcHR5X0ZvcndhcmRcIiwgbmFtZSwgdHlwZShzZWxmKS5fX25hbWVfXwoKICAgICAgICAgICAgICAgICAgICApLAoKICAgICAgICAgICAgICAgICAgICBzdGFja2xldmVsPTMsCgogICAgICAgICAgICAgICAgKQoKCgogICAgICAgIHJldHVybiBzdXBlcigpLl9zZXRSZXN1bHRzTmFtZShuYW1lLCBsaXN0X2FsbF9tYXRjaGVzKQoKCgogICAgaWdub3JlV2hpdGVzcGFjZSA9IGlnbm9yZV93aGl0ZXNwYWNlCgogICAgbGVhdmVXaGl0ZXNwYWNlID0gbGVhdmVfd2hpdGVzcGFjZQoKCgoKCmNsYXNzIFRva2VuQ29udmVydGVyKFBhcnNlRWxlbWVudEVuaGFuY2UpOgoKICAgIFwiXCJcIgoKICAgIEFic3RyYWN0IHN1YmNsYXNzIG9mIDpjbGFzczpgUGFyc2VFeHByZXNzaW9uYCwgZm9yIGNvbnZlcnRpbmcgcGFyc2VkIHJlc3VsdHMuCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oc2VsZiwgZXhwcjogVW5pb25bUGFyc2VyRWxlbWVudCwgc3RyXSwgc2F2ZWxpc3Q9RmFsc2UpOgoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGV4cHIpICAjICwgc2F2ZWxpc3QpCgogICAgICAgIHNlbGYuc2F2ZUFzTGlzdCA9IEZhbHNlCgoKCgoKY2xhc3MgQ29tYmluZShUb2tlbkNvbnZlcnRlcik6CgogICAgXCJcIlwiQ29udmVydGVyIHRvIGNvbmNhdGVuYXRlIGFsbCBtYXRjaGluZyB0b2tlbnMgdG8gYSBzaW5nbGUgc3RyaW5nLgoKICAgIEJ5IGRlZmF1bHQsIHRoZSBtYXRjaGluZyBwYXR0ZXJucyBtdXN0IGFsc28gYmUgY29udGlndW91cyBpbiB0aGUKCiAgICBpbnB1dCBzdHJpbmc7IHRoaXMgY2FuIGJlIGRpc2FibGVkIGJ5IHNwZWNpZnlpbmcKCiAgICBgYCdhZGphY2VudD1GYWxzZSdgYCBpbiB0aGUgY29uc3RydWN0b3IuCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICByZWFsID0gV29yZChudW1zKSArICcuJyArIFdvcmQobnVtcykKCiAgICAgICAgcHJpbnQocmVhbC5wYXJzZV9zdHJpbmcoJzMuMTQxNicpKSAjIC0+IFsnMycsICcuJywgJzE0MTYnXQoKICAgICAgICAjIHdpbGwgYWxzbyBlcnJvbmVvdXNseSBtYXRjaCB0aGUgZm9sbG93aW5nCgogICAgICAgIHByaW50KHJlYWwucGFyc2Vfc3RyaW5nKCczLiAxNDE2JykpICMgLT4gWyczJywgJy4nLCAnMTQxNiddCgoKCiAgICAgICAgcmVhbCA9IENvbWJpbmUoV29yZChudW1zKSArICcuJyArIFdvcmQobnVtcykpCgogICAgICAgIHByaW50KHJlYWwucGFyc2Vfc3RyaW5nKCczLjE0MTYnKSkgIyAtPiBbJzMuMTQxNiddCgogICAgICAgICMgbm8gbWF0Y2ggd2hlbiB0aGVyZSBhcmUgaW50ZXJuYWwgc3BhY2VzCgogICAgICAgIHByaW50KHJlYWwucGFyc2Vfc3RyaW5nKCczLiAxNDE2JykpICMgLT4gRXhjZXB0aW9uOiBFeHBlY3RlZCBXOigwMTIzLi4uKQoKICAgIFwiXCJcIgoKCgogICAgZGVmIF9faW5pdF9fKAoKICAgICAgICBzZWxmLAoKICAgICAgICBleHByOiBQYXJzZXJFbGVtZW50LAoKICAgICAgICBqb2luX3N0cmluZzogc3RyID0gXCJcIiwKCiAgICAgICAgYWRqYWNlbnQ6IGJvb2wgPSBUcnVlLAoKICAgICAgICAqLAoKICAgICAgICBqb2luU3RyaW5nOiB0eXBpbmcuT3B0aW9uYWxbc3RyXSA9IE5vbmUsCgogICAgKToKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhleHByKQoKICAgICAgICBqb2luU3RyaW5nID0gam9pblN0cmluZyBpZiBqb2luU3RyaW5nIGlzIG5vdCBOb25lIGVsc2Ugam9pbl9zdHJpbmcKCiAgICAgICAgIyBzdXBwcmVzcyB3aGl0ZXNwYWNlLXN0cmlwcGluZyBpbiBjb250YWluZWQgcGFyc2UgZXhwcmVzc2lvbnMsIGJ1dCByZS1lbmFibGUgaXQgb24gdGhlIENvbWJpbmUgaXRzZWxmCgogICAgICAgIGlmIGFkamFjZW50OgoKICAgICAgICAgICAgc2VsZi5sZWF2ZV93aGl0ZXNwYWNlKCkKCiAgICAgICAgc2VsZi5hZGphY2VudCA9IGFkamFjZW50CgogICAgICAgIHNlbGYuc2tpcFdoaXRlc3BhY2UgPSBUcnVlCgogICAgICAgIHNlbGYuam9pblN0cmluZyA9IGpvaW5TdHJpbmcKCiAgICAgICAgc2VsZi5jYWxsUHJlcGFyc2UgPSBUcnVlCgoKCiAgICBkZWYgaWdub3JlKHNlbGYsIG90aGVyKSAtPiBQYXJzZXJFbGVtZW50OgoKICAgICAgICBpZiBzZWxmLmFkamFjZW50OgoKICAgICAgICAgICAgUGFyc2VyRWxlbWVudC5pZ25vcmUoc2VsZiwgb3RoZXIpCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBzdXBlcigpLmlnbm9yZShvdGhlcikKCiAgICAgICAgcmV0dXJuIHNlbGYKCgoKICAgIGRlZiBwb3N0UGFyc2Uoc2VsZiwgaW5zdHJpbmcsIGxvYywgdG9rZW5saXN0KToKCiAgICAgICAgcmV0VG9rcyA9IHRva2VubGlzdC5jb3B5KCkKCiAgICAgICAgZGVsIHJldFRva3NbOl0KCiAgICAgICAgcmV0VG9rcyArPSBQYXJzZVJlc3VsdHMoCgogICAgICAgICAgICBbXCJcIi5qb2luKHRva2VubGlzdC5fYXNTdHJpbmdMaXN0KHNlbGYuam9pblN0cmluZykpXSwgbW9kYWw9c2VsZi5tb2RhbFJlc3VsdHMKCiAgICAgICAgKQoKCgogICAgICAgIGlmIHNlbGYucmVzdWx0c05hbWUgYW5kIHJldFRva3MuaGFza2V5cygpOgoKICAgICAgICAgICAgcmV0dXJuIFtyZXRUb2tzXQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgcmV0dXJuIHJldFRva3MKCgoKCgpjbGFzcyBHcm91cChUb2tlbkNvbnZlcnRlcik6CgogICAgXCJcIlwiQ29udmVydGVyIHRvIHJldHVybiB0aGUgbWF0Y2hlZCB0b2tlbnMgYXMgYSBsaXN0IC0gdXNlZnVsIGZvcgoKICAgIHJldHVybmluZyB0b2tlbnMgb2YgOmNsYXNzOmBaZXJvT3JNb3JlYCBhbmQgOmNsYXNzOmBPbmVPck1vcmVgIGV4cHJlc3Npb25zLgoKCgogICAgVGhlIG9wdGlvbmFsIGBgYXNsaXN0YGAgYXJndW1lbnQgd2hlbiBzZXQgdG8gVHJ1ZSB3aWxsIHJldHVybiB0aGUKCiAgICBwYXJzZWQgdG9rZW5zIGFzIGEgUHl0aG9uIGxpc3QgaW5zdGVhZCBvZiBhIHB5cGFyc2luZyBQYXJzZVJlc3VsdHMuCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICBpZGVudCA9IFdvcmQoYWxwaGFzKQoKICAgICAgICBudW0gPSBXb3JkKG51bXMpCgogICAgICAgIHRlcm0gPSBpZGVudCB8IG51bQoKICAgICAgICBmdW5jID0gaWRlbnQgKyBPcHQoZGVsaW1pdGVkX2xpc3QodGVybSkpCgogICAgICAgIHByaW50KGZ1bmMucGFyc2Vfc3RyaW5nKFwiZm4gYSwgYiwgMTAwXCIpKQoKICAgICAgICAjIC0+IFsnZm4nLCAnYScsICdiJywgJzEwMCddCgoKCiAgICAgICAgZnVuYyA9IGlkZW50ICsgR3JvdXAoT3B0KGRlbGltaXRlZF9saXN0KHRlcm0pKSkKCiAgICAgICAgcHJpbnQoZnVuYy5wYXJzZV9zdHJpbmcoXCJmbiBhLCBiLCAxMDBcIikpCgogICAgICAgICMgLT4gWydmbicsIFsnYScsICdiJywgJzEwMCddXQoKICAgIFwiXCJcIgoKCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGV4cHI6IFBhcnNlckVsZW1lbnQsIGFzbGlzdDogYm9vbCA9IEZhbHNlKToKCiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhleHByKQoKICAgICAgICBzZWxmLnNhdmVBc0xpc3QgPSBUcnVlCgogICAgICAgIHNlbGYuX2FzUHl0aG9uTGlzdCA9IGFzbGlzdAoKCgogICAgZGVmIHBvc3RQYXJzZShzZWxmLCBpbnN0cmluZywgbG9jLCB0b2tlbmxpc3QpOgoKICAgICAgICBpZiBzZWxmLl9hc1B5dGhvbkxpc3Q6CgogICAgICAgICAgICByZXR1cm4gUGFyc2VSZXN1bHRzLkxpc3QoCgogICAgICAgICAgICAgICAgdG9rZW5saXN0LmFzTGlzdCgpCgogICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh0b2tlbmxpc3QsIFBhcnNlUmVzdWx0cykKCiAgICAgICAgICAgICAgICBlbHNlIGxpc3QodG9rZW5saXN0KQoKICAgICAgICAgICAgKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgcmV0dXJuIFt0b2tlbmxpc3RdCgoKCgoKY2xhc3MgRGljdChUb2tlbkNvbnZlcnRlcik6CgogICAgXCJcIlwiQ29udmVydGVyIHRvIHJldHVybiBhIHJlcGV0aXRpdmUgZXhwcmVzc2lvbiBhcyBhIGxpc3QsIGJ1dCBhbHNvCgogICAgYXMgYSBkaWN0aW9uYXJ5LiBFYWNoIGVsZW1lbnQgY2FuIGFsc28gYmUgcmVmZXJlbmNlZCB1c2luZyB0aGUgZmlyc3QKCiAgICB0b2tlbiBpbiB0aGUgZXhwcmVzc2lvbiBhcyBpdHMga2V5LiBVc2VmdWwgZm9yIHRhYnVsYXIgcmVwb3J0CgogICAgc2NyYXBpbmcgd2hlbiB0aGUgZmlyc3QgY29sdW1uIGNhbiBiZSB1c2VkIGFzIGEgaXRlbSBrZXkuCgoKCiAgICBUaGUgb3B0aW9uYWwgYGBhc2RpY3RgYCBhcmd1bWVudCB3aGVuIHNldCB0byBUcnVlIHdpbGwgcmV0dXJuIHRoZQoKICAgIHBhcnNlZCB0b2tlbnMgYXMgYSBQeXRob24gZGljdCBpbnN0ZWFkIG9mIGEgcHlwYXJzaW5nIFBhcnNlUmVzdWx0cy4KCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgIGRhdGFfd29yZCA9IFdvcmQoYWxwaGFzKQoKICAgICAgICBsYWJlbCA9IGRhdGFfd29yZCArIEZvbGxvd2VkQnkoJzonKQoKCgogICAgICAgIHRleHQgPSBcInNoYXBlOiBTUVVBUkUgcG9zbjogdXBwZXIgbGVmdCBjb2xvcjogbGlnaHQgYmx1ZSB0ZXh0dXJlOiBidXJsYXBcIgoKICAgICAgICBhdHRyX2V4cHIgPSAobGFiZWwgKyBTdXBwcmVzcygnOicpICsgT25lT3JNb3JlKGRhdGFfd29yZCwgc3RvcF9vbj1sYWJlbCkuc2V0X3BhcnNlX2FjdGlvbignICcuam9pbikpCgoKCiAgICAgICAgIyBwcmludCBhdHRyaWJ1dGVzIGFzIHBsYWluIGdyb3VwcwoKICAgICAgICBwcmludChhdHRyX2V4cHJbMSwgLi4uXS5wYXJzZV9zdHJpbmcodGV4dCkuZHVtcCgpKQoKCgogICAgICAgICMgaW5zdGVhZCBvZiBPbmVPck1vcmUoZXhwciksIHBhcnNlIHVzaW5nIERpY3QoR3JvdXAoZXhwcilbMSwgLi4uXSkgLSBEaWN0IHdpbGwgYXV0by1hc3NpZ24gbmFtZXMKCiAgICAgICAgcmVzdWx0ID0gRGljdChHcm91cChhdHRyX2V4cHIpWzEsIC4uLl0pLnBhcnNlX3N0cmluZyh0ZXh0KQoKICAgICAgICBwcmludChyZXN1bHQuZHVtcCgpKQoKCgogICAgICAgICMgYWNjZXNzIG5hbWVkIGZpZWxkcyBhcyBkaWN0IGVudHJpZXMsIG9yIG91dHB1dCBhcyBkaWN0CgogICAgICAgIHByaW50KHJlc3VsdFsnc2hhcGUnXSkKCiAgICAgICAgcHJpbnQocmVzdWx0LmFzX2RpY3QoKSkKCgoKICAgIHByaW50czo6CgoKCiAgICAgICAgWydzaGFwZScsICdTUVVBUkUnLCAncG9zbicsICd1cHBlciBsZWZ0JywgJ2NvbG9yJywgJ2xpZ2h0IGJsdWUnLCAndGV4dHVyZScsICdidXJsYXAnXQoKICAgICAgICBbWydzaGFwZScsICdTUVVBUkUnXSwgWydwb3NuJywgJ3VwcGVyIGxlZnQnXSwgWydjb2xvcicsICdsaWdodCBibHVlJ10sIFsndGV4dHVyZScsICdidXJsYXAnXV0KCiAgICAgICAgLSBjb2xvcjogJ2xpZ2h0IGJsdWUnCgogICAgICAgIC0gcG9zbjogJ3VwcGVyIGxlZnQnCgogICAgICAgIC0gc2hhcGU6ICdTUVVBUkUnCgogICAgICAgIC0gdGV4dHVyZTogJ2J1cmxhcCcKCiAgICAgICAgU1FVQVJFCgogICAgICAgIHsnY29sb3InOiAnbGlnaHQgYmx1ZScsICdwb3NuJzogJ3VwcGVyIGxlZnQnLCAndGV4dHVyZSc6ICdidXJsYXAnLCAnc2hhcGUnOiAnU1FVQVJFJ30KCgoKICAgIFNlZSBtb3JlIGV4YW1wbGVzIGF0IDpjbGFzczpgUGFyc2VSZXN1bHRzYCBvZiBhY2Nlc3NpbmcgZmllbGRzIGJ5IHJlc3VsdHMgbmFtZS4KCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBleHByOiBQYXJzZXJFbGVtZW50LCBhc2RpY3Q6IGJvb2wgPSBGYWxzZSk6CgogICAgICAgIHN1cGVyKCkuX19pbml0X18oZXhwcikKCiAgICAgICAgc2VsZi5zYXZlQXNMaXN0ID0gVHJ1ZQoKICAgICAgICBzZWxmLl9hc1B5dGhvbkRpY3QgPSBhc2RpY3QKCgoKICAgIGRlZiBwb3N0UGFyc2Uoc2VsZiwgaW5zdHJpbmcsIGxvYywgdG9rZW5saXN0KToKCiAgICAgICAgZm9yIGksIHRvayBpbiBlbnVtZXJhdGUodG9rZW5saXN0KToKCiAgICAgICAgICAgIGlmIGxlbih0b2spID09IDA6CgogICAgICAgICAgICAgICAgY29udGludWUKCgoKICAgICAgICAgICAgaWtleSA9IHRva1swXQoKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShpa2V5LCBpbnQpOgoKICAgICAgICAgICAgICAgIGlrZXkgPSBzdHIoaWtleSkuc3RyaXAoKQoKCgogICAgICAgICAgICBpZiBsZW4odG9rKSA9PSAxOgoKICAgICAgICAgICAgICAgIHRva2VubGlzdFtpa2V5XSA9IF9QYXJzZVJlc3VsdHNXaXRoT2Zmc2V0KFwiXCIsIGkpCgoKCiAgICAgICAgICAgIGVsaWYgbGVuKHRvaykgPT0gMiBhbmQgbm90IGlzaW5zdGFuY2UodG9rWzFdLCBQYXJzZVJlc3VsdHMpOgoKICAgICAgICAgICAgICAgIHRva2VubGlzdFtpa2V5XSA9IF9QYXJzZVJlc3VsdHNXaXRoT2Zmc2V0KHRva1sxXSwgaSkKCgoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICB0cnk6CgogICAgICAgICAgICAgICAgICAgIGRpY3R2YWx1ZSA9IHRvay5jb3B5KCkgICMgUGFyc2VSZXN1bHRzKGkpCgogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKCiAgICAgICAgICAgICAgICAgICAgZXhjID0gVHlwZUVycm9yKAoKICAgICAgICAgICAgICAgICAgICAgICAgXCJjb3VsZCBub3QgZXh0cmFjdCBkaWN0IHZhbHVlcyBmcm9tIHBhcnNlZCByZXN1bHRzXCIKCiAgICAgICAgICAgICAgICAgICAgICAgIFwiIC0gRGljdCBleHByZXNzaW9uIG11c3QgY29udGFpbiBHcm91cGVkIGV4cHJlc3Npb25zXCIKCiAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICByYWlzZSBleGMgZnJvbSBOb25lCgoKCiAgICAgICAgICAgICAgICBkZWwgZGljdHZhbHVlWzBdCgoKCiAgICAgICAgICAgICAgICBpZiBsZW4oZGljdHZhbHVlKSAhPSAxIG9yICgKCiAgICAgICAgICAgICAgICAgICAgaXNpbnN0YW5jZShkaWN0dmFsdWUsIFBhcnNlUmVzdWx0cykgYW5kIGRpY3R2YWx1ZS5oYXNrZXlzKCkKCiAgICAgICAgICAgICAgICApOgoKICAgICAgICAgICAgICAgICAgICB0b2tlbmxpc3RbaWtleV0gPSBfUGFyc2VSZXN1bHRzV2l0aE9mZnNldChkaWN0dmFsdWUsIGkpCgogICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgdG9rZW5saXN0W2lrZXldID0gX1BhcnNlUmVzdWx0c1dpdGhPZmZzZXQoZGljdHZhbHVlWzBdLCBpKQoKCgogICAgICAgIGlmIHNlbGYuX2FzUHl0aG9uRGljdDoKCiAgICAgICAgICAgIHJldHVybiBbdG9rZW5saXN0LmFzX2RpY3QoKV0gaWYgc2VsZi5yZXN1bHRzTmFtZSBlbHNlIHRva2VubGlzdC5hc19kaWN0KCkKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHJldHVybiBbdG9rZW5saXN0XSBpZiBzZWxmLnJlc3VsdHNOYW1lIGVsc2UgdG9rZW5saXN0CgoKCgoKY2xhc3MgU3VwcHJlc3MoVG9rZW5Db252ZXJ0ZXIpOgoKICAgIFwiXCJcIkNvbnZlcnRlciBmb3IgaWdub3JpbmcgdGhlIHJlc3VsdHMgb2YgYSBwYXJzZWQgZXhwcmVzc2lvbi4KCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgIHNvdXJjZSA9IFwiYSwgYiwgYyxkXCIKCiAgICAgICAgd2QgPSBXb3JkKGFscGhhcykKCiAgICAgICAgd2RfbGlzdDEgPSB3ZCArICgnLCcgKyB3ZClbLi4uXQoKICAgICAgICBwcmludCh3ZF9saXN0MS5wYXJzZV9zdHJpbmcoc291cmNlKSkKCgoKICAgICAgICAjIG9mdGVuLCBkZWxpbWl0ZXJzIHRoYXQgYXJlIHVzZWZ1bCBkdXJpbmcgcGFyc2luZyBhcmUganVzdCBpbiB0aGUKCiAgICAgICAgIyB3YXkgYWZ0ZXJ3YXJkIC0gdXNlIFN1cHByZXNzIHRvIGtlZXAgdGhlbSBvdXQgb2YgdGhlIHBhcnNlZCBvdXRwdXQKCiAgICAgICAgd2RfbGlzdDIgPSB3ZCArIChTdXBwcmVzcygnLCcpICsgd2QpWy4uLl0KCiAgICAgICAgcHJpbnQod2RfbGlzdDIucGFyc2Vfc3RyaW5nKHNvdXJjZSkpCgoKCiAgICAgICAgIyBTa2lwcGVkIHRleHQgKHVzaW5nICcuLi4nKSBjYW4gYmUgc3VwcHJlc3NlZCBhcyB3ZWxsCgogICAgICAgIHNvdXJjZSA9IFwibGVhZCBpbiBTVEFSVCByZWxldmFudCB0ZXh0IEVORCB0cmFpbGluZyB0ZXh0XCIKCiAgICAgICAgc3RhcnRfbWFya2VyID0gS2V5d29yZChcIlNUQVJUXCIpCgogICAgICAgIGVuZF9tYXJrZXIgPSBLZXl3b3JkKFwiRU5EXCIpCgogICAgICAgIGZpbmRfYm9keSA9IFN1cHByZXNzKC4uLikgKyBzdGFydF9tYXJrZXIgKyAuLi4gKyBlbmRfbWFya2VyCgogICAgICAgIHByaW50KGZpbmRfYm9keS5wYXJzZV9zdHJpbmcoc291cmNlKQoKCgogICAgcHJpbnRzOjoKCgoKICAgICAgICBbJ2EnLCAnLCcsICdiJywgJywnLCAnYycsICcsJywgJ2QnXQoKICAgICAgICBbJ2EnLCAnYicsICdjJywgJ2QnXQoKICAgICAgICBbJ1NUQVJUJywgJ3JlbGV2YW50IHRleHQgJywgJ0VORCddCgoKCiAgICAoU2VlIGFsc28gOmNsYXNzOmBkZWxpbWl0ZWRfbGlzdGAuKQoKICAgIFwiXCJcIgoKCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGV4cHI6IFVuaW9uW1BhcnNlckVsZW1lbnQsIHN0cl0sIHNhdmVsaXN0OiBib29sID0gRmFsc2UpOgoKICAgICAgICBpZiBleHByIGlzIC4uLjoKCiAgICAgICAgICAgIGV4cHIgPSBfUGVuZGluZ1NraXAoTm9NYXRjaCgpKQoKICAgICAgICBzdXBlcigpLl9faW5pdF9fKGV4cHIpCgoKCiAgICBkZWYgX19hZGRfXyhzZWxmLCBvdGhlcikgLT4gXCJQYXJzZXJFbGVtZW50XCI6CgogICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZi5leHByLCBfUGVuZGluZ1NraXApOgoKICAgICAgICAgICAgcmV0dXJuIFN1cHByZXNzKFNraXBUbyhvdGhlcikpICsgb3RoZXIKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHJldHVybiBzdXBlcigpLl9fYWRkX18ob3RoZXIpCgoKCiAgICBkZWYgX19zdWJfXyhzZWxmLCBvdGhlcikgLT4gXCJQYXJzZXJFbGVtZW50XCI6CgogICAgICAgIGlmIGlzaW5zdGFuY2Uoc2VsZi5leHByLCBfUGVuZGluZ1NraXApOgoKICAgICAgICAgICAgcmV0dXJuIFN1cHByZXNzKFNraXBUbyhvdGhlcikpIC0gb3RoZXIKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHJldHVybiBzdXBlcigpLl9fc3ViX18ob3RoZXIpCgoKCiAgICBkZWYgcG9zdFBhcnNlKHNlbGYsIGluc3RyaW5nLCBsb2MsIHRva2VubGlzdCk6CgogICAgICAgIHJldHVybiBbXQoKCgogICAgZGVmIHN1cHByZXNzKHNlbGYpIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgICAgIHJldHVybiBzZWxmCgoKCgoKZGVmIHRyYWNlX3BhcnNlX2FjdGlvbihmOiBQYXJzZUFjdGlvbikgLT4gUGFyc2VBY3Rpb246CgogICAgXCJcIlwiRGVjb3JhdG9yIGZvciBkZWJ1Z2dpbmcgcGFyc2UgYWN0aW9ucy4KCgoKICAgIFdoZW4gdGhlIHBhcnNlIGFjdGlvbiBpcyBjYWxsZWQsIHRoaXMgZGVjb3JhdG9yIHdpbGwgcHJpbnQKCiAgICBgYFwiPj4gZW50ZXJpbmcgbWV0aG9kLW5hbWUobGluZTo8Y3VycmVudF9zb3VyY2VfbGluZT4sIDxwYXJzZV9sb2NhdGlvbj4sIDxtYXRjaGVkX3Rva2Vucz4pXCJgYC4KCiAgICBXaGVuIHRoZSBwYXJzZSBhY3Rpb24gY29tcGxldGVzLCB0aGUgZGVjb3JhdG9yIHdpbGwgcHJpbnQKCiAgICBgYFwiPDxcImBgIGZvbGxvd2VkIGJ5IHRoZSByZXR1cm5lZCB2YWx1ZSwgb3IgYW55IGV4Y2VwdGlvbiB0aGF0IHRoZSBwYXJzZSBhY3Rpb24gcmFpc2VkLgoKCgogICAgRXhhbXBsZTo6CgoKCiAgICAgICAgd2QgPSBXb3JkKGFscGhhcykKCgoKICAgICAgICBAdHJhY2VfcGFyc2VfYWN0aW9uCgogICAgICAgIGRlZiByZW1vdmVfZHVwbGljYXRlX2NoYXJzKHRva2Vucyk6CgogICAgICAgICAgICByZXR1cm4gJycuam9pbihzb3J0ZWQoc2V0KCcnLmpvaW4odG9rZW5zKSkpKQoKCgogICAgICAgIHdkcyA9IHdkWzEsIC4uLl0uc2V0X3BhcnNlX2FjdGlvbihyZW1vdmVfZHVwbGljYXRlX2NoYXJzKQoKICAgICAgICBwcmludCh3ZHMucGFyc2Vfc3RyaW5nKFwic2xrZGpzIHNsZCBzbGRkIHNkbGYgc2RsamZcIikpCgoKCiAgICBwcmludHM6OgoKCgogICAgICAgID4+ZW50ZXJpbmcgcmVtb3ZlX2R1cGxpY2F0ZV9jaGFycyhsaW5lOiAnc2xrZGpzIHNsZCBzbGRkIHNkbGYgc2RsamYnLCAwLCAoWydzbGtkanMnLCAnc2xkJywgJ3NsZGQnLCAnc2RsZicsICdzZGxqZiddLCB7fSkpCgogICAgICAgIDw8bGVhdmluZyByZW1vdmVfZHVwbGljYXRlX2NoYXJzIChyZXQ6ICdkZmprbHMnKQoKICAgICAgICBbJ2RmamtscyddCgogICAgXCJcIlwiCgogICAgZiA9IF90cmltX2FyaXR5KGYpCgoKCiAgICBkZWYgeigqcGFBcmdzKToKCiAgICAgICAgdGhpc0Z1bmMgPSBmLl9fbmFtZV9fCgogICAgICAgIHMsIGwsIHQgPSBwYUFyZ3NbLTM6XQoKICAgICAgICBpZiBsZW4ocGFBcmdzKSA+IDM6CgogICAgICAgICAgICB0aGlzRnVuYyA9IHBhQXJnc1swXS5fX2NsYXNzX18uX19uYW1lX18gKyBcIi5cIiArIHRoaXNGdW5jCgogICAgICAgIHN5cy5zdGRlcnIud3JpdGUoCgogICAgICAgICAgICBcIj4+ZW50ZXJpbmcge30obGluZTogeyFyfSwge30sIHshcn0pXFxuXCIuZm9ybWF0KHRoaXNGdW5jLCBsaW5lKGwsIHMpLCBsLCB0KQoKICAgICAgICApCgogICAgICAgIHRyeToKCiAgICAgICAgICAgIHJldCA9IGYoKnBhQXJncykKCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBleGM6CgogICAgICAgICAgICBzeXMuc3RkZXJyLndyaXRlKFwiPDxsZWF2aW5nIHt9IChleGNlcHRpb246IHt9KVxcblwiLmZvcm1hdCh0aGlzRnVuYywgZXhjKSkKCiAgICAgICAgICAgIHJhaXNlCgogICAgICAgIHN5cy5zdGRlcnIud3JpdGUoXCI8PGxlYXZpbmcge30gKHJldDogeyFyfSlcXG5cIi5mb3JtYXQodGhpc0Z1bmMsIHJldCkpCgogICAgICAgIHJldHVybiByZXQKCgoKICAgIHouX19uYW1lX18gPSBmLl9fbmFtZV9fCgogICAgcmV0dXJuIHoKCgoKCgojIGNvbnZlbmllbmNlIGNvbnN0YW50cyBmb3IgcG9zaXRpb25hbCBleHByZXNzaW9ucwoKZW1wdHkgPSBFbXB0eSgpLnNldF9uYW1lKFwiZW1wdHlcIikKCmxpbmVfc3RhcnQgPSBMaW5lU3RhcnQoKS5zZXRfbmFtZShcImxpbmVfc3RhcnRcIikKCmxpbmVfZW5kID0gTGluZUVuZCgpLnNldF9uYW1lKFwibGluZV9lbmRcIikKCnN0cmluZ19zdGFydCA9IFN0cmluZ1N0YXJ0KCkuc2V0X25hbWUoXCJzdHJpbmdfc3RhcnRcIikKCnN0cmluZ19lbmQgPSBTdHJpbmdFbmQoKS5zZXRfbmFtZShcInN0cmluZ19lbmRcIikKCgoKX2VzY2FwZWRQdW5jID0gV29yZChfYnNsYXNoLCByXCJcXFtdLSouJCtePygpfiBcIiwgZXhhY3Q9Mikuc2V0X3BhcnNlX2FjdGlvbigKCiAgICBsYW1iZGEgcywgbCwgdDogdFswXVsxXQoKKQoKX2VzY2FwZWRIZXhDaGFyID0gUmVnZXgoclwiXFxcXDA/W3hYXVswLTlhLWZBLUZdK1wiKS5zZXRfcGFyc2VfYWN0aW9uKAoKICAgIGxhbWJkYSBzLCBsLCB0OiBjaHIoaW50KHRbMF0ubHN0cmlwKHJcIlxcMHhcIiksIDE2KSkKCikKCl9lc2NhcGVkT2N0Q2hhciA9IFJlZ2V4KHJcIlxcXFwwWzAtN10rXCIpLnNldF9wYXJzZV9hY3Rpb24oCgogICAgbGFtYmRhIHMsIGwsIHQ6IGNocihpbnQodFswXVsxOl0sIDgpKQoKKQoKX3NpbmdsZUNoYXIgPSAoCgogICAgX2VzY2FwZWRQdW5jIHwgX2VzY2FwZWRIZXhDaGFyIHwgX2VzY2FwZWRPY3RDaGFyIHwgQ2hhcnNOb3RJbihyXCJcXF1cIiwgZXhhY3Q9MSkKCikKCl9jaGFyUmFuZ2UgPSBHcm91cChfc2luZ2xlQ2hhciArIFN1cHByZXNzKFwiLVwiKSArIF9zaW5nbGVDaGFyKQoKX3JlQnJhY2tldEV4cHIgPSAoCgogICAgTGl0ZXJhbChcIltcIikKCiAgICArIE9wdChcIl5cIikuc2V0X3Jlc3VsdHNfbmFtZShcIm5lZ2F0ZVwiKQoKICAgICsgR3JvdXAoT25lT3JNb3JlKF9jaGFyUmFuZ2UgfCBfc2luZ2xlQ2hhcikpLnNldF9yZXN1bHRzX25hbWUoXCJib2R5XCIpCgogICAgKyBcIl1cIgoKKQoKCgoKCmRlZiBzcmFuZ2Uoczogc3RyKSAtPiBzdHI6CgogICAgclwiXCJcIkhlbHBlciB0byBlYXNpbHkgZGVmaW5lIHN0cmluZyByYW5nZXMgZm9yIHVzZSBpbiA6Y2xhc3M6YFdvcmRgCgogICAgY29uc3RydWN0aW9uLiBCb3Jyb3dzIHN5bnRheCBmcm9tIHJlZ2V4cCBgYCdbXSdgYCBzdHJpbmcgcmFuZ2UKCiAgICBkZWZpbml0aW9uczo6CgoKCiAgICAgICAgc3JhbmdlKFwiWzAtOV1cIikgICAtPiBcIjAxMjM0NTY3ODlcIgoKICAgICAgICBzcmFuZ2UoXCJbYS16XVwiKSAgIC0+IFwiYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpcIgoKICAgICAgICBzcmFuZ2UoXCJbYS16JF9dXCIpIC0+IFwiYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXokX1wiCgoKCiAgICBUaGUgaW5wdXQgc3RyaW5nIG11c3QgYmUgZW5jbG9zZWQgaW4gW10ncywgYW5kIHRoZSByZXR1cm5lZCBzdHJpbmcKCiAgICBpcyB0aGUgZXhwYW5kZWQgY2hhcmFjdGVyIHNldCBqb2luZWQgaW50byBhIHNpbmdsZSBzdHJpbmcuIFRoZQoKICAgIHZhbHVlcyBlbmNsb3NlZCBpbiB0aGUgW10ncyBtYXkgYmU6CgoKCiAgICAtIGEgc2luZ2xlIGNoYXJhY3RlcgoKICAgIC0gYW4gZXNjYXBlZCBjaGFyYWN0ZXIgd2l0aCBhIGxlYWRpbmcgYmFja3NsYXNoIChzdWNoIGFzIGBgXFwtYGAKCiAgICAgIG9yIGBgXFxdYGApCgogICAgLSBhbiBlc2NhcGVkIGhleCBjaGFyYWN0ZXIgd2l0aCBhIGxlYWRpbmcgYGAnXFx4J2BgCgogICAgICAoYGBcXHgyMWBgLCB3aGljaCBpcyBhIGBgJyEnYGAgY2hhcmFjdGVyKSAoYGBcXDB4IyNgYAoKICAgICAgaXMgYWxzbyBzdXBwb3J0ZWQgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5KQoKICAgIC0gYW4gZXNjYXBlZCBvY3RhbCBjaGFyYWN0ZXIgd2l0aCBhIGxlYWRpbmcgYGAnXFwwJ2BgCgogICAgICAoYGBcXDA0MWBgLCB3aGljaCBpcyBhIGBgJyEnYGAgY2hhcmFjdGVyKQoKICAgIC0gYSByYW5nZSBvZiBhbnkgb2YgdGhlIGFib3ZlLCBzZXBhcmF0ZWQgYnkgYSBkYXNoIChgYCdhLXonYGAsCgogICAgICBldGMuKQoKICAgIC0gYW55IGNvbWJpbmF0aW9uIG9mIHRoZSBhYm92ZSAoYGAnYWVpb3V5J2BgLAoKICAgICAgYGAnYS16QS1aMC05XyQnYGAsIGV0Yy4pCgogICAgXCJcIlwiCgogICAgX2V4cGFuZGVkID0gKAoKICAgICAgICBsYW1iZGEgcDogcAoKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShwLCBQYXJzZVJlc3VsdHMpCgogICAgICAgIGVsc2UgXCJcIi5qb2luKGNocihjKSBmb3IgYyBpbiByYW5nZShvcmQocFswXSksIG9yZChwWzFdKSArIDEpKQoKICAgICkKCiAgICB0cnk6CgogICAgICAgIHJldHVybiBcIlwiLmpvaW4oX2V4cGFuZGVkKHBhcnQpIGZvciBwYXJ0IGluIF9yZUJyYWNrZXRFeHByLnBhcnNlX3N0cmluZyhzKS5ib2R5KQoKICAgIGV4Y2VwdCBFeGNlcHRpb246CgogICAgICAgIHJldHVybiBcIlwiCgoKCgoKZGVmIHRva2VuX21hcChmdW5jLCAqYXJncykgLT4gUGFyc2VBY3Rpb246CgogICAgXCJcIlwiSGVscGVyIHRvIGRlZmluZSBhIHBhcnNlIGFjdGlvbiBieSBtYXBwaW5nIGEgZnVuY3Rpb24gdG8gYWxsCgogICAgZWxlbWVudHMgb2YgYSA6Y2xhc3M6YFBhcnNlUmVzdWx0c2AgbGlzdC4gSWYgYW55IGFkZGl0aW9uYWwgYXJncyBhcmUgcGFzc2VkLAoKICAgIHRoZXkgYXJlIGZvcndhcmRlZCB0byB0aGUgZ2l2ZW4gZnVuY3Rpb24gYXMgYWRkaXRpb25hbCBhcmd1bWVudHMKCiAgICBhZnRlciB0aGUgdG9rZW4sIGFzIGluCgogICAgYGBoZXhfaW50ZWdlciA9IFdvcmQoaGV4bnVtcykuc2V0X3BhcnNlX2FjdGlvbih0b2tlbl9tYXAoaW50LCAxNikpYGAsCgogICAgd2hpY2ggd2lsbCBjb252ZXJ0IHRoZSBwYXJzZWQgZGF0YSB0byBhbiBpbnRlZ2VyIHVzaW5nIGJhc2UgMTYuCgoKCiAgICBFeGFtcGxlIChjb21wYXJlIHRoZSBsYXN0IHRvIGV4YW1wbGUgaW4gOmNsYXNzOmBQYXJzZXJFbGVtZW50LnRyYW5zZm9ybV9zdHJpbmdgOjoKCgoKICAgICAgICBoZXhfaW50cyA9IFdvcmQoaGV4bnVtcylbMSwgLi4uXS5zZXRfcGFyc2VfYWN0aW9uKHRva2VuX21hcChpbnQsIDE2KSkKCiAgICAgICAgaGV4X2ludHMucnVuX3Rlc3RzKCcnJwoKICAgICAgICAgICAgMDAgMTEgMjIgYWEgRkYgMGEgMGQgMWEKCiAgICAgICAgICAgICcnJykKCgoKICAgICAgICB1cHBlcndvcmQgPSBXb3JkKGFscGhhcykuc2V0X3BhcnNlX2FjdGlvbih0b2tlbl9tYXAoc3RyLnVwcGVyKSkKCiAgICAgICAgdXBwZXJ3b3JkWzEsIC4uLl0ucnVuX3Rlc3RzKCcnJwoKICAgICAgICAgICAgbXkga2luZ2RvbSBmb3IgYSBob3JzZQoKICAgICAgICAgICAgJycnKQoKCgogICAgICAgIHdkID0gV29yZChhbHBoYXMpLnNldF9wYXJzZV9hY3Rpb24odG9rZW5fbWFwKHN0ci50aXRsZSkpCgogICAgICAgIHdkWzEsIC4uLl0uc2V0X3BhcnNlX2FjdGlvbignICcuam9pbikucnVuX3Rlc3RzKCcnJwoKICAgICAgICAgICAgbm93IGlzIHRoZSB3aW50ZXIgb2Ygb3VyIGRpc2NvbnRlbnQgbWFkZSBnbG9yaW91cyBzdW1tZXIgYnkgdGhpcyBzdW4gb2YgeW9yawoKICAgICAgICAgICAgJycnKQoKCgogICAgcHJpbnRzOjoKCgoKICAgICAgICAwMCAxMSAyMiBhYSBGRiAwYSAwZCAxYQoKICAgICAgICBbMCwgMTcsIDM0LCAxNzAsIDI1NSwgMTAsIDEzLCAyNl0KCgoKICAgICAgICBteSBraW5nZG9tIGZvciBhIGhvcnNlCgogICAgICAgIFsnTVknLCAnS0lOR0RPTScsICdGT1InLCAnQScsICdIT1JTRSddCgoKCiAgICAgICAgbm93IGlzIHRoZSB3aW50ZXIgb2Ygb3VyIGRpc2NvbnRlbnQgbWFkZSBnbG9yaW91cyBzdW1tZXIgYnkgdGhpcyBzdW4gb2YgeW9yawoKICAgICAgICBbJ05vdyBJcyBUaGUgV2ludGVyIE9mIE91ciBEaXNjb250ZW50IE1hZGUgR2xvcmlvdXMgU3VtbWVyIEJ5IFRoaXMgU3VuIE9mIFlvcmsnXQoKICAgIFwiXCJcIgoKCgogICAgZGVmIHBhKHMsIGwsIHQpOgoKICAgICAgICByZXR1cm4gW2Z1bmModG9rbiwgKmFyZ3MpIGZvciB0b2tuIGluIHRdCgoKCiAgICBmdW5jX25hbWUgPSBnZXRhdHRyKGZ1bmMsIFwiX19uYW1lX19cIiwgZ2V0YXR0cihmdW5jLCBcIl9fY2xhc3NfX1wiKS5fX25hbWVfXykKCiAgICBwYS5fX25hbWVfXyA9IGZ1bmNfbmFtZQoKCgogICAgcmV0dXJuIHBhCgoKCgoKZGVmIGF1dG9uYW1lX2VsZW1lbnRzKCkgLT4gTm9uZToKCiAgICBcIlwiXCIKCiAgICBVdGlsaXR5IHRvIHNpbXBsaWZ5IG1hc3MtbmFtaW5nIG9mIHBhcnNlciBlbGVtZW50cywgZm9yCgogICAgZ2VuZXJhdGluZyByYWlscm9hZCBkaWFncmFtIHdpdGggbmFtZWQgc3ViZGlhZ3JhbXMuCgogICAgXCJcIlwiCgogICAgZm9yIG5hbWUsIHZhciBpbiBzeXMuX2dldGZyYW1lKCkuZl9iYWNrLmZfbG9jYWxzLml0ZW1zKCk6CgogICAgICAgIGlmIGlzaW5zdGFuY2UodmFyLCBQYXJzZXJFbGVtZW50KSBhbmQgbm90IHZhci5jdXN0b21OYW1lOgoKICAgICAgICAgICAgdmFyLnNldF9uYW1lKG5hbWUpCgoKCgoKZGJsX3F1b3RlZF9zdHJpbmcgPSBDb21iaW5lKAoKICAgIFJlZ2V4KHInXCIoPzpbXlwiXFxuXFxyXFxcXF18KD86XCJcIil8KD86XFxcXCg/OlteeF18eFswLTlhLWZBLUZdKykpKSonKSArICdcIicKCikuc2V0X25hbWUoXCJzdHJpbmcgZW5jbG9zZWQgaW4gZG91YmxlIHF1b3Rlc1wiKQoKCgpzZ2xfcXVvdGVkX3N0cmluZyA9IENvbWJpbmUoCgogICAgUmVnZXgoclwiJyg/OlteJ1xcblxcclxcXFxdfCg/OicnKXwoPzpcXFxcKD86W154XXx4WzAtOWEtZkEtRl0rKSkpKlwiKSArIFwiJ1wiCgopLnNldF9uYW1lKFwic3RyaW5nIGVuY2xvc2VkIGluIHNpbmdsZSBxdW90ZXNcIikKCgoKcXVvdGVkX3N0cmluZyA9IENvbWJpbmUoCgogICAgUmVnZXgocidcIig/OlteXCJcXG5cXHJcXFxcXXwoPzpcIlwiKXwoPzpcXFxcKD86W154XXx4WzAtOWEtZkEtRl0rKSkpKicpICsgJ1wiJwoKICAgIHwgUmVnZXgoclwiJyg/OlteJ1xcblxcclxcXFxdfCg/OicnKXwoPzpcXFxcKD86W154XXx4WzAtOWEtZkEtRl0rKSkpKlwiKSArIFwiJ1wiCgopLnNldF9uYW1lKFwicXVvdGVkU3RyaW5nIHVzaW5nIHNpbmdsZSBvciBkb3VibGUgcXVvdGVzXCIpCgoKCnVuaWNvZGVfc3RyaW5nID0gQ29tYmluZShcInVcIiArIHF1b3RlZF9zdHJpbmcuY29weSgpKS5zZXRfbmFtZShcInVuaWNvZGUgc3RyaW5nIGxpdGVyYWxcIikKCgoKCgphbHBoYXM4Yml0ID0gc3JhbmdlKHJcIltcXDB4YzAtXFwweGQ2XFwweGQ4LVxcMHhmNlxcMHhmOC1cXDB4ZmZdXCIpCgpwdW5jOGJpdCA9IHNyYW5nZShyXCJbXFwweGExLVxcMHhiZlxcMHhkN1xcMHhmN11cIikKCgoKIyBidWlsZCBsaXN0IG9mIGJ1aWx0LWluIGV4cHJlc3Npb25zLCBmb3IgZnV0dXJlIHJlZmVyZW5jZSBpZiBhIGdsb2JhbCBkZWZhdWx0IHZhbHVlCgojIGdldHMgdXBkYXRlZAoKX2J1aWx0aW5fZXhwcnM6IExpc3RbUGFyc2VyRWxlbWVudF0gPSBbCgogICAgdiBmb3IgdiBpbiB2YXJzKCkudmFsdWVzKCkgaWYgaXNpbnN0YW5jZSh2LCBQYXJzZXJFbGVtZW50KQoKXQoKCgojIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgbmFtZXMKCnRva2VuTWFwID0gdG9rZW5fbWFwCgpjb25kaXRpb25Bc1BhcnNlQWN0aW9uID0gY29uZGl0aW9uX2FzX3BhcnNlX2FjdGlvbgoKbnVsbERlYnVnQWN0aW9uID0gbnVsbF9kZWJ1Z19hY3Rpb24KCnNnbFF1b3RlZFN0cmluZyA9IHNnbF9xdW90ZWRfc3RyaW5nCgpkYmxRdW90ZWRTdHJpbmcgPSBkYmxfcXVvdGVkX3N0cmluZwoKcXVvdGVkU3RyaW5nID0gcXVvdGVkX3N0cmluZwoKdW5pY29kZVN0cmluZyA9IHVuaWNvZGVfc3RyaW5nCgpsaW5lU3RhcnQgPSBsaW5lX3N0YXJ0CgpsaW5lRW5kID0gbGluZV9lbmQKCnN0cmluZ1N0YXJ0ID0gc3RyaW5nX3N0YXJ0CgpzdHJpbmdFbmQgPSBzdHJpbmdfZW5kCgp0cmFjZVBhcnNlQWN0aW9uID0gdHJhY2VfcGFyc2VfYWN0aW9uCgoKCiIiIgoKbW9kdWxlX2RpY3RbInB5cGFyc2luZy9oZWxwZXJzLnB5Il09IiIiCgojIGhlbHBlcnMucHkKCmltcG9ydCBodG1sLmVudGl0aWVzCgppbXBvcnQgcmUKCmltcG9ydCB0eXBpbmcKCgoKZnJvbSAuIGltcG9ydCBfX2RpYWdfXwoKZnJvbSAuY29yZSBpbXBvcnQgKgoKZnJvbSAudXRpbCBpbXBvcnQgX2JzbGFzaCwgX2ZsYXR0ZW4sIF9lc2NhcGVfcmVnZXhfcmFuZ2VfY2hhcnMKCgoKCgojCgojIGdsb2JhbCBoZWxwZXJzCgojCgpkZWYgZGVsaW1pdGVkX2xpc3QoCgogICAgZXhwcjogVW5pb25bc3RyLCBQYXJzZXJFbGVtZW50XSwKCiAgICBkZWxpbTogVW5pb25bc3RyLCBQYXJzZXJFbGVtZW50XSA9IFwiLFwiLAoKICAgIGNvbWJpbmU6IGJvb2wgPSBGYWxzZSwKCiAgICBtaW46IHR5cGluZy5PcHRpb25hbFtpbnRdID0gTm9uZSwKCiAgICBtYXg6IHR5cGluZy5PcHRpb25hbFtpbnRdID0gTm9uZSwKCiAgICAqLAoKICAgIGFsbG93X3RyYWlsaW5nX2RlbGltOiBib29sID0gRmFsc2UsCgopIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgXCJcIlwiSGVscGVyIHRvIGRlZmluZSBhIGRlbGltaXRlZCBsaXN0IG9mIGV4cHJlc3Npb25zIC0gdGhlIGRlbGltaXRlcgoKICAgIGRlZmF1bHRzIHRvICcsJy4gQnkgZGVmYXVsdCwgdGhlIGxpc3QgZWxlbWVudHMgYW5kIGRlbGltaXRlcnMgY2FuCgogICAgaGF2ZSBpbnRlcnZlbmluZyB3aGl0ZXNwYWNlLCBhbmQgY29tbWVudHMsIGJ1dCB0aGlzIGNhbiBiZQoKICAgIG92ZXJyaWRkZW4gYnkgcGFzc2luZyBgYGNvbWJpbmU9VHJ1ZWBgIGluIHRoZSBjb25zdHJ1Y3Rvci4gSWYKCiAgICBgYGNvbWJpbmVgYCBpcyBzZXQgdG8gYGBUcnVlYGAsIHRoZSBtYXRjaGluZyB0b2tlbnMgYXJlCgogICAgcmV0dXJuZWQgYXMgYSBzaW5nbGUgdG9rZW4gc3RyaW5nLCB3aXRoIHRoZSBkZWxpbWl0ZXJzIGluY2x1ZGVkOwoKICAgIG90aGVyd2lzZSwgdGhlIG1hdGNoaW5nIHRva2VucyBhcmUgcmV0dXJuZWQgYXMgYSBsaXN0IG9mIHRva2VucywKCiAgICB3aXRoIHRoZSBkZWxpbWl0ZXJzIHN1cHByZXNzZWQuCgoKCiAgICBJZiBgYGFsbG93X3RyYWlsaW5nX2RlbGltYGAgaXMgc2V0IHRvIFRydWUsIHRoZW4gdGhlIGxpc3QgbWF5IGVuZCB3aXRoCgogICAgYSBkZWxpbWl0ZXIuCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICBkZWxpbWl0ZWRfbGlzdChXb3JkKGFscGhhcykpLnBhcnNlX3N0cmluZyhcImFhLGJiLGNjXCIpICMgLT4gWydhYScsICdiYicsICdjYyddCgogICAgICAgIGRlbGltaXRlZF9saXN0KFdvcmQoaGV4bnVtcyksIGRlbGltPSc6JywgY29tYmluZT1UcnVlKS5wYXJzZV9zdHJpbmcoXCJBQTpCQjpDQzpERDpFRVwiKSAjIC0+IFsnQUE6QkI6Q0M6REQ6RUUnXQoKICAgIFwiXCJcIgoKICAgIGlmIGlzaW5zdGFuY2UoZXhwciwgc3RyX3R5cGUpOgoKICAgICAgICBleHByID0gUGFyc2VyRWxlbWVudC5fbGl0ZXJhbFN0cmluZ0NsYXNzKGV4cHIpCgoKCiAgICBkbE5hbWUgPSBcIntleHByfSBbe2RlbGltfSB7ZXhwcn1dLi4ue2VuZH1cIi5mb3JtYXQoCgogICAgICAgIGV4cHI9c3RyKGV4cHIuY29weSgpLnN0cmVhbWxpbmUoKSksCgogICAgICAgIGRlbGltPXN0cihkZWxpbSksCgogICAgICAgIGVuZD1cIiBbe31dXCIuZm9ybWF0KHN0cihkZWxpbSkpIGlmIGFsbG93X3RyYWlsaW5nX2RlbGltIGVsc2UgXCJcIiwKCiAgICApCgoKCiAgICBpZiBub3QgY29tYmluZToKCiAgICAgICAgZGVsaW0gPSBTdXBwcmVzcyhkZWxpbSkKCgoKICAgIGlmIG1pbiBpcyBub3QgTm9uZToKCiAgICAgICAgaWYgbWluIDwgMToKCiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoXCJtaW4gbXVzdCBiZSBncmVhdGVyIHRoYW4gMFwiKQoKICAgICAgICBtaW4gLT0gMQoKICAgIGlmIG1heCBpcyBub3QgTm9uZToKCiAgICAgICAgaWYgbWluIGlzIG5vdCBOb25lIGFuZCBtYXggPD0gbWluOgoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihcIm1heCBtdXN0IGJlIGdyZWF0ZXIgdGhhbiwgb3IgZXF1YWwgdG8gbWluXCIpCgogICAgICAgIG1heCAtPSAxCgogICAgZGVsaW1pdGVkX2xpc3RfZXhwciA9IGV4cHIgKyAoZGVsaW0gKyBleHByKVttaW4sIG1heF0KCgoKICAgIGlmIGFsbG93X3RyYWlsaW5nX2RlbGltOgoKICAgICAgICBkZWxpbWl0ZWRfbGlzdF9leHByICs9IE9wdChkZWxpbSkKCgoKICAgIGlmIGNvbWJpbmU6CgogICAgICAgIHJldHVybiBDb21iaW5lKGRlbGltaXRlZF9saXN0X2V4cHIpLnNldF9uYW1lKGRsTmFtZSkKCiAgICBlbHNlOgoKICAgICAgICByZXR1cm4gZGVsaW1pdGVkX2xpc3RfZXhwci5zZXRfbmFtZShkbE5hbWUpCgoKCgoKZGVmIGNvdW50ZWRfYXJyYXkoCgogICAgZXhwcjogUGFyc2VyRWxlbWVudCwKCiAgICBpbnRfZXhwcjogdHlwaW5nLk9wdGlvbmFsW1BhcnNlckVsZW1lbnRdID0gTm9uZSwKCiAgICAqLAoKICAgIGludEV4cHI6IHR5cGluZy5PcHRpb25hbFtQYXJzZXJFbGVtZW50XSA9IE5vbmUsCgopIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgXCJcIlwiSGVscGVyIHRvIGRlZmluZSBhIGNvdW50ZWQgbGlzdCBvZiBleHByZXNzaW9ucy4KCgoKICAgIFRoaXMgaGVscGVyIGRlZmluZXMgYSBwYXR0ZXJuIG9mIHRoZSBmb3JtOjoKCgoKICAgICAgICBpbnRlZ2VyIGV4cHIgZXhwciBleHByLi4uCgoKCiAgICB3aGVyZSB0aGUgbGVhZGluZyBpbnRlZ2VyIHRlbGxzIGhvdyBtYW55IGV4cHIgZXhwcmVzc2lvbnMgZm9sbG93LgoKICAgIFRoZSBtYXRjaGVkIHRva2VucyByZXR1cm5zIHRoZSBhcnJheSBvZiBleHByIHRva2VucyBhcyBhIGxpc3QgLSB0aGUKCiAgICBsZWFkaW5nIGNvdW50IHRva2VuIGlzIHN1cHByZXNzZWQuCgoKCiAgICBJZiBgYGludF9leHByYGAgaXMgc3BlY2lmaWVkLCBpdCBzaG91bGQgYmUgYSBweXBhcnNpbmcgZXhwcmVzc2lvbgoKICAgIHRoYXQgcHJvZHVjZXMgYW4gaW50ZWdlciB2YWx1ZS4KCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgIGNvdW50ZWRfYXJyYXkoV29yZChhbHBoYXMpKS5wYXJzZV9zdHJpbmcoJzIgYWIgY2QgZWYnKSAgIyAtPiBbJ2FiJywgJ2NkJ10KCgoKICAgICAgICAjIGluIHRoaXMgcGFyc2VyLCB0aGUgbGVhZGluZyBpbnRlZ2VyIHZhbHVlIGlzIGdpdmVuIGluIGJpbmFyeSwKCiAgICAgICAgIyAnMTAnIGluZGljYXRpbmcgdGhhdCAyIHZhbHVlcyBhcmUgaW4gdGhlIGFycmF5CgogICAgICAgIGJpbmFyeV9jb25zdGFudCA9IFdvcmQoJzAxJykuc2V0X3BhcnNlX2FjdGlvbihsYW1iZGEgdDogaW50KHRbMF0sIDIpKQoKICAgICAgICBjb3VudGVkX2FycmF5KFdvcmQoYWxwaGFzKSwgaW50X2V4cHI9YmluYXJ5X2NvbnN0YW50KS5wYXJzZV9zdHJpbmcoJzEwIGFiIGNkIGVmJykgICMgLT4gWydhYicsICdjZCddCgoKCiAgICAgICAgIyBpZiBvdGhlciBmaWVsZHMgbXVzdCBiZSBwYXJzZWQgYWZ0ZXIgdGhlIGNvdW50IGJ1dCBiZWZvcmUgdGhlCgogICAgICAgICMgbGlzdCBpdGVtcywgZ2l2ZSB0aGUgZmllbGRzIHJlc3VsdHMgbmFtZXMgYW5kIHRoZXkgd2lsbAoKICAgICAgICAjIGJlIHByZXNlcnZlZCBpbiB0aGUgcmV0dXJuZWQgUGFyc2VSZXN1bHRzOgoKICAgICAgICBjb3VudF93aXRoX21ldGFkYXRhID0gaW50ZWdlciArIFdvcmQoYWxwaGFzKShcInR5cGVcIikKCiAgICAgICAgdHlwZWRfYXJyYXkgPSBjb3VudGVkX2FycmF5KFdvcmQoYWxwaGFudW1zKSwgaW50X2V4cHI9Y291bnRfd2l0aF9tZXRhZGF0YSkoXCJpdGVtc1wiKQoKICAgICAgICByZXN1bHQgPSB0eXBlZF9hcnJheS5wYXJzZV9zdHJpbmcoXCIzIGJvb2wgVHJ1ZSBUcnVlIEZhbHNlXCIpCgogICAgICAgIHByaW50KHJlc3VsdC5kdW1wKCkpCgoKCiAgICAgICAgIyBwcmludHMKCiAgICAgICAgIyBbJ1RydWUnLCAnVHJ1ZScsICdGYWxzZSddCgogICAgICAgICMgLSBpdGVtczogWydUcnVlJywgJ1RydWUnLCAnRmFsc2UnXQoKICAgICAgICAjIC0gdHlwZTogJ2Jvb2wnCgogICAgXCJcIlwiCgogICAgaW50RXhwciA9IGludEV4cHIgb3IgaW50X2V4cHIKCiAgICBhcnJheV9leHByID0gRm9yd2FyZCgpCgoKCiAgICBkZWYgY291bnRfZmllbGRfcGFyc2VfYWN0aW9uKHMsIGwsIHQpOgoKICAgICAgICBub25sb2NhbCBhcnJheV9leHByCgogICAgICAgIG4gPSB0WzBdCgogICAgICAgIGFycmF5X2V4cHIgPDw9IChleHByICogbikgaWYgbiBlbHNlIEVtcHR5KCkKCiAgICAgICAgIyBjbGVhciBsaXN0IGNvbnRlbnRzLCBidXQga2VlcCBhbnkgbmFtZWQgcmVzdWx0cwoKICAgICAgICBkZWwgdFs6XQoKCgogICAgaWYgaW50RXhwciBpcyBOb25lOgoKICAgICAgICBpbnRFeHByID0gV29yZChudW1zKS5zZXRfcGFyc2VfYWN0aW9uKGxhbWJkYSB0OiBpbnQodFswXSkpCgogICAgZWxzZToKCiAgICAgICAgaW50RXhwciA9IGludEV4cHIuY29weSgpCgogICAgaW50RXhwci5zZXRfbmFtZShcImFycmF5TGVuXCIpCgogICAgaW50RXhwci5hZGRfcGFyc2VfYWN0aW9uKGNvdW50X2ZpZWxkX3BhcnNlX2FjdGlvbiwgY2FsbF9kdXJpbmdfdHJ5PVRydWUpCgogICAgcmV0dXJuIChpbnRFeHByICsgYXJyYXlfZXhwcikuc2V0X25hbWUoXCIobGVuKSBcIiArIHN0cihleHByKSArIFwiLi4uXCIpCgoKCgoKZGVmIG1hdGNoX3ByZXZpb3VzX2xpdGVyYWwoZXhwcjogUGFyc2VyRWxlbWVudCkgLT4gUGFyc2VyRWxlbWVudDoKCiAgICBcIlwiXCJIZWxwZXIgdG8gZGVmaW5lIGFuIGV4cHJlc3Npb24gdGhhdCBpcyBpbmRpcmVjdGx5IGRlZmluZWQgZnJvbQoKICAgIHRoZSB0b2tlbnMgbWF0Y2hlZCBpbiBhIHByZXZpb3VzIGV4cHJlc3Npb24sIHRoYXQgaXMsIGl0IGxvb2tzIGZvcgoKICAgIGEgJ3JlcGVhdCcgb2YgYSBwcmV2aW91cyBleHByZXNzaW9uLiAgRm9yIGV4YW1wbGU6OgoKCgogICAgICAgIGZpcnN0ID0gV29yZChudW1zKQoKICAgICAgICBzZWNvbmQgPSBtYXRjaF9wcmV2aW91c19saXRlcmFsKGZpcnN0KQoKICAgICAgICBtYXRjaF9leHByID0gZmlyc3QgKyBcIjpcIiArIHNlY29uZAoKCgogICAgd2lsbCBtYXRjaCBgYFwiMToxXCJgYCwgYnV0IG5vdCBgYFwiMToyXCJgYC4gIEJlY2F1c2UgdGhpcwoKICAgIG1hdGNoZXMgYSBwcmV2aW91cyBsaXRlcmFsLCB3aWxsIGFsc28gbWF0Y2ggdGhlIGxlYWRpbmcKCiAgICBgYFwiMToxXCJgYCBpbiBgYFwiMToxMFwiYGAuIElmIHRoaXMgaXMgbm90IGRlc2lyZWQsIHVzZQoKICAgIDpjbGFzczpgbWF0Y2hfcHJldmlvdXNfZXhwcmAuIERvICpub3QqIHVzZSB3aXRoIHBhY2tyYXQgcGFyc2luZwoKICAgIGVuYWJsZWQuCgogICAgXCJcIlwiCgogICAgcmVwID0gRm9yd2FyZCgpCgoKCiAgICBkZWYgY29weV90b2tlbl90b19yZXBlYXRlcihzLCBsLCB0KToKCiAgICAgICAgaWYgdDoKCiAgICAgICAgICAgIGlmIGxlbih0KSA9PSAxOgoKICAgICAgICAgICAgICAgIHJlcCA8PCB0WzBdCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICMgZmxhdHRlbiB0IHRva2VucwoKICAgICAgICAgICAgICAgIHRmbGF0ID0gX2ZsYXR0ZW4odC5hc19saXN0KCkpCgogICAgICAgICAgICAgICAgcmVwIDw8IEFuZChMaXRlcmFsKHR0KSBmb3IgdHQgaW4gdGZsYXQpCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICByZXAgPDwgRW1wdHkoKQoKCgogICAgZXhwci5hZGRfcGFyc2VfYWN0aW9uKGNvcHlfdG9rZW5fdG9fcmVwZWF0ZXIsIGNhbGxEdXJpbmdUcnk9VHJ1ZSkKCiAgICByZXAuc2V0X25hbWUoXCIocHJldikgXCIgKyBzdHIoZXhwcikpCgogICAgcmV0dXJuIHJlcAoKCgoKCmRlZiBtYXRjaF9wcmV2aW91c19leHByKGV4cHI6IFBhcnNlckVsZW1lbnQpIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgXCJcIlwiSGVscGVyIHRvIGRlZmluZSBhbiBleHByZXNzaW9uIHRoYXQgaXMgaW5kaXJlY3RseSBkZWZpbmVkIGZyb20KCiAgICB0aGUgdG9rZW5zIG1hdGNoZWQgaW4gYSBwcmV2aW91cyBleHByZXNzaW9uLCB0aGF0IGlzLCBpdCBsb29rcyBmb3IKCiAgICBhICdyZXBlYXQnIG9mIGEgcHJldmlvdXMgZXhwcmVzc2lvbi4gIEZvciBleGFtcGxlOjoKCgoKICAgICAgICBmaXJzdCA9IFdvcmQobnVtcykKCiAgICAgICAgc2Vjb25kID0gbWF0Y2hfcHJldmlvdXNfZXhwcihmaXJzdCkKCiAgICAgICAgbWF0Y2hfZXhwciA9IGZpcnN0ICsgXCI6XCIgKyBzZWNvbmQKCgoKICAgIHdpbGwgbWF0Y2ggYGBcIjE6MVwiYGAsIGJ1dCBub3QgYGBcIjE6MlwiYGAuICBCZWNhdXNlIHRoaXMKCiAgICBtYXRjaGVzIGJ5IGV4cHJlc3Npb25zLCB3aWxsICpub3QqIG1hdGNoIHRoZSBsZWFkaW5nIGBgXCIxOjFcImBgCgogICAgaW4gYGBcIjE6MTBcImBgOyB0aGUgZXhwcmVzc2lvbnMgYXJlIGV2YWx1YXRlZCBmaXJzdCwgYW5kIHRoZW4KCiAgICBjb21wYXJlZCwgc28gYGBcIjFcImBgIGlzIGNvbXBhcmVkIHdpdGggYGBcIjEwXCJgYC4gRG8gKm5vdCogdXNlCgogICAgd2l0aCBwYWNrcmF0IHBhcnNpbmcgZW5hYmxlZC4KCiAgICBcIlwiXCIKCiAgICByZXAgPSBGb3J3YXJkKCkKCiAgICBlMiA9IGV4cHIuY29weSgpCgogICAgcmVwIDw8PSBlMgoKCgogICAgZGVmIGNvcHlfdG9rZW5fdG9fcmVwZWF0ZXIocywgbCwgdCk6CgogICAgICAgIG1hdGNoVG9rZW5zID0gX2ZsYXR0ZW4odC5hc19saXN0KCkpCgoKCiAgICAgICAgZGVmIG11c3RfbWF0Y2hfdGhlc2VfdG9rZW5zKHMsIGwsIHQpOgoKICAgICAgICAgICAgdGhlc2VUb2tlbnMgPSBfZmxhdHRlbih0LmFzX2xpc3QoKSkKCiAgICAgICAgICAgIGlmIHRoZXNlVG9rZW5zICE9IG1hdGNoVG9rZW5zOgoKICAgICAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKAoKICAgICAgICAgICAgICAgICAgICBzLCBsLCBcIkV4cGVjdGVkIHt9LCBmb3VuZHt9XCIuZm9ybWF0KG1hdGNoVG9rZW5zLCB0aGVzZVRva2VucykKCiAgICAgICAgICAgICAgICApCgoKCiAgICAgICAgcmVwLnNldF9wYXJzZV9hY3Rpb24obXVzdF9tYXRjaF90aGVzZV90b2tlbnMsIGNhbGxEdXJpbmdUcnk9VHJ1ZSkKCgoKICAgIGV4cHIuYWRkX3BhcnNlX2FjdGlvbihjb3B5X3Rva2VuX3RvX3JlcGVhdGVyLCBjYWxsRHVyaW5nVHJ5PVRydWUpCgogICAgcmVwLnNldF9uYW1lKFwiKHByZXYpIFwiICsgc3RyKGV4cHIpKQoKICAgIHJldHVybiByZXAKCgoKCgpkZWYgb25lX29mKAoKICAgIHN0cnM6IFVuaW9uW3R5cGluZy5JdGVyYWJsZVtzdHJdLCBzdHJdLAoKICAgIGNhc2VsZXNzOiBib29sID0gRmFsc2UsCgogICAgdXNlX3JlZ2V4OiBib29sID0gVHJ1ZSwKCiAgICBhc19rZXl3b3JkOiBib29sID0gRmFsc2UsCgogICAgKiwKCiAgICB1c2VSZWdleDogYm9vbCA9IFRydWUsCgogICAgYXNLZXl3b3JkOiBib29sID0gRmFsc2UsCgopIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgXCJcIlwiSGVscGVyIHRvIHF1aWNrbHkgZGVmaW5lIGEgc2V0IG9mIGFsdGVybmF0aXZlIDpjbGFzczpgTGl0ZXJhbGAgcywKCiAgICBhbmQgbWFrZXMgc3VyZSB0byBkbyBsb25nZXN0LWZpcnN0IHRlc3Rpbmcgd2hlbiB0aGVyZSBpcyBhIGNvbmZsaWN0LAoKICAgIHJlZ2FyZGxlc3Mgb2YgdGhlIGlucHV0IG9yZGVyLCBidXQgcmV0dXJucwoKICAgIGEgOmNsYXNzOmBNYXRjaEZpcnN0YCBmb3IgYmVzdCBwZXJmb3JtYW5jZS4KCgoKICAgIFBhcmFtZXRlcnM6CgoKCiAgICAtIGBgc3Ryc2BgIC0gYSBzdHJpbmcgb2Ygc3BhY2UtZGVsaW1pdGVkIGxpdGVyYWxzLCBvciBhIGNvbGxlY3Rpb24gb2YKCiAgICAgIHN0cmluZyBsaXRlcmFscwoKICAgIC0gYGBjYXNlbGVzc2BgIC0gdHJlYXQgYWxsIGxpdGVyYWxzIGFzIGNhc2VsZXNzIC0gKGRlZmF1bHQ9IGBgRmFsc2VgYCkKCiAgICAtIGBgdXNlX3JlZ2V4YGAgLSBhcyBhbiBvcHRpbWl6YXRpb24sIHdpbGwKCiAgICAgIGdlbmVyYXRlIGEgOmNsYXNzOmBSZWdleGAgb2JqZWN0OyBvdGhlcndpc2UsIHdpbGwgZ2VuZXJhdGUKCiAgICAgIGEgOmNsYXNzOmBNYXRjaEZpcnN0YCBvYmplY3QgKGlmIGBgY2FzZWxlc3M9VHJ1ZWBgIG9yIGBgYXNLZXl3b3JkPVRydWVgYCwgb3IgaWYKCiAgICAgIGNyZWF0aW5nIGEgOmNsYXNzOmBSZWdleGAgcmFpc2VzIGFuIGV4Y2VwdGlvbikgLSAoZGVmYXVsdD0gYGBUcnVlYGApCgogICAgLSBgYGFzX2tleXdvcmRgYCAtIGVuZm9yY2UgOmNsYXNzOmBLZXl3b3JkYC1zdHlsZSBtYXRjaGluZyBvbiB0aGUKCiAgICAgIGdlbmVyYXRlZCBleHByZXNzaW9ucyAtIChkZWZhdWx0PSBgYEZhbHNlYGApCgogICAgLSBgYGFzS2V5d29yZGBgIGFuZCBgYHVzZVJlZ2V4YGAgYXJlIHJldGFpbmVkIGZvciBwcmUtUEVQOCBjb21wYXRpYmlsaXR5LAoKICAgICAgYnV0IHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSByZWxlYXNlCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICBjb21wX29wZXIgPSBvbmVfb2YoXCI8ID0gPiA8PSA+PSAhPVwiKQoKICAgICAgICB2YXIgPSBXb3JkKGFscGhhcykKCiAgICAgICAgbnVtYmVyID0gV29yZChudW1zKQoKICAgICAgICB0ZXJtID0gdmFyIHwgbnVtYmVyCgogICAgICAgIGNvbXBhcmlzb25fZXhwciA9IHRlcm0gKyBjb21wX29wZXIgKyB0ZXJtCgogICAgICAgIHByaW50KGNvbXBhcmlzb25fZXhwci5zZWFyY2hfc3RyaW5nKFwiQiA9IDEyICBBQT0yMyBCPD1BQSBBQT4xMlwiKSkKCgoKICAgIHByaW50czo6CgoKCiAgICAgICAgW1snQicsICc9JywgJzEyJ10sIFsnQUEnLCAnPScsICcyMyddLCBbJ0InLCAnPD0nLCAnQUEnXSwgWydBQScsICc+JywgJzEyJ11dCgogICAgXCJcIlwiCgogICAgYXNLZXl3b3JkID0gYXNLZXl3b3JkIG9yIGFzX2tleXdvcmQKCiAgICB1c2VSZWdleCA9IHVzZVJlZ2V4IGFuZCB1c2VfcmVnZXgKCgoKICAgIGlmICgKCiAgICAgICAgaXNpbnN0YW5jZShjYXNlbGVzcywgc3RyX3R5cGUpCgogICAgICAgIGFuZCBfX2RpYWdfXy53YXJuX29uX211bHRpcGxlX3N0cmluZ19hcmdzX3RvX29uZW9mCgogICAgKToKCiAgICAgICAgd2FybmluZ3Mud2FybigKCiAgICAgICAgICAgIFwiTW9yZSB0aGFuIG9uZSBzdHJpbmcgYXJndW1lbnQgcGFzc2VkIHRvIG9uZV9vZiwgcGFzc1wiCgogICAgICAgICAgICBcIiBjaG9pY2VzIGFzIGEgbGlzdCBvciBzcGFjZS1kZWxpbWl0ZWQgc3RyaW5nXCIsCgogICAgICAgICAgICBzdGFja2xldmVsPTIsCgogICAgICAgICkKCgoKICAgIGlmIGNhc2VsZXNzOgoKICAgICAgICBpc2VxdWFsID0gbGFtYmRhIGEsIGI6IGEudXBwZXIoKSA9PSBiLnVwcGVyKCkKCiAgICAgICAgbWFza3MgPSBsYW1iZGEgYSwgYjogYi51cHBlcigpLnN0YXJ0c3dpdGgoYS51cHBlcigpKQoKICAgICAgICBwYXJzZUVsZW1lbnRDbGFzcyA9IENhc2VsZXNzS2V5d29yZCBpZiBhc0tleXdvcmQgZWxzZSBDYXNlbGVzc0xpdGVyYWwKCiAgICBlbHNlOgoKICAgICAgICBpc2VxdWFsID0gbGFtYmRhIGEsIGI6IGEgPT0gYgoKICAgICAgICBtYXNrcyA9IGxhbWJkYSBhLCBiOiBiLnN0YXJ0c3dpdGgoYSkKCiAgICAgICAgcGFyc2VFbGVtZW50Q2xhc3MgPSBLZXl3b3JkIGlmIGFzS2V5d29yZCBlbHNlIExpdGVyYWwKCgoKICAgIHN5bWJvbHM6IExpc3Rbc3RyXSA9IFtdCgogICAgaWYgaXNpbnN0YW5jZShzdHJzLCBzdHJfdHlwZSk6CgogICAgICAgIHN5bWJvbHMgPSBzdHJzLnNwbGl0KCkKCiAgICBlbGlmIGlzaW5zdGFuY2Uoc3RycywgSXRlcmFibGUpOgoKICAgICAgICBzeW1ib2xzID0gbGlzdChzdHJzKQoKICAgIGVsc2U6CgogICAgICAgIHJhaXNlIFR5cGVFcnJvcihcIkludmFsaWQgYXJndW1lbnQgdG8gb25lX29mLCBleHBlY3RlZCBzdHJpbmcgb3IgaXRlcmFibGVcIikKCiAgICBpZiBub3Qgc3ltYm9sczoKCiAgICAgICAgcmV0dXJuIE5vTWF0Y2goKQoKCgogICAgIyByZW9yZGVyIGdpdmVuIHN5bWJvbHMgdG8gdGFrZSBjYXJlIHRvIGF2b2lkIG1hc2tpbmcgbG9uZ2VyIGNob2ljZXMgd2l0aCBzaG9ydGVyIG9uZXMKCiAgICAjIChidXQgb25seSBpZiB0aGUgZ2l2ZW4gc3ltYm9scyBhcmUgbm90IGp1c3Qgc2luZ2xlIGNoYXJhY3RlcnMpCgogICAgaWYgYW55KGxlbihzeW0pID4gMSBmb3Igc3ltIGluIHN5bWJvbHMpOgoKICAgICAgICBpID0gMAoKICAgICAgICB3aGlsZSBpIDwgbGVuKHN5bWJvbHMpIC0gMToKCiAgICAgICAgICAgIGN1ciA9IHN5bWJvbHNbaV0KCiAgICAgICAgICAgIGZvciBqLCBvdGhlciBpbiBlbnVtZXJhdGUoc3ltYm9sc1tpICsgMSA6XSk6CgogICAgICAgICAgICAgICAgaWYgaXNlcXVhbChvdGhlciwgY3VyKToKCiAgICAgICAgICAgICAgICAgICAgZGVsIHN5bWJvbHNbaSArIGogKyAxXQoKICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICAgICAgICAgIGVsaWYgbWFza3MoY3VyLCBvdGhlcik6CgogICAgICAgICAgICAgICAgICAgIGRlbCBzeW1ib2xzW2kgKyBqICsgMV0KCiAgICAgICAgICAgICAgICAgICAgc3ltYm9scy5pbnNlcnQoaSwgb3RoZXIpCgogICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIGkgKz0gMQoKCgogICAgaWYgdXNlUmVnZXg6CgogICAgICAgIHJlX2ZsYWdzOiBpbnQgPSByZS5JR05PUkVDQVNFIGlmIGNhc2VsZXNzIGVsc2UgMAoKCgogICAgICAgIHRyeToKCiAgICAgICAgICAgIGlmIGFsbChsZW4oc3ltKSA9PSAxIGZvciBzeW0gaW4gc3ltYm9scyk6CgogICAgICAgICAgICAgICAgIyBzeW1ib2xzIGFyZSBqdXN0IHNpbmdsZSBjaGFyYWN0ZXJzLCBjcmVhdGUgcmFuZ2UgcmVnZXggcGF0dGVybgoKICAgICAgICAgICAgICAgIHBhdHQgPSBcIlt7fV1cIi5mb3JtYXQoCgogICAgICAgICAgICAgICAgICAgIFwiXCIuam9pbihfZXNjYXBlX3JlZ2V4X3JhbmdlX2NoYXJzKHN5bSkgZm9yIHN5bSBpbiBzeW1ib2xzKQoKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgcGF0dCA9IFwifFwiLmpvaW4ocmUuZXNjYXBlKHN5bSkgZm9yIHN5bSBpbiBzeW1ib2xzKQoKCgogICAgICAgICAgICAjIHdyYXAgd2l0aCBcXGIgd29yZCBicmVhayBtYXJrZXJzIGlmIGRlZmluaW5nIGFzIGtleXdvcmRzCgogICAgICAgICAgICBpZiBhc0tleXdvcmQ6CgogICAgICAgICAgICAgICAgcGF0dCA9IHJcIlxcYig/Ont9KVxcYlwiLmZvcm1hdChwYXR0KQoKCgogICAgICAgICAgICByZXQgPSBSZWdleChwYXR0LCBmbGFncz1yZV9mbGFncykuc2V0X25hbWUoXCIgfCBcIi5qb2luKHN5bWJvbHMpKQoKCgogICAgICAgICAgICBpZiBjYXNlbGVzczoKCiAgICAgICAgICAgICAgICAjIGFkZCBwYXJzZSBhY3Rpb24gdG8gcmV0dXJuIHN5bWJvbHMgYXMgc3BlY2lmaWVkLCBub3QgaW4gcmFuZG9tCgogICAgICAgICAgICAgICAgIyBjYXNpbmcgYXMgZm91bmQgaW4gaW5wdXQgc3RyaW5nCgogICAgICAgICAgICAgICAgc3ltYm9sX21hcCA9IHtzeW0ubG93ZXIoKTogc3ltIGZvciBzeW0gaW4gc3ltYm9sc30KCiAgICAgICAgICAgICAgICByZXQuYWRkX3BhcnNlX2FjdGlvbihsYW1iZGEgcywgbCwgdDogc3ltYm9sX21hcFt0WzBdLmxvd2VyKCldKQoKCgogICAgICAgICAgICByZXR1cm4gcmV0CgoKCiAgICAgICAgZXhjZXB0IHJlLmVycm9yOgoKICAgICAgICAgICAgd2FybmluZ3Mud2FybigKCiAgICAgICAgICAgICAgICBcIkV4Y2VwdGlvbiBjcmVhdGluZyBSZWdleCBmb3Igb25lX29mLCBidWlsZGluZyBNYXRjaEZpcnN0XCIsIHN0YWNrbGV2ZWw9MgoKICAgICAgICAgICAgKQoKCgogICAgIyBsYXN0IHJlc29ydCwganVzdCB1c2UgTWF0Y2hGaXJzdAoKICAgIHJldHVybiBNYXRjaEZpcnN0KHBhcnNlRWxlbWVudENsYXNzKHN5bSkgZm9yIHN5bSBpbiBzeW1ib2xzKS5zZXRfbmFtZSgKCiAgICAgICAgXCIgfCBcIi5qb2luKHN5bWJvbHMpCgogICAgKQoKCgoKCmRlZiBkaWN0X29mKGtleTogUGFyc2VyRWxlbWVudCwgdmFsdWU6IFBhcnNlckVsZW1lbnQpIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgXCJcIlwiSGVscGVyIHRvIGVhc2lseSBhbmQgY2xlYXJseSBkZWZpbmUgYSBkaWN0aW9uYXJ5IGJ5IHNwZWNpZnlpbmcKCiAgICB0aGUgcmVzcGVjdGl2ZSBwYXR0ZXJucyBmb3IgdGhlIGtleSBhbmQgdmFsdWUuICBUYWtlcyBjYXJlIG9mCgogICAgZGVmaW5pbmcgdGhlIDpjbGFzczpgRGljdGAsIDpjbGFzczpgWmVyb09yTW9yZWAsIGFuZAoKICAgIDpjbGFzczpgR3JvdXBgIHRva2VucyBpbiB0aGUgcHJvcGVyIG9yZGVyLiAgVGhlIGtleSBwYXR0ZXJuCgogICAgY2FuIGluY2x1ZGUgZGVsaW1pdGluZyBtYXJrZXJzIG9yIHB1bmN0dWF0aW9uLCBhcyBsb25nIGFzIHRoZXkgYXJlCgogICAgc3VwcHJlc3NlZCwgdGhlcmVieSBsZWF2aW5nIHRoZSBzaWduaWZpY2FudCBrZXkgdGV4dC4gIFRoZSB2YWx1ZQoKICAgIHBhdHRlcm4gY2FuIGluY2x1ZGUgbmFtZWQgcmVzdWx0cywgc28gdGhhdCB0aGUgOmNsYXNzOmBEaWN0YCByZXN1bHRzCgogICAgY2FuIGluY2x1ZGUgbmFtZWQgdG9rZW4gZmllbGRzLgoKCgogICAgRXhhbXBsZTo6CgoKCiAgICAgICAgdGV4dCA9IFwic2hhcGU6IFNRVUFSRSBwb3NuOiB1cHBlciBsZWZ0IGNvbG9yOiBsaWdodCBibHVlIHRleHR1cmU6IGJ1cmxhcFwiCgogICAgICAgIGF0dHJfZXhwciA9IChsYWJlbCArIFN1cHByZXNzKCc6JykgKyBPbmVPck1vcmUoZGF0YV93b3JkLCBzdG9wX29uPWxhYmVsKS5zZXRfcGFyc2VfYWN0aW9uKCcgJy5qb2luKSkKCiAgICAgICAgcHJpbnQoYXR0cl9leHByWzEsIC4uLl0ucGFyc2Vfc3RyaW5nKHRleHQpLmR1bXAoKSkKCgoKICAgICAgICBhdHRyX2xhYmVsID0gbGFiZWwKCiAgICAgICAgYXR0cl92YWx1ZSA9IFN1cHByZXNzKCc6JykgKyBPbmVPck1vcmUoZGF0YV93b3JkLCBzdG9wX29uPWxhYmVsKS5zZXRfcGFyc2VfYWN0aW9uKCcgJy5qb2luKQoKCgogICAgICAgICMgc2ltaWxhciB0byBEaWN0LCBidXQgc2ltcGxlciBjYWxsIGZvcm1hdAoKICAgICAgICByZXN1bHQgPSBkaWN0X29mKGF0dHJfbGFiZWwsIGF0dHJfdmFsdWUpLnBhcnNlX3N0cmluZyh0ZXh0KQoKICAgICAgICBwcmludChyZXN1bHQuZHVtcCgpKQoKICAgICAgICBwcmludChyZXN1bHRbJ3NoYXBlJ10pCgogICAgICAgIHByaW50KHJlc3VsdC5zaGFwZSkgICMgb2JqZWN0IGF0dHJpYnV0ZSBhY2Nlc3Mgd29ya3MgdG9vCgogICAgICAgIHByaW50KHJlc3VsdC5hc19kaWN0KCkpCgoKCiAgICBwcmludHM6OgoKCgogICAgICAgIFtbJ3NoYXBlJywgJ1NRVUFSRSddLCBbJ3Bvc24nLCAndXBwZXIgbGVmdCddLCBbJ2NvbG9yJywgJ2xpZ2h0IGJsdWUnXSwgWyd0ZXh0dXJlJywgJ2J1cmxhcCddXQoKICAgICAgICAtIGNvbG9yOiAnbGlnaHQgYmx1ZScKCiAgICAgICAgLSBwb3NuOiAndXBwZXIgbGVmdCcKCiAgICAgICAgLSBzaGFwZTogJ1NRVUFSRScKCiAgICAgICAgLSB0ZXh0dXJlOiAnYnVybGFwJwoKICAgICAgICBTUVVBUkUKCiAgICAgICAgU1FVQVJFCgogICAgICAgIHsnY29sb3InOiAnbGlnaHQgYmx1ZScsICdzaGFwZSc6ICdTUVVBUkUnLCAncG9zbic6ICd1cHBlciBsZWZ0JywgJ3RleHR1cmUnOiAnYnVybGFwJ30KCiAgICBcIlwiXCIKCiAgICByZXR1cm4gRGljdChPbmVPck1vcmUoR3JvdXAoa2V5ICsgdmFsdWUpKSkKCgoKCgpkZWYgb3JpZ2luYWxfdGV4dF9mb3IoCgogICAgZXhwcjogUGFyc2VyRWxlbWVudCwgYXNfc3RyaW5nOiBib29sID0gVHJ1ZSwgKiwgYXNTdHJpbmc6IGJvb2wgPSBUcnVlCgopIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgXCJcIlwiSGVscGVyIHRvIHJldHVybiB0aGUgb3JpZ2luYWwsIHVudG9rZW5pemVkIHRleHQgZm9yIGEgZ2l2ZW4KCiAgICBleHByZXNzaW9uLiAgVXNlZnVsIHRvIHJlc3RvcmUgdGhlIHBhcnNlZCBmaWVsZHMgb2YgYW4gSFRNTCBzdGFydAoKICAgIHRhZyBpbnRvIHRoZSByYXcgdGFnIHRleHQgaXRzZWxmLCBvciB0byByZXZlcnQgc2VwYXJhdGUgdG9rZW5zIHdpdGgKCiAgICBpbnRlcnZlbmluZyB3aGl0ZXNwYWNlIGJhY2sgdG8gdGhlIG9yaWdpbmFsIG1hdGNoaW5nIGlucHV0IHRleHQuIEJ5CgogICAgZGVmYXVsdCwgcmV0dXJucyBhc3RyaW5nIGNvbnRhaW5pbmcgdGhlIG9yaWdpbmFsIHBhcnNlZCB0ZXh0LgoKCgogICAgSWYgdGhlIG9wdGlvbmFsIGBgYXNfc3RyaW5nYGAgYXJndW1lbnQgaXMgcGFzc2VkIGFzCgogICAgYGBGYWxzZWBgLCB0aGVuIHRoZSByZXR1cm4gdmFsdWUgaXMKCiAgICBhIDpjbGFzczpgUGFyc2VSZXN1bHRzYCBjb250YWluaW5nIGFueSByZXN1bHRzIG5hbWVzIHRoYXQKCiAgICB3ZXJlIG9yaWdpbmFsbHkgbWF0Y2hlZCwgYW5kIGEgc2luZ2xlIHRva2VuIGNvbnRhaW5pbmcgdGhlIG9yaWdpbmFsCgogICAgbWF0Y2hlZCB0ZXh0IGZyb20gdGhlIGlucHV0IHN0cmluZy4gIFNvIGlmIHRoZSBleHByZXNzaW9uIHBhc3NlZCB0bwoKICAgIDpjbGFzczpgb3JpZ2luYWxfdGV4dF9mb3JgIGNvbnRhaW5zIGV4cHJlc3Npb25zIHdpdGggZGVmaW5lZAoKICAgIHJlc3VsdHMgbmFtZXMsIHlvdSBtdXN0IHNldCBgYGFzX3N0cmluZ2BgIHRvIGBgRmFsc2VgYCBpZiB5b3UKCiAgICB3YW50IHRvIHByZXNlcnZlIHRob3NlIHJlc3VsdHMgbmFtZSB2YWx1ZXMuCgoKCiAgICBUaGUgYGBhc1N0cmluZ2BgIHByZS1QRVA4IGFyZ3VtZW50IGlzIHJldGFpbmVkIGZvciBjb21wYXRpYmlsaXR5LAoKICAgIGJ1dCB3aWxsIGJlIHJlbW92ZWQgaW4gYSBmdXR1cmUgcmVsZWFzZS4KCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgIHNyYyA9IFwidGhpcyBpcyB0ZXN0IDxiPiBib2xkIDxpPnRleHQ8L2k+IDwvYj4gbm9ybWFsIHRleHQgXCIKCiAgICAgICAgZm9yIHRhZyBpbiAoXCJiXCIsIFwiaVwiKToKCiAgICAgICAgICAgIG9wZW5lciwgY2xvc2VyID0gbWFrZV9odG1sX3RhZ3ModGFnKQoKICAgICAgICAgICAgcGF0dCA9IG9yaWdpbmFsX3RleHRfZm9yKG9wZW5lciArIFNraXBUbyhjbG9zZXIpICsgY2xvc2VyKQoKICAgICAgICAgICAgcHJpbnQocGF0dC5zZWFyY2hfc3RyaW5nKHNyYylbMF0pCgoKCiAgICBwcmludHM6OgoKCgogICAgICAgIFsnPGI+IGJvbGQgPGk+dGV4dDwvaT4gPC9iPiddCgogICAgICAgIFsnPGk+dGV4dDwvaT4nXQoKICAgIFwiXCJcIgoKICAgIGFzU3RyaW5nID0gYXNTdHJpbmcgYW5kIGFzX3N0cmluZwoKCgogICAgbG9jTWFya2VyID0gRW1wdHkoKS5zZXRfcGFyc2VfYWN0aW9uKGxhbWJkYSBzLCBsb2MsIHQ6IGxvYykKCiAgICBlbmRsb2NNYXJrZXIgPSBsb2NNYXJrZXIuY29weSgpCgogICAgZW5kbG9jTWFya2VyLmNhbGxQcmVwYXJzZSA9IEZhbHNlCgogICAgbWF0Y2hFeHByID0gbG9jTWFya2VyKFwiX29yaWdpbmFsX3N0YXJ0XCIpICsgZXhwciArIGVuZGxvY01hcmtlcihcIl9vcmlnaW5hbF9lbmRcIikKCiAgICBpZiBhc1N0cmluZzoKCiAgICAgICAgZXh0cmFjdFRleHQgPSBsYW1iZGEgcywgbCwgdDogc1t0Ll9vcmlnaW5hbF9zdGFydCA6IHQuX29yaWdpbmFsX2VuZF0KCiAgICBlbHNlOgoKCgogICAgICAgIGRlZiBleHRyYWN0VGV4dChzLCBsLCB0KToKCiAgICAgICAgICAgIHRbOl0gPSBbc1t0LnBvcChcIl9vcmlnaW5hbF9zdGFydFwiKSA6IHQucG9wKFwiX29yaWdpbmFsX2VuZFwiKV1dCgoKCiAgICBtYXRjaEV4cHIuc2V0X3BhcnNlX2FjdGlvbihleHRyYWN0VGV4dCkKCiAgICBtYXRjaEV4cHIuaWdub3JlRXhwcnMgPSBleHByLmlnbm9yZUV4cHJzCgogICAgbWF0Y2hFeHByLnN1cHByZXNzX3dhcm5pbmcoRGlhZ25vc3RpY3Mud2Fybl91bmdyb3VwZWRfbmFtZWRfdG9rZW5zX2luX2NvbGxlY3Rpb24pCgogICAgcmV0dXJuIG1hdGNoRXhwcgoKCgoKCmRlZiB1bmdyb3VwKGV4cHI6IFBhcnNlckVsZW1lbnQpIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgXCJcIlwiSGVscGVyIHRvIHVuZG8gcHlwYXJzaW5nJ3MgZGVmYXVsdCBncm91cGluZyBvZiBBbmQgZXhwcmVzc2lvbnMsCgogICAgZXZlbiBpZiBhbGwgYnV0IG9uZSBhcmUgbm9uLWVtcHR5LgoKICAgIFwiXCJcIgoKICAgIHJldHVybiBUb2tlbkNvbnZlcnRlcihleHByKS5hZGRfcGFyc2VfYWN0aW9uKGxhbWJkYSB0OiB0WzBdKQoKCgoKCmRlZiBsb2NhdGVkRXhwcihleHByOiBQYXJzZXJFbGVtZW50KSAtPiBQYXJzZXJFbGVtZW50OgoKICAgIFwiXCJcIgoKICAgIChERVBSRUNBVEVEIC0gZnV0dXJlIGNvZGUgc2hvdWxkIHVzZSB0aGUgTG9jYXRlZCBjbGFzcykKCiAgICBIZWxwZXIgdG8gZGVjb3JhdGUgYSByZXR1cm5lZCB0b2tlbiB3aXRoIGl0cyBzdGFydGluZyBhbmQgZW5kaW5nCgogICAgbG9jYXRpb25zIGluIHRoZSBpbnB1dCBzdHJpbmcuCgoKCiAgICBUaGlzIGhlbHBlciBhZGRzIHRoZSBmb2xsb3dpbmcgcmVzdWx0cyBuYW1lczoKCgoKICAgIC0gYGBsb2NuX3N0YXJ0YGAgLSBsb2NhdGlvbiB3aGVyZSBtYXRjaGVkIGV4cHJlc3Npb24gYmVnaW5zCgogICAgLSBgYGxvY25fZW5kYGAgLSBsb2NhdGlvbiB3aGVyZSBtYXRjaGVkIGV4cHJlc3Npb24gZW5kcwoKICAgIC0gYGB2YWx1ZWBgIC0gdGhlIGFjdHVhbCBwYXJzZWQgcmVzdWx0cwoKCgogICAgQmUgY2FyZWZ1bCBpZiB0aGUgaW5wdXQgdGV4dCBjb250YWlucyBgYDxUQUI+YGAgY2hhcmFjdGVycywgeW91CgogICAgbWF5IHdhbnQgdG8gY2FsbCA6Y2xhc3M6YFBhcnNlckVsZW1lbnQucGFyc2VXaXRoVGFic2AKCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgIHdkID0gV29yZChhbHBoYXMpCgogICAgICAgIGZvciBtYXRjaCBpbiBsb2NhdGVkRXhwcih3ZCkuc2VhcmNoU3RyaW5nKFwibGpzZGYxMjNsa3NkampmMTIzbGtramoxMjIyXCIpOgoKICAgICAgICAgICAgcHJpbnQobWF0Y2gpCgoKCiAgICBwcmludHM6OgoKCgogICAgICAgIFtbMCwgJ2xqc2RmJywgNV1dCgogICAgICAgIFtbOCwgJ2xrc2RqamYnLCAxNV1dCgogICAgICAgIFtbMTgsICdsa2tqaicsIDIzXV0KCiAgICBcIlwiXCIKCiAgICBsb2NhdG9yID0gRW1wdHkoKS5zZXRfcGFyc2VfYWN0aW9uKGxhbWJkYSBzcywgbGwsIHR0OiBsbCkKCiAgICByZXR1cm4gR3JvdXAoCgogICAgICAgIGxvY2F0b3IoXCJsb2NuX3N0YXJ0XCIpCgogICAgICAgICsgZXhwcihcInZhbHVlXCIpCgogICAgICAgICsgbG9jYXRvci5jb3B5KCkubGVhdmVXaGl0ZXNwYWNlKCkoXCJsb2NuX2VuZFwiKQoKICAgICkKCgoKCgpkZWYgbmVzdGVkX2V4cHIoCgogICAgb3BlbmVyOiBVbmlvbltzdHIsIFBhcnNlckVsZW1lbnRdID0gXCIoXCIsCgogICAgY2xvc2VyOiBVbmlvbltzdHIsIFBhcnNlckVsZW1lbnRdID0gXCIpXCIsCgogICAgY29udGVudDogdHlwaW5nLk9wdGlvbmFsW1BhcnNlckVsZW1lbnRdID0gTm9uZSwKCiAgICBpZ25vcmVfZXhwcjogUGFyc2VyRWxlbWVudCA9IHF1b3RlZF9zdHJpbmcoKSwKCiAgICAqLAoKICAgIGlnbm9yZUV4cHI6IFBhcnNlckVsZW1lbnQgPSBxdW90ZWRfc3RyaW5nKCksCgopIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgXCJcIlwiSGVscGVyIG1ldGhvZCBmb3IgZGVmaW5pbmcgbmVzdGVkIGxpc3RzIGVuY2xvc2VkIGluIG9wZW5pbmcgYW5kCgogICAgY2xvc2luZyBkZWxpbWl0ZXJzIChgYFwiKFwiYGAgYW5kIGBgXCIpXCJgYCBhcmUgdGhlIGRlZmF1bHQpLgoKCgogICAgUGFyYW1ldGVyczoKCiAgICAtIGBgb3BlbmVyYGAgLSBvcGVuaW5nIGNoYXJhY3RlciBmb3IgYSBuZXN0ZWQgbGlzdAoKICAgICAgKGRlZmF1bHQ9IGBgXCIoXCJgYCk7IGNhbiBhbHNvIGJlIGEgcHlwYXJzaW5nIGV4cHJlc3Npb24KCiAgICAtIGBgY2xvc2VyYGAgLSBjbG9zaW5nIGNoYXJhY3RlciBmb3IgYSBuZXN0ZWQgbGlzdAoKICAgICAgKGRlZmF1bHQ9IGBgXCIpXCJgYCk7IGNhbiBhbHNvIGJlIGEgcHlwYXJzaW5nIGV4cHJlc3Npb24KCiAgICAtIGBgY29udGVudGBgIC0gZXhwcmVzc2lvbiBmb3IgaXRlbXMgd2l0aGluIHRoZSBuZXN0ZWQgbGlzdHMKCiAgICAgIChkZWZhdWx0PSBgYE5vbmVgYCkKCiAgICAtIGBgaWdub3JlX2V4cHJgYCAtIGV4cHJlc3Npb24gZm9yIGlnbm9yaW5nIG9wZW5pbmcgYW5kIGNsb3NpbmcgZGVsaW1pdGVycwoKICAgICAgKGRlZmF1bHQ9IDpjbGFzczpgcXVvdGVkX3N0cmluZ2ApCgogICAgLSBgYGlnbm9yZUV4cHJgYCAtIHRoaXMgcHJlLVBFUDggYXJndW1lbnQgaXMgcmV0YWluZWQgZm9yIGNvbXBhdGliaWxpdHkKCiAgICAgIGJ1dCB3aWxsIGJlIHJlbW92ZWQgaW4gYSBmdXR1cmUgcmVsZWFzZQoKCgogICAgSWYgYW4gZXhwcmVzc2lvbiBpcyBub3QgcHJvdmlkZWQgZm9yIHRoZSBjb250ZW50IGFyZ3VtZW50LCB0aGUKCiAgICBuZXN0ZWQgZXhwcmVzc2lvbiB3aWxsIGNhcHR1cmUgYWxsIHdoaXRlc3BhY2UtZGVsaW1pdGVkIGNvbnRlbnQKCiAgICBiZXR3ZWVuIGRlbGltaXRlcnMgYXMgYSBsaXN0IG9mIHNlcGFyYXRlIHZhbHVlcy4KCgoKICAgIFVzZSB0aGUgYGBpZ25vcmVfZXhwcmBgIGFyZ3VtZW50IHRvIGRlZmluZSBleHByZXNzaW9ucyB0aGF0IG1heQoKICAgIGNvbnRhaW4gb3BlbmluZyBvciBjbG9zaW5nIGNoYXJhY3RlcnMgdGhhdCBzaG91bGQgbm90IGJlIHRyZWF0ZWQgYXMKCiAgICBvcGVuaW5nIG9yIGNsb3NpbmcgY2hhcmFjdGVycyBmb3IgbmVzdGluZywgc3VjaCBhcyBxdW90ZWRfc3RyaW5nIG9yCgogICAgYSBjb21tZW50IGV4cHJlc3Npb24uICBTcGVjaWZ5IG11bHRpcGxlIGV4cHJlc3Npb25zIHVzaW5nIGFuCgogICAgOmNsYXNzOmBPcmAgb3IgOmNsYXNzOmBNYXRjaEZpcnN0YC4gVGhlIGRlZmF1bHQgaXMKCiAgICA6Y2xhc3M6YHF1b3RlZF9zdHJpbmdgLCBidXQgaWYgbm8gZXhwcmVzc2lvbnMgYXJlIHRvIGJlIGlnbm9yZWQsIHRoZW4KCiAgICBwYXNzIGBgTm9uZWBgIGZvciB0aGlzIGFyZ3VtZW50LgoKCgogICAgRXhhbXBsZTo6CgoKCiAgICAgICAgZGF0YV90eXBlID0gb25lX29mKFwidm9pZCBpbnQgc2hvcnQgbG9uZyBjaGFyIGZsb2F0IGRvdWJsZVwiKQoKICAgICAgICBkZWNsX2RhdGFfdHlwZSA9IENvbWJpbmUoZGF0YV90eXBlICsgT3B0KFdvcmQoJyonKSkpCgogICAgICAgIGlkZW50ID0gV29yZChhbHBoYXMrJ18nLCBhbHBoYW51bXMrJ18nKQoKICAgICAgICBudW1iZXIgPSBweXBhcnNpbmdfY29tbW9uLm51bWJlcgoKICAgICAgICBhcmcgPSBHcm91cChkZWNsX2RhdGFfdHlwZSArIGlkZW50KQoKICAgICAgICBMUEFSLCBSUEFSID0gbWFwKFN1cHByZXNzLCBcIigpXCIpCgoKCiAgICAgICAgY29kZV9ib2R5ID0gbmVzdGVkX2V4cHIoJ3snLCAnfScsIGlnbm9yZV9leHByPShxdW90ZWRfc3RyaW5nIHwgY19zdHlsZV9jb21tZW50KSkKCgoKICAgICAgICBjX2Z1bmN0aW9uID0gKGRlY2xfZGF0YV90eXBlKFwidHlwZVwiKQoKICAgICAgICAgICAgICAgICAgICAgICsgaWRlbnQoXCJuYW1lXCIpCgogICAgICAgICAgICAgICAgICAgICAgKyBMUEFSICsgT3B0KGRlbGltaXRlZF9saXN0KGFyZyksIFtdKShcImFyZ3NcIikgKyBSUEFSCgogICAgICAgICAgICAgICAgICAgICAgKyBjb2RlX2JvZHkoXCJib2R5XCIpKQoKICAgICAgICBjX2Z1bmN0aW9uLmlnbm9yZShjX3N0eWxlX2NvbW1lbnQpCgoKCiAgICAgICAgc291cmNlX2NvZGUgPSAnJycKCiAgICAgICAgICAgIGludCBpc19vZGQoaW50IHgpIHsKCiAgICAgICAgICAgICAgICByZXR1cm4gKHglMik7CgogICAgICAgICAgICB9CgoKCiAgICAgICAgICAgIGludCBkZWNfdG9faGV4KGNoYXIgaGNoYXIpIHsKCiAgICAgICAgICAgICAgICBpZiAoaGNoYXIgPj0gJzAnICYmIGhjaGFyIDw9ICc5JykgewoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKG9yZChoY2hhciktb3JkKCcwJykpOwoKICAgICAgICAgICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiAoMTArb3JkKGhjaGFyKS1vcmQoJ0EnKSk7CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfQoKICAgICAgICAnJycKCiAgICAgICAgZm9yIGZ1bmMgaW4gY19mdW5jdGlvbi5zZWFyY2hfc3RyaW5nKHNvdXJjZV9jb2RlKToKCiAgICAgICAgICAgIHByaW50KFwiJShuYW1lKXMgKCUodHlwZSlzKSBhcmdzOiAlKGFyZ3Mpc1wiICUgZnVuYykKCgoKCgogICAgcHJpbnRzOjoKCgoKICAgICAgICBpc19vZGQgKGludCkgYXJnczogW1snaW50JywgJ3gnXV0KCiAgICAgICAgZGVjX3RvX2hleCAoaW50KSBhcmdzOiBbWydjaGFyJywgJ2hjaGFyJ11dCgogICAgXCJcIlwiCgogICAgaWYgaWdub3JlRXhwciAhPSBpZ25vcmVfZXhwcjoKCiAgICAgICAgaWdub3JlRXhwciA9IGlnbm9yZV9leHByIGlmIGlnbm9yZUV4cHIgPT0gcXVvdGVkX3N0cmluZygpIGVsc2UgaWdub3JlRXhwcgoKICAgIGlmIG9wZW5lciA9PSBjbG9zZXI6CgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoXCJvcGVuaW5nIGFuZCBjbG9zaW5nIHN0cmluZ3MgY2Fubm90IGJlIHRoZSBzYW1lXCIpCgogICAgaWYgY29udGVudCBpcyBOb25lOgoKICAgICAgICBpZiBpc2luc3RhbmNlKG9wZW5lciwgc3RyX3R5cGUpIGFuZCBpc2luc3RhbmNlKGNsb3Nlciwgc3RyX3R5cGUpOgoKICAgICAgICAgICAgaWYgbGVuKG9wZW5lcikgPT0gMSBhbmQgbGVuKGNsb3NlcikgPT0gMToKCiAgICAgICAgICAgICAgICBpZiBpZ25vcmVFeHByIGlzIG5vdCBOb25lOgoKICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gQ29tYmluZSgKCiAgICAgICAgICAgICAgICAgICAgICAgIE9uZU9yTW9yZSgKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB+aWdub3JlRXhwcgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgQ2hhcnNOb3RJbigKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyICsgY2xvc2VyICsgUGFyc2VyRWxlbWVudC5ERUZBVUxUX1dISVRFX0NIQVJTLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGFjdD0xLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgKS5zZXRfcGFyc2VfYWN0aW9uKGxhbWJkYSB0OiB0WzBdLnN0cmlwKCkpCgogICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IGVtcHR5LmNvcHkoKSArIENoYXJzTm90SW4oCgogICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgKyBjbG9zZXIgKyBQYXJzZXJFbGVtZW50LkRFRkFVTFRfV0hJVEVfQ0hBUlMKCiAgICAgICAgICAgICAgICAgICAgKS5zZXRfcGFyc2VfYWN0aW9uKGxhbWJkYSB0OiB0WzBdLnN0cmlwKCkpCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIGlmIGlnbm9yZUV4cHIgaXMgbm90IE5vbmU6CgogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBDb21iaW5lKAoKICAgICAgICAgICAgICAgICAgICAgICAgT25lT3JNb3JlKAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH5pZ25vcmVFeHByCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB+TGl0ZXJhbChvcGVuZXIpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB+TGl0ZXJhbChjbG9zZXIpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBDaGFyc05vdEluKFBhcnNlckVsZW1lbnQuREVGQVVMVF9XSElURV9DSEFSUywgZXhhY3Q9MSkKCiAgICAgICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgKS5zZXRfcGFyc2VfYWN0aW9uKGxhbWJkYSB0OiB0WzBdLnN0cmlwKCkpCgogICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IENvbWJpbmUoCgogICAgICAgICAgICAgICAgICAgICAgICBPbmVPck1vcmUoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfkxpdGVyYWwob3BlbmVyKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgfkxpdGVyYWwoY2xvc2VyKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgQ2hhcnNOb3RJbihQYXJzZXJFbGVtZW50LkRFRkFVTFRfV0hJVEVfQ0hBUlMsIGV4YWN0PTEpCgogICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgICkuc2V0X3BhcnNlX2FjdGlvbihsYW1iZGEgdDogdFswXS5zdHJpcCgpKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKCiAgICAgICAgICAgICAgICBcIm9wZW5pbmcgYW5kIGNsb3NpbmcgYXJndW1lbnRzIG11c3QgYmUgc3RyaW5ncyBpZiBubyBjb250ZW50IGV4cHJlc3Npb24gaXMgZ2l2ZW5cIgoKICAgICAgICAgICAgKQoKICAgIHJldCA9IEZvcndhcmQoKQoKICAgIGlmIGlnbm9yZUV4cHIgaXMgbm90IE5vbmU6CgogICAgICAgIHJldCA8PD0gR3JvdXAoCgogICAgICAgICAgICBTdXBwcmVzcyhvcGVuZXIpICsgWmVyb09yTW9yZShpZ25vcmVFeHByIHwgcmV0IHwgY29udGVudCkgKyBTdXBwcmVzcyhjbG9zZXIpCgogICAgICAgICkKCiAgICBlbHNlOgoKICAgICAgICByZXQgPDw9IEdyb3VwKFN1cHByZXNzKG9wZW5lcikgKyBaZXJvT3JNb3JlKHJldCB8IGNvbnRlbnQpICsgU3VwcHJlc3MoY2xvc2VyKSkKCiAgICByZXQuc2V0X25hbWUoXCJuZXN0ZWQgJXMlcyBleHByZXNzaW9uXCIgJSAob3BlbmVyLCBjbG9zZXIpKQoKICAgIHJldHVybiByZXQKCgoKCgpkZWYgX21ha2VUYWdzKHRhZ1N0ciwgeG1sLCBzdXBwcmVzc19MVD1TdXBwcmVzcyhcIjxcIiksIHN1cHByZXNzX0dUPVN1cHByZXNzKFwiPlwiKSk6CgogICAgXCJcIlwiSW50ZXJuYWwgaGVscGVyIHRvIGNvbnN0cnVjdCBvcGVuaW5nIGFuZCBjbG9zaW5nIHRhZyBleHByZXNzaW9ucywgZ2l2ZW4gYSB0YWcgbmFtZVwiXCJcIgoKICAgIGlmIGlzaW5zdGFuY2UodGFnU3RyLCBzdHJfdHlwZSk6CgogICAgICAgIHJlc25hbWUgPSB0YWdTdHIKCiAgICAgICAgdGFnU3RyID0gS2V5d29yZCh0YWdTdHIsIGNhc2VsZXNzPW5vdCB4bWwpCgogICAgZWxzZToKCiAgICAgICAgcmVzbmFtZSA9IHRhZ1N0ci5uYW1lCgoKCiAgICB0YWdBdHRyTmFtZSA9IFdvcmQoYWxwaGFzLCBhbHBoYW51bXMgKyBcIl8tOlwiKQoKICAgIGlmIHhtbDoKCiAgICAgICAgdGFnQXR0clZhbHVlID0gZGJsX3F1b3RlZF9zdHJpbmcuY29weSgpLnNldF9wYXJzZV9hY3Rpb24ocmVtb3ZlX3F1b3RlcykKCiAgICAgICAgb3BlblRhZyA9ICgKCiAgICAgICAgICAgIHN1cHByZXNzX0xUCgogICAgICAgICAgICArIHRhZ1N0cihcInRhZ1wiKQoKICAgICAgICAgICAgKyBEaWN0KFplcm9Pck1vcmUoR3JvdXAodGFnQXR0ck5hbWUgKyBTdXBwcmVzcyhcIj1cIikgKyB0YWdBdHRyVmFsdWUpKSkKCiAgICAgICAgICAgICsgT3B0KFwiL1wiLCBkZWZhdWx0PVtGYWxzZV0pKFwiZW1wdHlcIikuc2V0X3BhcnNlX2FjdGlvbigKCiAgICAgICAgICAgICAgICBsYW1iZGEgcywgbCwgdDogdFswXSA9PSBcIi9cIgoKICAgICAgICAgICAgKQoKICAgICAgICAgICAgKyBzdXBwcmVzc19HVAoKICAgICAgICApCgogICAgZWxzZToKCiAgICAgICAgdGFnQXR0clZhbHVlID0gcXVvdGVkX3N0cmluZy5jb3B5KCkuc2V0X3BhcnNlX2FjdGlvbihyZW1vdmVfcXVvdGVzKSB8IFdvcmQoCgogICAgICAgICAgICBwcmludGFibGVzLCBleGNsdWRlX2NoYXJzPVwiPlwiCgogICAgICAgICkKCiAgICAgICAgb3BlblRhZyA9ICgKCiAgICAgICAgICAgIHN1cHByZXNzX0xUCgogICAgICAgICAgICArIHRhZ1N0cihcInRhZ1wiKQoKICAgICAgICAgICAgKyBEaWN0KAoKICAgICAgICAgICAgICAgIFplcm9Pck1vcmUoCgogICAgICAgICAgICAgICAgICAgIEdyb3VwKAoKICAgICAgICAgICAgICAgICAgICAgICAgdGFnQXR0ck5hbWUuc2V0X3BhcnNlX2FjdGlvbihsYW1iZGEgdDogdFswXS5sb3dlcigpKQoKICAgICAgICAgICAgICAgICAgICAgICAgKyBPcHQoU3VwcHJlc3MoXCI9XCIpICsgdGFnQXR0clZhbHVlKQoKICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgKQoKICAgICAgICAgICAgKyBPcHQoXCIvXCIsIGRlZmF1bHQ9W0ZhbHNlXSkoXCJlbXB0eVwiKS5zZXRfcGFyc2VfYWN0aW9uKAoKICAgICAgICAgICAgICAgIGxhbWJkYSBzLCBsLCB0OiB0WzBdID09IFwiL1wiCgogICAgICAgICAgICApCgogICAgICAgICAgICArIHN1cHByZXNzX0dUCgogICAgICAgICkKCiAgICBjbG9zZVRhZyA9IENvbWJpbmUoTGl0ZXJhbChcIjwvXCIpICsgdGFnU3RyICsgXCI+XCIsIGFkamFjZW50PUZhbHNlKQoKCgogICAgb3BlblRhZy5zZXRfbmFtZShcIjwlcz5cIiAlIHJlc25hbWUpCgogICAgIyBhZGQgc3RhcnQ8dGFnbmFtZT4gcmVzdWx0cyBuYW1lIGluIHBhcnNlIGFjdGlvbiBub3cgdGhhdCB1bmdyb3VwZWQgbmFtZXMgYXJlIG5vdCByZXBvcnRlZCBhdCB0d28gbGV2ZWxzCgogICAgb3BlblRhZy5hZGRfcGFyc2VfYWN0aW9uKAoKICAgICAgICBsYW1iZGEgdDogdC5fX3NldGl0ZW1fXygKCiAgICAgICAgICAgIFwic3RhcnRcIiArIFwiXCIuam9pbihyZXNuYW1lLnJlcGxhY2UoXCI6XCIsIFwiIFwiKS50aXRsZSgpLnNwbGl0KCkpLCB0LmNvcHkoKQoKICAgICAgICApCgogICAgKQoKICAgIGNsb3NlVGFnID0gY2xvc2VUYWcoCgogICAgICAgIFwiZW5kXCIgKyBcIlwiLmpvaW4ocmVzbmFtZS5yZXBsYWNlKFwiOlwiLCBcIiBcIikudGl0bGUoKS5zcGxpdCgpKQoKICAgICkuc2V0X25hbWUoXCI8LyVzPlwiICUgcmVzbmFtZSkKCiAgICBvcGVuVGFnLnRhZyA9IHJlc25hbWUKCiAgICBjbG9zZVRhZy50YWcgPSByZXNuYW1lCgogICAgb3BlblRhZy50YWdfYm9keSA9IFNraXBUbyhjbG9zZVRhZygpKQoKICAgIHJldHVybiBvcGVuVGFnLCBjbG9zZVRhZwoKCgoKCmRlZiBtYWtlX2h0bWxfdGFncygKCiAgICB0YWdfc3RyOiBVbmlvbltzdHIsIFBhcnNlckVsZW1lbnRdCgopIC0+IFR1cGxlW1BhcnNlckVsZW1lbnQsIFBhcnNlckVsZW1lbnRdOgoKICAgIFwiXCJcIkhlbHBlciB0byBjb25zdHJ1Y3Qgb3BlbmluZyBhbmQgY2xvc2luZyB0YWcgZXhwcmVzc2lvbnMgZm9yIEhUTUwsCgogICAgZ2l2ZW4gYSB0YWcgbmFtZS4gTWF0Y2hlcyB0YWdzIGluIGVpdGhlciB1cHBlciBvciBsb3dlciBjYXNlLAoKICAgIGF0dHJpYnV0ZXMgd2l0aCBuYW1lc3BhY2VzIGFuZCB3aXRoIHF1b3RlZCBvciB1bnF1b3RlZCB2YWx1ZXMuCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICB0ZXh0ID0gJzx0ZD5Nb3JlIGluZm8gYXQgdGhlIDxhIGhyZWY9XCJodHRwczovL2dpdGh1Yi5jb20vcHlwYXJzaW5nL3B5cGFyc2luZy93aWtpXCI+cHlwYXJzaW5nPC9hPiB3aWtpIHBhZ2U8L3RkPicKCiAgICAgICAgIyBtYWtlX2h0bWxfdGFncyByZXR1cm5zIHB5cGFyc2luZyBleHByZXNzaW9ucyBmb3IgdGhlIG9wZW5pbmcgYW5kCgogICAgICAgICMgY2xvc2luZyB0YWdzIGFzIGEgMi10dXBsZQoKICAgICAgICBhLCBhX2VuZCA9IG1ha2VfaHRtbF90YWdzKFwiQVwiKQoKICAgICAgICBsaW5rX2V4cHIgPSBhICsgU2tpcFRvKGFfZW5kKShcImxpbmtfdGV4dFwiKSArIGFfZW5kCgoKCiAgICAgICAgZm9yIGxpbmsgaW4gbGlua19leHByLnNlYXJjaF9zdHJpbmcodGV4dCk6CgogICAgICAgICAgICAjIGF0dHJpYnV0ZXMgaW4gdGhlIDxBPiB0YWcgKGxpa2UgXCJocmVmXCIgc2hvd24gaGVyZSkgYXJlCgogICAgICAgICAgICAjIGFsc28gYWNjZXNzaWJsZSBhcyBuYW1lZCByZXN1bHRzCgogICAgICAgICAgICBwcmludChsaW5rLmxpbmtfdGV4dCwgJy0+JywgbGluay5ocmVmKQoKCgogICAgcHJpbnRzOjoKCgoKICAgICAgICBweXBhcnNpbmcgLT4gaHR0cHM6Ly9naXRodWIuY29tL3B5cGFyc2luZy9weXBhcnNpbmcvd2lraQoKICAgIFwiXCJcIgoKICAgIHJldHVybiBfbWFrZVRhZ3ModGFnX3N0ciwgRmFsc2UpCgoKCgoKZGVmIG1ha2VfeG1sX3RhZ3MoCgogICAgdGFnX3N0cjogVW5pb25bc3RyLCBQYXJzZXJFbGVtZW50XQoKKSAtPiBUdXBsZVtQYXJzZXJFbGVtZW50LCBQYXJzZXJFbGVtZW50XToKCiAgICBcIlwiXCJIZWxwZXIgdG8gY29uc3RydWN0IG9wZW5pbmcgYW5kIGNsb3NpbmcgdGFnIGV4cHJlc3Npb25zIGZvciBYTUwsCgogICAgZ2l2ZW4gYSB0YWcgbmFtZS4gTWF0Y2hlcyB0YWdzIG9ubHkgaW4gdGhlIGdpdmVuIHVwcGVyL2xvd2VyIGNhc2UuCgoKCiAgICBFeGFtcGxlOiBzaW1pbGFyIHRvIDpjbGFzczpgbWFrZV9odG1sX3RhZ3NgCgogICAgXCJcIlwiCgogICAgcmV0dXJuIF9tYWtlVGFncyh0YWdfc3RyLCBUcnVlKQoKCgoKCmFueV9vcGVuX3RhZzogUGFyc2VyRWxlbWVudAoKYW55X2Nsb3NlX3RhZzogUGFyc2VyRWxlbWVudAoKYW55X29wZW5fdGFnLCBhbnlfY2xvc2VfdGFnID0gbWFrZV9odG1sX3RhZ3MoCgogICAgV29yZChhbHBoYXMsIGFscGhhbnVtcyArIFwiXzpcIikuc2V0X25hbWUoXCJhbnkgdGFnXCIpCgopCgoKCl9odG1sRW50aXR5TWFwID0ge2sucnN0cmlwKFwiO1wiKTogdiBmb3IgaywgdiBpbiBodG1sLmVudGl0aWVzLmh0bWw1Lml0ZW1zKCl9Cgpjb21tb25faHRtbF9lbnRpdHkgPSBSZWdleChcIiYoP1A8ZW50aXR5PlwiICsgXCJ8XCIuam9pbihfaHRtbEVudGl0eU1hcCkgKyBcIik7XCIpLnNldF9uYW1lKAoKICAgIFwiY29tbW9uIEhUTUwgZW50aXR5XCIKCikKCgoKCgpkZWYgcmVwbGFjZV9odG1sX2VudGl0eSh0KToKCiAgICBcIlwiXCJIZWxwZXIgcGFyc2VyIGFjdGlvbiB0byByZXBsYWNlIGNvbW1vbiBIVE1MIGVudGl0aWVzIHdpdGggdGhlaXIgc3BlY2lhbCBjaGFyYWN0ZXJzXCJcIlwiCgogICAgcmV0dXJuIF9odG1sRW50aXR5TWFwLmdldCh0LmVudGl0eSkKCgoKCgpjbGFzcyBPcEFzc29jKEVudW0pOgoKICAgIExFRlQgPSAxCgogICAgUklHSFQgPSAyCgoKCgoKSW5maXhOb3RhdGlvbk9wZXJhdG9yQXJnVHlwZSA9IFVuaW9uWwoKICAgIFBhcnNlckVsZW1lbnQsIHN0ciwgVHVwbGVbVW5pb25bUGFyc2VyRWxlbWVudCwgc3RyXSwgVW5pb25bUGFyc2VyRWxlbWVudCwgc3RyXV0KCl0KCkluZml4Tm90YXRpb25PcGVyYXRvclNwZWMgPSBVbmlvblsKCiAgICBUdXBsZVsKCiAgICAgICAgSW5maXhOb3RhdGlvbk9wZXJhdG9yQXJnVHlwZSwKCiAgICAgICAgaW50LAoKICAgICAgICBPcEFzc29jLAoKICAgICAgICB0eXBpbmcuT3B0aW9uYWxbUGFyc2VBY3Rpb25dLAoKICAgIF0sCgogICAgVHVwbGVbCgogICAgICAgIEluZml4Tm90YXRpb25PcGVyYXRvckFyZ1R5cGUsCgogICAgICAgIGludCwKCiAgICAgICAgT3BBc3NvYywKCiAgICBdLAoKXQoKCgoKCmRlZiBpbmZpeF9ub3RhdGlvbigKCiAgICBiYXNlX2V4cHI6IFBhcnNlckVsZW1lbnQsCgogICAgb3BfbGlzdDogTGlzdFtJbmZpeE5vdGF0aW9uT3BlcmF0b3JTcGVjXSwKCiAgICBscGFyOiBVbmlvbltzdHIsIFBhcnNlckVsZW1lbnRdID0gU3VwcHJlc3MoXCIoXCIpLAoKICAgIHJwYXI6IFVuaW9uW3N0ciwgUGFyc2VyRWxlbWVudF0gPSBTdXBwcmVzcyhcIilcIiksCgopIC0+IFBhcnNlckVsZW1lbnQ6CgogICAgXCJcIlwiSGVscGVyIG1ldGhvZCBmb3IgY29uc3RydWN0aW5nIGdyYW1tYXJzIG9mIGV4cHJlc3Npb25zIG1hZGUgdXAgb2YKCiAgICBvcGVyYXRvcnMgd29ya2luZyBpbiBhIHByZWNlZGVuY2UgaGllcmFyY2h5LiAgT3BlcmF0b3JzIG1heSBiZSB1bmFyeQoKICAgIG9yIGJpbmFyeSwgbGVmdC0gb3IgcmlnaHQtYXNzb2NpYXRpdmUuICBQYXJzZSBhY3Rpb25zIGNhbiBhbHNvIGJlCgogICAgYXR0YWNoZWQgdG8gb3BlcmF0b3IgZXhwcmVzc2lvbnMuIFRoZSBnZW5lcmF0ZWQgcGFyc2VyIHdpbGwgYWxzbwoKICAgIHJlY29nbml6ZSB0aGUgdXNlIG9mIHBhcmVudGhlc2VzIHRvIG92ZXJyaWRlIG9wZXJhdG9yIHByZWNlZGVuY2VzCgogICAgKHNlZSBleGFtcGxlIGJlbG93KS4KCgoKICAgIE5vdGU6IGlmIHlvdSBkZWZpbmUgYSBkZWVwIG9wZXJhdG9yIGxpc3QsIHlvdSBtYXkgc2VlIHBlcmZvcm1hbmNlCgogICAgaXNzdWVzIHdoZW4gdXNpbmcgaW5maXhfbm90YXRpb24uIFNlZQoKICAgIDpjbGFzczpgUGFyc2VyRWxlbWVudC5lbmFibGVfcGFja3JhdGAgZm9yIGEgbWVjaGFuaXNtIHRvIHBvdGVudGlhbGx5CgogICAgaW1wcm92ZSB5b3VyIHBhcnNlciBwZXJmb3JtYW5jZS4KCgoKICAgIFBhcmFtZXRlcnM6CgogICAgLSBgYGJhc2VfZXhwcmBgIC0gZXhwcmVzc2lvbiByZXByZXNlbnRpbmcgdGhlIG1vc3QgYmFzaWMgb3BlcmFuZCB0bwoKICAgICAgYmUgdXNlZCBpbiB0aGUgZXhwcmVzc2lvbgoKICAgIC0gYGBvcF9saXN0YGAgLSBsaXN0IG9mIHR1cGxlcywgb25lIGZvciBlYWNoIG9wZXJhdG9yIHByZWNlZGVuY2UgbGV2ZWwKCiAgICAgIGluIHRoZSBleHByZXNzaW9uIGdyYW1tYXI7IGVhY2ggdHVwbGUgaXMgb2YgdGhlIGZvcm0gYGAob3BfZXhwciwKCiAgICAgIG51bV9vcGVyYW5kcywgcmlnaHRfbGVmdF9hc3NvYywgKG9wdGlvbmFsKXBhcnNlX2FjdGlvbilgYCwgd2hlcmU6CgoKCiAgICAgIC0gYGBvcF9leHByYGAgaXMgdGhlIHB5cGFyc2luZyBleHByZXNzaW9uIGZvciB0aGUgb3BlcmF0b3I7IG1heSBhbHNvCgogICAgICAgIGJlIGEgc3RyaW5nLCB3aGljaCB3aWxsIGJlIGNvbnZlcnRlZCB0byBhIExpdGVyYWw7IGlmIGBgbnVtX29wZXJhbmRzYGAKCiAgICAgICAgaXMgMywgYGBvcF9leHByYGAgaXMgYSB0dXBsZSBvZiB0d28gZXhwcmVzc2lvbnMsIGZvciB0aGUgdHdvCgogICAgICAgIG9wZXJhdG9ycyBzZXBhcmF0aW5nIHRoZSAzIHRlcm1zCgogICAgICAtIGBgbnVtX29wZXJhbmRzYGAgaXMgdGhlIG51bWJlciBvZiB0ZXJtcyBmb3IgdGhpcyBvcGVyYXRvciAobXVzdCBiZSAxLAoKICAgICAgICAyLCBvciAzKQoKICAgICAgLSBgYHJpZ2h0X2xlZnRfYXNzb2NgYCBpcyB0aGUgaW5kaWNhdG9yIHdoZXRoZXIgdGhlIG9wZXJhdG9yIGlzIHJpZ2h0CgogICAgICAgIG9yIGxlZnQgYXNzb2NpYXRpdmUsIHVzaW5nIHRoZSBweXBhcnNpbmctZGVmaW5lZCBjb25zdGFudHMKCiAgICAgICAgYGBPcEFzc29jLlJJR0hUYGAgYW5kIGBgT3BBc3NvYy5MRUZUYGAuCgogICAgICAtIGBgcGFyc2VfYWN0aW9uYGAgaXMgdGhlIHBhcnNlIGFjdGlvbiB0byBiZSBhc3NvY2lhdGVkIHdpdGgKCiAgICAgICAgZXhwcmVzc2lvbnMgbWF0Y2hpbmcgdGhpcyBvcGVyYXRvciBleHByZXNzaW9uICh0aGUgcGFyc2UgYWN0aW9uCgogICAgICAgIHR1cGxlIG1lbWJlciBtYXkgYmUgb21pdHRlZCk7IGlmIHRoZSBwYXJzZSBhY3Rpb24gaXMgcGFzc2VkCgogICAgICAgIGEgdHVwbGUgb3IgbGlzdCBvZiBmdW5jdGlvbnMsIHRoaXMgaXMgZXF1aXZhbGVudCB0byBjYWxsaW5nCgogICAgICAgIGBgc2V0X3BhcnNlX2FjdGlvbigqZm4pYGAKCiAgICAgICAgKDpjbGFzczpgUGFyc2VyRWxlbWVudC5zZXRfcGFyc2VfYWN0aW9uYCkKCiAgICAtIGBgbHBhcmBgIC0gZXhwcmVzc2lvbiBmb3IgbWF0Y2hpbmcgbGVmdC1wYXJlbnRoZXNlczsgaWYgcGFzc2VkIGFzIGEKCiAgICAgIHN0ciwgdGhlbiB3aWxsIGJlIHBhcnNlZCBhcyBTdXBwcmVzcyhscGFyKS4gSWYgbHBhciBpcyBwYXNzZWQgYXMKCiAgICAgIGFuIGV4cHJlc3Npb24gKHN1Y2ggYXMgYGBMaXRlcmFsKCcoJylgYCksIHRoZW4gaXQgd2lsbCBiZSBrZXB0IGluCgogICAgICB0aGUgcGFyc2VkIHJlc3VsdHMsIGFuZCBncm91cGVkIHdpdGggdGhlbS4gKGRlZmF1bHQ9IGBgU3VwcHJlc3MoJygnKWBgKQoKICAgIC0gYGBycGFyYGAgLSBleHByZXNzaW9uIGZvciBtYXRjaGluZyByaWdodC1wYXJlbnRoZXNlczsgaWYgcGFzc2VkIGFzIGEKCiAgICAgIHN0ciwgdGhlbiB3aWxsIGJlIHBhcnNlZCBhcyBTdXBwcmVzcyhycGFyKS4gSWYgcnBhciBpcyBwYXNzZWQgYXMKCiAgICAgIGFuIGV4cHJlc3Npb24gKHN1Y2ggYXMgYGBMaXRlcmFsKCcpJylgYCksIHRoZW4gaXQgd2lsbCBiZSBrZXB0IGluCgogICAgICB0aGUgcGFyc2VkIHJlc3VsdHMsIGFuZCBncm91cGVkIHdpdGggdGhlbS4gKGRlZmF1bHQ9IGBgU3VwcHJlc3MoJyknKWBgKQoKCgogICAgRXhhbXBsZTo6CgoKCiAgICAgICAgIyBzaW1wbGUgZXhhbXBsZSBvZiBmb3VyLWZ1bmN0aW9uIGFyaXRobWV0aWMgd2l0aCBpbnRzIGFuZAoKICAgICAgICAjIHZhcmlhYmxlIG5hbWVzCgogICAgICAgIGludGVnZXIgPSBweXBhcnNpbmdfY29tbW9uLnNpZ25lZF9pbnRlZ2VyCgogICAgICAgIHZhcm5hbWUgPSBweXBhcnNpbmdfY29tbW9uLmlkZW50aWZpZXIKCgoKICAgICAgICBhcml0aF9leHByID0gaW5maXhfbm90YXRpb24oaW50ZWdlciB8IHZhcm5hbWUsCgogICAgICAgICAgICBbCgogICAgICAgICAgICAoJy0nLCAxLCBPcEFzc29jLlJJR0hUKSwKCiAgICAgICAgICAgIChvbmVfb2YoJyogLycpLCAyLCBPcEFzc29jLkxFRlQpLAoKICAgICAgICAgICAgKG9uZV9vZignKyAtJyksIDIsIE9wQXNzb2MuTEVGVCksCgogICAgICAgICAgICBdKQoKCgogICAgICAgIGFyaXRoX2V4cHIucnVuX3Rlc3RzKCcnJwoKICAgICAgICAgICAgNSszKjYKCiAgICAgICAgICAgICg1KzMpKjYKCiAgICAgICAgICAgIC0yLS0xMQoKICAgICAgICAgICAgJycnLCBmdWxsX2R1bXA9RmFsc2UpCgoKCiAgICBwcmludHM6OgoKCgogICAgICAgIDUrMyo2CgogICAgICAgIFtbNSwgJysnLCBbMywgJyonLCA2XV1dCgoKCiAgICAgICAgKDUrMykqNgoKICAgICAgICBbW1s1LCAnKycsIDNdLCAnKicsIDZdXQoKCgogICAgICAgIC0yLS0xMQoKICAgICAgICBbW1snLScsIDJdLCAnLScsIFsnLScsIDExXV1dCgogICAgXCJcIlwiCgogICAgIyBjYXB0aXZlIHZlcnNpb24gb2YgRm9sbG93ZWRCeSB0aGF0IGRvZXMgbm90IGRvIHBhcnNlIGFjdGlvbnMgb3IgY2FwdHVyZSByZXN1bHRzIG5hbWVzCgogICAgY2xhc3MgX0ZCKEZvbGxvd2VkQnkpOgoKICAgICAgICBkZWYgcGFyc2VJbXBsKHNlbGYsIGluc3RyaW5nLCBsb2MsIGRvQWN0aW9ucz1UcnVlKToKCiAgICAgICAgICAgIHNlbGYuZXhwci50cnlfcGFyc2UoaW5zdHJpbmcsIGxvYykKCiAgICAgICAgICAgIHJldHVybiBsb2MsIFtdCgoKCiAgICBfRkIuX19uYW1lX18gPSBcIkZvbGxvd2VkQnk+XCIKCgoKICAgIHJldCA9IEZvcndhcmQoKQoKICAgIGlmIGlzaW5zdGFuY2UobHBhciwgc3RyKToKCiAgICAgICAgbHBhciA9IFN1cHByZXNzKGxwYXIpCgogICAgaWYgaXNpbnN0YW5jZShycGFyLCBzdHIpOgoKICAgICAgICBycGFyID0gU3VwcHJlc3MocnBhcikKCgoKICAgICMgaWYgbHBhciBhbmQgcnBhciBhcmUgbm90IHN1cHByZXNzZWQsIHdyYXAgaW4gZ3JvdXAKCiAgICBpZiBub3QgKGlzaW5zdGFuY2UocnBhciwgU3VwcHJlc3MpIGFuZCBpc2luc3RhbmNlKHJwYXIsIFN1cHByZXNzKSk6CgogICAgICAgIGxhc3RFeHByID0gYmFzZV9leHByIHwgR3JvdXAobHBhciArIHJldCArIHJwYXIpCgogICAgZWxzZToKCiAgICAgICAgbGFzdEV4cHIgPSBiYXNlX2V4cHIgfCAobHBhciArIHJldCArIHJwYXIpCgoKCiAgICBmb3IgaSwgb3BlckRlZiBpbiBlbnVtZXJhdGUob3BfbGlzdCk6CgogICAgICAgIG9wRXhwciwgYXJpdHksIHJpZ2h0TGVmdEFzc29jLCBwYSA9IChvcGVyRGVmICsgKE5vbmUsKSlbOjRdCgogICAgICAgIGlmIGlzaW5zdGFuY2Uob3BFeHByLCBzdHJfdHlwZSk6CgogICAgICAgICAgICBvcEV4cHIgPSBQYXJzZXJFbGVtZW50Ll9saXRlcmFsU3RyaW5nQ2xhc3Mob3BFeHByKQoKICAgICAgICBpZiBhcml0eSA9PSAzOgoKICAgICAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uob3BFeHByLCAodHVwbGUsIGxpc3QpKSBvciBsZW4ob3BFeHByKSAhPSAyOgoKICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCgogICAgICAgICAgICAgICAgICAgIFwiaWYgbnVtdGVybXM9Mywgb3BFeHByIG11c3QgYmUgYSB0dXBsZSBvciBsaXN0IG9mIHR3byBleHByZXNzaW9uc1wiCgogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgb3BFeHByMSwgb3BFeHByMiA9IG9wRXhwcgoKICAgICAgICAgICAgdGVybV9uYW1lID0gXCJ7fXt9IHRlcm1cIi5mb3JtYXQob3BFeHByMSwgb3BFeHByMikKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHRlcm1fbmFtZSA9IFwie30gdGVybVwiLmZvcm1hdChvcEV4cHIpCgoKCiAgICAgICAgaWYgbm90IDEgPD0gYXJpdHkgPD0gMzoKCiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoXCJvcGVyYXRvciBtdXN0IGJlIHVuYXJ5ICgxKSwgYmluYXJ5ICgyKSwgb3IgdGVybmFyeSAoMylcIikKCgoKICAgICAgICBpZiByaWdodExlZnRBc3NvYyBub3QgaW4gKE9wQXNzb2MuTEVGVCwgT3BBc3NvYy5SSUdIVCk6CgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKFwib3BlcmF0b3IgbXVzdCBpbmRpY2F0ZSByaWdodCBvciBsZWZ0IGFzc29jaWF0aXZpdHlcIikKCgoKICAgICAgICB0aGlzRXhwcjogRm9yd2FyZCA9IEZvcndhcmQoKS5zZXRfbmFtZSh0ZXJtX25hbWUpCgogICAgICAgIGlmIHJpZ2h0TGVmdEFzc29jIGlzIE9wQXNzb2MuTEVGVDoKCiAgICAgICAgICAgIGlmIGFyaXR5ID09IDE6CgogICAgICAgICAgICAgICAgbWF0Y2hFeHByID0gX0ZCKGxhc3RFeHByICsgb3BFeHByKSArIEdyb3VwKGxhc3RFeHByICsgb3BFeHByWzEsIC4uLl0pCgogICAgICAgICAgICBlbGlmIGFyaXR5ID09IDI6CgogICAgICAgICAgICAgICAgaWYgb3BFeHByIGlzIG5vdCBOb25lOgoKICAgICAgICAgICAgICAgICAgICBtYXRjaEV4cHIgPSBfRkIobGFzdEV4cHIgKyBvcEV4cHIgKyBsYXN0RXhwcikgKyBHcm91cCgKCiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RFeHByICsgKG9wRXhwciArIGxhc3RFeHByKVsxLCAuLi5dCgogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICBtYXRjaEV4cHIgPSBfRkIobGFzdEV4cHIgKyBsYXN0RXhwcikgKyBHcm91cChsYXN0RXhwclsyLCAuLi5dKQoKICAgICAgICAgICAgZWxpZiBhcml0eSA9PSAzOgoKICAgICAgICAgICAgICAgIG1hdGNoRXhwciA9IF9GQigKCiAgICAgICAgICAgICAgICAgICAgbGFzdEV4cHIgKyBvcEV4cHIxICsgbGFzdEV4cHIgKyBvcEV4cHIyICsgbGFzdEV4cHIKCiAgICAgICAgICAgICAgICApICsgR3JvdXAobGFzdEV4cHIgKyBPbmVPck1vcmUob3BFeHByMSArIGxhc3RFeHByICsgb3BFeHByMiArIGxhc3RFeHByKSkKCiAgICAgICAgZWxpZiByaWdodExlZnRBc3NvYyBpcyBPcEFzc29jLlJJR0hUOgoKICAgICAgICAgICAgaWYgYXJpdHkgPT0gMToKCiAgICAgICAgICAgICAgICAjIHRyeSB0byBhdm9pZCBMUiB3aXRoIHRoaXMgZXh0cmEgdGVzdAoKICAgICAgICAgICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG9wRXhwciwgT3B0KToKCiAgICAgICAgICAgICAgICAgICAgb3BFeHByID0gT3B0KG9wRXhwcikKCiAgICAgICAgICAgICAgICBtYXRjaEV4cHIgPSBfRkIob3BFeHByLmV4cHIgKyB0aGlzRXhwcikgKyBHcm91cChvcEV4cHIgKyB0aGlzRXhwcikKCiAgICAgICAgICAgIGVsaWYgYXJpdHkgPT0gMjoKCiAgICAgICAgICAgICAgICBpZiBvcEV4cHIgaXMgbm90IE5vbmU6CgogICAgICAgICAgICAgICAgICAgIG1hdGNoRXhwciA9IF9GQihsYXN0RXhwciArIG9wRXhwciArIHRoaXNFeHByKSArIEdyb3VwKAoKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdEV4cHIgKyAob3BFeHByICsgdGhpc0V4cHIpWzEsIC4uLl0KCiAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgIG1hdGNoRXhwciA9IF9GQihsYXN0RXhwciArIHRoaXNFeHByKSArIEdyb3VwKAoKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdEV4cHIgKyB0aGlzRXhwclsxLCAuLi5dCgogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgIGVsaWYgYXJpdHkgPT0gMzoKCiAgICAgICAgICAgICAgICBtYXRjaEV4cHIgPSBfRkIoCgogICAgICAgICAgICAgICAgICAgIGxhc3RFeHByICsgb3BFeHByMSArIHRoaXNFeHByICsgb3BFeHByMiArIHRoaXNFeHByCgogICAgICAgICAgICAgICAgKSArIEdyb3VwKGxhc3RFeHByICsgb3BFeHByMSArIHRoaXNFeHByICsgb3BFeHByMiArIHRoaXNFeHByKQoKICAgICAgICBpZiBwYToKCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UocGEsICh0dXBsZSwgbGlzdCkpOgoKICAgICAgICAgICAgICAgIG1hdGNoRXhwci5zZXRfcGFyc2VfYWN0aW9uKCpwYSkKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgbWF0Y2hFeHByLnNldF9wYXJzZV9hY3Rpb24ocGEpCgogICAgICAgIHRoaXNFeHByIDw8PSAobWF0Y2hFeHByIHwgbGFzdEV4cHIpLnNldE5hbWUodGVybV9uYW1lKQoKICAgICAgICBsYXN0RXhwciA9IHRoaXNFeHByCgogICAgcmV0IDw8PSBsYXN0RXhwcgoKICAgIHJldHVybiByZXQKCgoKCgpkZWYgaW5kZW50ZWRCbG9jayhibG9ja1N0YXRlbWVudEV4cHIsIGluZGVudFN0YWNrLCBpbmRlbnQ9VHJ1ZSwgYmFja3VwX3N0YWNrcz1bXSk6CgogICAgXCJcIlwiCgogICAgKERFUFJFQ0FURUQgLSB1c2UgSW5kZW50ZWRCbG9jayBjbGFzcyBpbnN0ZWFkKQoKICAgIEhlbHBlciBtZXRob2QgZm9yIGRlZmluaW5nIHNwYWNlLWRlbGltaXRlZCBpbmRlbnRhdGlvbiBibG9ja3MsCgogICAgc3VjaCBhcyB0aG9zZSB1c2VkIHRvIGRlZmluZSBibG9jayBzdGF0ZW1lbnRzIGluIFB5dGhvbiBzb3VyY2UgY29kZS4KCgoKICAgIFBhcmFtZXRlcnM6CgoKCiAgICAtIGBgYmxvY2tTdGF0ZW1lbnRFeHByYGAgLSBleHByZXNzaW9uIGRlZmluaW5nIHN5bnRheCBvZiBzdGF0ZW1lbnQgdGhhdAoKICAgICAgaXMgcmVwZWF0ZWQgd2l0aGluIHRoZSBpbmRlbnRlZCBibG9jawoKICAgIC0gYGBpbmRlbnRTdGFja2BgIC0gbGlzdCBjcmVhdGVkIGJ5IGNhbGxlciB0byBtYW5hZ2UgaW5kZW50YXRpb24gc3RhY2sKCiAgICAgIChtdWx0aXBsZSBgYHN0YXRlbWVudFdpdGhJbmRlbnRlZEJsb2NrYGAgZXhwcmVzc2lvbnMgd2l0aGluIGEgc2luZ2xlCgogICAgICBncmFtbWFyIHNob3VsZCBzaGFyZSBhIGNvbW1vbiBgYGluZGVudFN0YWNrYGApCgogICAgLSBgYGluZGVudGBgIC0gYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgYmxvY2sgbXVzdCBiZSBpbmRlbnRlZCBiZXlvbmQKCiAgICAgIHRoZSBjdXJyZW50IGxldmVsOyBzZXQgdG8gYGBGYWxzZWBgIGZvciBibG9jayBvZiBsZWZ0LW1vc3Qgc3RhdGVtZW50cwoKICAgICAgKGRlZmF1bHQ9IGBgVHJ1ZWBgKQoKCgogICAgQSB2YWxpZCBibG9jayBtdXN0IGNvbnRhaW4gYXQgbGVhc3Qgb25lIGBgYmxvY2tTdGF0ZW1lbnRgYC4KCgoKICAgIChOb3RlIHRoYXQgaW5kZW50ZWRCbG9jayB1c2VzIGludGVybmFsIHBhcnNlIGFjdGlvbnMgd2hpY2ggbWFrZSBpdAoKICAgIGluY29tcGF0aWJsZSB3aXRoIHBhY2tyYXQgcGFyc2luZy4pCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICBkYXRhID0gJycnCgogICAgICAgIGRlZiBBKHopOgoKICAgICAgICAgIEExCgogICAgICAgICAgQiA9IDEwMAoKICAgICAgICAgIEcgPSBBMgoKICAgICAgICAgIEEyCgogICAgICAgICAgQTMKCiAgICAgICAgQgoKICAgICAgICBkZWYgQkIoYSxiLGMpOgoKICAgICAgICAgIEJCMQoKICAgICAgICAgIGRlZiBCQkEoKToKCiAgICAgICAgICAgIGJiYTEKCiAgICAgICAgICAgIGJiYTIKCiAgICAgICAgICAgIGJiYTMKCiAgICAgICAgQwoKICAgICAgICBECgogICAgICAgIGRlZiBzcGFtKHgseSk6CgogICAgICAgICAgICAgZGVmIGVnZ3Moeik6CgogICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgJycnCgoKCgoKICAgICAgICBpbmRlbnRTdGFjayA9IFsxXQoKICAgICAgICBzdG10ID0gRm9yd2FyZCgpCgoKCiAgICAgICAgaWRlbnRpZmllciA9IFdvcmQoYWxwaGFzLCBhbHBoYW51bXMpCgogICAgICAgIGZ1bmNEZWNsID0gKFwiZGVmXCIgKyBpZGVudGlmaWVyICsgR3JvdXAoXCIoXCIgKyBPcHQoZGVsaW1pdGVkTGlzdChpZGVudGlmaWVyKSkgKyBcIilcIikgKyBcIjpcIikKCiAgICAgICAgZnVuY19ib2R5ID0gaW5kZW50ZWRCbG9jayhzdG10LCBpbmRlbnRTdGFjaykKCiAgICAgICAgZnVuY0RlZiA9IEdyb3VwKGZ1bmNEZWNsICsgZnVuY19ib2R5KQoKCgogICAgICAgIHJ2YWx1ZSA9IEZvcndhcmQoKQoKICAgICAgICBmdW5jQ2FsbCA9IEdyb3VwKGlkZW50aWZpZXIgKyBcIihcIiArIE9wdChkZWxpbWl0ZWRMaXN0KHJ2YWx1ZSkpICsgXCIpXCIpCgogICAgICAgIHJ2YWx1ZSA8PCAoZnVuY0NhbGwgfCBpZGVudGlmaWVyIHwgV29yZChudW1zKSkKCiAgICAgICAgYXNzaWdubWVudCA9IEdyb3VwKGlkZW50aWZpZXIgKyBcIj1cIiArIHJ2YWx1ZSkKCiAgICAgICAgc3RtdCA8PCAoZnVuY0RlZiB8IGFzc2lnbm1lbnQgfCBpZGVudGlmaWVyKQoKCgogICAgICAgIG1vZHVsZV9ib2R5ID0gc3RtdFsxLCAuLi5dCgoKCiAgICAgICAgcGFyc2VUcmVlID0gbW9kdWxlX2JvZHkucGFyc2VTdHJpbmcoZGF0YSkKCiAgICAgICAgcGFyc2VUcmVlLnBwcmludCgpCgoKCiAgICBwcmludHM6OgoKCgogICAgICAgIFtbJ2RlZicsCgogICAgICAgICAgJ0EnLAoKICAgICAgICAgIFsnKCcsICd6JywgJyknXSwKCiAgICAgICAgICAnOicsCgogICAgICAgICAgW1snQTEnXSwgW1snQicsICc9JywgJzEwMCddXSwgW1snRycsICc9JywgJ0EyJ11dLCBbJ0EyJ10sIFsnQTMnXV1dLAoKICAgICAgICAgJ0InLAoKICAgICAgICAgWydkZWYnLAoKICAgICAgICAgICdCQicsCgogICAgICAgICAgWycoJywgJ2EnLCAnYicsICdjJywgJyknXSwKCiAgICAgICAgICAnOicsCgogICAgICAgICAgW1snQkIxJ10sIFtbJ2RlZicsICdCQkEnLCBbJygnLCAnKSddLCAnOicsIFtbJ2JiYTEnXSwgWydiYmEyJ10sIFsnYmJhMyddXV1dXV0sCgogICAgICAgICAnQycsCgogICAgICAgICAnRCcsCgogICAgICAgICBbJ2RlZicsCgogICAgICAgICAgJ3NwYW0nLAoKICAgICAgICAgIFsnKCcsICd4JywgJ3knLCAnKSddLAoKICAgICAgICAgICc6JywKCiAgICAgICAgICBbW1snZGVmJywgJ2VnZ3MnLCBbJygnLCAneicsICcpJ10sICc6JywgW1sncGFzcyddXV1dXV1dCgogICAgXCJcIlwiCgogICAgYmFja3VwX3N0YWNrcy5hcHBlbmQoaW5kZW50U3RhY2tbOl0pCgoKCiAgICBkZWYgcmVzZXRfc3RhY2soKToKCiAgICAgICAgaW5kZW50U3RhY2tbOl0gPSBiYWNrdXBfc3RhY2tzWy0xXQoKCgogICAgZGVmIGNoZWNrUGVlckluZGVudChzLCBsLCB0KToKCiAgICAgICAgaWYgbCA+PSBsZW4ocyk6CgogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgY3VyQ29sID0gY29sKGwsIHMpCgogICAgICAgIGlmIGN1ckNvbCAhPSBpbmRlbnRTdGFja1stMV06CgogICAgICAgICAgICBpZiBjdXJDb2wgPiBpbmRlbnRTdGFja1stMV06CgogICAgICAgICAgICAgICAgcmFpc2UgUGFyc2VFeGNlcHRpb24ocywgbCwgXCJpbGxlZ2FsIG5lc3RpbmdcIikKCiAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKHMsIGwsIFwibm90IGEgcGVlciBlbnRyeVwiKQoKCgogICAgZGVmIGNoZWNrU3ViSW5kZW50KHMsIGwsIHQpOgoKICAgICAgICBjdXJDb2wgPSBjb2wobCwgcykKCiAgICAgICAgaWYgY3VyQ29sID4gaW5kZW50U3RhY2tbLTFdOgoKICAgICAgICAgICAgaW5kZW50U3RhY2suYXBwZW5kKGN1ckNvbCkKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKHMsIGwsIFwibm90IGEgc3ViZW50cnlcIikKCgoKICAgIGRlZiBjaGVja1VuaW5kZW50KHMsIGwsIHQpOgoKICAgICAgICBpZiBsID49IGxlbihzKToKCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBjdXJDb2wgPSBjb2wobCwgcykKCiAgICAgICAgaWYgbm90IChpbmRlbnRTdGFjayBhbmQgY3VyQ29sIGluIGluZGVudFN0YWNrKToKCiAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKHMsIGwsIFwibm90IGFuIHVuaW5kZW50XCIpCgogICAgICAgIGlmIGN1ckNvbCA8IGluZGVudFN0YWNrWy0xXToKCiAgICAgICAgICAgIGluZGVudFN0YWNrLnBvcCgpCgoKCiAgICBOTCA9IE9uZU9yTW9yZShMaW5lRW5kKCkuc2V0X3doaXRlc3BhY2VfY2hhcnMoXCJcXHQgXCIpLnN1cHByZXNzKCkpCgogICAgSU5ERU5UID0gKEVtcHR5KCkgKyBFbXB0eSgpLnNldF9wYXJzZV9hY3Rpb24oY2hlY2tTdWJJbmRlbnQpKS5zZXRfbmFtZShcIklOREVOVFwiKQoKICAgIFBFRVIgPSBFbXB0eSgpLnNldF9wYXJzZV9hY3Rpb24oY2hlY2tQZWVySW5kZW50KS5zZXRfbmFtZShcIlwiKQoKICAgIFVOREVOVCA9IEVtcHR5KCkuc2V0X3BhcnNlX2FjdGlvbihjaGVja1VuaW5kZW50KS5zZXRfbmFtZShcIlVOSU5ERU5UXCIpCgogICAgaWYgaW5kZW50OgoKICAgICAgICBzbUV4cHIgPSBHcm91cCgKCiAgICAgICAgICAgIE9wdChOTCkKCiAgICAgICAgICAgICsgSU5ERU5UCgogICAgICAgICAgICArIE9uZU9yTW9yZShQRUVSICsgR3JvdXAoYmxvY2tTdGF0ZW1lbnRFeHByKSArIE9wdChOTCkpCgogICAgICAgICAgICArIFVOREVOVAoKICAgICAgICApCgogICAgZWxzZToKCiAgICAgICAgc21FeHByID0gR3JvdXAoCgogICAgICAgICAgICBPcHQoTkwpCgogICAgICAgICAgICArIE9uZU9yTW9yZShQRUVSICsgR3JvdXAoYmxvY2tTdGF0ZW1lbnRFeHByKSArIE9wdChOTCkpCgogICAgICAgICAgICArIE9wdChVTkRFTlQpCgogICAgICAgICkKCgoKICAgICMgYWRkIGEgcGFyc2UgYWN0aW9uIHRvIHJlbW92ZSBiYWNrdXBfc3RhY2sgZnJvbSBsaXN0IG9mIGJhY2t1cHMKCiAgICBzbUV4cHIuYWRkX3BhcnNlX2FjdGlvbigKCiAgICAgICAgbGFtYmRhOiBiYWNrdXBfc3RhY2tzLnBvcCgtMSkgYW5kIE5vbmUgaWYgYmFja3VwX3N0YWNrcyBlbHNlIE5vbmUKCiAgICApCgogICAgc21FeHByLnNldF9mYWlsX2FjdGlvbihsYW1iZGEgYSwgYiwgYywgZDogcmVzZXRfc3RhY2soKSkKCiAgICBibG9ja1N0YXRlbWVudEV4cHIuaWdub3JlKF9ic2xhc2ggKyBMaW5lRW5kKCkpCgogICAgcmV0dXJuIHNtRXhwci5zZXRfbmFtZShcImluZGVudGVkIGJsb2NrXCIpCgoKCgoKIyBpdCdzIGVhc3kgdG8gZ2V0IHRoZXNlIGNvbW1lbnQgc3RydWN0dXJlcyB3cm9uZyAtIHRoZXkncmUgdmVyeSBjb21tb24sIHNvIG1heSBhcyB3ZWxsIG1ha2UgdGhlbSBhdmFpbGFibGUKCmNfc3R5bGVfY29tbWVudCA9IENvbWJpbmUoUmVnZXgoclwiL1xcKig/OlteKl18XFwqKD8hLykpKlwiKSArIFwiKi9cIikuc2V0X25hbWUoCgogICAgXCJDIHN0eWxlIGNvbW1lbnRcIgoKKQoKXCJDb21tZW50IG9mIHRoZSBmb3JtIGBgLyogLi4uICovYGBcIgoKCgpodG1sX2NvbW1lbnQgPSBSZWdleChyXCI8IS0tW1xcc1xcU10qPy0tPlwiKS5zZXRfbmFtZShcIkhUTUwgY29tbWVudFwiKQoKXCJDb21tZW50IG9mIHRoZSBmb3JtIGBgPCEtLSAuLi4gLS0+YGBcIgoKCgpyZXN0X29mX2xpbmUgPSBSZWdleChyXCIuKlwiKS5sZWF2ZV93aGl0ZXNwYWNlKCkuc2V0X25hbWUoXCJyZXN0IG9mIGxpbmVcIikKCmRibF9zbGFzaF9jb21tZW50ID0gUmVnZXgoclwiLy8oPzpcXFxcXFxufFteXFxuXSkqXCIpLnNldF9uYW1lKFwiLy8gY29tbWVudFwiKQoKXCJDb21tZW50IG9mIHRoZSBmb3JtIGBgLy8gLi4uICh0byBlbmQgb2YgbGluZSlgYFwiCgoKCmNwcF9zdHlsZV9jb21tZW50ID0gQ29tYmluZSgKCiAgICBSZWdleChyXCIvXFwqKD86W14qXXxcXCooPyEvKSkqXCIpICsgXCIqL1wiIHwgZGJsX3NsYXNoX2NvbW1lbnQKCikuc2V0X25hbWUoXCJDKysgc3R5bGUgY29tbWVudFwiKQoKXCJDb21tZW50IG9mIGVpdGhlciBmb3JtIDpjbGFzczpgY19zdHlsZV9jb21tZW50YCBvciA6Y2xhc3M6YGRibF9zbGFzaF9jb21tZW50YFwiCgoKCmphdmFfc3R5bGVfY29tbWVudCA9IGNwcF9zdHlsZV9jb21tZW50CgpcIlNhbWUgYXMgOmNsYXNzOmBjcHBfc3R5bGVfY29tbWVudGBcIgoKCgpweXRob25fc3R5bGVfY29tbWVudCA9IFJlZ2V4KHJcIiMuKlwiKS5zZXRfbmFtZShcIlB5dGhvbiBzdHlsZSBjb21tZW50XCIpCgpcIkNvbW1lbnQgb2YgdGhlIGZvcm0gYGAjIC4uLiAodG8gZW5kIG9mIGxpbmUpYGBcIgoKCgoKCiMgYnVpbGQgbGlzdCBvZiBidWlsdC1pbiBleHByZXNzaW9ucywgZm9yIGZ1dHVyZSByZWZlcmVuY2UgaWYgYSBnbG9iYWwgZGVmYXVsdCB2YWx1ZQoKIyBnZXRzIHVwZGF0ZWQKCl9idWlsdGluX2V4cHJzOiBMaXN0W1BhcnNlckVsZW1lbnRdID0gWwoKICAgIHYgZm9yIHYgaW4gdmFycygpLnZhbHVlcygpIGlmIGlzaW5zdGFuY2UodiwgUGFyc2VyRWxlbWVudCkKCl0KCgoKCgojIHByZS1QRVA4IGNvbXBhdGlibGUgbmFtZXMKCmRlbGltaXRlZExpc3QgPSBkZWxpbWl0ZWRfbGlzdAoKY291bnRlZEFycmF5ID0gY291bnRlZF9hcnJheQoKbWF0Y2hQcmV2aW91c0xpdGVyYWwgPSBtYXRjaF9wcmV2aW91c19saXRlcmFsCgptYXRjaFByZXZpb3VzRXhwciA9IG1hdGNoX3ByZXZpb3VzX2V4cHIKCm9uZU9mID0gb25lX29mCgpkaWN0T2YgPSBkaWN0X29mCgpvcmlnaW5hbFRleHRGb3IgPSBvcmlnaW5hbF90ZXh0X2ZvcgoKbmVzdGVkRXhwciA9IG5lc3RlZF9leHByCgptYWtlSFRNTFRhZ3MgPSBtYWtlX2h0bWxfdGFncwoKbWFrZVhNTFRhZ3MgPSBtYWtlX3htbF90YWdzCgphbnlPcGVuVGFnLCBhbnlDbG9zZVRhZyA9IGFueV9vcGVuX3RhZywgYW55X2Nsb3NlX3RhZwoKY29tbW9uSFRNTEVudGl0eSA9IGNvbW1vbl9odG1sX2VudGl0eQoKcmVwbGFjZUhUTUxFbnRpdHkgPSByZXBsYWNlX2h0bWxfZW50aXR5CgpvcEFzc29jID0gT3BBc3NvYwoKaW5maXhOb3RhdGlvbiA9IGluZml4X25vdGF0aW9uCgpjU3R5bGVDb21tZW50ID0gY19zdHlsZV9jb21tZW50CgpodG1sQ29tbWVudCA9IGh0bWxfY29tbWVudAoKcmVzdE9mTGluZSA9IHJlc3Rfb2ZfbGluZQoKZGJsU2xhc2hDb21tZW50ID0gZGJsX3NsYXNoX2NvbW1lbnQKCmNwcFN0eWxlQ29tbWVudCA9IGNwcF9zdHlsZV9jb21tZW50CgpqYXZhU3R5bGVDb21tZW50ID0gamF2YV9zdHlsZV9jb21tZW50CgpweXRob25TdHlsZUNvbW1lbnQgPSBweXRob25fc3R5bGVfY29tbWVudAoKCgoiIiIKCm1vZHVsZV9kaWN0WyJweXBhcnNpbmcvdGVzdGluZy5weSJdPSIiIgoKIyB0ZXN0aW5nLnB5CgoKCmZyb20gY29udGV4dGxpYiBpbXBvcnQgY29udGV4dG1hbmFnZXIKCmltcG9ydCB0eXBpbmcKCgoKZnJvbSAuY29yZSBpbXBvcnQgKAoKICAgIFBhcnNlckVsZW1lbnQsCgogICAgUGFyc2VFeGNlcHRpb24sCgogICAgS2V5d29yZCwKCiAgICBfX2RpYWdfXywKCiAgICBfX2NvbXBhdF9fLAoKKQoKCgoKCmNsYXNzIHB5cGFyc2luZ190ZXN0OgoKICAgIFwiXCJcIgoKICAgIG5hbWVzcGFjZSBjbGFzcyBmb3IgY2xhc3NlcyB1c2VmdWwgaW4gd3JpdGluZyB1bml0IHRlc3RzCgogICAgXCJcIlwiCgoKCiAgICBjbGFzcyByZXNldF9weXBhcnNpbmdfY29udGV4dDoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIENvbnRleHQgbWFuYWdlciB0byBiZSB1c2VkIHdoZW4gd3JpdGluZyB1bml0IHRlc3RzIHRoYXQgbW9kaWZ5IHB5cGFyc2luZyBjb25maWcgdmFsdWVzOgoKICAgICAgICAtIHBhY2tyYXQgcGFyc2luZwoKICAgICAgICAtIGJvdW5kZWQgcmVjdXJzaW9uIHBhcnNpbmcKCiAgICAgICAgLSBkZWZhdWx0IHdoaXRlc3BhY2UgY2hhcmFjdGVycy4KCiAgICAgICAgLSBkZWZhdWx0IGtleXdvcmQgY2hhcmFjdGVycwoKICAgICAgICAtIGxpdGVyYWwgc3RyaW5nIGF1dG8tY29udmVyc2lvbiBjbGFzcwoKICAgICAgICAtIF9fZGlhZ19fIHNldHRpbmdzCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIHdpdGggcmVzZXRfcHlwYXJzaW5nX2NvbnRleHQoKToKCiAgICAgICAgICAgICAgICAjIHRlc3QgdGhhdCBsaXRlcmFscyB1c2VkIHRvIGNvbnN0cnVjdCBhIGdyYW1tYXIgYXJlIGF1dG9tYXRpY2FsbHkgc3VwcHJlc3NlZAoKICAgICAgICAgICAgICAgIFBhcnNlckVsZW1lbnQuaW5saW5lTGl0ZXJhbHNVc2luZyhTdXBwcmVzcykKCgoKICAgICAgICAgICAgICAgIHRlcm0gPSBXb3JkKGFscGhhcykgfCBXb3JkKG51bXMpCgogICAgICAgICAgICAgICAgZ3JvdXAgPSBHcm91cCgnKCcgKyB0ZXJtWy4uLl0gKyAnKScpCgoKCiAgICAgICAgICAgICAgICAjIGFzc2VydCB0aGF0IHRoZSAnKCknIGNoYXJhY3RlcnMgYXJlIG5vdCBpbmNsdWRlZCBpbiB0aGUgcGFyc2VkIHRva2VucwoKICAgICAgICAgICAgICAgIHNlbGYuYXNzZXJ0UGFyc2VBbmRDaGVja0xpc3QoZ3JvdXAsIFwiKGFiYyAxMjMgZGVmKVwiLCBbJ2FiYycsICcxMjMnLCAnZGVmJ10pCgoKCiAgICAgICAgICAgICMgYWZ0ZXIgZXhpdGluZyBjb250ZXh0IG1hbmFnZXIsIGxpdGVyYWxzIGFyZSBjb252ZXJ0ZWQgdG8gTGl0ZXJhbCBleHByZXNzaW9ucyBhZ2FpbgoKICAgICAgICBcIlwiXCIKCgoKICAgICAgICBkZWYgX19pbml0X18oc2VsZik6CgogICAgICAgICAgICBzZWxmLl9zYXZlX2NvbnRleHQgPSB7fQoKCgogICAgICAgIGRlZiBzYXZlKHNlbGYpOgoKICAgICAgICAgICAgc2VsZi5fc2F2ZV9jb250ZXh0W1wiZGVmYXVsdF93aGl0ZXNwYWNlXCJdID0gUGFyc2VyRWxlbWVudC5ERUZBVUxUX1dISVRFX0NIQVJTCgogICAgICAgICAgICBzZWxmLl9zYXZlX2NvbnRleHRbXCJkZWZhdWx0X2tleXdvcmRfY2hhcnNcIl0gPSBLZXl3b3JkLkRFRkFVTFRfS0VZV09SRF9DSEFSUwoKCgogICAgICAgICAgICBzZWxmLl9zYXZlX2NvbnRleHRbCgogICAgICAgICAgICAgICAgXCJsaXRlcmFsX3N0cmluZ19jbGFzc1wiCgogICAgICAgICAgICBdID0gUGFyc2VyRWxlbWVudC5fbGl0ZXJhbFN0cmluZ0NsYXNzCgoKCiAgICAgICAgICAgIHNlbGYuX3NhdmVfY29udGV4dFtcInZlcmJvc2Vfc3RhY2t0cmFjZVwiXSA9IFBhcnNlckVsZW1lbnQudmVyYm9zZV9zdGFja3RyYWNlCgoKCiAgICAgICAgICAgIHNlbGYuX3NhdmVfY29udGV4dFtcInBhY2tyYXRfZW5hYmxlZFwiXSA9IFBhcnNlckVsZW1lbnQuX3BhY2tyYXRFbmFibGVkCgogICAgICAgICAgICBpZiBQYXJzZXJFbGVtZW50Ll9wYWNrcmF0RW5hYmxlZDoKCiAgICAgICAgICAgICAgICBzZWxmLl9zYXZlX2NvbnRleHRbCgogICAgICAgICAgICAgICAgICAgIFwicGFja3JhdF9jYWNoZV9zaXplXCIKCiAgICAgICAgICAgICAgICBdID0gUGFyc2VyRWxlbWVudC5wYWNrcmF0X2NhY2hlLnNpemUKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgc2VsZi5fc2F2ZV9jb250ZXh0W1wicGFja3JhdF9jYWNoZV9zaXplXCJdID0gTm9uZQoKICAgICAgICAgICAgc2VsZi5fc2F2ZV9jb250ZXh0W1wicGFja3JhdF9wYXJzZVwiXSA9IFBhcnNlckVsZW1lbnQuX3BhcnNlCgogICAgICAgICAgICBzZWxmLl9zYXZlX2NvbnRleHRbCgogICAgICAgICAgICAgICAgXCJyZWN1cnNpb25fZW5hYmxlZFwiCgogICAgICAgICAgICBdID0gUGFyc2VyRWxlbWVudC5fbGVmdF9yZWN1cnNpb25fZW5hYmxlZAoKCgogICAgICAgICAgICBzZWxmLl9zYXZlX2NvbnRleHRbXCJfX2RpYWdfX1wiXSA9IHsKCiAgICAgICAgICAgICAgICBuYW1lOiBnZXRhdHRyKF9fZGlhZ19fLCBuYW1lKSBmb3IgbmFtZSBpbiBfX2RpYWdfXy5fYWxsX25hbWVzCgogICAgICAgICAgICB9CgoKCiAgICAgICAgICAgIHNlbGYuX3NhdmVfY29udGV4dFtcIl9fY29tcGF0X19cIl0gPSB7CgogICAgICAgICAgICAgICAgXCJjb2xsZWN0X2FsbF9BbmRfdG9rZW5zXCI6IF9fY29tcGF0X18uY29sbGVjdF9hbGxfQW5kX3Rva2VucwoKICAgICAgICAgICAgfQoKCgogICAgICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgICAgIGRlZiByZXN0b3JlKHNlbGYpOgoKICAgICAgICAgICAgIyByZXNldCBweXBhcnNpbmcgZ2xvYmFsIHN0YXRlCgogICAgICAgICAgICBpZiAoCgogICAgICAgICAgICAgICAgUGFyc2VyRWxlbWVudC5ERUZBVUxUX1dISVRFX0NIQVJTCgogICAgICAgICAgICAgICAgIT0gc2VsZi5fc2F2ZV9jb250ZXh0W1wiZGVmYXVsdF93aGl0ZXNwYWNlXCJdCgogICAgICAgICAgICApOgoKICAgICAgICAgICAgICAgIFBhcnNlckVsZW1lbnQuc2V0X2RlZmF1bHRfd2hpdGVzcGFjZV9jaGFycygKCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2F2ZV9jb250ZXh0W1wiZGVmYXVsdF93aGl0ZXNwYWNlXCJdCgogICAgICAgICAgICAgICAgKQoKCgogICAgICAgICAgICBQYXJzZXJFbGVtZW50LnZlcmJvc2Vfc3RhY2t0cmFjZSA9IHNlbGYuX3NhdmVfY29udGV4dFtcInZlcmJvc2Vfc3RhY2t0cmFjZVwiXQoKCgogICAgICAgICAgICBLZXl3b3JkLkRFRkFVTFRfS0VZV09SRF9DSEFSUyA9IHNlbGYuX3NhdmVfY29udGV4dFtcImRlZmF1bHRfa2V5d29yZF9jaGFyc1wiXQoKICAgICAgICAgICAgUGFyc2VyRWxlbWVudC5pbmxpbmVMaXRlcmFsc1VzaW5nKAoKICAgICAgICAgICAgICAgIHNlbGYuX3NhdmVfY29udGV4dFtcImxpdGVyYWxfc3RyaW5nX2NsYXNzXCJdCgogICAgICAgICAgICApCgoKCiAgICAgICAgICAgIGZvciBuYW1lLCB2YWx1ZSBpbiBzZWxmLl9zYXZlX2NvbnRleHRbXCJfX2RpYWdfX1wiXS5pdGVtcygpOgoKICAgICAgICAgICAgICAgIChfX2RpYWdfXy5lbmFibGUgaWYgdmFsdWUgZWxzZSBfX2RpYWdfXy5kaXNhYmxlKShuYW1lKQoKCgogICAgICAgICAgICBQYXJzZXJFbGVtZW50Ll9wYWNrcmF0RW5hYmxlZCA9IEZhbHNlCgogICAgICAgICAgICBpZiBzZWxmLl9zYXZlX2NvbnRleHRbXCJwYWNrcmF0X2VuYWJsZWRcIl06CgogICAgICAgICAgICAgICAgUGFyc2VyRWxlbWVudC5lbmFibGVfcGFja3JhdChzZWxmLl9zYXZlX2NvbnRleHRbXCJwYWNrcmF0X2NhY2hlX3NpemVcIl0pCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIFBhcnNlckVsZW1lbnQuX3BhcnNlID0gc2VsZi5fc2F2ZV9jb250ZXh0W1wicGFja3JhdF9wYXJzZVwiXQoKICAgICAgICAgICAgUGFyc2VyRWxlbWVudC5fbGVmdF9yZWN1cnNpb25fZW5hYmxlZCA9IHNlbGYuX3NhdmVfY29udGV4dFsKCiAgICAgICAgICAgICAgICBcInJlY3Vyc2lvbl9lbmFibGVkXCIKCiAgICAgICAgICAgIF0KCgoKICAgICAgICAgICAgX19jb21wYXRfXy5jb2xsZWN0X2FsbF9BbmRfdG9rZW5zID0gc2VsZi5fc2F2ZV9jb250ZXh0W1wiX19jb21wYXRfX1wiXQoKCgogICAgICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgICAgIGRlZiBjb3B5KHNlbGYpOgoKICAgICAgICAgICAgcmV0ID0gdHlwZShzZWxmKSgpCgogICAgICAgICAgICByZXQuX3NhdmVfY29udGV4dC51cGRhdGUoc2VsZi5fc2F2ZV9jb250ZXh0KQoKICAgICAgICAgICAgcmV0dXJuIHJldAoKCgogICAgICAgIGRlZiBfX2VudGVyX18oc2VsZik6CgogICAgICAgICAgICByZXR1cm4gc2VsZi5zYXZlKCkKCgoKICAgICAgICBkZWYgX19leGl0X18oc2VsZiwgKmFyZ3MpOgoKICAgICAgICAgICAgc2VsZi5yZXN0b3JlKCkKCgoKICAgIGNsYXNzIFRlc3RQYXJzZVJlc3VsdHNBc3NlcnRzOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgQSBtaXhpbiBjbGFzcyB0byBhZGQgcGFyc2UgcmVzdWx0cyBhc3NlcnRpb24gbWV0aG9kcyB0byBub3JtYWwgdW5pdHRlc3QuVGVzdENhc2UgY2xhc3Nlcy4KCiAgICAgICAgXCJcIlwiCgoKCiAgICAgICAgZGVmIGFzc2VydFBhcnNlUmVzdWx0c0VxdWFscygKCiAgICAgICAgICAgIHNlbGYsIHJlc3VsdCwgZXhwZWN0ZWRfbGlzdD1Ob25lLCBleHBlY3RlZF9kaWN0PU5vbmUsIG1zZz1Ob25lCgogICAgICAgICk6CgogICAgICAgICAgICBcIlwiXCIKCiAgICAgICAgICAgIFVuaXQgdGVzdCBhc3NlcnRpb24gdG8gY29tcGFyZSBhIDpjbGFzczpgUGFyc2VSZXN1bHRzYCBvYmplY3Qgd2l0aCBhbiBvcHRpb25hbCBgYGV4cGVjdGVkX2xpc3RgYCwKCiAgICAgICAgICAgIGFuZCBjb21wYXJlIGFueSBkZWZpbmVkIHJlc3VsdHMgbmFtZXMgd2l0aCBhbiBvcHRpb25hbCBgYGV4cGVjdGVkX2RpY3RgYC4KCiAgICAgICAgICAgIFwiXCJcIgoKICAgICAgICAgICAgaWYgZXhwZWN0ZWRfbGlzdCBpcyBub3QgTm9uZToKCiAgICAgICAgICAgICAgICBzZWxmLmFzc2VydEVxdWFsKGV4cGVjdGVkX2xpc3QsIHJlc3VsdC5hc19saXN0KCksIG1zZz1tc2cpCgogICAgICAgICAgICBpZiBleHBlY3RlZF9kaWN0IGlzIG5vdCBOb25lOgoKICAgICAgICAgICAgICAgIHNlbGYuYXNzZXJ0RXF1YWwoZXhwZWN0ZWRfZGljdCwgcmVzdWx0LmFzX2RpY3QoKSwgbXNnPW1zZykKCgoKICAgICAgICBkZWYgYXNzZXJ0UGFyc2VBbmRDaGVja0xpc3QoCgogICAgICAgICAgICBzZWxmLCBleHByLCB0ZXN0X3N0cmluZywgZXhwZWN0ZWRfbGlzdCwgbXNnPU5vbmUsIHZlcmJvc2U9VHJ1ZQoKICAgICAgICApOgoKICAgICAgICAgICAgXCJcIlwiCgogICAgICAgICAgICBDb252ZW5pZW5jZSB3cmFwcGVyIGFzc2VydCB0byB0ZXN0IGEgcGFyc2VyIGVsZW1lbnQgYW5kIGlucHV0IHN0cmluZywgYW5kIGFzc2VydCB0aGF0CgogICAgICAgICAgICB0aGUgcmVzdWx0aW5nIGBgUGFyc2VSZXN1bHRzLmFzTGlzdCgpYGAgaXMgZXF1YWwgdG8gdGhlIGBgZXhwZWN0ZWRfbGlzdGBgLgoKICAgICAgICAgICAgXCJcIlwiCgogICAgICAgICAgICByZXN1bHQgPSBleHByLnBhcnNlX3N0cmluZyh0ZXN0X3N0cmluZywgcGFyc2VfYWxsPVRydWUpCgogICAgICAgICAgICBpZiB2ZXJib3NlOgoKICAgICAgICAgICAgICAgIHByaW50KHJlc3VsdC5kdW1wKCkpCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIHByaW50KHJlc3VsdC5hc19saXN0KCkpCgogICAgICAgICAgICBzZWxmLmFzc2VydFBhcnNlUmVzdWx0c0VxdWFscyhyZXN1bHQsIGV4cGVjdGVkX2xpc3Q9ZXhwZWN0ZWRfbGlzdCwgbXNnPW1zZykKCgoKICAgICAgICBkZWYgYXNzZXJ0UGFyc2VBbmRDaGVja0RpY3QoCgogICAgICAgICAgICBzZWxmLCBleHByLCB0ZXN0X3N0cmluZywgZXhwZWN0ZWRfZGljdCwgbXNnPU5vbmUsIHZlcmJvc2U9VHJ1ZQoKICAgICAgICApOgoKICAgICAgICAgICAgXCJcIlwiCgogICAgICAgICAgICBDb252ZW5pZW5jZSB3cmFwcGVyIGFzc2VydCB0byB0ZXN0IGEgcGFyc2VyIGVsZW1lbnQgYW5kIGlucHV0IHN0cmluZywgYW5kIGFzc2VydCB0aGF0CgogICAgICAgICAgICB0aGUgcmVzdWx0aW5nIGBgUGFyc2VSZXN1bHRzLmFzRGljdCgpYGAgaXMgZXF1YWwgdG8gdGhlIGBgZXhwZWN0ZWRfZGljdGBgLgoKICAgICAgICAgICAgXCJcIlwiCgogICAgICAgICAgICByZXN1bHQgPSBleHByLnBhcnNlX3N0cmluZyh0ZXN0X3N0cmluZywgcGFyc2VBbGw9VHJ1ZSkKCiAgICAgICAgICAgIGlmIHZlcmJvc2U6CgogICAgICAgICAgICAgICAgcHJpbnQocmVzdWx0LmR1bXAoKSkKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgcHJpbnQocmVzdWx0LmFzX2xpc3QoKSkKCiAgICAgICAgICAgIHNlbGYuYXNzZXJ0UGFyc2VSZXN1bHRzRXF1YWxzKHJlc3VsdCwgZXhwZWN0ZWRfZGljdD1leHBlY3RlZF9kaWN0LCBtc2c9bXNnKQoKCgogICAgICAgIGRlZiBhc3NlcnRSdW5UZXN0UmVzdWx0cygKCiAgICAgICAgICAgIHNlbGYsIHJ1bl90ZXN0c19yZXBvcnQsIGV4cGVjdGVkX3BhcnNlX3Jlc3VsdHM9Tm9uZSwgbXNnPU5vbmUKCiAgICAgICAgKToKCiAgICAgICAgICAgIFwiXCJcIgoKICAgICAgICAgICAgVW5pdCB0ZXN0IGFzc2VydGlvbiB0byBldmFsdWF0ZSBvdXRwdXQgb2YgYGBQYXJzZXJFbGVtZW50LnJ1blRlc3RzKClgYC4gSWYgYSBsaXN0IG9mCgogICAgICAgICAgICBsaXN0LWRpY3QgdHVwbGVzIGlzIGdpdmVuIGFzIHRoZSBgYGV4cGVjdGVkX3BhcnNlX3Jlc3VsdHNgYCBhcmd1bWVudCwgdGhlbiB0aGVzZSBhcmUgemlwcGVkCgogICAgICAgICAgICB3aXRoIHRoZSByZXBvcnQgdHVwbGVzIHJldHVybmVkIGJ5IGBgcnVuVGVzdHNgYCBhbmQgZXZhbHVhdGVkIHVzaW5nIGBgYXNzZXJ0UGFyc2VSZXN1bHRzRXF1YWxzYGAuCgogICAgICAgICAgICBGaW5hbGx5LCBhc3NlcnRzIHRoYXQgdGhlIG92ZXJhbGwgYGBydW5UZXN0cygpYGAgc3VjY2VzcyB2YWx1ZSBpcyBgYFRydWVgYC4KCgoKICAgICAgICAgICAgOnBhcmFtIHJ1bl90ZXN0c19yZXBvcnQ6IHR1cGxlKGJvb2wsIFt0dXBsZShzdHIsIFBhcnNlUmVzdWx0cyBvciBFeGNlcHRpb24pXSkgcmV0dXJuZWQgZnJvbSBydW5UZXN0cwoKICAgICAgICAgICAgOnBhcmFtIGV4cGVjdGVkX3BhcnNlX3Jlc3VsdHMgKG9wdGlvbmFsKTogW3R1cGxlKHN0ciwgbGlzdCwgZGljdCwgRXhjZXB0aW9uKV0KCiAgICAgICAgICAgIFwiXCJcIgoKICAgICAgICAgICAgcnVuX3Rlc3Rfc3VjY2VzcywgcnVuX3Rlc3RfcmVzdWx0cyA9IHJ1bl90ZXN0c19yZXBvcnQKCgoKICAgICAgICAgICAgaWYgZXhwZWN0ZWRfcGFyc2VfcmVzdWx0cyBpcyBub3QgTm9uZToKCiAgICAgICAgICAgICAgICBtZXJnZWQgPSBbCgogICAgICAgICAgICAgICAgICAgICgqcnB0LCBleHBlY3RlZCkKCiAgICAgICAgICAgICAgICAgICAgZm9yIHJwdCwgZXhwZWN0ZWQgaW4gemlwKHJ1bl90ZXN0X3Jlc3VsdHMsIGV4cGVjdGVkX3BhcnNlX3Jlc3VsdHMpCgogICAgICAgICAgICAgICAgXQoKICAgICAgICAgICAgICAgIGZvciB0ZXN0X3N0cmluZywgcmVzdWx0LCBleHBlY3RlZCBpbiBtZXJnZWQ6CgogICAgICAgICAgICAgICAgICAgICMgZXhwZWN0ZWQgc2hvdWxkIGJlIGEgdHVwbGUgY29udGFpbmluZyBhIGxpc3QgYW5kL29yIGEgZGljdCBvciBhbiBleGNlcHRpb24sCgogICAgICAgICAgICAgICAgICAgICMgYW5kIG9wdGlvbmFsIGZhaWx1cmUgbWVzc2FnZSBzdHJpbmcKCiAgICAgICAgICAgICAgICAgICAgIyBhbiBlbXB0eSB0dXBsZSB3aWxsIHNraXAgYW55IHJlc3VsdCB2YWxpZGF0aW9uCgogICAgICAgICAgICAgICAgICAgIGZhaWxfbXNnID0gbmV4dCgKCiAgICAgICAgICAgICAgICAgICAgICAgIChleHAgZm9yIGV4cCBpbiBleHBlY3RlZCBpZiBpc2luc3RhbmNlKGV4cCwgc3RyKSksIE5vbmUKCiAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICBleHBlY3RlZF9leGNlcHRpb24gPSBuZXh0KAoKICAgICAgICAgICAgICAgICAgICAgICAgKAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBleHAgaW4gZXhwZWN0ZWQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGV4cCwgdHlwZSkgYW5kIGlzc3ViY2xhc3MoZXhwLCBFeGNlcHRpb24pCgogICAgICAgICAgICAgICAgICAgICAgICApLAoKICAgICAgICAgICAgICAgICAgICAgICAgTm9uZSwKCiAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICBpZiBleHBlY3RlZF9leGNlcHRpb24gaXMgbm90IE5vbmU6CgogICAgICAgICAgICAgICAgICAgICAgICB3aXRoIHNlbGYuYXNzZXJ0UmFpc2VzKAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkX2V4Y2VwdGlvbj1leHBlY3RlZF9leGNlcHRpb24sIG1zZz1mYWlsX21zZyBvciBtc2cKCiAgICAgICAgICAgICAgICAgICAgICAgICk6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShyZXN1bHQsIEV4Y2VwdGlvbik6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlIHJlc3VsdAoKICAgICAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWRfbGlzdCA9IG5leHQoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKGV4cCBmb3IgZXhwIGluIGV4cGVjdGVkIGlmIGlzaW5zdGFuY2UoZXhwLCBsaXN0KSksIE5vbmUKCiAgICAgICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkX2RpY3QgPSBuZXh0KAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIChleHAgZm9yIGV4cCBpbiBleHBlY3RlZCBpZiBpc2luc3RhbmNlKGV4cCwgZGljdCkpLCBOb25lCgogICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXhwZWN0ZWRfbGlzdCwgZXhwZWN0ZWRfZGljdCkgIT0gKE5vbmUsIE5vbmUpOgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYXNzZXJ0UGFyc2VSZXN1bHRzRXF1YWxzKAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkX2xpc3Q9ZXhwZWN0ZWRfbGlzdCwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWRfZGljdD1leHBlY3RlZF9kaWN0LAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2c9ZmFpbF9tc2cgb3IgbXNnLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyB3YXJuaW5nIGhlcmUgbWF5YmU/CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoXCJubyB2YWxpZGF0aW9uIGZvciB7IXJ9XCIuZm9ybWF0KHRlc3Rfc3RyaW5nKSkKCgoKICAgICAgICAgICAgIyBkbyB0aGlzIGxhc3QsIGluIGNhc2Ugc29tZSBzcGVjaWZpYyB0ZXN0IHJlc3VsdHMgY2FuIGJlIHJlcG9ydGVkIGluc3RlYWQKCiAgICAgICAgICAgIHNlbGYuYXNzZXJ0VHJ1ZSgKCiAgICAgICAgICAgICAgICBydW5fdGVzdF9zdWNjZXNzLCBtc2c9bXNnIGlmIG1zZyBpcyBub3QgTm9uZSBlbHNlIFwiZmFpbGVkIHJ1blRlc3RzXCIKCiAgICAgICAgICAgICkKCgoKICAgICAgICBAY29udGV4dG1hbmFnZXIKCiAgICAgICAgZGVmIGFzc2VydFJhaXNlc1BhcnNlRXhjZXB0aW9uKHNlbGYsIGV4Y190eXBlPVBhcnNlRXhjZXB0aW9uLCBtc2c9Tm9uZSk6CgogICAgICAgICAgICB3aXRoIHNlbGYuYXNzZXJ0UmFpc2VzKGV4Y190eXBlLCBtc2c9bXNnKToKCiAgICAgICAgICAgICAgICB5aWVsZAoKCgogICAgQHN0YXRpY21ldGhvZAoKICAgIGRlZiB3aXRoX2xpbmVfbnVtYmVycygKCiAgICAgICAgczogc3RyLAoKICAgICAgICBzdGFydF9saW5lOiB0eXBpbmcuT3B0aW9uYWxbaW50XSA9IE5vbmUsCgogICAgICAgIGVuZF9saW5lOiB0eXBpbmcuT3B0aW9uYWxbaW50XSA9IE5vbmUsCgogICAgICAgIGV4cGFuZF90YWJzOiBib29sID0gVHJ1ZSwKCiAgICAgICAgZW9sX21hcms6IHN0ciA9IFwifFwiLAoKICAgICAgICBtYXJrX3NwYWNlczogdHlwaW5nLk9wdGlvbmFsW3N0cl0gPSBOb25lLAoKICAgICAgICBtYXJrX2NvbnRyb2w6IHR5cGluZy5PcHRpb25hbFtzdHJdID0gTm9uZSwKCiAgICApIC0+IHN0cjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIEhlbHBmdWwgbWV0aG9kIGZvciBkZWJ1Z2dpbmcgYSBwYXJzZXIgLSBwcmludHMgYSBzdHJpbmcgd2l0aCBsaW5lIGFuZCBjb2x1bW4gbnVtYmVycy4KCiAgICAgICAgKExpbmUgYW5kIGNvbHVtbiBudW1iZXJzIGFyZSAxLWJhc2VkLikKCgoKICAgICAgICA6cGFyYW0gczogdHVwbGUoYm9vbCwgc3RyIC0gc3RyaW5nIHRvIGJlIHByaW50ZWQgd2l0aCBsaW5lIGFuZCBjb2x1bW4gbnVtYmVycwoKICAgICAgICA6cGFyYW0gc3RhcnRfbGluZTogaW50IC0gKG9wdGlvbmFsKSBzdGFydGluZyBsaW5lIG51bWJlciBpbiBzIHRvIHByaW50IChkZWZhdWx0PTEpCgogICAgICAgIDpwYXJhbSBlbmRfbGluZTogaW50IC0gKG9wdGlvbmFsKSBlbmRpbmcgbGluZSBudW1iZXIgaW4gcyB0byBwcmludCAoZGVmYXVsdD1sZW4ocykpCgogICAgICAgIDpwYXJhbSBleHBhbmRfdGFiczogYm9vbCAtIChvcHRpb25hbCkgZXhwYW5kIHRhYnMgdG8gc3BhY2VzLCB0byBtYXRjaCB0aGUgcHlwYXJzaW5nIGRlZmF1bHQKCiAgICAgICAgOnBhcmFtIGVvbF9tYXJrOiBzdHIgLSAob3B0aW9uYWwpIHN0cmluZyB0byBtYXJrIHRoZSBlbmQgb2YgbGluZXMsIGhlbHBzIHZpc3VhbGl6ZSB0cmFpbGluZyBzcGFjZXMgKGRlZmF1bHQ9XCJ8XCIpCgogICAgICAgIDpwYXJhbSBtYXJrX3NwYWNlczogc3RyIC0gKG9wdGlvbmFsKSBzcGVjaWFsIGNoYXJhY3RlciB0byBkaXNwbGF5IGluIHBsYWNlIG9mIHNwYWNlcwoKICAgICAgICA6cGFyYW0gbWFya19jb250cm9sOiBzdHIgLSAob3B0aW9uYWwpIGNvbnZlcnQgbm9uLXByaW50aW5nIGNvbnRyb2wgY2hhcmFjdGVycyB0byBhIHBsYWNlaG9sZGluZwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhcmFjdGVyOyB2YWxpZCB2YWx1ZXM6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIFwidW5pY29kZVwiIC0gcmVwbGFjZXMgY29udHJvbCBjaGFycyB3aXRoIFVuaWNvZGUgc3ltYm9scywgc3VjaCBhcyBcIuKQjVwiIGFuZCBcIuKQilwiCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIGFueSBzaW5nbGUgY2hhcmFjdGVyIHN0cmluZyAtIHJlcGxhY2UgY29udHJvbCBjaGFyYWN0ZXJzIHdpdGggZ2l2ZW4gc3RyaW5nCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIE5vbmUgKGRlZmF1bHQpIC0gc3RyaW5nIGlzIGRpc3BsYXllZCBhcy1pcwoKCgogICAgICAgIDpyZXR1cm46IHN0ciAtIGlucHV0IHN0cmluZyB3aXRoIGxlYWRpbmcgbGluZSBudW1iZXJzIGFuZCBjb2x1bW4gbnVtYmVyIGhlYWRlcnMKCiAgICAgICAgXCJcIlwiCgogICAgICAgIGlmIGV4cGFuZF90YWJzOgoKICAgICAgICAgICAgcyA9IHMuZXhwYW5kdGFicygpCgogICAgICAgIGlmIG1hcmtfY29udHJvbCBpcyBub3QgTm9uZToKCiAgICAgICAgICAgIGlmIG1hcmtfY29udHJvbCA9PSBcInVuaWNvZGVcIjoKCiAgICAgICAgICAgICAgICB0YmwgPSBzdHIubWFrZXRyYW5zKAoKICAgICAgICAgICAgICAgICAgICB7YzogdSBmb3IgYywgdSBpbiB6aXAocmFuZ2UoMCwgMzMpLCByYW5nZSgweDI0MDAsIDB4MjQzMykpfQoKICAgICAgICAgICAgICAgICAgICB8IHsxMjc6IDB4MjQyMX0KCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgZW9sX21hcmsgPSBcIlwiCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIHRibCA9IHN0ci5tYWtldHJhbnMoCgogICAgICAgICAgICAgICAgICAgIHtjOiBtYXJrX2NvbnRyb2wgZm9yIGMgaW4gbGlzdChyYW5nZSgwLCAzMikpICsgWzEyN119CgogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgcyA9IHMudHJhbnNsYXRlKHRibCkKCiAgICAgICAgaWYgbWFya19zcGFjZXMgaXMgbm90IE5vbmUgYW5kIG1hcmtfc3BhY2VzICE9IFwiIFwiOgoKICAgICAgICAgICAgaWYgbWFya19zcGFjZXMgPT0gXCJ1bmljb2RlXCI6CgogICAgICAgICAgICAgICAgdGJsID0gc3RyLm1ha2V0cmFucyh7OTogMHgyNDA5LCAzMjogMHgyNDIzfSkKCiAgICAgICAgICAgICAgICBzID0gcy50cmFuc2xhdGUodGJsKQoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICBzID0gcy5yZXBsYWNlKFwiIFwiLCBtYXJrX3NwYWNlcykKCiAgICAgICAgaWYgc3RhcnRfbGluZSBpcyBOb25lOgoKICAgICAgICAgICAgc3RhcnRfbGluZSA9IDEKCiAgICAgICAgaWYgZW5kX2xpbmUgaXMgTm9uZToKCiAgICAgICAgICAgIGVuZF9saW5lID0gbGVuKHMpCgogICAgICAgIGVuZF9saW5lID0gbWluKGVuZF9saW5lLCBsZW4ocykpCgogICAgICAgIHN0YXJ0X2xpbmUgPSBtaW4obWF4KDEsIHN0YXJ0X2xpbmUpLCBlbmRfbGluZSkKCgoKICAgICAgICBpZiBtYXJrX2NvbnRyb2wgIT0gXCJ1bmljb2RlXCI6CgogICAgICAgICAgICBzX2xpbmVzID0gcy5zcGxpdGxpbmVzKClbc3RhcnRfbGluZSAtIDEgOiBlbmRfbGluZV0KCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHNfbGluZXMgPSBbbGluZSArIFwi4pCKXCIgZm9yIGxpbmUgaW4gcy5zcGxpdChcIuKQilwiKVtzdGFydF9saW5lIC0gMSA6IGVuZF9saW5lXV0KCiAgICAgICAgaWYgbm90IHNfbGluZXM6CgogICAgICAgICAgICByZXR1cm4gXCJcIgoKCgogICAgICAgIGxpbmVub193aWR0aCA9IGxlbihzdHIoZW5kX2xpbmUpKQoKICAgICAgICBtYXhfbGluZV9sZW4gPSBtYXgobGVuKGxpbmUpIGZvciBsaW5lIGluIHNfbGluZXMpCgogICAgICAgIGxlYWQgPSBcIiBcIiAqIChsaW5lbm9fd2lkdGggKyAxKQoKICAgICAgICBpZiBtYXhfbGluZV9sZW4gPj0gOTk6CgogICAgICAgICAgICBoZWFkZXIwID0gKAoKICAgICAgICAgICAgICAgIGxlYWQKCiAgICAgICAgICAgICAgICArIFwiXCIuam9pbigKCiAgICAgICAgICAgICAgICAgICAgXCJ7fXt9XCIuZm9ybWF0KFwiIFwiICogOTksIChpICsgMSkgJSAxMDApCgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKG1heChtYXhfbGluZV9sZW4gLy8gMTAwLCAxKSkKCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgKyBcIlxcblwiCgogICAgICAgICAgICApCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBoZWFkZXIwID0gXCJcIgoKICAgICAgICBoZWFkZXIxID0gKAoKICAgICAgICAgICAgaGVhZGVyMAoKICAgICAgICAgICAgKyBsZWFkCgogICAgICAgICAgICArIFwiXCIuam9pbigKCiAgICAgICAgICAgICAgICBcIiAgICAgICAgIHt9XCIuZm9ybWF0KChpICsgMSkgJSAxMCkKCiAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZSgtKC1tYXhfbGluZV9sZW4gLy8gMTApKQoKICAgICAgICAgICAgKQoKICAgICAgICAgICAgKyBcIlxcblwiCgogICAgICAgICkKCiAgICAgICAgaGVhZGVyMiA9IGxlYWQgKyBcIjEyMzQ1Njc4OTBcIiAqICgtKC1tYXhfbGluZV9sZW4gLy8gMTApKSArIFwiXFxuXCIKCiAgICAgICAgcmV0dXJuICgKCiAgICAgICAgICAgIGhlYWRlcjEKCiAgICAgICAgICAgICsgaGVhZGVyMgoKICAgICAgICAgICAgKyBcIlxcblwiLmpvaW4oCgogICAgICAgICAgICAgICAgXCJ7Ont9ZH06e317fVwiLmZvcm1hdChpLCBsaW5lbm9fd2lkdGgsIGxpbmUsIGVvbF9tYXJrKQoKICAgICAgICAgICAgICAgIGZvciBpLCBsaW5lIGluIGVudW1lcmF0ZShzX2xpbmVzLCBzdGFydD1zdGFydF9saW5lKQoKICAgICAgICAgICAgKQoKICAgICAgICAgICAgKyBcIlxcblwiCgogICAgICAgICkKCgoKIiIiCgptb2R1bGVfZGljdFsicHlwYXJzaW5nL2V4Y2VwdGlvbnMucHkiXT0iIiIKCiMgZXhjZXB0aW9ucy5weQoKCgppbXBvcnQgcmUKCmltcG9ydCBzeXMKCmltcG9ydCB0eXBpbmcKCgoKZnJvbSAudXRpbCBpbXBvcnQgY29sLCBsaW5lLCBsaW5lbm8sIF9jb2xsYXBzZV9zdHJpbmdfdG9fcmFuZ2VzCgpmcm9tIC51bmljb2RlIGltcG9ydCBweXBhcnNpbmdfdW5pY29kZSBhcyBwcHUKCgoKCgpjbGFzcyBFeGNlcHRpb25Xb3JkVW5pY29kZShwcHUuTGF0aW4xLCBwcHUuTGF0aW5BLCBwcHUuTGF0aW5CLCBwcHUuR3JlZWssIHBwdS5DeXJpbGxpYyk6CgogICAgcGFzcwoKCgoKCl9leHRyYWN0X2FscGhhbnVtcyA9IF9jb2xsYXBzZV9zdHJpbmdfdG9fcmFuZ2VzKEV4Y2VwdGlvbldvcmRVbmljb2RlLmFscGhhbnVtcykKCl9leGNlcHRpb25fd29yZF9leHRyYWN0b3IgPSByZS5jb21waWxlKFwiKFtcIiArIF9leHRyYWN0X2FscGhhbnVtcyArIFwiXXsxLDE2fSl8LlwiKQoKCgoKCmNsYXNzIFBhcnNlQmFzZUV4Y2VwdGlvbihFeGNlcHRpb24pOgoKICAgIFwiXCJcImJhc2UgZXhjZXB0aW9uIGNsYXNzIGZvciBhbGwgcGFyc2luZyBydW50aW1lIGV4Y2VwdGlvbnNcIlwiXCIKCgoKICAgICMgUGVyZm9ybWFuY2UgdHVuaW5nOiB3ZSBjb25zdHJ1Y3QgYSAqbG90KiBvZiB0aGVzZSwgc28ga2VlcCB0aGlzCgogICAgIyBjb25zdHJ1Y3RvciBhcyBzbWFsbCBhbmQgZmFzdCBhcyBwb3NzaWJsZQoKICAgIGRlZiBfX2luaXRfXygKCiAgICAgICAgc2VsZiwKCiAgICAgICAgcHN0cjogc3RyLAoKICAgICAgICBsb2M6IGludCA9IDAsCgogICAgICAgIG1zZzogdHlwaW5nLk9wdGlvbmFsW3N0cl0gPSBOb25lLAoKICAgICAgICBlbGVtPU5vbmUsCgogICAgKToKCiAgICAgICAgc2VsZi5sb2MgPSBsb2MKCiAgICAgICAgaWYgbXNnIGlzIE5vbmU6CgogICAgICAgICAgICBzZWxmLm1zZyA9IHBzdHIKCiAgICAgICAgICAgIHNlbGYucHN0ciA9IFwiXCIKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHNlbGYubXNnID0gbXNnCgogICAgICAgICAgICBzZWxmLnBzdHIgPSBwc3RyCgogICAgICAgIHNlbGYucGFyc2VyX2VsZW1lbnQgPSBzZWxmLnBhcnNlckVsZW1lbnQgPSBlbGVtCgogICAgICAgIHNlbGYuYXJncyA9IChwc3RyLCBsb2MsIG1zZykKCgoKICAgIEBzdGF0aWNtZXRob2QKCiAgICBkZWYgZXhwbGFpbl9leGNlcHRpb24oZXhjLCBkZXB0aD0xNik6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBNZXRob2QgdG8gdGFrZSBhbiBleGNlcHRpb24gYW5kIHRyYW5zbGF0ZSB0aGUgUHl0aG9uIGludGVybmFsIHRyYWNlYmFjayBpbnRvIGEgbGlzdAoKICAgICAgICBvZiB0aGUgcHlwYXJzaW5nIGV4cHJlc3Npb25zIHRoYXQgY2F1c2VkIHRoZSBleGNlcHRpb24gdG8gYmUgcmFpc2VkLgoKCgogICAgICAgIFBhcmFtZXRlcnM6CgoKCiAgICAgICAgLSBleGMgLSBleGNlcHRpb24gcmFpc2VkIGR1cmluZyBwYXJzaW5nIChuZWVkIG5vdCBiZSBhIFBhcnNlRXhjZXB0aW9uLCBpbiBzdXBwb3J0CgogICAgICAgICAgb2YgUHl0aG9uIGV4Y2VwdGlvbnMgdGhhdCBtaWdodCBiZSByYWlzZWQgaW4gYSBwYXJzZSBhY3Rpb24pCgogICAgICAgIC0gZGVwdGggKGRlZmF1bHQ9MTYpIC0gbnVtYmVyIG9mIGxldmVscyBiYWNrIGluIHRoZSBzdGFjayB0cmFjZSB0byBsaXN0IGV4cHJlc3Npb24KCiAgICAgICAgICBhbmQgZnVuY3Rpb24gbmFtZXM7IGlmIE5vbmUsIHRoZSBmdWxsIHN0YWNrIHRyYWNlIG5hbWVzIHdpbGwgYmUgbGlzdGVkOyBpZiAwLCBvbmx5CgogICAgICAgICAgdGhlIGZhaWxpbmcgaW5wdXQgbGluZSwgbWFya2VyLCBhbmQgZXhjZXB0aW9uIHN0cmluZyB3aWxsIGJlIHNob3duCgoKCiAgICAgICAgUmV0dXJucyBhIG11bHRpLWxpbmUgc3RyaW5nIGxpc3RpbmcgdGhlIFBhcnNlckVsZW1lbnRzIGFuZC9vciBmdW5jdGlvbiBuYW1lcyBpbiB0aGUKCiAgICAgICAgZXhjZXB0aW9uJ3Mgc3RhY2sgdHJhY2UuCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpbXBvcnQgaW5zcGVjdAoKICAgICAgICBmcm9tIC5jb3JlIGltcG9ydCBQYXJzZXJFbGVtZW50CgoKCiAgICAgICAgaWYgZGVwdGggaXMgTm9uZToKCiAgICAgICAgICAgIGRlcHRoID0gc3lzLmdldHJlY3Vyc2lvbmxpbWl0KCkKCiAgICAgICAgcmV0ID0gW10KCiAgICAgICAgaWYgaXNpbnN0YW5jZShleGMsIFBhcnNlQmFzZUV4Y2VwdGlvbik6CgogICAgICAgICAgICByZXQuYXBwZW5kKGV4Yy5saW5lKQoKICAgICAgICAgICAgcmV0LmFwcGVuZChcIiBcIiAqIChleGMuY29sdW1uIC0gMSkgKyBcIl5cIikKCiAgICAgICAgcmV0LmFwcGVuZChcInt9OiB7fVwiLmZvcm1hdCh0eXBlKGV4YykuX19uYW1lX18sIGV4YykpCgoKCiAgICAgICAgaWYgZGVwdGggPiAwOgoKICAgICAgICAgICAgY2FsbGVycyA9IGluc3BlY3QuZ2V0aW5uZXJmcmFtZXMoZXhjLl9fdHJhY2ViYWNrX18sIGNvbnRleHQ9ZGVwdGgpCgogICAgICAgICAgICBzZWVuID0gc2V0KCkKCiAgICAgICAgICAgIGZvciBpLCBmZiBpbiBlbnVtZXJhdGUoY2FsbGVyc1stZGVwdGg6XSk6CgogICAgICAgICAgICAgICAgZnJtID0gZmZbMF0KCgoKICAgICAgICAgICAgICAgIGZfc2VsZiA9IGZybS5mX2xvY2Fscy5nZXQoXCJzZWxmXCIsIE5vbmUpCgogICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShmX3NlbGYsIFBhcnNlckVsZW1lbnQpOgoKICAgICAgICAgICAgICAgICAgICBpZiBmcm0uZl9jb2RlLmNvX25hbWUgbm90IGluIChcInBhcnNlSW1wbFwiLCBcIl9wYXJzZU5vQ2FjaGVcIik6CgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgICAgICAgICBpZiBpZChmX3NlbGYpIGluIHNlZW46CgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgICAgICAgICBzZWVuLmFkZChpZChmX3NlbGYpKQoKCgogICAgICAgICAgICAgICAgICAgIHNlbGZfdHlwZSA9IHR5cGUoZl9zZWxmKQoKICAgICAgICAgICAgICAgICAgICByZXQuYXBwZW5kKAoKICAgICAgICAgICAgICAgICAgICAgICAgXCJ7fS57fSAtIHt9XCIuZm9ybWF0KAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGZfdHlwZS5fX21vZHVsZV9fLCBzZWxmX3R5cGUuX19uYW1lX18sIGZfc2VsZgoKICAgICAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICApCgoKCiAgICAgICAgICAgICAgICBlbGlmIGZfc2VsZiBpcyBub3QgTm9uZToKCiAgICAgICAgICAgICAgICAgICAgc2VsZl90eXBlID0gdHlwZShmX3NlbGYpCgogICAgICAgICAgICAgICAgICAgIHJldC5hcHBlbmQoXCJ7fS57fVwiLmZvcm1hdChzZWxmX3R5cGUuX19tb2R1bGVfXywgc2VsZl90eXBlLl9fbmFtZV9fKSkKCgoKICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgIGNvZGUgPSBmcm0uZl9jb2RlCgogICAgICAgICAgICAgICAgICAgIGlmIGNvZGUuY29fbmFtZSBpbiAoXCJ3cmFwcGVyXCIsIFwiPG1vZHVsZT5cIik6CgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQoKCgogICAgICAgICAgICAgICAgICAgIHJldC5hcHBlbmQoXCJ7fVwiLmZvcm1hdChjb2RlLmNvX25hbWUpKQoKCgogICAgICAgICAgICAgICAgZGVwdGggLT0gMQoKICAgICAgICAgICAgICAgIGlmIG5vdCBkZXB0aDoKCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKCgoKICAgICAgICByZXR1cm4gXCJcXG5cIi5qb2luKHJldCkKCgoKICAgIEBjbGFzc21ldGhvZAoKICAgIGRlZiBfZnJvbV9leGNlcHRpb24oY2xzLCBwZSk6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBpbnRlcm5hbCBmYWN0b3J5IG1ldGhvZCB0byBzaW1wbGlmeSBjcmVhdGluZyBvbmUgdHlwZSBvZiBQYXJzZUV4Y2VwdGlvbgoKICAgICAgICBmcm9tIGFub3RoZXIgLSBhdm9pZHMgaGF2aW5nIF9faW5pdF9fIHNpZ25hdHVyZSBjb25mbGljdHMgYW1vbmcgc3ViY2xhc3NlcwoKICAgICAgICBcIlwiXCIKCiAgICAgICAgcmV0dXJuIGNscyhwZS5wc3RyLCBwZS5sb2MsIHBlLm1zZywgcGUucGFyc2VyRWxlbWVudCkKCgoKICAgIEBwcm9wZXJ0eQoKICAgIGRlZiBsaW5lKHNlbGYpIC0+IHN0cjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIFJldHVybiB0aGUgbGluZSBvZiB0ZXh0IHdoZXJlIHRoZSBleGNlcHRpb24gb2NjdXJyZWQuCgogICAgICAgIFwiXCJcIgoKICAgICAgICByZXR1cm4gbGluZShzZWxmLmxvYywgc2VsZi5wc3RyKQoKCgogICAgQHByb3BlcnR5CgogICAgZGVmIGxpbmVubyhzZWxmKSAtPiBpbnQ6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBSZXR1cm4gdGhlIDEtYmFzZWQgbGluZSBudW1iZXIgb2YgdGV4dCB3aGVyZSB0aGUgZXhjZXB0aW9uIG9jY3VycmVkLgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgcmV0dXJuIGxpbmVubyhzZWxmLmxvYywgc2VsZi5wc3RyKQoKCgogICAgQHByb3BlcnR5CgogICAgZGVmIGNvbChzZWxmKSAtPiBpbnQ6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBSZXR1cm4gdGhlIDEtYmFzZWQgY29sdW1uIG9uIHRoZSBsaW5lIG9mIHRleHQgd2hlcmUgdGhlIGV4Y2VwdGlvbiBvY2N1cnJlZC4KCiAgICAgICAgXCJcIlwiCgogICAgICAgIHJldHVybiBjb2woc2VsZi5sb2MsIHNlbGYucHN0cikKCgoKICAgIEBwcm9wZXJ0eQoKICAgIGRlZiBjb2x1bW4oc2VsZikgLT4gaW50OgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgUmV0dXJuIHRoZSAxLWJhc2VkIGNvbHVtbiBvbiB0aGUgbGluZSBvZiB0ZXh0IHdoZXJlIHRoZSBleGNlcHRpb24gb2NjdXJyZWQuCgogICAgICAgIFwiXCJcIgoKICAgICAgICByZXR1cm4gY29sKHNlbGYubG9jLCBzZWxmLnBzdHIpCgoKCiAgICBkZWYgX19zdHJfXyhzZWxmKSAtPiBzdHI6CgogICAgICAgIGlmIHNlbGYucHN0cjoKCiAgICAgICAgICAgIGlmIHNlbGYubG9jID49IGxlbihzZWxmLnBzdHIpOgoKICAgICAgICAgICAgICAgIGZvdW5kc3RyID0gXCIsIGZvdW5kIGVuZCBvZiB0ZXh0XCIKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgIyBwdWxsIG91dCBuZXh0IHdvcmQgYXQgZXJyb3IgbG9jYXRpb24KCiAgICAgICAgICAgICAgICBmb3VuZF9tYXRjaCA9IF9leGNlcHRpb25fd29yZF9leHRyYWN0b3IubWF0Y2goc2VsZi5wc3RyLCBzZWxmLmxvYykKCiAgICAgICAgICAgICAgICBpZiBmb3VuZF9tYXRjaCBpcyBub3QgTm9uZToKCiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSBmb3VuZF9tYXRjaC5ncm91cCgwKQoKICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgIGZvdW5kID0gc2VsZi5wc3RyW3NlbGYubG9jIDogc2VsZi5sb2MgKyAxXQoKICAgICAgICAgICAgICAgIGZvdW5kc3RyID0gKFwiLCBmb3VuZCAlclwiICUgZm91bmQpLnJlcGxhY2UoclwiXFxcXFwiLCBcIlxcXFxcIikKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIGZvdW5kc3RyID0gXCJcIgoKICAgICAgICByZXR1cm4gXCJ7fXt9ICAoYXQgY2hhciB7fSksIChsaW5lOnt9LCBjb2w6e30pXCIuZm9ybWF0KAoKICAgICAgICAgICAgc2VsZi5tc2csIGZvdW5kc3RyLCBzZWxmLmxvYywgc2VsZi5saW5lbm8sIHNlbGYuY29sdW1uCgogICAgICAgICkKCgoKICAgIGRlZiBfX3JlcHJfXyhzZWxmKToKCiAgICAgICAgcmV0dXJuIHN0cihzZWxmKQoKCgogICAgZGVmIG1hcmtfaW5wdXRfbGluZShzZWxmLCBtYXJrZXJfc3RyaW5nOiBzdHIgPSBOb25lLCAqLCBtYXJrZXJTdHJpbmc9XCI+ITxcIikgLT4gc3RyOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgRXh0cmFjdHMgdGhlIGV4Y2VwdGlvbiBsaW5lIGZyb20gdGhlIGlucHV0IHN0cmluZywgYW5kIG1hcmtzCgogICAgICAgIHRoZSBsb2NhdGlvbiBvZiB0aGUgZXhjZXB0aW9uIHdpdGggYSBzcGVjaWFsIHN5bWJvbC4KCiAgICAgICAgXCJcIlwiCgogICAgICAgIG1hcmtlclN0cmluZyA9IG1hcmtlcl9zdHJpbmcgaWYgbWFya2VyX3N0cmluZyBpcyBub3QgTm9uZSBlbHNlIG1hcmtlclN0cmluZwoKICAgICAgICBsaW5lX3N0ciA9IHNlbGYubGluZQoKICAgICAgICBsaW5lX2NvbHVtbiA9IHNlbGYuY29sdW1uIC0gMQoKICAgICAgICBpZiBtYXJrZXJTdHJpbmc6CgogICAgICAgICAgICBsaW5lX3N0ciA9IFwiXCIuam9pbigKCiAgICAgICAgICAgICAgICAobGluZV9zdHJbOmxpbmVfY29sdW1uXSwgbWFya2VyU3RyaW5nLCBsaW5lX3N0cltsaW5lX2NvbHVtbjpdKQoKICAgICAgICAgICAgKQoKICAgICAgICByZXR1cm4gbGluZV9zdHIuc3RyaXAoKQoKCgogICAgZGVmIGV4cGxhaW4oc2VsZiwgZGVwdGg9MTYpIC0+IHN0cjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIE1ldGhvZCB0byB0cmFuc2xhdGUgdGhlIFB5dGhvbiBpbnRlcm5hbCB0cmFjZWJhY2sgaW50byBhIGxpc3QKCiAgICAgICAgb2YgdGhlIHB5cGFyc2luZyBleHByZXNzaW9ucyB0aGF0IGNhdXNlZCB0aGUgZXhjZXB0aW9uIHRvIGJlIHJhaXNlZC4KCgoKICAgICAgICBQYXJhbWV0ZXJzOgoKCgogICAgICAgIC0gZGVwdGggKGRlZmF1bHQ9MTYpIC0gbnVtYmVyIG9mIGxldmVscyBiYWNrIGluIHRoZSBzdGFjayB0cmFjZSB0byBsaXN0IGV4cHJlc3Npb24KCiAgICAgICAgICBhbmQgZnVuY3Rpb24gbmFtZXM7IGlmIE5vbmUsIHRoZSBmdWxsIHN0YWNrIHRyYWNlIG5hbWVzIHdpbGwgYmUgbGlzdGVkOyBpZiAwLCBvbmx5CgogICAgICAgICAgdGhlIGZhaWxpbmcgaW5wdXQgbGluZSwgbWFya2VyLCBhbmQgZXhjZXB0aW9uIHN0cmluZyB3aWxsIGJlIHNob3duCgoKCiAgICAgICAgUmV0dXJucyBhIG11bHRpLWxpbmUgc3RyaW5nIGxpc3RpbmcgdGhlIFBhcnNlckVsZW1lbnRzIGFuZC9vciBmdW5jdGlvbiBuYW1lcyBpbiB0aGUKCiAgICAgICAgZXhjZXB0aW9uJ3Mgc3RhY2sgdHJhY2UuCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIGV4cHIgPSBwcC5Xb3JkKHBwLm51bXMpICogMwoKICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgIGV4cHIucGFyc2Vfc3RyaW5nKFwiMTIzIDQ1NiBBNzg5XCIpCgogICAgICAgICAgICBleGNlcHQgcHAuUGFyc2VFeGNlcHRpb24gYXMgcGU6CgogICAgICAgICAgICAgICAgcHJpbnQocGUuZXhwbGFpbihkZXB0aD0wKSkKCgoKICAgICAgICBwcmludHM6OgoKCgogICAgICAgICAgICAxMjMgNDU2IEE3ODkKCiAgICAgICAgICAgICAgICAgICAgXgoKICAgICAgICAgICAgUGFyc2VFeGNlcHRpb246IEV4cGVjdGVkIFc6KDAtOSksIGZvdW5kICdBJyAgKGF0IGNoYXIgOCksIChsaW5lOjEsIGNvbDo5KQoKCgogICAgICAgIE5vdGU6IHRoZSBkaWFnbm9zdGljIG91dHB1dCB3aWxsIGluY2x1ZGUgc3RyaW5nIHJlcHJlc2VudGF0aW9ucyBvZiB0aGUgZXhwcmVzc2lvbnMKCiAgICAgICAgdGhhdCBmYWlsZWQgdG8gcGFyc2UuIFRoZXNlIHJlcHJlc2VudGF0aW9ucyB3aWxsIGJlIG1vcmUgaGVscGZ1bCBpZiB5b3UgdXNlIGBzZXRfbmFtZWAgdG8KCiAgICAgICAgZ2l2ZSBpZGVudGlmaWFibGUgbmFtZXMgdG8geW91ciBleHByZXNzaW9ucy4gT3RoZXJ3aXNlIHRoZXkgd2lsbCB1c2UgdGhlIGRlZmF1bHQgc3RyaW5nCgogICAgICAgIGZvcm1zLCB3aGljaCBtYXkgYmUgY3J5cHRpYyB0byByZWFkLgoKCgogICAgICAgIE5vdGU6IHB5cGFyc2luZydzIGRlZmF1bHQgdHJ1bmNhdGlvbiBvZiBleGNlcHRpb24gdHJhY2ViYWNrcyBtYXkgYWxzbyB0cnVuY2F0ZSB0aGUKCiAgICAgICAgc3RhY2sgb2YgZXhwcmVzc2lvbnMgdGhhdCBhcmUgZGlzcGxheWVkIGluIHRoZSBgYGV4cGxhaW5gYCBvdXRwdXQuIFRvIGdldCB0aGUgZnVsbCBsaXN0aW5nCgogICAgICAgIG9mIHBhcnNlciBleHByZXNzaW9ucywgeW91IG1heSBoYXZlIHRvIHNldCBgYFBhcnNlckVsZW1lbnQudmVyYm9zZV9zdGFja3RyYWNlID0gVHJ1ZWBgCgogICAgICAgIFwiXCJcIgoKICAgICAgICByZXR1cm4gc2VsZi5leHBsYWluX2V4Y2VwdGlvbihzZWxmLCBkZXB0aCkKCgoKICAgIG1hcmtJbnB1dGxpbmUgPSBtYXJrX2lucHV0X2xpbmUKCgoKCgpjbGFzcyBQYXJzZUV4Y2VwdGlvbihQYXJzZUJhc2VFeGNlcHRpb24pOgoKICAgIFwiXCJcIgoKICAgIEV4Y2VwdGlvbiB0aHJvd24gd2hlbiBhIHBhcnNlIGV4cHJlc3Npb24gZG9lc24ndCBtYXRjaCB0aGUgaW5wdXQgc3RyaW5nCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICB0cnk6CgogICAgICAgICAgICBXb3JkKG51bXMpLnNldF9uYW1lKFwiaW50ZWdlclwiKS5wYXJzZV9zdHJpbmcoXCJBQkNcIikKCiAgICAgICAgZXhjZXB0IFBhcnNlRXhjZXB0aW9uIGFzIHBlOgoKICAgICAgICAgICAgcHJpbnQocGUpCgogICAgICAgICAgICBwcmludChcImNvbHVtbjoge31cIi5mb3JtYXQocGUuY29sdW1uKSkKCgoKICAgIHByaW50czo6CgoKCiAgICAgICBFeHBlY3RlZCBpbnRlZ2VyIChhdCBjaGFyIDApLCAobGluZToxLCBjb2w6MSkKCiAgICAgICAgY29sdW1uOiAxCgoKCiAgICBcIlwiXCIKCgoKCgpjbGFzcyBQYXJzZUZhdGFsRXhjZXB0aW9uKFBhcnNlQmFzZUV4Y2VwdGlvbik6CgogICAgXCJcIlwiCgogICAgVXNlci10aHJvd2FibGUgZXhjZXB0aW9uIHRocm93biB3aGVuIGluY29uc2lzdGVudCBwYXJzZSBjb250ZW50CgogICAgaXMgZm91bmQ7IHN0b3BzIGFsbCBwYXJzaW5nIGltbWVkaWF0ZWx5CgogICAgXCJcIlwiCgoKCgoKY2xhc3MgUGFyc2VTeW50YXhFeGNlcHRpb24oUGFyc2VGYXRhbEV4Y2VwdGlvbik6CgogICAgXCJcIlwiCgogICAgSnVzdCBsaWtlIDpjbGFzczpgUGFyc2VGYXRhbEV4Y2VwdGlvbmAsIGJ1dCB0aHJvd24gaW50ZXJuYWxseQoKICAgIHdoZW4gYW4gOmNsYXNzOmBFcnJvclN0b3A8QW5kLl9FcnJvclN0b3A+YCAoJy0nIG9wZXJhdG9yKSBpbmRpY2F0ZXMKCiAgICB0aGF0IHBhcnNpbmcgaXMgdG8gc3RvcCBpbW1lZGlhdGVseSBiZWNhdXNlIGFuIHVuYmFja3RyYWNrYWJsZQoKICAgIHN5bnRheCBlcnJvciBoYXMgYmVlbiBmb3VuZC4KCiAgICBcIlwiXCIKCgoKCgpjbGFzcyBSZWN1cnNpdmVHcmFtbWFyRXhjZXB0aW9uKEV4Y2VwdGlvbik6CgogICAgXCJcIlwiCgogICAgRXhjZXB0aW9uIHRocm93biBieSA6Y2xhc3M6YFBhcnNlckVsZW1lbnQudmFsaWRhdGVgIGlmIHRoZQoKICAgIGdyYW1tYXIgY291bGQgYmUgbGVmdC1yZWN1cnNpdmU7IHBhcnNlciBtYXkgbmVlZCB0byBlbmFibGUKCiAgICBsZWZ0IHJlY3Vyc2lvbiB1c2luZyA6Y2xhc3M6YFBhcnNlckVsZW1lbnQuZW5hYmxlX2xlZnRfcmVjdXJzaW9uPFBhcnNlckVsZW1lbnQuZW5hYmxlX2xlZnRfcmVjdXJzaW9uPmAKCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBwYXJzZUVsZW1lbnRMaXN0KToKCiAgICAgICAgc2VsZi5wYXJzZUVsZW1lbnRUcmFjZSA9IHBhcnNlRWxlbWVudExpc3QKCgoKICAgIGRlZiBfX3N0cl9fKHNlbGYpIC0+IHN0cjoKCiAgICAgICAgcmV0dXJuIFwiUmVjdXJzaXZlR3JhbW1hckV4Y2VwdGlvbjoge31cIi5mb3JtYXQoc2VsZi5wYXJzZUVsZW1lbnRUcmFjZSkKCgoKIiIiCgptb2R1bGVfZGljdFsicHlwYXJzaW5nL3Jlc3VsdHMucHkiXT0iIiIKCiMgcmVzdWx0cy5weQoKZnJvbSBjb2xsZWN0aW9ucy5hYmMgaW1wb3J0IE11dGFibGVNYXBwaW5nLCBNYXBwaW5nLCBNdXRhYmxlU2VxdWVuY2UsIEl0ZXJhdG9yCgppbXBvcnQgcHByaW50Cgpmcm9tIHdlYWtyZWYgaW1wb3J0IHJlZiBhcyB3a3JlZgoKZnJvbSB0eXBpbmcgaW1wb3J0IFR1cGxlLCBBbnkKCgoKc3RyX3R5cGU6IFR1cGxlW3R5cGUsIC4uLl0gPSAoc3RyLCBieXRlcykKCl9nZW5lcmF0b3JfdHlwZSA9IHR5cGUoKF8gZm9yIF8gaW4gKCkpKQoKCgoKCmNsYXNzIF9QYXJzZVJlc3VsdHNXaXRoT2Zmc2V0OgoKICAgIF9fc2xvdHNfXyA9IFtcInR1cFwiXQoKCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHAxLCBwMik6CgogICAgICAgIHNlbGYudHVwID0gKHAxLCBwMikKCgoKICAgIGRlZiBfX2dldGl0ZW1fXyhzZWxmLCBpKToKCiAgICAgICAgcmV0dXJuIHNlbGYudHVwW2ldCgoKCiAgICBkZWYgX19nZXRzdGF0ZV9fKHNlbGYpOgoKICAgICAgICByZXR1cm4gc2VsZi50dXAKCgoKICAgIGRlZiBfX3NldHN0YXRlX18oc2VsZiwgKmFyZ3MpOgoKICAgICAgICBzZWxmLnR1cCA9IGFyZ3NbMF0KCgoKCgpjbGFzcyBQYXJzZVJlc3VsdHM6CgogICAgXCJcIlwiU3RydWN0dXJlZCBwYXJzZSByZXN1bHRzLCB0byBwcm92aWRlIG11bHRpcGxlIG1lYW5zIG9mIGFjY2VzcyB0bwoKICAgIHRoZSBwYXJzZWQgZGF0YToKCgoKICAgIC0gYXMgYSBsaXN0IChgYGxlbihyZXN1bHRzKWBgKQoKICAgIC0gYnkgbGlzdCBpbmRleCAoYGByZXN1bHRzWzBdLCByZXN1bHRzWzFdYGAsIGV0Yy4pCgogICAgLSBieSBhdHRyaWJ1dGUgKGBgcmVzdWx0cy48cmVzdWx0c19uYW1lPmBgIC0gc2VlIDpjbGFzczpgUGFyc2VyRWxlbWVudC5zZXRfcmVzdWx0c19uYW1lYCkKCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgIGludGVnZXIgPSBXb3JkKG51bXMpCgogICAgICAgIGRhdGVfc3RyID0gKGludGVnZXIuc2V0X3Jlc3VsdHNfbmFtZShcInllYXJcIikgKyAnLycKCiAgICAgICAgICAgICAgICAgICAgKyBpbnRlZ2VyLnNldF9yZXN1bHRzX25hbWUoXCJtb250aFwiKSArICcvJwoKICAgICAgICAgICAgICAgICAgICArIGludGVnZXIuc2V0X3Jlc3VsdHNfbmFtZShcImRheVwiKSkKCiAgICAgICAgIyBlcXVpdmFsZW50IGZvcm06CgogICAgICAgICMgZGF0ZV9zdHIgPSAoaW50ZWdlcihcInllYXJcIikgKyAnLycKCiAgICAgICAgIyAgICAgICAgICAgICArIGludGVnZXIoXCJtb250aFwiKSArICcvJwoKICAgICAgICAjICAgICAgICAgICAgICsgaW50ZWdlcihcImRheVwiKSkKCgoKICAgICAgICAjIHBhcnNlX3N0cmluZyByZXR1cm5zIGEgUGFyc2VSZXN1bHRzIG9iamVjdAoKICAgICAgICByZXN1bHQgPSBkYXRlX3N0ci5wYXJzZV9zdHJpbmcoXCIxOTk5LzEyLzMxXCIpCgoKCiAgICAgICAgZGVmIHRlc3QocywgZm49cmVwcik6CgogICAgICAgICAgICBwcmludChcInt9IC0+IHt9XCIuZm9ybWF0KHMsIGZuKGV2YWwocykpKSkKCiAgICAgICAgdGVzdChcImxpc3QocmVzdWx0KVwiKQoKICAgICAgICB0ZXN0KFwicmVzdWx0WzBdXCIpCgogICAgICAgIHRlc3QoXCJyZXN1bHRbJ21vbnRoJ11cIikKCiAgICAgICAgdGVzdChcInJlc3VsdC5kYXlcIikKCiAgICAgICAgdGVzdChcIidtb250aCcgaW4gcmVzdWx0XCIpCgogICAgICAgIHRlc3QoXCInbWludXRlcycgaW4gcmVzdWx0XCIpCgogICAgICAgIHRlc3QoXCJyZXN1bHQuZHVtcCgpXCIsIHN0cikKCgoKICAgIHByaW50czo6CgoKCiAgICAgICAgbGlzdChyZXN1bHQpIC0+IFsnMTk5OScsICcvJywgJzEyJywgJy8nLCAnMzEnXQoKICAgICAgICByZXN1bHRbMF0gLT4gJzE5OTknCgogICAgICAgIHJlc3VsdFsnbW9udGgnXSAtPiAnMTInCgogICAgICAgIHJlc3VsdC5kYXkgLT4gJzMxJwoKICAgICAgICAnbW9udGgnIGluIHJlc3VsdCAtPiBUcnVlCgogICAgICAgICdtaW51dGVzJyBpbiByZXN1bHQgLT4gRmFsc2UKCiAgICAgICAgcmVzdWx0LmR1bXAoKSAtPiBbJzE5OTknLCAnLycsICcxMicsICcvJywgJzMxJ10KCiAgICAgICAgLSBkYXk6ICczMScKCiAgICAgICAgLSBtb250aDogJzEyJwoKICAgICAgICAtIHllYXI6ICcxOTk5JwoKICAgIFwiXCJcIgoKCgogICAgX251bGxfdmFsdWVzOiBUdXBsZVtBbnksIC4uLl0gPSAoTm9uZSwgW10sIFwiXCIsICgpKQoKCgogICAgX19zbG90c19fID0gWwoKICAgICAgICBcIl9uYW1lXCIsCgogICAgICAgIFwiX3BhcmVudFwiLAoKICAgICAgICBcIl9hbGxfbmFtZXNcIiwKCiAgICAgICAgXCJfbW9kYWxcIiwKCiAgICAgICAgXCJfdG9rbGlzdFwiLAoKICAgICAgICBcIl90b2tkaWN0XCIsCgogICAgICAgIFwiX193ZWFrcmVmX19cIiwKCiAgICBdCgoKCiAgICBjbGFzcyBMaXN0KGxpc3QpOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgU2ltcGxlIHdyYXBwZXIgY2xhc3MgdG8gZGlzdGluZ3Vpc2ggcGFyc2VkIGxpc3QgcmVzdWx0cyB0aGF0IHNob3VsZCBiZSBwcmVzZXJ2ZWQKCiAgICAgICAgYXMgYWN0dWFsIFB5dGhvbiBsaXN0cywgaW5zdGVhZCBvZiBiZWluZyBjb252ZXJ0ZWQgdG8gOmNsYXNzOmBQYXJzZVJlc3VsdHNgOgoKCgogICAgICAgICAgICBMQlJBQ0ssIFJCUkFDSyA9IG1hcChwcC5TdXBwcmVzcywgXCJbXVwiKQoKICAgICAgICAgICAgZWxlbWVudCA9IHBwLkZvcndhcmQoKQoKICAgICAgICAgICAgaXRlbSA9IHBwYy5pbnRlZ2VyCgogICAgICAgICAgICBlbGVtZW50X2xpc3QgPSBMQlJBQ0sgKyBwcC5kZWxpbWl0ZWRfbGlzdChlbGVtZW50KSArIFJCUkFDSwoKCgogICAgICAgICAgICAjIGFkZCBwYXJzZSBhY3Rpb25zIHRvIGNvbnZlcnQgZnJvbSBQYXJzZVJlc3VsdHMgdG8gYWN0dWFsIFB5dGhvbiBjb2xsZWN0aW9uIHR5cGVzCgogICAgICAgICAgICBkZWYgYXNfcHl0aG9uX2xpc3QodCk6CgogICAgICAgICAgICAgICAgcmV0dXJuIHBwLlBhcnNlUmVzdWx0cy5MaXN0KHQuYXNfbGlzdCgpKQoKICAgICAgICAgICAgZWxlbWVudF9saXN0LmFkZF9wYXJzZV9hY3Rpb24oYXNfcHl0aG9uX2xpc3QpCgoKCiAgICAgICAgICAgIGVsZW1lbnQgPDw9IGl0ZW0gfCBlbGVtZW50X2xpc3QKCgoKICAgICAgICAgICAgZWxlbWVudC5ydW5fdGVzdHMoJycnCgogICAgICAgICAgICAgICAgMTAwCgogICAgICAgICAgICAgICAgWzIsMyw0XQoKICAgICAgICAgICAgICAgIFtbMiwgMV0sMyw0XQoKICAgICAgICAgICAgICAgIFsoMiwgMSksMyw0XQoKICAgICAgICAgICAgICAgICgyLDMsNCkKCiAgICAgICAgICAgICAgICAnJycsIHBvc3RfcGFyc2U9bGFtYmRhIHMsIHI6IChyWzBdLCB0eXBlKHJbMF0pKSkKCgoKICAgICAgICBwcmludHM6CgoKCiAgICAgICAgICAgIDEwMAoKICAgICAgICAgICAgKDEwMCwgPGNsYXNzICdpbnQnPikKCgoKICAgICAgICAgICAgWzIsMyw0XQoKICAgICAgICAgICAgKFsyLCAzLCA0XSwgPGNsYXNzICdsaXN0Jz4pCgoKCiAgICAgICAgICAgIFtbMiwgMV0sMyw0XQoKICAgICAgICAgICAgKFtbMiwgMV0sIDMsIDRdLCA8Y2xhc3MgJ2xpc3QnPikKCgoKICAgICAgICAoVXNlZCBpbnRlcm5hbGx5IGJ5IDpjbGFzczpgR3JvdXBgIHdoZW4gYGFzbGlzdD1UcnVlYC4pCgogICAgICAgIFwiXCJcIgoKCgogICAgICAgIGRlZiBfX25ld19fKGNscywgY29udGFpbmVkPU5vbmUpOgoKICAgICAgICAgICAgaWYgY29udGFpbmVkIGlzIE5vbmU6CgogICAgICAgICAgICAgICAgY29udGFpbmVkID0gW10KCgoKICAgICAgICAgICAgaWYgbm90IGlzaW5zdGFuY2UoY29udGFpbmVkLCBsaXN0KToKCiAgICAgICAgICAgICAgICByYWlzZSBUeXBlRXJyb3IoCgogICAgICAgICAgICAgICAgICAgIFwie30gbWF5IG9ubHkgYmUgY29uc3RydWN0ZWQgd2l0aCBhIGxpc3QsXCIKCiAgICAgICAgICAgICAgICAgICAgXCIgbm90IHt9XCIuZm9ybWF0KGNscy5fX25hbWVfXywgdHlwZShjb250YWluZWQpLl9fbmFtZV9fKQoKICAgICAgICAgICAgICAgICkKCgoKICAgICAgICAgICAgcmV0dXJuIGxpc3QuX19uZXdfXyhjbHMpCgoKCiAgICBkZWYgX19uZXdfXyhjbHMsIHRva2xpc3Q9Tm9uZSwgbmFtZT1Ob25lLCAqKmt3YXJncyk6CgogICAgICAgIGlmIGlzaW5zdGFuY2UodG9rbGlzdCwgUGFyc2VSZXN1bHRzKToKCiAgICAgICAgICAgIHJldHVybiB0b2tsaXN0CgogICAgICAgIHNlbGYgPSBvYmplY3QuX19uZXdfXyhjbHMpCgogICAgICAgIHNlbGYuX25hbWUgPSBOb25lCgogICAgICAgIHNlbGYuX3BhcmVudCA9IE5vbmUKCiAgICAgICAgc2VsZi5fYWxsX25hbWVzID0gc2V0KCkKCgoKICAgICAgICBpZiB0b2tsaXN0IGlzIE5vbmU6CgogICAgICAgICAgICBzZWxmLl90b2tsaXN0ID0gW10KCiAgICAgICAgZWxpZiBpc2luc3RhbmNlKHRva2xpc3QsIChsaXN0LCBfZ2VuZXJhdG9yX3R5cGUpKToKCiAgICAgICAgICAgIHNlbGYuX3Rva2xpc3QgPSAoCgogICAgICAgICAgICAgICAgW3Rva2xpc3RbOl1dCgogICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh0b2tsaXN0LCBQYXJzZVJlc3VsdHMuTGlzdCkKCiAgICAgICAgICAgICAgICBlbHNlIGxpc3QodG9rbGlzdCkKCiAgICAgICAgICAgICkKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHNlbGYuX3Rva2xpc3QgPSBbdG9rbGlzdF0KCiAgICAgICAgc2VsZi5fdG9rZGljdCA9IGRpY3QoKQoKICAgICAgICByZXR1cm4gc2VsZgoKCgogICAgIyBQZXJmb3JtYW5jZSB0dW5pbmc6IHdlIGNvbnN0cnVjdCBhICpsb3QqIG9mIHRoZXNlLCBzbyBrZWVwIHRoaXMKCiAgICAjIGNvbnN0cnVjdG9yIGFzIHNtYWxsIGFuZCBmYXN0IGFzIHBvc3NpYmxlCgogICAgZGVmIF9faW5pdF9fKAoKICAgICAgICBzZWxmLCB0b2tsaXN0PU5vbmUsIG5hbWU9Tm9uZSwgYXNMaXN0PVRydWUsIG1vZGFsPVRydWUsIGlzaW5zdGFuY2U9aXNpbnN0YW5jZQoKICAgICk6CgogICAgICAgIHNlbGYuX21vZGFsID0gbW9kYWwKCiAgICAgICAgaWYgbmFtZSBpcyBub3QgTm9uZSBhbmQgbmFtZSAhPSBcIlwiOgoKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShuYW1lLCBpbnQpOgoKICAgICAgICAgICAgICAgIG5hbWUgPSBzdHIobmFtZSkKCiAgICAgICAgICAgIGlmIG5vdCBtb2RhbDoKCiAgICAgICAgICAgICAgICBzZWxmLl9hbGxfbmFtZXMgPSB7bmFtZX0KCiAgICAgICAgICAgIHNlbGYuX25hbWUgPSBuYW1lCgogICAgICAgICAgICBpZiB0b2tsaXN0IG5vdCBpbiBzZWxmLl9udWxsX3ZhbHVlczoKCiAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHRva2xpc3QsIChzdHJfdHlwZSwgdHlwZSkpOgoKICAgICAgICAgICAgICAgICAgICB0b2tsaXN0ID0gW3Rva2xpc3RdCgogICAgICAgICAgICAgICAgaWYgYXNMaXN0OgoKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHRva2xpc3QsIFBhcnNlUmVzdWx0cyk6CgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmW25hbWVdID0gX1BhcnNlUmVzdWx0c1dpdGhPZmZzZXQoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyc2VSZXN1bHRzKHRva2xpc3QuX3Rva2xpc3QpLCAwCgogICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmW25hbWVdID0gX1BhcnNlUmVzdWx0c1dpdGhPZmZzZXQoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyc2VSZXN1bHRzKHRva2xpc3RbMF0pLCAwCgogICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgIHNlbGZbbmFtZV0uX25hbWUgPSBuYW1lCgogICAgICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZltuYW1lXSA9IHRva2xpc3RbMF0KCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IChLZXlFcnJvciwgVHlwZUVycm9yLCBJbmRleEVycm9yKToKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRva2xpc3QgaXMgbm90IHNlbGY6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZltuYW1lXSA9IHRva2xpc3QKCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fbmFtZSA9IG5hbWUKCgoKICAgIGRlZiBfX2dldGl0ZW1fXyhzZWxmLCBpKToKCiAgICAgICAgaWYgaXNpbnN0YW5jZShpLCAoaW50LCBzbGljZSkpOgoKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX3Rva2xpc3RbaV0KCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIGlmIGkgbm90IGluIHNlbGYuX2FsbF9uYW1lczoKCiAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5fdG9rZGljdFtpXVstMV1bMF0KCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgcmV0dXJuIFBhcnNlUmVzdWx0cyhbdlswXSBmb3IgdiBpbiBzZWxmLl90b2tkaWN0W2ldXSkKCgoKICAgIGRlZiBfX3NldGl0ZW1fXyhzZWxmLCBrLCB2LCBpc2luc3RhbmNlPWlzaW5zdGFuY2UpOgoKICAgICAgICBpZiBpc2luc3RhbmNlKHYsIF9QYXJzZVJlc3VsdHNXaXRoT2Zmc2V0KToKCiAgICAgICAgICAgIHNlbGYuX3Rva2RpY3Rba10gPSBzZWxmLl90b2tkaWN0LmdldChrLCBsaXN0KCkpICsgW3ZdCgogICAgICAgICAgICBzdWIgPSB2WzBdCgogICAgICAgIGVsaWYgaXNpbnN0YW5jZShrLCAoaW50LCBzbGljZSkpOgoKICAgICAgICAgICAgc2VsZi5fdG9rbGlzdFtrXSA9IHYKCiAgICAgICAgICAgIHN1YiA9IHYKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHNlbGYuX3Rva2RpY3Rba10gPSBzZWxmLl90b2tkaWN0LmdldChrLCBsaXN0KCkpICsgWwoKICAgICAgICAgICAgICAgIF9QYXJzZVJlc3VsdHNXaXRoT2Zmc2V0KHYsIDApCgogICAgICAgICAgICBdCgogICAgICAgICAgICBzdWIgPSB2CgogICAgICAgIGlmIGlzaW5zdGFuY2Uoc3ViLCBQYXJzZVJlc3VsdHMpOgoKICAgICAgICAgICAgc3ViLl9wYXJlbnQgPSB3a3JlZihzZWxmKQoKCgogICAgZGVmIF9fZGVsaXRlbV9fKHNlbGYsIGkpOgoKICAgICAgICBpZiBpc2luc3RhbmNlKGksIChpbnQsIHNsaWNlKSk6CgogICAgICAgICAgICBteWxlbiA9IGxlbihzZWxmLl90b2tsaXN0KQoKICAgICAgICAgICAgZGVsIHNlbGYuX3Rva2xpc3RbaV0KCgoKICAgICAgICAgICAgIyBjb252ZXJ0IGludCB0byBzbGljZQoKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShpLCBpbnQpOgoKICAgICAgICAgICAgICAgIGlmIGkgPCAwOgoKICAgICAgICAgICAgICAgICAgICBpICs9IG15bGVuCgogICAgICAgICAgICAgICAgaSA9IHNsaWNlKGksIGkgKyAxKQoKICAgICAgICAgICAgIyBnZXQgcmVtb3ZlZCBpbmRpY2VzCgogICAgICAgICAgICByZW1vdmVkID0gbGlzdChyYW5nZSgqaS5pbmRpY2VzKG15bGVuKSkpCgogICAgICAgICAgICByZW1vdmVkLnJldmVyc2UoKQoKICAgICAgICAgICAgIyBmaXh1cCBpbmRpY2VzIGluIHRva2VuIGRpY3Rpb25hcnkKCiAgICAgICAgICAgIGZvciBuYW1lLCBvY2N1cnJlbmNlcyBpbiBzZWxmLl90b2tkaWN0Lml0ZW1zKCk6CgogICAgICAgICAgICAgICAgZm9yIGogaW4gcmVtb3ZlZDoKCiAgICAgICAgICAgICAgICAgICAgZm9yIGssICh2YWx1ZSwgcG9zaXRpb24pIGluIGVudW1lcmF0ZShvY2N1cnJlbmNlcyk6CgogICAgICAgICAgICAgICAgICAgICAgICBvY2N1cnJlbmNlc1trXSA9IF9QYXJzZVJlc3VsdHNXaXRoT2Zmc2V0KAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLCBwb3NpdGlvbiAtIChwb3NpdGlvbiA+IGopCgogICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBkZWwgc2VsZi5fdG9rZGljdFtpXQoKCgogICAgZGVmIF9fY29udGFpbnNfXyhzZWxmLCBrKSAtPiBib29sOgoKICAgICAgICByZXR1cm4gayBpbiBzZWxmLl90b2tkaWN0CgoKCiAgICBkZWYgX19sZW5fXyhzZWxmKSAtPiBpbnQ6CgogICAgICAgIHJldHVybiBsZW4oc2VsZi5fdG9rbGlzdCkKCgoKICAgIGRlZiBfX2Jvb2xfXyhzZWxmKSAtPiBib29sOgoKICAgICAgICByZXR1cm4gbm90IG5vdCAoc2VsZi5fdG9rbGlzdCBvciBzZWxmLl90b2tkaWN0KQoKCgogICAgZGVmIF9faXRlcl9fKHNlbGYpIC0+IEl0ZXJhdG9yOgoKICAgICAgICByZXR1cm4gaXRlcihzZWxmLl90b2tsaXN0KQoKCgogICAgZGVmIF9fcmV2ZXJzZWRfXyhzZWxmKSAtPiBJdGVyYXRvcjoKCiAgICAgICAgcmV0dXJuIGl0ZXIoc2VsZi5fdG9rbGlzdFs6Oi0xXSkKCgoKICAgIGRlZiBrZXlzKHNlbGYpOgoKICAgICAgICByZXR1cm4gaXRlcihzZWxmLl90b2tkaWN0KQoKCgogICAgZGVmIHZhbHVlcyhzZWxmKToKCiAgICAgICAgcmV0dXJuIChzZWxmW2tdIGZvciBrIGluIHNlbGYua2V5cygpKQoKCgogICAgZGVmIGl0ZW1zKHNlbGYpOgoKICAgICAgICByZXR1cm4gKChrLCBzZWxmW2tdKSBmb3IgayBpbiBzZWxmLmtleXMoKSkKCgoKICAgIGRlZiBoYXNrZXlzKHNlbGYpIC0+IGJvb2w6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBTaW5jZSBgYGtleXMoKWBgIHJldHVybnMgYW4gaXRlcmF0b3IsIHRoaXMgbWV0aG9kIGlzIGhlbHBmdWwgaW4gYnlwYXNzaW5nCgogICAgICAgIGNvZGUgdGhhdCBsb29rcyBmb3IgdGhlIGV4aXN0ZW5jZSBvZiBhbnkgZGVmaW5lZCByZXN1bHRzIG5hbWVzLlwiXCJcIgoKICAgICAgICByZXR1cm4gYm9vbChzZWxmLl90b2tkaWN0KQoKCgogICAgZGVmIHBvcChzZWxmLCAqYXJncywgKiprd2FyZ3MpOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgUmVtb3ZlcyBhbmQgcmV0dXJucyBpdGVtIGF0IHNwZWNpZmllZCBpbmRleCAoZGVmYXVsdD0gYGBsYXN0YGApLgoKICAgICAgICBTdXBwb3J0cyBib3RoIGBgbGlzdGBgIGFuZCBgYGRpY3RgYCBzZW1hbnRpY3MgZm9yIGBgcG9wKClgYC4gSWYKCiAgICAgICAgcGFzc2VkIG5vIGFyZ3VtZW50IG9yIGFuIGludGVnZXIgYXJndW1lbnQsIGl0IHdpbGwgdXNlIGBgbGlzdGBgCgogICAgICAgIHNlbWFudGljcyBhbmQgcG9wIHRva2VucyBmcm9tIHRoZSBsaXN0IG9mIHBhcnNlZCB0b2tlbnMuIElmIHBhc3NlZAoKICAgICAgICBhIG5vbi1pbnRlZ2VyIGFyZ3VtZW50IChtb3N0IGxpa2VseSBhIHN0cmluZyksIGl0IHdpbGwgdXNlIGBgZGljdGBgCgogICAgICAgIHNlbWFudGljcyBhbmQgcG9wIHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlIGZyb20gYW55IGRlZmluZWQgcmVzdWx0cwoKICAgICAgICBuYW1lcy4gQSBzZWNvbmQgZGVmYXVsdCByZXR1cm4gdmFsdWUgYXJndW1lbnQgaXMgc3VwcG9ydGVkLCBqdXN0IGFzIGluCgogICAgICAgIGBgZGljdC5wb3AoKWBgLgoKCgogICAgICAgIEV4YW1wbGU6OgoKCgogICAgICAgICAgICBudW1saXN0ID0gV29yZChudW1zKVsuLi5dCgogICAgICAgICAgICBwcmludChudW1saXN0LnBhcnNlX3N0cmluZyhcIjAgMTIzIDMyMVwiKSkgIyAtPiBbJzAnLCAnMTIzJywgJzMyMSddCgoKCiAgICAgICAgICAgIGRlZiByZW1vdmVfZmlyc3QodG9rZW5zKToKCiAgICAgICAgICAgICAgICB0b2tlbnMucG9wKDApCgogICAgICAgICAgICBudW1saXN0LmFkZF9wYXJzZV9hY3Rpb24ocmVtb3ZlX2ZpcnN0KQoKICAgICAgICAgICAgcHJpbnQobnVtbGlzdC5wYXJzZV9zdHJpbmcoXCIwIDEyMyAzMjFcIikpICMgLT4gWycxMjMnLCAnMzIxJ10KCgoKICAgICAgICAgICAgbGFiZWwgPSBXb3JkKGFscGhhcykKCiAgICAgICAgICAgIHBhdHQgPSBsYWJlbChcIkxBQkVMXCIpICsgV29yZChudW1zKVsxLCAuLi5dCgogICAgICAgICAgICBwcmludChwYXR0LnBhcnNlX3N0cmluZyhcIkFBQiAxMjMgMzIxXCIpLmR1bXAoKSkKCgoKICAgICAgICAgICAgIyBVc2UgcG9wKCkgaW4gYSBwYXJzZSBhY3Rpb24gdG8gcmVtb3ZlIG5hbWVkIHJlc3VsdCAobm90ZSB0aGF0IGNvcnJlc3BvbmRpbmcgdmFsdWUgaXMgbm90CgogICAgICAgICAgICAjIHJlbW92ZWQgZnJvbSBsaXN0IGZvcm0gb2YgcmVzdWx0cykKCiAgICAgICAgICAgIGRlZiByZW1vdmVfTEFCRUwodG9rZW5zKToKCiAgICAgICAgICAgICAgICB0b2tlbnMucG9wKFwiTEFCRUxcIikKCiAgICAgICAgICAgICAgICByZXR1cm4gdG9rZW5zCgogICAgICAgICAgICBwYXR0LmFkZF9wYXJzZV9hY3Rpb24ocmVtb3ZlX0xBQkVMKQoKICAgICAgICAgICAgcHJpbnQocGF0dC5wYXJzZV9zdHJpbmcoXCJBQUIgMTIzIDMyMVwiKS5kdW1wKCkpCgoKCiAgICAgICAgcHJpbnRzOjoKCgoKICAgICAgICAgICAgWydBQUInLCAnMTIzJywgJzMyMSddCgogICAgICAgICAgICAtIExBQkVMOiAnQUFCJwoKCgogICAgICAgICAgICBbJ0FBQicsICcxMjMnLCAnMzIxJ10KCiAgICAgICAgXCJcIlwiCgogICAgICAgIGlmIG5vdCBhcmdzOgoKICAgICAgICAgICAgYXJncyA9IFstMV0KCiAgICAgICAgZm9yIGssIHYgaW4ga3dhcmdzLml0ZW1zKCk6CgogICAgICAgICAgICBpZiBrID09IFwiZGVmYXVsdFwiOgoKICAgICAgICAgICAgICAgIGFyZ3MgPSAoYXJnc1swXSwgdikKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgcmFpc2UgVHlwZUVycm9yKAoKICAgICAgICAgICAgICAgICAgICBcInBvcCgpIGdvdCBhbiB1bmV4cGVjdGVkIGtleXdvcmQgYXJndW1lbnQgeyFyfVwiLmZvcm1hdChrKQoKICAgICAgICAgICAgICAgICkKCiAgICAgICAgaWYgaXNpbnN0YW5jZShhcmdzWzBdLCBpbnQpIG9yIGxlbihhcmdzKSA9PSAxIG9yIGFyZ3NbMF0gaW4gc2VsZjoKCiAgICAgICAgICAgIGluZGV4ID0gYXJnc1swXQoKICAgICAgICAgICAgcmV0ID0gc2VsZltpbmRleF0KCiAgICAgICAgICAgIGRlbCBzZWxmW2luZGV4XQoKICAgICAgICAgICAgcmV0dXJuIHJldAoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgZGVmYXVsdHZhbHVlID0gYXJnc1sxXQoKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHR2YWx1ZQoKCgogICAgZGVmIGdldChzZWxmLCBrZXksIGRlZmF1bHRfdmFsdWU9Tm9uZSk6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBSZXR1cm5zIG5hbWVkIHJlc3VsdCBtYXRjaGluZyB0aGUgZ2l2ZW4ga2V5LCBvciBpZiB0aGVyZSBpcyBubwoKICAgICAgICBzdWNoIG5hbWUsIHRoZW4gcmV0dXJucyB0aGUgZ2l2ZW4gYGBkZWZhdWx0X3ZhbHVlYGAgb3IgYGBOb25lYGAgaWYgbm8KCiAgICAgICAgYGBkZWZhdWx0X3ZhbHVlYGAgaXMgc3BlY2lmaWVkLgoKCgogICAgICAgIFNpbWlsYXIgdG8gYGBkaWN0LmdldCgpYGAuCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIGludGVnZXIgPSBXb3JkKG51bXMpCgogICAgICAgICAgICBkYXRlX3N0ciA9IGludGVnZXIoXCJ5ZWFyXCIpICsgJy8nICsgaW50ZWdlcihcIm1vbnRoXCIpICsgJy8nICsgaW50ZWdlcihcImRheVwiKQoKCgogICAgICAgICAgICByZXN1bHQgPSBkYXRlX3N0ci5wYXJzZV9zdHJpbmcoXCIxOTk5LzEyLzMxXCIpCgogICAgICAgICAgICBwcmludChyZXN1bHQuZ2V0KFwieWVhclwiKSkgIyAtPiAnMTk5OScKCiAgICAgICAgICAgIHByaW50KHJlc3VsdC5nZXQoXCJob3VyXCIsIFwibm90IHNwZWNpZmllZFwiKSkgIyAtPiAnbm90IHNwZWNpZmllZCcKCiAgICAgICAgICAgIHByaW50KHJlc3VsdC5nZXQoXCJob3VyXCIpKSAjIC0+IE5vbmUKCiAgICAgICAgXCJcIlwiCgogICAgICAgIGlmIGtleSBpbiBzZWxmOgoKICAgICAgICAgICAgcmV0dXJuIHNlbGZba2V5XQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRfdmFsdWUKCgoKICAgIGRlZiBpbnNlcnQoc2VsZiwgaW5kZXgsIGluc19zdHJpbmcpOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgSW5zZXJ0cyBuZXcgZWxlbWVudCBhdCBsb2NhdGlvbiBpbmRleCBpbiB0aGUgbGlzdCBvZiBwYXJzZWQgdG9rZW5zLgoKCgogICAgICAgIFNpbWlsYXIgdG8gYGBsaXN0Lmluc2VydCgpYGAuCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIG51bWxpc3QgPSBXb3JkKG51bXMpWy4uLl0KCiAgICAgICAgICAgIHByaW50KG51bWxpc3QucGFyc2Vfc3RyaW5nKFwiMCAxMjMgMzIxXCIpKSAjIC0+IFsnMCcsICcxMjMnLCAnMzIxJ10KCgoKICAgICAgICAgICAgIyB1c2UgYSBwYXJzZSBhY3Rpb24gdG8gaW5zZXJ0IHRoZSBwYXJzZSBsb2NhdGlvbiBpbiB0aGUgZnJvbnQgb2YgdGhlIHBhcnNlZCByZXN1bHRzCgogICAgICAgICAgICBkZWYgaW5zZXJ0X2xvY24obG9jbiwgdG9rZW5zKToKCiAgICAgICAgICAgICAgICB0b2tlbnMuaW5zZXJ0KDAsIGxvY24pCgogICAgICAgICAgICBudW1saXN0LmFkZF9wYXJzZV9hY3Rpb24oaW5zZXJ0X2xvY24pCgogICAgICAgICAgICBwcmludChudW1saXN0LnBhcnNlX3N0cmluZyhcIjAgMTIzIDMyMVwiKSkgIyAtPiBbMCwgJzAnLCAnMTIzJywgJzMyMSddCgogICAgICAgIFwiXCJcIgoKICAgICAgICBzZWxmLl90b2tsaXN0Lmluc2VydChpbmRleCwgaW5zX3N0cmluZykKCiAgICAgICAgIyBmaXh1cCBpbmRpY2VzIGluIHRva2VuIGRpY3Rpb25hcnkKCiAgICAgICAgZm9yIG5hbWUsIG9jY3VycmVuY2VzIGluIHNlbGYuX3Rva2RpY3QuaXRlbXMoKToKCiAgICAgICAgICAgIGZvciBrLCAodmFsdWUsIHBvc2l0aW9uKSBpbiBlbnVtZXJhdGUob2NjdXJyZW5jZXMpOgoKICAgICAgICAgICAgICAgIG9jY3VycmVuY2VzW2tdID0gX1BhcnNlUmVzdWx0c1dpdGhPZmZzZXQoCgogICAgICAgICAgICAgICAgICAgIHZhbHVlLCBwb3NpdGlvbiArIChwb3NpdGlvbiA+IGluZGV4KQoKICAgICAgICAgICAgICAgICkKCgoKICAgIGRlZiBhcHBlbmQoc2VsZiwgaXRlbSk6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBBZGQgc2luZ2xlIGVsZW1lbnQgdG8gZW5kIG9mIGBgUGFyc2VSZXN1bHRzYGAgbGlzdCBvZiBlbGVtZW50cy4KCgoKICAgICAgICBFeGFtcGxlOjoKCgoKICAgICAgICAgICAgbnVtbGlzdCA9IFdvcmQobnVtcylbLi4uXQoKICAgICAgICAgICAgcHJpbnQobnVtbGlzdC5wYXJzZV9zdHJpbmcoXCIwIDEyMyAzMjFcIikpICMgLT4gWycwJywgJzEyMycsICczMjEnXQoKCgogICAgICAgICAgICAjIHVzZSBhIHBhcnNlIGFjdGlvbiB0byBjb21wdXRlIHRoZSBzdW0gb2YgdGhlIHBhcnNlZCBpbnRlZ2VycywgYW5kIGFkZCBpdCB0byB0aGUgZW5kCgogICAgICAgICAgICBkZWYgYXBwZW5kX3N1bSh0b2tlbnMpOgoKICAgICAgICAgICAgICAgIHRva2Vucy5hcHBlbmQoc3VtKG1hcChpbnQsIHRva2VucykpKQoKICAgICAgICAgICAgbnVtbGlzdC5hZGRfcGFyc2VfYWN0aW9uKGFwcGVuZF9zdW0pCgogICAgICAgICAgICBwcmludChudW1saXN0LnBhcnNlX3N0cmluZyhcIjAgMTIzIDMyMVwiKSkgIyAtPiBbJzAnLCAnMTIzJywgJzMyMScsIDQ0NF0KCiAgICAgICAgXCJcIlwiCgogICAgICAgIHNlbGYuX3Rva2xpc3QuYXBwZW5kKGl0ZW0pCgoKCiAgICBkZWYgZXh0ZW5kKHNlbGYsIGl0ZW1zZXEpOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgQWRkIHNlcXVlbmNlIG9mIGVsZW1lbnRzIHRvIGVuZCBvZiBgYFBhcnNlUmVzdWx0c2BgIGxpc3Qgb2YgZWxlbWVudHMuCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIHBhdHQgPSBXb3JkKGFscGhhcylbMSwgLi4uXQoKCgogICAgICAgICAgICAjIHVzZSBhIHBhcnNlIGFjdGlvbiB0byBhcHBlbmQgdGhlIHJldmVyc2Ugb2YgdGhlIG1hdGNoZWQgc3RyaW5ncywgdG8gbWFrZSBhIHBhbGluZHJvbWUKCiAgICAgICAgICAgIGRlZiBtYWtlX3BhbGluZHJvbWUodG9rZW5zKToKCiAgICAgICAgICAgICAgICB0b2tlbnMuZXh0ZW5kKHJldmVyc2VkKFt0Wzo6LTFdIGZvciB0IGluIHRva2Vuc10pKQoKICAgICAgICAgICAgICAgIHJldHVybiAnJy5qb2luKHRva2VucykKCiAgICAgICAgICAgIHBhdHQuYWRkX3BhcnNlX2FjdGlvbihtYWtlX3BhbGluZHJvbWUpCgogICAgICAgICAgICBwcmludChwYXR0LnBhcnNlX3N0cmluZyhcImxza2RqIHNkbGtqZiBsa3NkXCIpKSAjIC0+ICdsc2tkanNkbGtqZmxrc2Rkc2tsZmprbGRzamRrc2wnCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpZiBpc2luc3RhbmNlKGl0ZW1zZXEsIFBhcnNlUmVzdWx0cyk6CgogICAgICAgICAgICBzZWxmLl9faWFkZF9fKGl0ZW1zZXEpCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBzZWxmLl90b2tsaXN0LmV4dGVuZChpdGVtc2VxKQoKCgogICAgZGVmIGNsZWFyKHNlbGYpOgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgQ2xlYXIgYWxsIGVsZW1lbnRzIGFuZCByZXN1bHRzIG5hbWVzLgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgZGVsIHNlbGYuX3Rva2xpc3RbOl0KCiAgICAgICAgc2VsZi5fdG9rZGljdC5jbGVhcigpCgoKCiAgICBkZWYgX19nZXRhdHRyX18oc2VsZiwgbmFtZSk6CgogICAgICAgIHRyeToKCiAgICAgICAgICAgIHJldHVybiBzZWxmW25hbWVdCgogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKCiAgICAgICAgICAgIGlmIG5hbWUuc3RhcnRzd2l0aChcIl9fXCIpOgoKICAgICAgICAgICAgICAgIHJhaXNlIEF0dHJpYnV0ZUVycm9yKG5hbWUpCgogICAgICAgICAgICByZXR1cm4gXCJcIgoKCgogICAgZGVmIF9fYWRkX18oc2VsZiwgb3RoZXIpIC0+IFwiUGFyc2VSZXN1bHRzXCI6CgogICAgICAgIHJldCA9IHNlbGYuY29weSgpCgogICAgICAgIHJldCArPSBvdGhlcgoKICAgICAgICByZXR1cm4gcmV0CgoKCiAgICBkZWYgX19pYWRkX18oc2VsZiwgb3RoZXIpIC0+IFwiUGFyc2VSZXN1bHRzXCI6CgogICAgICAgIGlmIG90aGVyLl90b2tkaWN0OgoKICAgICAgICAgICAgb2Zmc2V0ID0gbGVuKHNlbGYuX3Rva2xpc3QpCgogICAgICAgICAgICBhZGRvZmZzZXQgPSBsYW1iZGEgYTogb2Zmc2V0IGlmIGEgPCAwIGVsc2UgYSArIG9mZnNldAoKICAgICAgICAgICAgb3RoZXJpdGVtcyA9IG90aGVyLl90b2tkaWN0Lml0ZW1zKCkKCiAgICAgICAgICAgIG90aGVyZGljdGl0ZW1zID0gWwoKICAgICAgICAgICAgICAgIChrLCBfUGFyc2VSZXN1bHRzV2l0aE9mZnNldCh2WzBdLCBhZGRvZmZzZXQodlsxXSkpKQoKICAgICAgICAgICAgICAgIGZvciBrLCB2bGlzdCBpbiBvdGhlcml0ZW1zCgogICAgICAgICAgICAgICAgZm9yIHYgaW4gdmxpc3QKCiAgICAgICAgICAgIF0KCiAgICAgICAgICAgIGZvciBrLCB2IGluIG90aGVyZGljdGl0ZW1zOgoKICAgICAgICAgICAgICAgIHNlbGZba10gPSB2CgogICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh2WzBdLCBQYXJzZVJlc3VsdHMpOgoKICAgICAgICAgICAgICAgICAgICB2WzBdLl9wYXJlbnQgPSB3a3JlZihzZWxmKQoKCgogICAgICAgIHNlbGYuX3Rva2xpc3QgKz0gb3RoZXIuX3Rva2xpc3QKCiAgICAgICAgc2VsZi5fYWxsX25hbWVzIHw9IG90aGVyLl9hbGxfbmFtZXMKCiAgICAgICAgcmV0dXJuIHNlbGYKCgoKICAgIGRlZiBfX3JhZGRfXyhzZWxmLCBvdGhlcikgLT4gXCJQYXJzZVJlc3VsdHNcIjoKCiAgICAgICAgaWYgaXNpbnN0YW5jZShvdGhlciwgaW50KSBhbmQgb3RoZXIgPT0gMDoKCiAgICAgICAgICAgICMgdXNlZnVsIGZvciBtZXJnaW5nIG1hbnkgUGFyc2VSZXN1bHRzIHVzaW5nIHN1bSgpIGJ1aWx0aW4KCiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvcHkoKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgIyB0aGlzIG1heSByYWlzZSBhIFR5cGVFcnJvciAtIHNvIGJlIGl0CgogICAgICAgICAgICByZXR1cm4gb3RoZXIgKyBzZWxmCgoKCiAgICBkZWYgX19yZXByX18oc2VsZikgLT4gc3RyOgoKICAgICAgICByZXR1cm4gXCJ7fSh7IXJ9LCB7fSlcIi5mb3JtYXQodHlwZShzZWxmKS5fX25hbWVfXywgc2VsZi5fdG9rbGlzdCwgc2VsZi5hc19kaWN0KCkpCgoKCiAgICBkZWYgX19zdHJfXyhzZWxmKSAtPiBzdHI6CgogICAgICAgIHJldHVybiAoCgogICAgICAgICAgICBcIltcIgoKICAgICAgICAgICAgKyBcIiwgXCIuam9pbigKCiAgICAgICAgICAgICAgICBbCgogICAgICAgICAgICAgICAgICAgIHN0cihpKSBpZiBpc2luc3RhbmNlKGksIFBhcnNlUmVzdWx0cykgZWxzZSByZXByKGkpCgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHNlbGYuX3Rva2xpc3QKCiAgICAgICAgICAgICAgICBdCgogICAgICAgICAgICApCgogICAgICAgICAgICArIFwiXVwiCgogICAgICAgICkKCgoKICAgIGRlZiBfYXNTdHJpbmdMaXN0KHNlbGYsIHNlcD1cIlwiKToKCiAgICAgICAgb3V0ID0gW10KCiAgICAgICAgZm9yIGl0ZW0gaW4gc2VsZi5fdG9rbGlzdDoKCiAgICAgICAgICAgIGlmIG91dCBhbmQgc2VwOgoKICAgICAgICAgICAgICAgIG91dC5hcHBlbmQoc2VwKQoKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShpdGVtLCBQYXJzZVJlc3VsdHMpOgoKICAgICAgICAgICAgICAgIG91dCArPSBpdGVtLl9hc1N0cmluZ0xpc3QoKQoKICAgICAgICAgICAgZWxzZToKCiAgICAgICAgICAgICAgICBvdXQuYXBwZW5kKHN0cihpdGVtKSkKCiAgICAgICAgcmV0dXJuIG91dAoKCgogICAgZGVmIGFzX2xpc3Qoc2VsZikgLT4gbGlzdDoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIFJldHVybnMgdGhlIHBhcnNlIHJlc3VsdHMgYXMgYSBuZXN0ZWQgbGlzdCBvZiBtYXRjaGluZyB0b2tlbnMsIGFsbCBjb252ZXJ0ZWQgdG8gc3RyaW5ncy4KCgoKICAgICAgICBFeGFtcGxlOjoKCgoKICAgICAgICAgICAgcGF0dCA9IFdvcmQoYWxwaGFzKVsxLCAuLi5dCgogICAgICAgICAgICByZXN1bHQgPSBwYXR0LnBhcnNlX3N0cmluZyhcInNsZGtqIGxzZGtqIHNsZGtqXCIpCgogICAgICAgICAgICAjIGV2ZW4gdGhvdWdoIHRoZSByZXN1bHQgcHJpbnRzIGluIHN0cmluZy1saWtlIGZvcm0sIGl0IGlzIGFjdHVhbGx5IGEgcHlwYXJzaW5nIFBhcnNlUmVzdWx0cwoKICAgICAgICAgICAgcHJpbnQodHlwZShyZXN1bHQpLCByZXN1bHQpICMgLT4gPGNsYXNzICdweXBhcnNpbmcuUGFyc2VSZXN1bHRzJz4gWydzbGRraicsICdsc2RraicsICdzbGRraiddCgoKCiAgICAgICAgICAgICMgVXNlIGFzX2xpc3QoKSB0byBjcmVhdGUgYW4gYWN0dWFsIGxpc3QKCiAgICAgICAgICAgIHJlc3VsdF9saXN0ID0gcmVzdWx0LmFzX2xpc3QoKQoKICAgICAgICAgICAgcHJpbnQodHlwZShyZXN1bHRfbGlzdCksIHJlc3VsdF9saXN0KSAjIC0+IDxjbGFzcyAnbGlzdCc+IFsnc2xka2onLCAnbHNka2onLCAnc2xka2onXQoKICAgICAgICBcIlwiXCIKCiAgICAgICAgcmV0dXJuIFsKCiAgICAgICAgICAgIHJlcy5hc19saXN0KCkgaWYgaXNpbnN0YW5jZShyZXMsIFBhcnNlUmVzdWx0cykgZWxzZSByZXMKCiAgICAgICAgICAgIGZvciByZXMgaW4gc2VsZi5fdG9rbGlzdAoKICAgICAgICBdCgoKCiAgICBkZWYgYXNfZGljdChzZWxmKSAtPiBkaWN0OgoKICAgICAgICBcIlwiXCIKCiAgICAgICAgUmV0dXJucyB0aGUgbmFtZWQgcGFyc2UgcmVzdWx0cyBhcyBhIG5lc3RlZCBkaWN0aW9uYXJ5LgoKCgogICAgICAgIEV4YW1wbGU6OgoKCgogICAgICAgICAgICBpbnRlZ2VyID0gV29yZChudW1zKQoKICAgICAgICAgICAgZGF0ZV9zdHIgPSBpbnRlZ2VyKFwieWVhclwiKSArICcvJyArIGludGVnZXIoXCJtb250aFwiKSArICcvJyArIGludGVnZXIoXCJkYXlcIikKCgoKICAgICAgICAgICAgcmVzdWx0ID0gZGF0ZV9zdHIucGFyc2Vfc3RyaW5nKCcxMi8zMS8xOTk5JykKCiAgICAgICAgICAgIHByaW50KHR5cGUocmVzdWx0KSwgcmVwcihyZXN1bHQpKSAjIC0+IDxjbGFzcyAncHlwYXJzaW5nLlBhcnNlUmVzdWx0cyc+IChbJzEyJywgJy8nLCAnMzEnLCAnLycsICcxOTk5J10sIHsnZGF5JzogWygnMTk5OScsIDQpXSwgJ3llYXInOiBbKCcxMicsIDApXSwgJ21vbnRoJzogWygnMzEnLCAyKV19KQoKCgogICAgICAgICAgICByZXN1bHRfZGljdCA9IHJlc3VsdC5hc19kaWN0KCkKCiAgICAgICAgICAgIHByaW50KHR5cGUocmVzdWx0X2RpY3QpLCByZXByKHJlc3VsdF9kaWN0KSkgIyAtPiA8Y2xhc3MgJ2RpY3QnPiB7J2RheSc6ICcxOTk5JywgJ3llYXInOiAnMTInLCAnbW9udGgnOiAnMzEnfQoKCgogICAgICAgICAgICAjIGV2ZW4gdGhvdWdoIGEgUGFyc2VSZXN1bHRzIHN1cHBvcnRzIGRpY3QtbGlrZSBhY2Nlc3MsIHNvbWV0aW1lIHlvdSBqdXN0IG5lZWQgdG8gaGF2ZSBhIGRpY3QKCiAgICAgICAgICAgIGltcG9ydCBqc29uCgogICAgICAgICAgICBwcmludChqc29uLmR1bXBzKHJlc3VsdCkpICMgLT4gRXhjZXB0aW9uOiBUeXBlRXJyb3I6IC4uLiBpcyBub3QgSlNPTiBzZXJpYWxpemFibGUKCiAgICAgICAgICAgIHByaW50KGpzb24uZHVtcHMocmVzdWx0LmFzX2RpY3QoKSkpICMgLT4ge1wibW9udGhcIjogXCIzMVwiLCBcImRheVwiOiBcIjE5OTlcIiwgXCJ5ZWFyXCI6IFwiMTJcIn0KCiAgICAgICAgXCJcIlwiCgoKCiAgICAgICAgZGVmIHRvX2l0ZW0ob2JqKToKCiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uob2JqLCBQYXJzZVJlc3VsdHMpOgoKICAgICAgICAgICAgICAgIHJldHVybiBvYmouYXNfZGljdCgpIGlmIG9iai5oYXNrZXlzKCkgZWxzZSBbdG9faXRlbSh2KSBmb3IgdiBpbiBvYmpdCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIHJldHVybiBvYmoKCgoKICAgICAgICByZXR1cm4gZGljdCgoaywgdG9faXRlbSh2KSkgZm9yIGssIHYgaW4gc2VsZi5pdGVtcygpKQoKCgogICAgZGVmIGNvcHkoc2VsZikgLT4gXCJQYXJzZVJlc3VsdHNcIjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIFJldHVybnMgYSBuZXcgY29weSBvZiBhIDpjbGFzczpgUGFyc2VSZXN1bHRzYCBvYmplY3QuCgogICAgICAgIFwiXCJcIgoKICAgICAgICByZXQgPSBQYXJzZVJlc3VsdHMoc2VsZi5fdG9rbGlzdCkKCiAgICAgICAgcmV0Ll90b2tkaWN0ID0gc2VsZi5fdG9rZGljdC5jb3B5KCkKCiAgICAgICAgcmV0Ll9wYXJlbnQgPSBzZWxmLl9wYXJlbnQKCiAgICAgICAgcmV0Ll9hbGxfbmFtZXMgfD0gc2VsZi5fYWxsX25hbWVzCgogICAgICAgIHJldC5fbmFtZSA9IHNlbGYuX25hbWUKCiAgICAgICAgcmV0dXJuIHJldAoKCgogICAgZGVmIGdldF9uYW1lKHNlbGYpOgoKICAgICAgICByXCJcIlwiCgogICAgICAgIFJldHVybnMgdGhlIHJlc3VsdHMgbmFtZSBmb3IgdGhpcyB0b2tlbiBleHByZXNzaW9uLiBVc2VmdWwgd2hlbiBzZXZlcmFsCgogICAgICAgIGRpZmZlcmVudCBleHByZXNzaW9ucyBtaWdodCBtYXRjaCBhdCBhIHBhcnRpY3VsYXIgbG9jYXRpb24uCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIGludGVnZXIgPSBXb3JkKG51bXMpCgogICAgICAgICAgICBzc25fZXhwciA9IFJlZ2V4KHJcIlxcZFxcZFxcZC1cXGRcXGQtXFxkXFxkXFxkXFxkXCIpCgogICAgICAgICAgICBob3VzZV9udW1iZXJfZXhwciA9IFN1cHByZXNzKCcjJykgKyBXb3JkKG51bXMsIGFscGhhbnVtcykKCiAgICAgICAgICAgIHVzZXJfZGF0YSA9IChHcm91cChob3VzZV9udW1iZXJfZXhwcikoXCJob3VzZV9udW1iZXJcIikKCiAgICAgICAgICAgICAgICAgICAgICAgIHwgR3JvdXAoc3NuX2V4cHIpKFwic3NuXCIpCgogICAgICAgICAgICAgICAgICAgICAgICB8IEdyb3VwKGludGVnZXIpKFwiYWdlXCIpKQoKICAgICAgICAgICAgdXNlcl9pbmZvID0gdXNlcl9kYXRhWzEsIC4uLl0KCgoKICAgICAgICAgICAgcmVzdWx0ID0gdXNlcl9pbmZvLnBhcnNlX3N0cmluZyhcIjIyIDExMS0yMi0zMzMzICMyMjFCXCIpCgogICAgICAgICAgICBmb3IgaXRlbSBpbiByZXN1bHQ6CgogICAgICAgICAgICAgICAgcHJpbnQoaXRlbS5nZXRfbmFtZSgpLCAnOicsIGl0ZW1bMF0pCgoKCiAgICAgICAgcHJpbnRzOjoKCgoKICAgICAgICAgICAgYWdlIDogMjIKCiAgICAgICAgICAgIHNzbiA6IDExMS0yMi0zMzMzCgogICAgICAgICAgICBob3VzZV9udW1iZXIgOiAyMjFCCgogICAgICAgIFwiXCJcIgoKICAgICAgICBpZiBzZWxmLl9uYW1lOgoKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX25hbWUKCiAgICAgICAgZWxpZiBzZWxmLl9wYXJlbnQ6CgogICAgICAgICAgICBwYXIgPSBzZWxmLl9wYXJlbnQoKQoKCgogICAgICAgICAgICBkZWYgZmluZF9pbl9wYXJlbnQoc3ViKToKCiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dCgKCiAgICAgICAgICAgICAgICAgICAgKAoKICAgICAgICAgICAgICAgICAgICAgICAgawoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGssIHZsaXN0IGluIHBhci5fdG9rZGljdC5pdGVtcygpCgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgdiwgbG9jIGluIHZsaXN0CgogICAgICAgICAgICAgICAgICAgICAgICBpZiBzdWIgaXMgdgoKICAgICAgICAgICAgICAgICAgICApLAoKICAgICAgICAgICAgICAgICAgICBOb25lLAoKICAgICAgICAgICAgICAgICkKCgoKICAgICAgICAgICAgcmV0dXJuIGZpbmRfaW5fcGFyZW50KHNlbGYpIGlmIHBhciBlbHNlIE5vbmUKCiAgICAgICAgZWxpZiAoCgogICAgICAgICAgICBsZW4oc2VsZikgPT0gMQoKICAgICAgICAgICAgYW5kIGxlbihzZWxmLl90b2tkaWN0KSA9PSAxCgogICAgICAgICAgICBhbmQgbmV4dChpdGVyKHNlbGYuX3Rva2RpY3QudmFsdWVzKCkpKVswXVsxXSBpbiAoMCwgLTEpCgogICAgICAgICk6CgogICAgICAgICAgICByZXR1cm4gbmV4dChpdGVyKHNlbGYuX3Rva2RpY3Qua2V5cygpKSkKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHJldHVybiBOb25lCgoKCiAgICBkZWYgZHVtcChzZWxmLCBpbmRlbnQ9XCJcIiwgZnVsbD1UcnVlLCBpbmNsdWRlX2xpc3Q9VHJ1ZSwgX2RlcHRoPTApIC0+IHN0cjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIERpYWdub3N0aWMgbWV0aG9kIGZvciBsaXN0aW5nIG91dCB0aGUgY29udGVudHMgb2YKCiAgICAgICAgYSA6Y2xhc3M6YFBhcnNlUmVzdWx0c2AuIEFjY2VwdHMgYW4gb3B0aW9uYWwgYGBpbmRlbnRgYCBhcmd1bWVudCBzbwoKICAgICAgICB0aGF0IHRoaXMgc3RyaW5nIGNhbiBiZSBlbWJlZGRlZCBpbiBhIG5lc3RlZCBkaXNwbGF5IG9mIG90aGVyIGRhdGEuCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIGludGVnZXIgPSBXb3JkKG51bXMpCgogICAgICAgICAgICBkYXRlX3N0ciA9IGludGVnZXIoXCJ5ZWFyXCIpICsgJy8nICsgaW50ZWdlcihcIm1vbnRoXCIpICsgJy8nICsgaW50ZWdlcihcImRheVwiKQoKCgogICAgICAgICAgICByZXN1bHQgPSBkYXRlX3N0ci5wYXJzZV9zdHJpbmcoJzE5OTkvMTIvMzEnKQoKICAgICAgICAgICAgcHJpbnQocmVzdWx0LmR1bXAoKSkKCgoKICAgICAgICBwcmludHM6OgoKCgogICAgICAgICAgICBbJzE5OTknLCAnLycsICcxMicsICcvJywgJzMxJ10KCiAgICAgICAgICAgIC0gZGF5OiAnMzEnCgogICAgICAgICAgICAtIG1vbnRoOiAnMTInCgogICAgICAgICAgICAtIHllYXI6ICcxOTk5JwoKICAgICAgICBcIlwiXCIKCiAgICAgICAgb3V0ID0gW10KCiAgICAgICAgTkwgPSBcIlxcblwiCgogICAgICAgIG91dC5hcHBlbmQoaW5kZW50ICsgc3RyKHNlbGYuYXNfbGlzdCgpKSBpZiBpbmNsdWRlX2xpc3QgZWxzZSBcIlwiKQoKCgogICAgICAgIGlmIGZ1bGw6CgogICAgICAgICAgICBpZiBzZWxmLmhhc2tleXMoKToKCiAgICAgICAgICAgICAgICBpdGVtcyA9IHNvcnRlZCgoc3RyKGspLCB2KSBmb3IgaywgdiBpbiBzZWxmLml0ZW1zKCkpCgogICAgICAgICAgICAgICAgZm9yIGssIHYgaW4gaXRlbXM6CgogICAgICAgICAgICAgICAgICAgIGlmIG91dDoKCiAgICAgICAgICAgICAgICAgICAgICAgIG91dC5hcHBlbmQoTkwpCgogICAgICAgICAgICAgICAgICAgIG91dC5hcHBlbmQoXCJ7fXt9LSB7fTogXCIuZm9ybWF0KGluZGVudCwgKFwiICBcIiAqIF9kZXB0aCksIGspKQoKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHYsIFBhcnNlUmVzdWx0cyk6CgogICAgICAgICAgICAgICAgICAgICAgICBpZiB2OgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dC5hcHBlbmQoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuZHVtcCgKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGVudD1pbmRlbnQsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsPWZ1bGwsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlX2xpc3Q9aW5jbHVkZV9saXN0LAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2RlcHRoPV9kZXB0aCArIDEsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dC5hcHBlbmQoc3RyKHYpKQoKICAgICAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICAgICAgb3V0LmFwcGVuZChyZXByKHYpKQoKICAgICAgICAgICAgaWYgYW55KGlzaW5zdGFuY2UodnYsIFBhcnNlUmVzdWx0cykgZm9yIHZ2IGluIHNlbGYpOgoKICAgICAgICAgICAgICAgIHYgPSBzZWxmCgogICAgICAgICAgICAgICAgZm9yIGksIHZ2IGluIGVudW1lcmF0ZSh2KToKCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh2diwgUGFyc2VSZXN1bHRzKToKCiAgICAgICAgICAgICAgICAgICAgICAgIG91dC5hcHBlbmQoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJcXG57fXt9W3t9XTpcXG57fXt9e31cIi5mb3JtYXQoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGVudCwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKFwiICBcIiAqIChfZGVwdGgpKSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZW50LAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoXCIgIFwiICogKF9kZXB0aCArIDEpKSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdnYuZHVtcCgKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGVudD1pbmRlbnQsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsPWZ1bGwsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNsdWRlX2xpc3Q9aW5jbHVkZV9saXN0LAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2RlcHRoPV9kZXB0aCArIDEsCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICksCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICAgICAgb3V0LmFwcGVuZCgKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIlxcbiVzJXNbJWRdOlxcbiVzJXMlc1wiCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJSAoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGVudCwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKFwiICBcIiAqIChfZGVwdGgpKSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZW50LAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoXCIgIFwiICogKF9kZXB0aCArIDEpKSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyKHZ2KSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgICAgICAgICApCgoKCiAgICAgICAgcmV0dXJuIFwiXCIuam9pbihvdXQpCgoKCiAgICBkZWYgcHByaW50KHNlbGYsICphcmdzLCAqKmt3YXJncyk6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBQcmV0dHktcHJpbnRlciBmb3IgcGFyc2VkIHJlc3VsdHMgYXMgYSBsaXN0LCB1c2luZyB0aGUKCiAgICAgICAgYHBwcmludCA8aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9saWJyYXJ5L3BwcmludC5odG1sPmBfIG1vZHVsZS4KCiAgICAgICAgQWNjZXB0cyBhZGRpdGlvbmFsIHBvc2l0aW9uYWwgb3Iga2V5d29yZCBhcmdzIGFzIGRlZmluZWQgZm9yCgogICAgICAgIGBwcHJpbnQucHByaW50IDxodHRwczovL2RvY3MucHl0aG9uLm9yZy8zL2xpYnJhcnkvcHByaW50Lmh0bWwjcHByaW50LnBwcmludD5gXyAuCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIGlkZW50ID0gV29yZChhbHBoYXMsIGFscGhhbnVtcykKCiAgICAgICAgICAgIG51bSA9IFdvcmQobnVtcykKCiAgICAgICAgICAgIGZ1bmMgPSBGb3J3YXJkKCkKCiAgICAgICAgICAgIHRlcm0gPSBpZGVudCB8IG51bSB8IEdyb3VwKCcoJyArIGZ1bmMgKyAnKScpCgogICAgICAgICAgICBmdW5jIDw8PSBpZGVudCArIEdyb3VwKE9wdGlvbmFsKGRlbGltaXRlZF9saXN0KHRlcm0pKSkKCiAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMucGFyc2Vfc3RyaW5nKFwiZm5hIGEsYiwoZm5iIGMsZCwyMDApLDEwMFwiKQoKICAgICAgICAgICAgcmVzdWx0LnBwcmludCh3aWR0aD00MCkKCgoKICAgICAgICBwcmludHM6OgoKCgogICAgICAgICAgICBbJ2ZuYScsCgogICAgICAgICAgICAgWydhJywKCiAgICAgICAgICAgICAgJ2InLAoKICAgICAgICAgICAgICBbJygnLCAnZm5iJywgWydjJywgJ2QnLCAnMjAwJ10sICcpJ10sCgogICAgICAgICAgICAgICcxMDAnXV0KCiAgICAgICAgXCJcIlwiCgogICAgICAgIHBwcmludC5wcHJpbnQoc2VsZi5hc19saXN0KCksICphcmdzLCAqKmt3YXJncykKCgoKICAgICMgYWRkIHN1cHBvcnQgZm9yIHBpY2tsZSBwcm90b2NvbAoKICAgIGRlZiBfX2dldHN0YXRlX18oc2VsZik6CgogICAgICAgIHJldHVybiAoCgogICAgICAgICAgICBzZWxmLl90b2tsaXN0LAoKICAgICAgICAgICAgKAoKICAgICAgICAgICAgICAgIHNlbGYuX3Rva2RpY3QuY29weSgpLAoKICAgICAgICAgICAgICAgIHNlbGYuX3BhcmVudCBpcyBub3QgTm9uZSBhbmQgc2VsZi5fcGFyZW50KCkgb3IgTm9uZSwKCiAgICAgICAgICAgICAgICBzZWxmLl9hbGxfbmFtZXMsCgogICAgICAgICAgICAgICAgc2VsZi5fbmFtZSwKCiAgICAgICAgICAgICksCgogICAgICAgICkKCgoKICAgIGRlZiBfX3NldHN0YXRlX18oc2VsZiwgc3RhdGUpOgoKICAgICAgICBzZWxmLl90b2tsaXN0LCAoc2VsZi5fdG9rZGljdCwgcGFyLCBpbkFjY3VtTmFtZXMsIHNlbGYuX25hbWUpID0gc3RhdGUKCiAgICAgICAgc2VsZi5fYWxsX25hbWVzID0gc2V0KGluQWNjdW1OYW1lcykKCiAgICAgICAgaWYgcGFyIGlzIG5vdCBOb25lOgoKICAgICAgICAgICAgc2VsZi5fcGFyZW50ID0gd2tyZWYocGFyKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgc2VsZi5fcGFyZW50ID0gTm9uZQoKCgogICAgZGVmIF9fZ2V0bmV3YXJnc19fKHNlbGYpOgoKICAgICAgICByZXR1cm4gc2VsZi5fdG9rbGlzdCwgc2VsZi5fbmFtZQoKCgogICAgZGVmIF9fZGlyX18oc2VsZik6CgogICAgICAgIHJldHVybiBkaXIodHlwZShzZWxmKSkgKyBsaXN0KHNlbGYua2V5cygpKQoKCgogICAgQGNsYXNzbWV0aG9kCgogICAgZGVmIGZyb21fZGljdChjbHMsIG90aGVyLCBuYW1lPU5vbmUpIC0+IFwiUGFyc2VSZXN1bHRzXCI6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBIZWxwZXIgY2xhc3NtZXRob2QgdG8gY29uc3RydWN0IGEgYGBQYXJzZVJlc3VsdHNgYCBmcm9tIGEgYGBkaWN0YGAsIHByZXNlcnZpbmcgdGhlCgogICAgICAgIG5hbWUtdmFsdWUgcmVsYXRpb25zIGFzIHJlc3VsdHMgbmFtZXMuIElmIGFuIG9wdGlvbmFsIGBgbmFtZWBgIGFyZ3VtZW50IGlzCgogICAgICAgIGdpdmVuLCBhIG5lc3RlZCBgYFBhcnNlUmVzdWx0c2BgIHdpbGwgYmUgcmV0dXJuZWQuCgogICAgICAgIFwiXCJcIgoKCgogICAgICAgIGRlZiBpc19pdGVyYWJsZShvYmopOgoKICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgIGl0ZXIob2JqKQoKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgcmV0dXJuIG5vdCBpc2luc3RhbmNlKG9iaiwgc3RyX3R5cGUpCgoKCiAgICAgICAgcmV0ID0gY2xzKFtdKQoKICAgICAgICBmb3IgaywgdiBpbiBvdGhlci5pdGVtcygpOgoKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZSh2LCBNYXBwaW5nKToKCiAgICAgICAgICAgICAgICByZXQgKz0gY2xzLmZyb21fZGljdCh2LCBuYW1lPWspCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIHJldCArPSBjbHMoW3ZdLCBuYW1lPWssIGFzTGlzdD1pc19pdGVyYWJsZSh2KSkKCiAgICAgICAgaWYgbmFtZSBpcyBub3QgTm9uZToKCiAgICAgICAgICAgIHJldCA9IGNscyhbcmV0XSwgbmFtZT1uYW1lKQoKICAgICAgICByZXR1cm4gcmV0CgoKCiAgICBhc0xpc3QgPSBhc19saXN0CgogICAgYXNEaWN0ID0gYXNfZGljdAoKICAgIGdldE5hbWUgPSBnZXRfbmFtZQoKCgoKCk11dGFibGVNYXBwaW5nLnJlZ2lzdGVyKFBhcnNlUmVzdWx0cykKCk11dGFibGVTZXF1ZW5jZS5yZWdpc3RlcihQYXJzZVJlc3VsdHMpCgoKCiIiIgoKbW9kdWxlX2RpY3RbInB5cGFyc2luZy9fX2luaXRfXy5weSJdPSIiIgoKIyBtb2R1bGUgcHlwYXJzaW5nLnB5CgojCgojIENvcHlyaWdodCAoYykgMjAwMy0yMDIyICBQYXVsIFQuIE1jR3VpcmUKCiMKCiMgUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nCgojIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZQoKIyBcIlNvZnR3YXJlXCIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcKCiMgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLAoKIyBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8KCiMgcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvCgojIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKCiMKCiMgVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUKCiMgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCgojCgojIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsCgojIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRgoKIyBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuCgojIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZCgojIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsCgojIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFCgojIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgoKIwoKCgpfX2RvY19fID0gXCJcIlwiCgpweXBhcnNpbmcgbW9kdWxlIC0gQ2xhc3NlcyBhbmQgbWV0aG9kcyB0byBkZWZpbmUgYW5kIGV4ZWN1dGUgcGFyc2luZyBncmFtbWFycwoKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCgoKVGhlIHB5cGFyc2luZyBtb2R1bGUgaXMgYW4gYWx0ZXJuYXRpdmUgYXBwcm9hY2ggdG8gY3JlYXRpbmcgYW5kCgpleGVjdXRpbmcgc2ltcGxlIGdyYW1tYXJzLCB2cy4gdGhlIHRyYWRpdGlvbmFsIGxleC95YWNjIGFwcHJvYWNoLCBvciB0aGUKCnVzZSBvZiByZWd1bGFyIGV4cHJlc3Npb25zLiAgV2l0aCBweXBhcnNpbmcsIHlvdSBkb24ndCBuZWVkIHRvIGxlYXJuCgphIG5ldyBzeW50YXggZm9yIGRlZmluaW5nIGdyYW1tYXJzIG9yIG1hdGNoaW5nIGV4cHJlc3Npb25zIC0gdGhlIHBhcnNpbmcKCm1vZHVsZSBwcm92aWRlcyBhIGxpYnJhcnkgb2YgY2xhc3NlcyB0aGF0IHlvdSB1c2UgdG8gY29uc3RydWN0IHRoZQoKZ3JhbW1hciBkaXJlY3RseSBpbiBQeXRob24uCgoKCkhlcmUgaXMgYSBwcm9ncmFtIHRvIHBhcnNlIFwiSGVsbG8sIFdvcmxkIVwiIChvciBhbnkgZ3JlZXRpbmcgb2YgdGhlIGZvcm0KCmBgXCI8c2FsdXRhdGlvbj4sIDxhZGRyZXNzZWU+IVwiYGApLCBidWlsdCB1cCB1c2luZyA6Y2xhc3M6YFdvcmRgLAoKOmNsYXNzOmBMaXRlcmFsYCwgYW5kIDpjbGFzczpgQW5kYCBlbGVtZW50cwoKKHRoZSA6bWV0aDpgJysnPFBhcnNlckVsZW1lbnQuX19hZGRfXz5gIG9wZXJhdG9ycyBjcmVhdGUgOmNsYXNzOmBBbmRgIGV4cHJlc3Npb25zLAoKYW5kIHRoZSBzdHJpbmdzIGFyZSBhdXRvLWNvbnZlcnRlZCB0byA6Y2xhc3M6YExpdGVyYWxgIGV4cHJlc3Npb25zKTo6CgoKCiAgICBmcm9tIHB5cGFyc2luZyBpbXBvcnQgV29yZCwgYWxwaGFzCgoKCiAgICAjIGRlZmluZSBncmFtbWFyIG9mIGEgZ3JlZXRpbmcKCiAgICBncmVldCA9IFdvcmQoYWxwaGFzKSArIFwiLFwiICsgV29yZChhbHBoYXMpICsgXCIhXCIKCgoKICAgIGhlbGxvID0gXCJIZWxsbywgV29ybGQhXCIKCiAgICBwcmludChoZWxsbywgXCItPlwiLCBncmVldC5wYXJzZV9zdHJpbmcoaGVsbG8pKQoKCgpUaGUgcHJvZ3JhbSBvdXRwdXRzIHRoZSBmb2xsb3dpbmc6OgoKCgogICAgSGVsbG8sIFdvcmxkISAtPiBbJ0hlbGxvJywgJywnLCAnV29ybGQnLCAnISddCgoKClRoZSBQeXRob24gcmVwcmVzZW50YXRpb24gb2YgdGhlIGdyYW1tYXIgaXMgcXVpdGUgcmVhZGFibGUsIG93aW5nIHRvIHRoZQoKc2VsZi1leHBsYW5hdG9yeSBjbGFzcyBuYW1lcywgYW5kIHRoZSB1c2Ugb2YgOmNsYXNzOmAnKyc8QW5kPmAsCgo6Y2xhc3M6YCd8JzxNYXRjaEZpcnN0PmAsIDpjbGFzczpgJ14nPE9yPmAgYW5kIDpjbGFzczpgJyYnPEVhY2g+YCBvcGVyYXRvcnMuCgoKClRoZSA6Y2xhc3M6YFBhcnNlUmVzdWx0c2Agb2JqZWN0IHJldHVybmVkIGZyb20KCjpjbGFzczpgUGFyc2VyRWxlbWVudC5wYXJzZVN0cmluZ2AgY2FuIGJlCgphY2Nlc3NlZCBhcyBhIG5lc3RlZCBsaXN0LCBhIGRpY3Rpb25hcnksIG9yIGFuIG9iamVjdCB3aXRoIG5hbWVkCgphdHRyaWJ1dGVzLgoKCgpUaGUgcHlwYXJzaW5nIG1vZHVsZSBoYW5kbGVzIHNvbWUgb2YgdGhlIHByb2JsZW1zIHRoYXQgYXJlIHR5cGljYWxseQoKdmV4aW5nIHdoZW4gd3JpdGluZyB0ZXh0IHBhcnNlcnM6CgoKCiAgLSBleHRyYSBvciBtaXNzaW5nIHdoaXRlc3BhY2UgKHRoZSBhYm92ZSBwcm9ncmFtIHdpbGwgYWxzbyBoYW5kbGUKCiAgICBcIkhlbGxvLFdvcmxkIVwiLCBcIkhlbGxvICAsICBXb3JsZCAgIVwiLCBldGMuKQoKICAtIHF1b3RlZCBzdHJpbmdzCgogIC0gZW1iZWRkZWQgY29tbWVudHMKCgoKCgpHZXR0aW5nIFN0YXJ0ZWQgLQoKLS0tLS0tLS0tLS0tLS0tLS0KClZpc2l0IHRoZSBjbGFzc2VzIDpjbGFzczpgUGFyc2VyRWxlbWVudGAgYW5kIDpjbGFzczpgUGFyc2VSZXN1bHRzYCB0bwoKc2VlIHRoZSBiYXNlIGNsYXNzZXMgdGhhdCBtb3N0IG90aGVyIHB5cGFyc2luZwoKY2xhc3NlcyBpbmhlcml0IGZyb20uIFVzZSB0aGUgZG9jc3RyaW5ncyBmb3IgZXhhbXBsZXMgb2YgaG93IHRvOgoKCgogLSBjb25zdHJ1Y3QgbGl0ZXJhbCBtYXRjaCBleHByZXNzaW9ucyBmcm9tIDpjbGFzczpgTGl0ZXJhbGAgYW5kCgogICA6Y2xhc3M6YENhc2VsZXNzTGl0ZXJhbGAgY2xhc3NlcwoKIC0gY29uc3RydWN0IGNoYXJhY3RlciB3b3JkLWdyb3VwIGV4cHJlc3Npb25zIHVzaW5nIHRoZSA6Y2xhc3M6YFdvcmRgCgogICBjbGFzcwoKIC0gc2VlIGhvdyB0byBjcmVhdGUgcmVwZXRpdGl2ZSBleHByZXNzaW9ucyB1c2luZyA6Y2xhc3M6YFplcm9Pck1vcmVgCgogICBhbmQgOmNsYXNzOmBPbmVPck1vcmVgIGNsYXNzZXMKCiAtIHVzZSA6Y2xhc3M6YCcrJzxBbmQ+YCwgOmNsYXNzOmAnfCc8TWF0Y2hGaXJzdD5gLCA6Y2xhc3M6YCdeJzxPcj5gLAoKICAgYW5kIDpjbGFzczpgJyYnPEVhY2g+YCBvcGVyYXRvcnMgdG8gY29tYmluZSBzaW1wbGUgZXhwcmVzc2lvbnMgaW50bwoKICAgbW9yZSBjb21wbGV4IG9uZXMKCiAtIGFzc29jaWF0ZSBuYW1lcyB3aXRoIHlvdXIgcGFyc2VkIHJlc3VsdHMgdXNpbmcKCiAgIDpjbGFzczpgUGFyc2VyRWxlbWVudC5zZXRSZXN1bHRzTmFtZWAKCiAtIGFjY2VzcyB0aGUgcGFyc2VkIGRhdGEsIHdoaWNoIGlzIHJldHVybmVkIGFzIGEgOmNsYXNzOmBQYXJzZVJlc3VsdHNgCgogICBvYmplY3QKCiAtIGZpbmQgc29tZSBoZWxwZnVsIGV4cHJlc3Npb24gc2hvcnQtY3V0cyBsaWtlIDpjbGFzczpgZGVsaW1pdGVkTGlzdGAKCiAgIGFuZCA6Y2xhc3M6YG9uZU9mYAoKIC0gZmluZCBtb3JlIHVzZWZ1bCBjb21tb24gZXhwcmVzc2lvbnMgaW4gdGhlIDpjbGFzczpgcHlwYXJzaW5nX2NvbW1vbmAKCiAgIG5hbWVzcGFjZSBjbGFzcwoKXCJcIlwiCgpmcm9tIHR5cGluZyBpbXBvcnQgTmFtZWRUdXBsZQoKCgoKCmNsYXNzIHZlcnNpb25faW5mbyhOYW1lZFR1cGxlKToKCiAgICBtYWpvcjogaW50CgogICAgbWlub3I6IGludAoKICAgIG1pY3JvOiBpbnQKCiAgICByZWxlYXNlbGV2ZWw6IHN0cgoKICAgIHNlcmlhbDogaW50CgoKCiAgICBAcHJvcGVydHkKCiAgICBkZWYgX192ZXJzaW9uX18oc2VsZik6CgogICAgICAgIHJldHVybiAoCgogICAgICAgICAgICBcInt9Lnt9Lnt9XCIuZm9ybWF0KHNlbGYubWFqb3IsIHNlbGYubWlub3IsIHNlbGYubWljcm8pCgogICAgICAgICAgICArICgKCiAgICAgICAgICAgICAgICBcInt9e317fVwiLmZvcm1hdCgKCiAgICAgICAgICAgICAgICAgICAgXCJyXCIgaWYgc2VsZi5yZWxlYXNlbGV2ZWxbMF0gPT0gXCJjXCIgZWxzZSBcIlwiLAoKICAgICAgICAgICAgICAgICAgICBzZWxmLnJlbGVhc2VsZXZlbFswXSwKCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXJpYWwsCgogICAgICAgICAgICAgICAgKSwKCiAgICAgICAgICAgICAgICBcIlwiLAoKICAgICAgICAgICAgKVtzZWxmLnJlbGVhc2VsZXZlbCA9PSBcImZpbmFsXCJdCgogICAgICAgICkKCgoKICAgIGRlZiBfX3N0cl9fKHNlbGYpOgoKICAgICAgICByZXR1cm4gXCJ7fSB7fSAvIHt9XCIuZm9ybWF0KF9fbmFtZV9fLCBzZWxmLl9fdmVyc2lvbl9fLCBfX3ZlcnNpb25fdGltZV9fKQoKCgogICAgZGVmIF9fcmVwcl9fKHNlbGYpOgoKICAgICAgICByZXR1cm4gXCJ7fS57fSh7fSlcIi5mb3JtYXQoCgogICAgICAgICAgICBfX25hbWVfXywKCiAgICAgICAgICAgIHR5cGUoc2VsZikuX19uYW1lX18sCgogICAgICAgICAgICBcIiwgXCIuam9pbihcInt9PXshcn1cIi5mb3JtYXQoKm52KSBmb3IgbnYgaW4gemlwKHNlbGYuX2ZpZWxkcywgc2VsZikpLAoKICAgICAgICApCgoKCgoKX192ZXJzaW9uX2luZm9fXyA9IHZlcnNpb25faW5mbygzLCAwLCA5LCBcImZpbmFsXCIsIDApCgpfX3ZlcnNpb25fdGltZV9fID0gXCIwNSBNYXkgMjAyMiAwNzowMiBVVENcIgoKX192ZXJzaW9uX18gPSBfX3ZlcnNpb25faW5mb19fLl9fdmVyc2lvbl9fCgpfX3ZlcnNpb25UaW1lX18gPSBfX3ZlcnNpb25fdGltZV9fCgpfX2F1dGhvcl9fID0gXCJQYXVsIE1jR3VpcmUgPHB0bWNnLmdtK3B5cGFyc2luZ0BnbWFpbC5jb20+XCIKCgoKZnJvbSAudXRpbCBpbXBvcnQgKgoKZnJvbSAuZXhjZXB0aW9ucyBpbXBvcnQgKgoKZnJvbSAuYWN0aW9ucyBpbXBvcnQgKgoKZnJvbSAuY29yZSBpbXBvcnQgX19kaWFnX18sIF9fY29tcGF0X18KCmZyb20gLnJlc3VsdHMgaW1wb3J0ICoKCmZyb20gLmNvcmUgaW1wb3J0ICoKCmZyb20gLmNvcmUgaW1wb3J0IF9idWlsdGluX2V4cHJzIGFzIGNvcmVfYnVpbHRpbl9leHBycwoKZnJvbSAuaGVscGVycyBpbXBvcnQgKgoKZnJvbSAuaGVscGVycyBpbXBvcnQgX2J1aWx0aW5fZXhwcnMgYXMgaGVscGVyX2J1aWx0aW5fZXhwcnMKCgoKZnJvbSAudW5pY29kZSBpbXBvcnQgdW5pY29kZV9zZXQsIFVuaWNvZGVSYW5nZUxpc3QsIHB5cGFyc2luZ191bmljb2RlIGFzIHVuaWNvZGUKCmZyb20gLnRlc3RpbmcgaW1wb3J0IHB5cGFyc2luZ190ZXN0IGFzIHRlc3RpbmcKCmZyb20gLmNvbW1vbiBpbXBvcnQgKAoKICAgIHB5cGFyc2luZ19jb21tb24gYXMgY29tbW9uLAoKICAgIF9idWlsdGluX2V4cHJzIGFzIGNvbW1vbl9idWlsdGluX2V4cHJzLAoKKQoKCgojIGRlZmluZSBiYWNrd2FyZCBjb21wYXQgc3lub255bXMKCmlmIFwicHlwYXJzaW5nX3VuaWNvZGVcIiBub3QgaW4gZ2xvYmFscygpOgoKICAgIHB5cGFyc2luZ191bmljb2RlID0gdW5pY29kZQoKaWYgXCJweXBhcnNpbmdfY29tbW9uXCIgbm90IGluIGdsb2JhbHMoKToKCiAgICBweXBhcnNpbmdfY29tbW9uID0gY29tbW9uCgppZiBcInB5cGFyc2luZ190ZXN0XCIgbm90IGluIGdsb2JhbHMoKToKCiAgICBweXBhcnNpbmdfdGVzdCA9IHRlc3RpbmcKCgoKY29yZV9idWlsdGluX2V4cHJzICs9IGNvbW1vbl9idWlsdGluX2V4cHJzICsgaGVscGVyX2J1aWx0aW5fZXhwcnMKCgoKCgpfX2FsbF9fID0gWwoKICAgIFwiX192ZXJzaW9uX19cIiwKCiAgICBcIl9fdmVyc2lvbl90aW1lX19cIiwKCiAgICBcIl9fYXV0aG9yX19cIiwKCiAgICBcIl9fY29tcGF0X19cIiwKCiAgICBcIl9fZGlhZ19fXCIsCgogICAgXCJBbmRcIiwKCiAgICBcIkF0TGluZVN0YXJ0XCIsCgogICAgXCJBdFN0cmluZ1N0YXJ0XCIsCgogICAgXCJDYXNlbGVzc0tleXdvcmRcIiwKCiAgICBcIkNhc2VsZXNzTGl0ZXJhbFwiLAoKICAgIFwiQ2hhcnNOb3RJblwiLAoKICAgIFwiQ29tYmluZVwiLAoKICAgIFwiRGljdFwiLAoKICAgIFwiRWFjaFwiLAoKICAgIFwiRW1wdHlcIiwKCiAgICBcIkZvbGxvd2VkQnlcIiwKCiAgICBcIkZvcndhcmRcIiwKCiAgICBcIkdvVG9Db2x1bW5cIiwKCiAgICBcIkdyb3VwXCIsCgogICAgXCJJbmRlbnRlZEJsb2NrXCIsCgogICAgXCJLZXl3b3JkXCIsCgogICAgXCJMaW5lRW5kXCIsCgogICAgXCJMaW5lU3RhcnRcIiwKCiAgICBcIkxpdGVyYWxcIiwKCiAgICBcIkxvY2F0ZWRcIiwKCiAgICBcIlByZWNlZGVkQnlcIiwKCiAgICBcIk1hdGNoRmlyc3RcIiwKCiAgICBcIk5vTWF0Y2hcIiwKCiAgICBcIk5vdEFueVwiLAoKICAgIFwiT25lT3JNb3JlXCIsCgogICAgXCJPbmx5T25jZVwiLAoKICAgIFwiT3BBc3NvY1wiLAoKICAgIFwiT3B0XCIsCgogICAgXCJPcHRpb25hbFwiLAoKICAgIFwiT3JcIiwKCiAgICBcIlBhcnNlQmFzZUV4Y2VwdGlvblwiLAoKICAgIFwiUGFyc2VFbGVtZW50RW5oYW5jZVwiLAoKICAgIFwiUGFyc2VFeGNlcHRpb25cIiwKCiAgICBcIlBhcnNlRXhwcmVzc2lvblwiLAoKICAgIFwiUGFyc2VGYXRhbEV4Y2VwdGlvblwiLAoKICAgIFwiUGFyc2VSZXN1bHRzXCIsCgogICAgXCJQYXJzZVN5bnRheEV4Y2VwdGlvblwiLAoKICAgIFwiUGFyc2VyRWxlbWVudFwiLAoKICAgIFwiUG9zaXRpb25Ub2tlblwiLAoKICAgIFwiUXVvdGVkU3RyaW5nXCIsCgogICAgXCJSZWN1cnNpdmVHcmFtbWFyRXhjZXB0aW9uXCIsCgogICAgXCJSZWdleFwiLAoKICAgIFwiU2tpcFRvXCIsCgogICAgXCJTdHJpbmdFbmRcIiwKCiAgICBcIlN0cmluZ1N0YXJ0XCIsCgogICAgXCJTdXBwcmVzc1wiLAoKICAgIFwiVG9rZW5cIiwKCiAgICBcIlRva2VuQ29udmVydGVyXCIsCgogICAgXCJXaGl0ZVwiLAoKICAgIFwiV29yZFwiLAoKICAgIFwiV29yZEVuZFwiLAoKICAgIFwiV29yZFN0YXJ0XCIsCgogICAgXCJaZXJvT3JNb3JlXCIsCgogICAgXCJDaGFyXCIsCgogICAgXCJhbHBoYW51bXNcIiwKCiAgICBcImFscGhhc1wiLAoKICAgIFwiYWxwaGFzOGJpdFwiLAoKICAgIFwiYW55X2Nsb3NlX3RhZ1wiLAoKICAgIFwiYW55X29wZW5fdGFnXCIsCgogICAgXCJjX3N0eWxlX2NvbW1lbnRcIiwKCiAgICBcImNvbFwiLAoKICAgIFwiY29tbW9uX2h0bWxfZW50aXR5XCIsCgogICAgXCJjb3VudGVkX2FycmF5XCIsCgogICAgXCJjcHBfc3R5bGVfY29tbWVudFwiLAoKICAgIFwiZGJsX3F1b3RlZF9zdHJpbmdcIiwKCiAgICBcImRibF9zbGFzaF9jb21tZW50XCIsCgogICAgXCJkZWxpbWl0ZWRfbGlzdFwiLAoKICAgIFwiZGljdF9vZlwiLAoKICAgIFwiZW1wdHlcIiwKCiAgICBcImhleG51bXNcIiwKCiAgICBcImh0bWxfY29tbWVudFwiLAoKICAgIFwiaWRlbnRjaGFyc1wiLAoKICAgIFwiaWRlbnRib2R5Y2hhcnNcIiwKCiAgICBcImphdmFfc3R5bGVfY29tbWVudFwiLAoKICAgIFwibGluZVwiLAoKICAgIFwibGluZV9lbmRcIiwKCiAgICBcImxpbmVfc3RhcnRcIiwKCiAgICBcImxpbmVub1wiLAoKICAgIFwibWFrZV9odG1sX3RhZ3NcIiwKCiAgICBcIm1ha2VfeG1sX3RhZ3NcIiwKCiAgICBcIm1hdGNoX29ubHlfYXRfY29sXCIsCgogICAgXCJtYXRjaF9wcmV2aW91c19leHByXCIsCgogICAgXCJtYXRjaF9wcmV2aW91c19saXRlcmFsXCIsCgogICAgXCJuZXN0ZWRfZXhwclwiLAoKICAgIFwibnVsbF9kZWJ1Z19hY3Rpb25cIiwKCiAgICBcIm51bXNcIiwKCiAgICBcIm9uZV9vZlwiLAoKICAgIFwicHJpbnRhYmxlc1wiLAoKICAgIFwicHVuYzhiaXRcIiwKCiAgICBcInB5dGhvbl9zdHlsZV9jb21tZW50XCIsCgogICAgXCJxdW90ZWRfc3RyaW5nXCIsCgogICAgXCJyZW1vdmVfcXVvdGVzXCIsCgogICAgXCJyZXBsYWNlX3dpdGhcIiwKCiAgICBcInJlcGxhY2VfaHRtbF9lbnRpdHlcIiwKCiAgICBcInJlc3Rfb2ZfbGluZVwiLAoKICAgIFwic2dsX3F1b3RlZF9zdHJpbmdcIiwKCiAgICBcInNyYW5nZVwiLAoKICAgIFwic3RyaW5nX2VuZFwiLAoKICAgIFwic3RyaW5nX3N0YXJ0XCIsCgogICAgXCJ0cmFjZV9wYXJzZV9hY3Rpb25cIiwKCiAgICBcInVuaWNvZGVfc3RyaW5nXCIsCgogICAgXCJ3aXRoX2F0dHJpYnV0ZVwiLAoKICAgIFwiaW5kZW50ZWRCbG9ja1wiLAoKICAgIFwib3JpZ2luYWxfdGV4dF9mb3JcIiwKCiAgICBcInVuZ3JvdXBcIiwKCiAgICBcImluZml4X25vdGF0aW9uXCIsCgogICAgXCJsb2NhdGVkRXhwclwiLAoKICAgIFwid2l0aF9jbGFzc1wiLAoKICAgIFwiQ2xvc2VNYXRjaFwiLAoKICAgIFwidG9rZW5fbWFwXCIsCgogICAgXCJweXBhcnNpbmdfY29tbW9uXCIsCgogICAgXCJweXBhcnNpbmdfdW5pY29kZVwiLAoKICAgIFwidW5pY29kZV9zZXRcIiwKCiAgICBcImNvbmRpdGlvbl9hc19wYXJzZV9hY3Rpb25cIiwKCiAgICBcInB5cGFyc2luZ190ZXN0XCIsCgogICAgIyBwcmUtUEVQOCBjb21wYXRpYmlsaXR5IG5hbWVzCgogICAgXCJfX3ZlcnNpb25UaW1lX19cIiwKCiAgICBcImFueUNsb3NlVGFnXCIsCgogICAgXCJhbnlPcGVuVGFnXCIsCgogICAgXCJjU3R5bGVDb21tZW50XCIsCgogICAgXCJjb21tb25IVE1MRW50aXR5XCIsCgogICAgXCJjb3VudGVkQXJyYXlcIiwKCiAgICBcImNwcFN0eWxlQ29tbWVudFwiLAoKICAgIFwiZGJsUXVvdGVkU3RyaW5nXCIsCgogICAgXCJkYmxTbGFzaENvbW1lbnRcIiwKCiAgICBcImRlbGltaXRlZExpc3RcIiwKCiAgICBcImRpY3RPZlwiLAoKICAgIFwiaHRtbENvbW1lbnRcIiwKCiAgICBcImphdmFTdHlsZUNvbW1lbnRcIiwKCiAgICBcImxpbmVFbmRcIiwKCiAgICBcImxpbmVTdGFydFwiLAoKICAgIFwibWFrZUhUTUxUYWdzXCIsCgogICAgXCJtYWtlWE1MVGFnc1wiLAoKICAgIFwibWF0Y2hPbmx5QXRDb2xcIiwKCiAgICBcIm1hdGNoUHJldmlvdXNFeHByXCIsCgogICAgXCJtYXRjaFByZXZpb3VzTGl0ZXJhbFwiLAoKICAgIFwibmVzdGVkRXhwclwiLAoKICAgIFwibnVsbERlYnVnQWN0aW9uXCIsCgogICAgXCJvbmVPZlwiLAoKICAgIFwib3BBc3NvY1wiLAoKICAgIFwicHl0aG9uU3R5bGVDb21tZW50XCIsCgogICAgXCJxdW90ZWRTdHJpbmdcIiwKCiAgICBcInJlbW92ZVF1b3Rlc1wiLAoKICAgIFwicmVwbGFjZUhUTUxFbnRpdHlcIiwKCiAgICBcInJlcGxhY2VXaXRoXCIsCgogICAgXCJyZXN0T2ZMaW5lXCIsCgogICAgXCJzZ2xRdW90ZWRTdHJpbmdcIiwKCiAgICBcInN0cmluZ0VuZFwiLAoKICAgIFwic3RyaW5nU3RhcnRcIiwKCiAgICBcInRyYWNlUGFyc2VBY3Rpb25cIiwKCiAgICBcInVuaWNvZGVTdHJpbmdcIiwKCiAgICBcIndpdGhBdHRyaWJ1dGVcIiwKCiAgICBcImluZGVudGVkQmxvY2tcIiwKCiAgICBcIm9yaWdpbmFsVGV4dEZvclwiLAoKICAgIFwiaW5maXhOb3RhdGlvblwiLAoKICAgIFwibG9jYXRlZEV4cHJcIiwKCiAgICBcIndpdGhDbGFzc1wiLAoKICAgIFwidG9rZW5NYXBcIiwKCiAgICBcImNvbmRpdGlvbkFzUGFyc2VBY3Rpb25cIiwKCiAgICBcImF1dG9uYW1lX2VsZW1lbnRzXCIsCgpdCgoKCiIiIgoKbW9kdWxlX2RpY3RbInB5cGFyc2luZy91dGlsLnB5Il09IiIiCgojIHV0aWwucHkKCmltcG9ydCB3YXJuaW5ncwoKaW1wb3J0IHR5cGVzCgppbXBvcnQgY29sbGVjdGlvbnMKCmltcG9ydCBpdGVydG9vbHMKCmZyb20gZnVuY3Rvb2xzIGltcG9ydCBscnVfY2FjaGUKCmZyb20gdHlwaW5nIGltcG9ydCBMaXN0LCBVbmlvbiwgSXRlcmFibGUKCgoKX2JzbGFzaCA9IGNocig5MikKCgoKCgpjbGFzcyBfX2NvbmZpZ19mbGFnczoKCiAgICBcIlwiXCJJbnRlcm5hbCBjbGFzcyBmb3IgZGVmaW5pbmcgY29tcGF0aWJpbGl0eSBhbmQgZGVidWdnaW5nIGZsYWdzXCJcIlwiCgoKCiAgICBfYWxsX25hbWVzOiBMaXN0W3N0cl0gPSBbXQoKICAgIF9maXhlZF9uYW1lczogTGlzdFtzdHJdID0gW10KCiAgICBfdHlwZV9kZXNjID0gXCJjb25maWd1cmF0aW9uXCIKCgoKICAgIEBjbGFzc21ldGhvZAoKICAgIGRlZiBfc2V0KGNscywgZG5hbWUsIHZhbHVlKToKCiAgICAgICAgaWYgZG5hbWUgaW4gY2xzLl9maXhlZF9uYW1lczoKCiAgICAgICAgICAgIHdhcm5pbmdzLndhcm4oCgogICAgICAgICAgICAgICAgXCJ7fS57fSB7fSBpcyB7fSBhbmQgY2Fubm90IGJlIG92ZXJyaWRkZW5cIi5mb3JtYXQoCgogICAgICAgICAgICAgICAgICAgIGNscy5fX25hbWVfXywKCiAgICAgICAgICAgICAgICAgICAgZG5hbWUsCgogICAgICAgICAgICAgICAgICAgIGNscy5fdHlwZV9kZXNjLAoKICAgICAgICAgICAgICAgICAgICBzdHIoZ2V0YXR0cihjbHMsIGRuYW1lKSkudXBwZXIoKSwKCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICApCgogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgaWYgZG5hbWUgaW4gY2xzLl9hbGxfbmFtZXM6CgogICAgICAgICAgICBzZXRhdHRyKGNscywgZG5hbWUsIHZhbHVlKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihcIm5vIHN1Y2gge30geyFyfVwiLmZvcm1hdChjbHMuX3R5cGVfZGVzYywgZG5hbWUpKQoKCgogICAgZW5hYmxlID0gY2xhc3NtZXRob2QobGFtYmRhIGNscywgbmFtZTogY2xzLl9zZXQobmFtZSwgVHJ1ZSkpCgogICAgZGlzYWJsZSA9IGNsYXNzbWV0aG9kKGxhbWJkYSBjbHMsIG5hbWU6IGNscy5fc2V0KG5hbWUsIEZhbHNlKSkKCgoKCgpAbHJ1X2NhY2hlKG1heHNpemU9MTI4KQoKZGVmIGNvbChsb2M6IGludCwgc3RyZzogc3RyKSAtPiBpbnQ6CgogICAgXCJcIlwiCgogICAgUmV0dXJucyBjdXJyZW50IGNvbHVtbiB3aXRoaW4gYSBzdHJpbmcsIGNvdW50aW5nIG5ld2xpbmVzIGFzIGxpbmUgc2VwYXJhdG9ycy4KCiAgICBUaGUgZmlyc3QgY29sdW1uIGlzIG51bWJlciAxLgoKCgogICAgTm90ZTogdGhlIGRlZmF1bHQgcGFyc2luZyBiZWhhdmlvciBpcyB0byBleHBhbmQgdGFicyBpbiB0aGUgaW5wdXQgc3RyaW5nCgogICAgYmVmb3JlIHN0YXJ0aW5nIHRoZSBwYXJzaW5nIHByb2Nlc3MuICBTZWUKCiAgICA6Y2xhc3M6YFBhcnNlckVsZW1lbnQucGFyc2VTdHJpbmdgIGZvciBtb3JlCgogICAgaW5mb3JtYXRpb24gb24gcGFyc2luZyBzdHJpbmdzIGNvbnRhaW5pbmcgYGA8VEFCPmBgIHMsIGFuZCBzdWdnZXN0ZWQKCiAgICBtZXRob2RzIHRvIG1haW50YWluIGEgY29uc2lzdGVudCB2aWV3IG9mIHRoZSBwYXJzZWQgc3RyaW5nLCB0aGUgcGFyc2UKCiAgICBsb2NhdGlvbiwgYW5kIGxpbmUgYW5kIGNvbHVtbiBwb3NpdGlvbnMgd2l0aGluIHRoZSBwYXJzZWQgc3RyaW5nLgoKICAgIFwiXCJcIgoKICAgIHMgPSBzdHJnCgogICAgcmV0dXJuIDEgaWYgMCA8IGxvYyA8IGxlbihzKSBhbmQgc1tsb2MgLSAxXSA9PSBcIlxcblwiIGVsc2UgbG9jIC0gcy5yZmluZChcIlxcblwiLCAwLCBsb2MpCgoKCgoKQGxydV9jYWNoZShtYXhzaXplPTEyOCkKCmRlZiBsaW5lbm8obG9jOiBpbnQsIHN0cmc6IHN0cikgLT4gaW50OgoKICAgIFwiXCJcIlJldHVybnMgY3VycmVudCBsaW5lIG51bWJlciB3aXRoaW4gYSBzdHJpbmcsIGNvdW50aW5nIG5ld2xpbmVzIGFzIGxpbmUgc2VwYXJhdG9ycy4KCiAgICBUaGUgZmlyc3QgbGluZSBpcyBudW1iZXIgMS4KCgoKICAgIE5vdGUgLSB0aGUgZGVmYXVsdCBwYXJzaW5nIGJlaGF2aW9yIGlzIHRvIGV4cGFuZCB0YWJzIGluIHRoZSBpbnB1dCBzdHJpbmcKCiAgICBiZWZvcmUgc3RhcnRpbmcgdGhlIHBhcnNpbmcgcHJvY2Vzcy4gIFNlZSA6Y2xhc3M6YFBhcnNlckVsZW1lbnQucGFyc2VTdHJpbmdgCgogICAgZm9yIG1vcmUgaW5mb3JtYXRpb24gb24gcGFyc2luZyBzdHJpbmdzIGNvbnRhaW5pbmcgYGA8VEFCPmBgIHMsIGFuZAoKICAgIHN1Z2dlc3RlZCBtZXRob2RzIHRvIG1haW50YWluIGEgY29uc2lzdGVudCB2aWV3IG9mIHRoZSBwYXJzZWQgc3RyaW5nLCB0aGUKCiAgICBwYXJzZSBsb2NhdGlvbiwgYW5kIGxpbmUgYW5kIGNvbHVtbiBwb3NpdGlvbnMgd2l0aGluIHRoZSBwYXJzZWQgc3RyaW5nLgoKICAgIFwiXCJcIgoKICAgIHJldHVybiBzdHJnLmNvdW50KFwiXFxuXCIsIDAsIGxvYykgKyAxCgoKCgoKQGxydV9jYWNoZShtYXhzaXplPTEyOCkKCmRlZiBsaW5lKGxvYzogaW50LCBzdHJnOiBzdHIpIC0+IHN0cjoKCiAgICBcIlwiXCIKCiAgICBSZXR1cm5zIHRoZSBsaW5lIG9mIHRleHQgY29udGFpbmluZyBsb2Mgd2l0aGluIGEgc3RyaW5nLCBjb3VudGluZyBuZXdsaW5lcyBhcyBsaW5lIHNlcGFyYXRvcnMuCgogICAgXCJcIlwiCgogICAgbGFzdF9jciA9IHN0cmcucmZpbmQoXCJcXG5cIiwgMCwgbG9jKQoKICAgIG5leHRfY3IgPSBzdHJnLmZpbmQoXCJcXG5cIiwgbG9jKQoKICAgIHJldHVybiBzdHJnW2xhc3RfY3IgKyAxIDogbmV4dF9jcl0gaWYgbmV4dF9jciA+PSAwIGVsc2Ugc3RyZ1tsYXN0X2NyICsgMSA6XQoKCgoKCmNsYXNzIF9VbmJvdW5kZWRDYWNoZToKCiAgICBkZWYgX19pbml0X18oc2VsZik6CgogICAgICAgIGNhY2hlID0ge30KCiAgICAgICAgY2FjaGVfZ2V0ID0gY2FjaGUuZ2V0CgogICAgICAgIHNlbGYubm90X2luX2NhY2hlID0gbm90X2luX2NhY2hlID0gb2JqZWN0KCkKCgoKICAgICAgICBkZWYgZ2V0KF8sIGtleSk6CgogICAgICAgICAgICByZXR1cm4gY2FjaGVfZ2V0KGtleSwgbm90X2luX2NhY2hlKQoKCgogICAgICAgIGRlZiBzZXRfKF8sIGtleSwgdmFsdWUpOgoKICAgICAgICAgICAgY2FjaGVba2V5XSA9IHZhbHVlCgoKCiAgICAgICAgZGVmIGNsZWFyKF8pOgoKICAgICAgICAgICAgY2FjaGUuY2xlYXIoKQoKCgogICAgICAgIHNlbGYuc2l6ZSA9IE5vbmUKCiAgICAgICAgc2VsZi5nZXQgPSB0eXBlcy5NZXRob2RUeXBlKGdldCwgc2VsZikKCiAgICAgICAgc2VsZi5zZXQgPSB0eXBlcy5NZXRob2RUeXBlKHNldF8sIHNlbGYpCgogICAgICAgIHNlbGYuY2xlYXIgPSB0eXBlcy5NZXRob2RUeXBlKGNsZWFyLCBzZWxmKQoKCgoKCmNsYXNzIF9GaWZvQ2FjaGU6CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIHNpemUpOgoKICAgICAgICBzZWxmLm5vdF9pbl9jYWNoZSA9IG5vdF9pbl9jYWNoZSA9IG9iamVjdCgpCgogICAgICAgIGNhY2hlID0gY29sbGVjdGlvbnMuT3JkZXJlZERpY3QoKQoKICAgICAgICBjYWNoZV9nZXQgPSBjYWNoZS5nZXQKCgoKICAgICAgICBkZWYgZ2V0KF8sIGtleSk6CgogICAgICAgICAgICByZXR1cm4gY2FjaGVfZ2V0KGtleSwgbm90X2luX2NhY2hlKQoKCgogICAgICAgIGRlZiBzZXRfKF8sIGtleSwgdmFsdWUpOgoKICAgICAgICAgICAgY2FjaGVba2V5XSA9IHZhbHVlCgogICAgICAgICAgICB3aGlsZSBsZW4oY2FjaGUpID4gc2l6ZToKCiAgICAgICAgICAgICAgICBjYWNoZS5wb3BpdGVtKGxhc3Q9RmFsc2UpCgoKCiAgICAgICAgZGVmIGNsZWFyKF8pOgoKICAgICAgICAgICAgY2FjaGUuY2xlYXIoKQoKCgogICAgICAgIHNlbGYuc2l6ZSA9IHNpemUKCiAgICAgICAgc2VsZi5nZXQgPSB0eXBlcy5NZXRob2RUeXBlKGdldCwgc2VsZikKCiAgICAgICAgc2VsZi5zZXQgPSB0eXBlcy5NZXRob2RUeXBlKHNldF8sIHNlbGYpCgogICAgICAgIHNlbGYuY2xlYXIgPSB0eXBlcy5NZXRob2RUeXBlKGNsZWFyLCBzZWxmKQoKCgoKCmNsYXNzIExSVU1lbW86CgogICAgXCJcIlwiCgogICAgQSBtZW1vaXppbmcgbWFwcGluZyB0aGF0IHJldGFpbnMgYGNhcGFjaXR5YCBkZWxldGVkIGl0ZW1zCgoKCiAgICBUaGUgbWVtbyB0cmFja3MgcmV0YWluZWQgaXRlbXMgYnkgdGhlaXIgYWNjZXNzIG9yZGVyOyBvbmNlIGBjYXBhY2l0eWAgaXRlbXMKCiAgICBhcmUgcmV0YWluZWQsIHRoZSBsZWFzdCByZWNlbnRseSB1c2VkIGl0ZW0gaXMgZGlzY2FyZGVkLgoKICAgIFwiXCJcIgoKCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGNhcGFjaXR5KToKCiAgICAgICAgc2VsZi5fY2FwYWNpdHkgPSBjYXBhY2l0eQoKICAgICAgICBzZWxmLl9hY3RpdmUgPSB7fQoKICAgICAgICBzZWxmLl9tZW1vcnkgPSBjb2xsZWN0aW9ucy5PcmRlcmVkRGljdCgpCgoKCiAgICBkZWYgX19nZXRpdGVtX18oc2VsZiwga2V5KToKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2FjdGl2ZVtrZXldCgogICAgICAgIGV4Y2VwdCBLZXlFcnJvcjoKCiAgICAgICAgICAgIHNlbGYuX21lbW9yeS5tb3ZlX3RvX2VuZChrZXkpCgogICAgICAgICAgICByZXR1cm4gc2VsZi5fbWVtb3J5W2tleV0KCgoKICAgIGRlZiBfX3NldGl0ZW1fXyhzZWxmLCBrZXksIHZhbHVlKToKCiAgICAgICAgc2VsZi5fbWVtb3J5LnBvcChrZXksIE5vbmUpCgogICAgICAgIHNlbGYuX2FjdGl2ZVtrZXldID0gdmFsdWUKCgoKICAgIGRlZiBfX2RlbGl0ZW1fXyhzZWxmLCBrZXkpOgoKICAgICAgICB0cnk6CgogICAgICAgICAgICB2YWx1ZSA9IHNlbGYuX2FjdGl2ZS5wb3Aoa2V5KQoKICAgICAgICBleGNlcHQgS2V5RXJyb3I6CgogICAgICAgICAgICBwYXNzCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICB3aGlsZSBsZW4oc2VsZi5fbWVtb3J5KSA+PSBzZWxmLl9jYXBhY2l0eToKCiAgICAgICAgICAgICAgICBzZWxmLl9tZW1vcnkucG9waXRlbShsYXN0PUZhbHNlKQoKICAgICAgICAgICAgc2VsZi5fbWVtb3J5W2tleV0gPSB2YWx1ZQoKCgogICAgZGVmIGNsZWFyKHNlbGYpOgoKICAgICAgICBzZWxmLl9hY3RpdmUuY2xlYXIoKQoKICAgICAgICBzZWxmLl9tZW1vcnkuY2xlYXIoKQoKCgoKCmNsYXNzIFVuYm91bmRlZE1lbW8oZGljdCk6CgogICAgXCJcIlwiCgogICAgQSBtZW1vaXppbmcgbWFwcGluZyB0aGF0IHJldGFpbnMgYWxsIGRlbGV0ZWQgaXRlbXMKCiAgICBcIlwiXCIKCgoKICAgIGRlZiBfX2RlbGl0ZW1fXyhzZWxmLCBrZXkpOgoKICAgICAgICBwYXNzCgoKCgoKZGVmIF9lc2NhcGVfcmVnZXhfcmFuZ2VfY2hhcnMoczogc3RyKSAtPiBzdHI6CgogICAgIyBlc2NhcGUgdGhlc2UgY2hhcnM6IF4tW10KCiAgICBmb3IgYyBpbiByXCJcXF4tW11cIjoKCiAgICAgICAgcyA9IHMucmVwbGFjZShjLCBfYnNsYXNoICsgYykKCiAgICBzID0gcy5yZXBsYWNlKFwiXFxuXCIsIHJcIlxcblwiKQoKICAgIHMgPSBzLnJlcGxhY2UoXCJcXHRcIiwgclwiXFx0XCIpCgogICAgcmV0dXJuIHN0cihzKQoKCgoKCmRlZiBfY29sbGFwc2Vfc3RyaW5nX3RvX3JhbmdlcygKCiAgICBzOiBVbmlvbltzdHIsIEl0ZXJhYmxlW3N0cl1dLCByZV9lc2NhcGU6IGJvb2wgPSBUcnVlCgopIC0+IHN0cjoKCiAgICBkZWYgaXNfY29uc2VjdXRpdmUoYyk6CgogICAgICAgIGNfaW50ID0gb3JkKGMpCgogICAgICAgIGlzX2NvbnNlY3V0aXZlLnByZXYsIHByZXYgPSBjX2ludCwgaXNfY29uc2VjdXRpdmUucHJldgoKICAgICAgICBpZiBjX2ludCAtIHByZXYgPiAxOgoKICAgICAgICAgICAgaXNfY29uc2VjdXRpdmUudmFsdWUgPSBuZXh0KGlzX2NvbnNlY3V0aXZlLmNvdW50ZXIpCgogICAgICAgIHJldHVybiBpc19jb25zZWN1dGl2ZS52YWx1ZQoKCgogICAgaXNfY29uc2VjdXRpdmUucHJldiA9IDAKCiAgICBpc19jb25zZWN1dGl2ZS5jb3VudGVyID0gaXRlcnRvb2xzLmNvdW50KCkKCiAgICBpc19jb25zZWN1dGl2ZS52YWx1ZSA9IC0xCgoKCiAgICBkZWYgZXNjYXBlX3JlX3JhbmdlX2NoYXIoYyk6CgogICAgICAgIHJldHVybiBcIlxcXFxcIiArIGMgaWYgYyBpbiByXCJcXF4tXVtcIiBlbHNlIGMKCgoKICAgIGRlZiBub19lc2NhcGVfcmVfcmFuZ2VfY2hhcihjKToKCiAgICAgICAgcmV0dXJuIGMKCgoKICAgIGlmIG5vdCByZV9lc2NhcGU6CgogICAgICAgIGVzY2FwZV9yZV9yYW5nZV9jaGFyID0gbm9fZXNjYXBlX3JlX3JhbmdlX2NoYXIKCgoKICAgIHJldCA9IFtdCgogICAgcyA9IFwiXCIuam9pbihzb3J0ZWQoc2V0KHMpKSkKCiAgICBpZiBsZW4ocykgPiAzOgoKICAgICAgICBmb3IgXywgY2hhcnMgaW4gaXRlcnRvb2xzLmdyb3VwYnkocywga2V5PWlzX2NvbnNlY3V0aXZlKToKCiAgICAgICAgICAgIGZpcnN0ID0gbGFzdCA9IG5leHQoY2hhcnMpCgogICAgICAgICAgICBsYXN0ID0gY29sbGVjdGlvbnMuZGVxdWUoCgogICAgICAgICAgICAgICAgaXRlcnRvb2xzLmNoYWluKGl0ZXIoW2xhc3RdKSwgY2hhcnMpLCBtYXhsZW49MQoKICAgICAgICAgICAgKS5wb3AoKQoKICAgICAgICAgICAgaWYgZmlyc3QgPT0gbGFzdDoKCiAgICAgICAgICAgICAgICByZXQuYXBwZW5kKGVzY2FwZV9yZV9yYW5nZV9jaGFyKGZpcnN0KSkKCiAgICAgICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgc2VwID0gXCJcIiBpZiBvcmQobGFzdCkgPT0gb3JkKGZpcnN0KSArIDEgZWxzZSBcIi1cIgoKICAgICAgICAgICAgICAgIHJldC5hcHBlbmQoCgogICAgICAgICAgICAgICAgICAgIFwie317fXt9XCIuZm9ybWF0KAoKICAgICAgICAgICAgICAgICAgICAgICAgZXNjYXBlX3JlX3JhbmdlX2NoYXIoZmlyc3QpLCBzZXAsIGVzY2FwZV9yZV9yYW5nZV9jaGFyKGxhc3QpCgogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICApCgogICAgZWxzZToKCiAgICAgICAgcmV0ID0gW2VzY2FwZV9yZV9yYW5nZV9jaGFyKGMpIGZvciBjIGluIHNdCgoKCiAgICByZXR1cm4gXCJcIi5qb2luKHJldCkKCgoKCgpkZWYgX2ZsYXR0ZW4obGw6IGxpc3QpIC0+IGxpc3Q6CgogICAgcmV0ID0gW10KCiAgICBmb3IgaSBpbiBsbDoKCiAgICAgICAgaWYgaXNpbnN0YW5jZShpLCBsaXN0KToKCiAgICAgICAgICAgIHJldC5leHRlbmQoX2ZsYXR0ZW4oaSkpCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICByZXQuYXBwZW5kKGkpCgogICAgcmV0dXJuIHJldAoKCgoiIiIKCm1vZHVsZV9kaWN0WyJweXBhcnNpbmcvY29tbW9uLnB5Il09IiIiCgojIGNvbW1vbi5weQoKZnJvbSAuY29yZSBpbXBvcnQgKgoKZnJvbSAuaGVscGVycyBpbXBvcnQgZGVsaW1pdGVkX2xpc3QsIGFueV9vcGVuX3RhZywgYW55X2Nsb3NlX3RhZwoKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKCgoKCgojIHNvbWUgb3RoZXIgdXNlZnVsIGV4cHJlc3Npb25zIC0gdXNpbmcgbG93ZXItY2FzZSBjbGFzcyBuYW1lIHNpbmNlIHdlIGFyZSByZWFsbHkgdXNpbmcgdGhpcyBhcyBhIG5hbWVzcGFjZQoKY2xhc3MgcHlwYXJzaW5nX2NvbW1vbjoKCiAgICBcIlwiXCJIZXJlIGFyZSBzb21lIGNvbW1vbiBsb3ctbGV2ZWwgZXhwcmVzc2lvbnMgdGhhdCBtYXkgYmUgdXNlZnVsIGluCgogICAganVtcC1zdGFydGluZyBwYXJzZXIgZGV2ZWxvcG1lbnQ6CgoKCiAgICAtIG51bWVyaWMgZm9ybXMgKDpjbGFzczpgaW50ZWdlcnM8aW50ZWdlcj5gLCA6Y2xhc3M6YHJlYWxzPHJlYWw+YCwKCiAgICAgIDpjbGFzczpgc2NpZW50aWZpYyBub3RhdGlvbjxzY2lfcmVhbD5gKQoKICAgIC0gY29tbW9uIDpjbGFzczpgcHJvZ3JhbW1pbmcgaWRlbnRpZmllcnM8aWRlbnRpZmllcj5gCgogICAgLSBuZXR3b3JrIGFkZHJlc3NlcyAoOmNsYXNzOmBNQUM8bWFjX2FkZHJlc3M+YCwKCiAgICAgIDpjbGFzczpgSVB2NDxpcHY0X2FkZHJlc3M+YCwgOmNsYXNzOmBJUHY2PGlwdjZfYWRkcmVzcz5gKQoKICAgIC0gSVNPODYwMSA6Y2xhc3M6YGRhdGVzPGlzbzg2MDFfZGF0ZT5gIGFuZAoKICAgICAgOmNsYXNzOmBkYXRldGltZTxpc284NjAxX2RhdGV0aW1lPmAKCiAgICAtIDpjbGFzczpgVVVJRDx1dWlkPmAKCiAgICAtIDpjbGFzczpgY29tbWEtc2VwYXJhdGVkIGxpc3Q8Y29tbWFfc2VwYXJhdGVkX2xpc3Q+YAoKICAgIC0gOmNsYXNzOmB1cmxgCgoKCiAgICBQYXJzZSBhY3Rpb25zOgoKCgogICAgLSA6Y2xhc3M6YGNvbnZlcnRUb0ludGVnZXJgCgogICAgLSA6Y2xhc3M6YGNvbnZlcnRUb0Zsb2F0YAoKICAgIC0gOmNsYXNzOmBjb252ZXJ0VG9EYXRlYAoKICAgIC0gOmNsYXNzOmBjb252ZXJ0VG9EYXRldGltZWAKCiAgICAtIDpjbGFzczpgc3RyaXBIVE1MVGFnc2AKCiAgICAtIDpjbGFzczpgdXBjYXNlVG9rZW5zYAoKICAgIC0gOmNsYXNzOmBkb3duY2FzZVRva2Vuc2AKCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgIHB5cGFyc2luZ19jb21tb24ubnVtYmVyLnJ1blRlc3RzKCcnJwoKICAgICAgICAgICAgIyBhbnkgaW50IG9yIHJlYWwgbnVtYmVyLCByZXR1cm5lZCBhcyB0aGUgYXBwcm9wcmlhdGUgdHlwZQoKICAgICAgICAgICAgMTAwCgogICAgICAgICAgICAtMTAwCgogICAgICAgICAgICArMTAwCgogICAgICAgICAgICAzLjE0MTU5CgogICAgICAgICAgICA2LjAyZTIzCgogICAgICAgICAgICAxZS0xMgoKICAgICAgICAgICAgJycnKQoKCgogICAgICAgIHB5cGFyc2luZ19jb21tb24uZm51bWJlci5ydW5UZXN0cygnJycKCiAgICAgICAgICAgICMgYW55IGludCBvciByZWFsIG51bWJlciwgcmV0dXJuZWQgYXMgZmxvYXQKCiAgICAgICAgICAgIDEwMAoKICAgICAgICAgICAgLTEwMAoKICAgICAgICAgICAgKzEwMAoKICAgICAgICAgICAgMy4xNDE1OQoKICAgICAgICAgICAgNi4wMmUyMwoKICAgICAgICAgICAgMWUtMTIKCiAgICAgICAgICAgICcnJykKCgoKICAgICAgICBweXBhcnNpbmdfY29tbW9uLmhleF9pbnRlZ2VyLnJ1blRlc3RzKCcnJwoKICAgICAgICAgICAgIyBoZXggbnVtYmVycwoKICAgICAgICAgICAgMTAwCgogICAgICAgICAgICBGRgoKICAgICAgICAgICAgJycnKQoKCgogICAgICAgIHB5cGFyc2luZ19jb21tb24uZnJhY3Rpb24ucnVuVGVzdHMoJycnCgogICAgICAgICAgICAjIGZyYWN0aW9ucwoKICAgICAgICAgICAgMS8yCgogICAgICAgICAgICAtMy80CgogICAgICAgICAgICAnJycpCgoKCiAgICAgICAgcHlwYXJzaW5nX2NvbW1vbi5taXhlZF9pbnRlZ2VyLnJ1blRlc3RzKCcnJwoKICAgICAgICAgICAgIyBtaXhlZCBmcmFjdGlvbnMKCiAgICAgICAgICAgIDEKCiAgICAgICAgICAgIDEvMgoKICAgICAgICAgICAgLTMvNAoKICAgICAgICAgICAgMS0zLzQKCiAgICAgICAgICAgICcnJykKCgoKICAgICAgICBpbXBvcnQgdXVpZAoKICAgICAgICBweXBhcnNpbmdfY29tbW9uLnV1aWQuc2V0UGFyc2VBY3Rpb24odG9rZW5NYXAodXVpZC5VVUlEKSkKCiAgICAgICAgcHlwYXJzaW5nX2NvbW1vbi51dWlkLnJ1blRlc3RzKCcnJwoKICAgICAgICAgICAgIyB1dWlkCgogICAgICAgICAgICAxMjM0NTY3OC0xMjM0LTU2NzgtMTIzNC01Njc4MTIzNDU2NzgKCiAgICAgICAgICAgICcnJykKCgoKICAgIHByaW50czo6CgoKCiAgICAgICAgIyBhbnkgaW50IG9yIHJlYWwgbnVtYmVyLCByZXR1cm5lZCBhcyB0aGUgYXBwcm9wcmlhdGUgdHlwZQoKICAgICAgICAxMDAKCiAgICAgICAgWzEwMF0KCgoKICAgICAgICAtMTAwCgogICAgICAgIFstMTAwXQoKCgogICAgICAgICsxMDAKCiAgICAgICAgWzEwMF0KCgoKICAgICAgICAzLjE0MTU5CgogICAgICAgIFszLjE0MTU5XQoKCgogICAgICAgIDYuMDJlMjMKCiAgICAgICAgWzYuMDJlKzIzXQoKCgogICAgICAgIDFlLTEyCgogICAgICAgIFsxZS0xMl0KCgoKICAgICAgICAjIGFueSBpbnQgb3IgcmVhbCBudW1iZXIsIHJldHVybmVkIGFzIGZsb2F0CgogICAgICAgIDEwMAoKICAgICAgICBbMTAwLjBdCgoKCiAgICAgICAgLTEwMAoKICAgICAgICBbLTEwMC4wXQoKCgogICAgICAgICsxMDAKCiAgICAgICAgWzEwMC4wXQoKCgogICAgICAgIDMuMTQxNTkKCiAgICAgICAgWzMuMTQxNTldCgoKCiAgICAgICAgNi4wMmUyMwoKICAgICAgICBbNi4wMmUrMjNdCgoKCiAgICAgICAgMWUtMTIKCiAgICAgICAgWzFlLTEyXQoKCgogICAgICAgICMgaGV4IG51bWJlcnMKCiAgICAgICAgMTAwCgogICAgICAgIFsyNTZdCgoKCiAgICAgICAgRkYKCiAgICAgICAgWzI1NV0KCgoKICAgICAgICAjIGZyYWN0aW9ucwoKICAgICAgICAxLzIKCiAgICAgICAgWzAuNV0KCgoKICAgICAgICAtMy80CgogICAgICAgIFstMC43NV0KCgoKICAgICAgICAjIG1peGVkIGZyYWN0aW9ucwoKICAgICAgICAxCgogICAgICAgIFsxXQoKCgogICAgICAgIDEvMgoKICAgICAgICBbMC41XQoKCgogICAgICAgIC0zLzQKCiAgICAgICAgWy0wLjc1XQoKCgogICAgICAgIDEtMy80CgogICAgICAgIFsxLjc1XQoKCgogICAgICAgICMgdXVpZAoKICAgICAgICAxMjM0NTY3OC0xMjM0LTU2NzgtMTIzNC01Njc4MTIzNDU2NzgKCiAgICAgICAgW1VVSUQoJzEyMzQ1Njc4LTEyMzQtNTY3OC0xMjM0LTU2NzgxMjM0NTY3OCcpXQoKICAgIFwiXCJcIgoKCgogICAgY29udmVydF90b19pbnRlZ2VyID0gdG9rZW5fbWFwKGludCkKCiAgICBcIlwiXCIKCiAgICBQYXJzZSBhY3Rpb24gZm9yIGNvbnZlcnRpbmcgcGFyc2VkIGludGVnZXJzIHRvIFB5dGhvbiBpbnQKCiAgICBcIlwiXCIKCgoKICAgIGNvbnZlcnRfdG9fZmxvYXQgPSB0b2tlbl9tYXAoZmxvYXQpCgogICAgXCJcIlwiCgogICAgUGFyc2UgYWN0aW9uIGZvciBjb252ZXJ0aW5nIHBhcnNlZCBudW1iZXJzIHRvIFB5dGhvbiBmbG9hdAoKICAgIFwiXCJcIgoKCgogICAgaW50ZWdlciA9IFdvcmQobnVtcykuc2V0X25hbWUoXCJpbnRlZ2VyXCIpLnNldF9wYXJzZV9hY3Rpb24oY29udmVydF90b19pbnRlZ2VyKQoKICAgIFwiXCJcImV4cHJlc3Npb24gdGhhdCBwYXJzZXMgYW4gdW5zaWduZWQgaW50ZWdlciwgcmV0dXJucyBhbiBpbnRcIlwiXCIKCgoKICAgIGhleF9pbnRlZ2VyID0gKAoKICAgICAgICBXb3JkKGhleG51bXMpLnNldF9uYW1lKFwiaGV4IGludGVnZXJcIikuc2V0X3BhcnNlX2FjdGlvbih0b2tlbl9tYXAoaW50LCAxNikpCgogICAgKQoKICAgIFwiXCJcImV4cHJlc3Npb24gdGhhdCBwYXJzZXMgYSBoZXhhZGVjaW1hbCBpbnRlZ2VyLCByZXR1cm5zIGFuIGludFwiXCJcIgoKCgogICAgc2lnbmVkX2ludGVnZXIgPSAoCgogICAgICAgIFJlZ2V4KHJcIlsrLV0/XFxkK1wiKQoKICAgICAgICAuc2V0X25hbWUoXCJzaWduZWQgaW50ZWdlclwiKQoKICAgICAgICAuc2V0X3BhcnNlX2FjdGlvbihjb252ZXJ0X3RvX2ludGVnZXIpCgogICAgKQoKICAgIFwiXCJcImV4cHJlc3Npb24gdGhhdCBwYXJzZXMgYW4gaW50ZWdlciB3aXRoIG9wdGlvbmFsIGxlYWRpbmcgc2lnbiwgcmV0dXJucyBhbiBpbnRcIlwiXCIKCgoKICAgIGZyYWN0aW9uID0gKAoKICAgICAgICBzaWduZWRfaW50ZWdlcigpLnNldF9wYXJzZV9hY3Rpb24oY29udmVydF90b19mbG9hdCkKCiAgICAgICAgKyBcIi9cIgoKICAgICAgICArIHNpZ25lZF9pbnRlZ2VyKCkuc2V0X3BhcnNlX2FjdGlvbihjb252ZXJ0X3RvX2Zsb2F0KQoKICAgICkuc2V0X25hbWUoXCJmcmFjdGlvblwiKQoKICAgIFwiXCJcImZyYWN0aW9uYWwgZXhwcmVzc2lvbiBvZiBhbiBpbnRlZ2VyIGRpdmlkZWQgYnkgYW4gaW50ZWdlciwgcmV0dXJucyBhIGZsb2F0XCJcIlwiCgogICAgZnJhY3Rpb24uYWRkX3BhcnNlX2FjdGlvbihsYW1iZGEgdHQ6IHR0WzBdIC8gdHRbLTFdKQoKCgogICAgbWl4ZWRfaW50ZWdlciA9ICgKCiAgICAgICAgZnJhY3Rpb24gfCBzaWduZWRfaW50ZWdlciArIE9wdChPcHQoXCItXCIpLnN1cHByZXNzKCkgKyBmcmFjdGlvbikKCiAgICApLnNldF9uYW1lKFwiZnJhY3Rpb24gb3IgbWl4ZWQgaW50ZWdlci1mcmFjdGlvblwiKQoKICAgIFwiXCJcIm1peGVkIGludGVnZXIgb2YgdGhlIGZvcm0gJ2ludGVnZXIgLSBmcmFjdGlvbicsIHdpdGggb3B0aW9uYWwgbGVhZGluZyBpbnRlZ2VyLCByZXR1cm5zIGZsb2F0XCJcIlwiCgogICAgbWl4ZWRfaW50ZWdlci5hZGRfcGFyc2VfYWN0aW9uKHN1bSkKCgoKICAgIHJlYWwgPSAoCgogICAgICAgIFJlZ2V4KHJcIlsrLV0/KD86XFxkK1xcLlxcZCp8XFwuXFxkKylcIikKCiAgICAgICAgLnNldF9uYW1lKFwicmVhbCBudW1iZXJcIikKCiAgICAgICAgLnNldF9wYXJzZV9hY3Rpb24oY29udmVydF90b19mbG9hdCkKCiAgICApCgogICAgXCJcIlwiZXhwcmVzc2lvbiB0aGF0IHBhcnNlcyBhIGZsb2F0aW5nIHBvaW50IG51bWJlciBhbmQgcmV0dXJucyBhIGZsb2F0XCJcIlwiCgoKCiAgICBzY2lfcmVhbCA9ICgKCiAgICAgICAgUmVnZXgoclwiWystXT8oPzpcXGQrKD86W2VFXVsrLV0/XFxkKyl8KD86XFxkK1xcLlxcZCp8XFwuXFxkKykoPzpbZUVdWystXT9cXGQrKT8pXCIpCgogICAgICAgIC5zZXRfbmFtZShcInJlYWwgbnVtYmVyIHdpdGggc2NpZW50aWZpYyBub3RhdGlvblwiKQoKICAgICAgICAuc2V0X3BhcnNlX2FjdGlvbihjb252ZXJ0X3RvX2Zsb2F0KQoKICAgICkKCiAgICBcIlwiXCJleHByZXNzaW9uIHRoYXQgcGFyc2VzIGEgZmxvYXRpbmcgcG9pbnQgbnVtYmVyIHdpdGggb3B0aW9uYWwKCiAgICBzY2llbnRpZmljIG5vdGF0aW9uIGFuZCByZXR1cm5zIGEgZmxvYXRcIlwiXCIKCgoKICAgICMgc3RyZWFtbGluaW5nIHRoaXMgZXhwcmVzc2lvbiBtYWtlcyB0aGUgZG9jcyBuaWNlci1sb29raW5nCgogICAgbnVtYmVyID0gKHNjaV9yZWFsIHwgcmVhbCB8IHNpZ25lZF9pbnRlZ2VyKS5zZXROYW1lKFwibnVtYmVyXCIpLnN0cmVhbWxpbmUoKQoKICAgIFwiXCJcImFueSBudW1lcmljIGV4cHJlc3Npb24sIHJldHVybnMgdGhlIGNvcnJlc3BvbmRpbmcgUHl0aG9uIHR5cGVcIlwiXCIKCgoKICAgIGZudW1iZXIgPSAoCgogICAgICAgIFJlZ2V4KHJcIlsrLV0/XFxkK1xcLj9cXGQqKFtlRV1bKy1dP1xcZCspP1wiKQoKICAgICAgICAuc2V0X25hbWUoXCJmbnVtYmVyXCIpCgogICAgICAgIC5zZXRfcGFyc2VfYWN0aW9uKGNvbnZlcnRfdG9fZmxvYXQpCgogICAgKQoKICAgIFwiXCJcImFueSBpbnQgb3IgcmVhbCBudW1iZXIsIHJldHVybmVkIGFzIGZsb2F0XCJcIlwiCgoKCiAgICBpZGVudGlmaWVyID0gV29yZChpZGVudGNoYXJzLCBpZGVudGJvZHljaGFycykuc2V0X25hbWUoXCJpZGVudGlmaWVyXCIpCgogICAgXCJcIlwidHlwaWNhbCBjb2RlIGlkZW50aWZpZXIgKGxlYWRpbmcgYWxwaGEgb3IgJ18nLCBmb2xsb3dlZCBieSAwIG9yIG1vcmUgYWxwaGFzLCBudW1zLCBvciAnXycpXCJcIlwiCgoKCiAgICBpcHY0X2FkZHJlc3MgPSBSZWdleCgKCiAgICAgICAgclwiKDI1WzAtNV18MlswLTRdWzAtOV18MT9bMC05XXsxLDJ9KShcXC4oMjVbMC01XXwyWzAtNF1bMC05XXwxP1swLTldezEsMn0pKXszfVwiCgogICAgKS5zZXRfbmFtZShcIklQdjQgYWRkcmVzc1wiKQoKICAgIFwiSVB2NCBhZGRyZXNzIChgYDAuMC4wLjAgLSAyNTUuMjU1LjI1NS4yNTVgYClcIgoKCgogICAgX2lwdjZfcGFydCA9IFJlZ2V4KHJcIlswLTlhLWZBLUZdezEsNH1cIikuc2V0X25hbWUoXCJoZXhfaW50ZWdlclwiKQoKICAgIF9mdWxsX2lwdjZfYWRkcmVzcyA9IChfaXB2Nl9wYXJ0ICsgKFwiOlwiICsgX2lwdjZfcGFydCkgKiA3KS5zZXRfbmFtZSgKCiAgICAgICAgXCJmdWxsIElQdjYgYWRkcmVzc1wiCgogICAgKQoKICAgIF9zaG9ydF9pcHY2X2FkZHJlc3MgPSAoCgogICAgICAgIE9wdChfaXB2Nl9wYXJ0ICsgKFwiOlwiICsgX2lwdjZfcGFydCkgKiAoMCwgNikpCgogICAgICAgICsgXCI6OlwiCgogICAgICAgICsgT3B0KF9pcHY2X3BhcnQgKyAoXCI6XCIgKyBfaXB2Nl9wYXJ0KSAqICgwLCA2KSkKCiAgICApLnNldF9uYW1lKFwic2hvcnQgSVB2NiBhZGRyZXNzXCIpCgogICAgX3Nob3J0X2lwdjZfYWRkcmVzcy5hZGRfY29uZGl0aW9uKAoKICAgICAgICBsYW1iZGEgdDogc3VtKDEgZm9yIHR0IGluIHQgaWYgcHlwYXJzaW5nX2NvbW1vbi5faXB2Nl9wYXJ0Lm1hdGNoZXModHQpKSA8IDgKCiAgICApCgogICAgX21peGVkX2lwdjZfYWRkcmVzcyA9IChcIjo6ZmZmZjpcIiArIGlwdjRfYWRkcmVzcykuc2V0X25hbWUoXCJtaXhlZCBJUHY2IGFkZHJlc3NcIikKCiAgICBpcHY2X2FkZHJlc3MgPSBDb21iaW5lKAoKICAgICAgICAoX2Z1bGxfaXB2Nl9hZGRyZXNzIHwgX21peGVkX2lwdjZfYWRkcmVzcyB8IF9zaG9ydF9pcHY2X2FkZHJlc3MpLnNldF9uYW1lKAoKICAgICAgICAgICAgXCJJUHY2IGFkZHJlc3NcIgoKICAgICAgICApCgogICAgKS5zZXRfbmFtZShcIklQdjYgYWRkcmVzc1wiKQoKICAgIFwiSVB2NiBhZGRyZXNzIChsb25nLCBzaG9ydCwgb3IgbWl4ZWQgZm9ybSlcIgoKCgogICAgbWFjX2FkZHJlc3MgPSBSZWdleCgKCiAgICAgICAgclwiWzAtOWEtZkEtRl17Mn0oWzouLV0pWzAtOWEtZkEtRl17Mn0oPzpcXDFbMC05YS1mQS1GXXsyfSl7NH1cIgoKICAgICkuc2V0X25hbWUoXCJNQUMgYWRkcmVzc1wiKQoKICAgIFwiTUFDIGFkZHJlc3MgeHg6eHg6eHg6eHg6eHggKG1heSBhbHNvIGhhdmUgJy0nIG9yICcuJyBkZWxpbWl0ZXJzKVwiCgoKCiAgICBAc3RhdGljbWV0aG9kCgogICAgZGVmIGNvbnZlcnRfdG9fZGF0ZShmbXQ6IHN0ciA9IFwiJVktJW0tJWRcIik6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBIZWxwZXIgdG8gY3JlYXRlIGEgcGFyc2UgYWN0aW9uIGZvciBjb252ZXJ0aW5nIHBhcnNlZCBkYXRlIHN0cmluZyB0byBQeXRob24gZGF0ZXRpbWUuZGF0ZQoKCgogICAgICAgIFBhcmFtcyAtCgogICAgICAgIC0gZm10IC0gZm9ybWF0IHRvIGJlIHBhc3NlZCB0byBkYXRldGltZS5zdHJwdGltZSAoZGVmYXVsdD0gYGBcIiVZLSVtLSVkXCJgYCkKCgoKICAgICAgICBFeGFtcGxlOjoKCgoKICAgICAgICAgICAgZGF0ZV9leHByID0gcHlwYXJzaW5nX2NvbW1vbi5pc284NjAxX2RhdGUuY29weSgpCgogICAgICAgICAgICBkYXRlX2V4cHIuc2V0UGFyc2VBY3Rpb24ocHlwYXJzaW5nX2NvbW1vbi5jb252ZXJ0VG9EYXRlKCkpCgogICAgICAgICAgICBwcmludChkYXRlX2V4cHIucGFyc2VTdHJpbmcoXCIxOTk5LTEyLTMxXCIpKQoKCgogICAgICAgIHByaW50czo6CgoKCiAgICAgICAgICAgIFtkYXRldGltZS5kYXRlKDE5OTksIDEyLCAzMSldCgogICAgICAgIFwiXCJcIgoKCgogICAgICAgIGRlZiBjdnRfZm4oc3MsIGxsLCB0dCk6CgogICAgICAgICAgICB0cnk6CgogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGV0aW1lLnN0cnB0aW1lKHR0WzBdLCBmbXQpLmRhdGUoKQoKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3IgYXMgdmU6CgogICAgICAgICAgICAgICAgcmFpc2UgUGFyc2VFeGNlcHRpb24oc3MsIGxsLCBzdHIodmUpKQoKCgogICAgICAgIHJldHVybiBjdnRfZm4KCgoKICAgIEBzdGF0aWNtZXRob2QKCiAgICBkZWYgY29udmVydF90b19kYXRldGltZShmbXQ6IHN0ciA9IFwiJVktJW0tJWRUJUg6JU06JVMuJWZcIik6CgogICAgICAgIFwiXCJcIkhlbHBlciB0byBjcmVhdGUgYSBwYXJzZSBhY3Rpb24gZm9yIGNvbnZlcnRpbmcgcGFyc2VkCgogICAgICAgIGRhdGV0aW1lIHN0cmluZyB0byBQeXRob24gZGF0ZXRpbWUuZGF0ZXRpbWUKCgoKICAgICAgICBQYXJhbXMgLQoKICAgICAgICAtIGZtdCAtIGZvcm1hdCB0byBiZSBwYXNzZWQgdG8gZGF0ZXRpbWUuc3RycHRpbWUgKGRlZmF1bHQ9IGBgXCIlWS0lbS0lZFQlSDolTTolUy4lZlwiYGApCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgIGR0X2V4cHIgPSBweXBhcnNpbmdfY29tbW9uLmlzbzg2MDFfZGF0ZXRpbWUuY29weSgpCgogICAgICAgICAgICBkdF9leHByLnNldFBhcnNlQWN0aW9uKHB5cGFyc2luZ19jb21tb24uY29udmVydFRvRGF0ZXRpbWUoKSkKCiAgICAgICAgICAgIHByaW50KGR0X2V4cHIucGFyc2VTdHJpbmcoXCIxOTk5LTEyLTMxVDIzOjU5OjU5Ljk5OVwiKSkKCgoKICAgICAgICBwcmludHM6OgoKCgogICAgICAgICAgICBbZGF0ZXRpbWUuZGF0ZXRpbWUoMTk5OSwgMTIsIDMxLCAyMywgNTksIDU5LCA5OTkwMDApXQoKICAgICAgICBcIlwiXCIKCgoKICAgICAgICBkZWYgY3Z0X2ZuKHMsIGwsIHQpOgoKICAgICAgICAgICAgdHJ5OgoKICAgICAgICAgICAgICAgIHJldHVybiBkYXRldGltZS5zdHJwdGltZSh0WzBdLCBmbXQpCgogICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvciBhcyB2ZToKCiAgICAgICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihzLCBsLCBzdHIodmUpKQoKCgogICAgICAgIHJldHVybiBjdnRfZm4KCgoKICAgIGlzbzg2MDFfZGF0ZSA9IFJlZ2V4KAoKICAgICAgICByXCIoP1A8eWVhcj5cXGR7NH0pKD86LSg/UDxtb250aD5cXGRcXGQpKD86LSg/UDxkYXk+XFxkXFxkKSk/KT9cIgoKICAgICkuc2V0X25hbWUoXCJJU084NjAxIGRhdGVcIikKCiAgICBcIklTTzg2MDEgZGF0ZSAoYGB5eXl5LW1tLWRkYGApXCIKCgoKICAgIGlzbzg2MDFfZGF0ZXRpbWUgPSBSZWdleCgKCiAgICAgICAgclwiKD9QPHllYXI+XFxkezR9KS0oP1A8bW9udGg+XFxkXFxkKS0oP1A8ZGF5PlxcZFxcZClbVCBdKD9QPGhvdXI+XFxkXFxkKTooP1A8bWludXRlPlxcZFxcZCkoOig/UDxzZWNvbmQ+XFxkXFxkKFxcLlxcZCopPyk/KT8oP1A8dHo+WnxbKy1dXFxkXFxkOj9cXGRcXGQpP1wiCgogICAgKS5zZXRfbmFtZShcIklTTzg2MDEgZGF0ZXRpbWVcIikKCiAgICBcIklTTzg2MDEgZGF0ZXRpbWUgKGBgeXl5eS1tbS1kZFRoaDptbTpzcy5zKFp8Ky0wMDowMClgYCkgLSB0cmFpbGluZyBzZWNvbmRzLCBtaWxsaXNlY29uZHMsIGFuZCB0aW1lem9uZSBvcHRpb25hbDsgYWNjZXB0cyBzZXBhcmF0aW5nIGBgJ1QnYGAgb3IgYGAnICdgYFwiCgoKCiAgICB1dWlkID0gUmVnZXgoclwiWzAtOWEtZkEtRl17OH0oLVswLTlhLWZBLUZdezR9KXszfS1bMC05YS1mQS1GXXsxMn1cIikuc2V0X25hbWUoXCJVVUlEXCIpCgogICAgXCJVVUlEIChgYHh4eHh4eHh4LXh4eHgteHh4eC14eHh4LXh4eHh4eHh4eHh4eGBgKVwiCgoKCiAgICBfaHRtbF9zdHJpcHBlciA9IGFueV9vcGVuX3RhZy5zdXBwcmVzcygpIHwgYW55X2Nsb3NlX3RhZy5zdXBwcmVzcygpCgoKCiAgICBAc3RhdGljbWV0aG9kCgogICAgZGVmIHN0cmlwX2h0bWxfdGFncyhzOiBzdHIsIGw6IGludCwgdG9rZW5zOiBQYXJzZVJlc3VsdHMpOgoKICAgICAgICBcIlwiXCJQYXJzZSBhY3Rpb24gdG8gcmVtb3ZlIEhUTUwgdGFncyBmcm9tIHdlYiBwYWdlIEhUTUwgc291cmNlCgoKCiAgICAgICAgRXhhbXBsZTo6CgoKCiAgICAgICAgICAgICMgc3RyaXAgSFRNTCBsaW5rcyBmcm9tIG5vcm1hbCB0ZXh0CgogICAgICAgICAgICB0ZXh0ID0gJzx0ZD5Nb3JlIGluZm8gYXQgdGhlIDxhIGhyZWY9XCJodHRwczovL2dpdGh1Yi5jb20vcHlwYXJzaW5nL3B5cGFyc2luZy93aWtpXCI+cHlwYXJzaW5nPC9hPiB3aWtpIHBhZ2U8L3RkPicKCiAgICAgICAgICAgIHRkLCB0ZF9lbmQgPSBtYWtlSFRNTFRhZ3MoXCJURFwiKQoKICAgICAgICAgICAgdGFibGVfdGV4dCA9IHRkICsgU2tpcFRvKHRkX2VuZCkuc2V0UGFyc2VBY3Rpb24ocHlwYXJzaW5nX2NvbW1vbi5zdHJpcEhUTUxUYWdzKShcImJvZHlcIikgKyB0ZF9lbmQKCiAgICAgICAgICAgIHByaW50KHRhYmxlX3RleHQucGFyc2VTdHJpbmcodGV4dCkuYm9keSkKCgoKICAgICAgICBQcmludHM6OgoKCgogICAgICAgICAgICBNb3JlIGluZm8gYXQgdGhlIHB5cGFyc2luZyB3aWtpIHBhZ2UKCiAgICAgICAgXCJcIlwiCgogICAgICAgIHJldHVybiBweXBhcnNpbmdfY29tbW9uLl9odG1sX3N0cmlwcGVyLnRyYW5zZm9ybV9zdHJpbmcodG9rZW5zWzBdKQoKCgogICAgX2NvbW1hc2VwaXRlbSA9ICgKCiAgICAgICAgQ29tYmluZSgKCiAgICAgICAgICAgIE9uZU9yTW9yZSgKCiAgICAgICAgICAgICAgICB+TGl0ZXJhbChcIixcIikKCiAgICAgICAgICAgICAgICArIH5MaW5lRW5kKCkKCiAgICAgICAgICAgICAgICArIFdvcmQocHJpbnRhYmxlcywgZXhjbHVkZV9jaGFycz1cIixcIikKCiAgICAgICAgICAgICAgICArIE9wdChXaGl0ZShcIiBcXHRcIikgKyB+Rm9sbG93ZWRCeShMaW5lRW5kKCkgfCBcIixcIikpCgogICAgICAgICAgICApCgogICAgICAgICkKCiAgICAgICAgLnN0cmVhbWxpbmUoKQoKICAgICAgICAuc2V0X25hbWUoXCJjb21tYUl0ZW1cIikKCiAgICApCgogICAgY29tbWFfc2VwYXJhdGVkX2xpc3QgPSBkZWxpbWl0ZWRfbGlzdCgKCiAgICAgICAgT3B0KHF1b3RlZF9zdHJpbmcuY29weSgpIHwgX2NvbW1hc2VwaXRlbSwgZGVmYXVsdD1cIlwiKQoKICAgICkuc2V0X25hbWUoXCJjb21tYSBzZXBhcmF0ZWQgbGlzdFwiKQoKICAgIFwiXCJcIlByZWRlZmluZWQgZXhwcmVzc2lvbiBvZiAxIG9yIG1vcmUgcHJpbnRhYmxlIHdvcmRzIG9yIHF1b3RlZCBzdHJpbmdzLCBzZXBhcmF0ZWQgYnkgY29tbWFzLlwiXCJcIgoKCgogICAgdXBjYXNlX3Rva2VucyA9IHN0YXRpY21ldGhvZCh0b2tlbl9tYXAobGFtYmRhIHQ6IHQudXBwZXIoKSkpCgogICAgXCJcIlwiUGFyc2UgYWN0aW9uIHRvIGNvbnZlcnQgdG9rZW5zIHRvIHVwcGVyIGNhc2UuXCJcIlwiCgoKCiAgICBkb3duY2FzZV90b2tlbnMgPSBzdGF0aWNtZXRob2QodG9rZW5fbWFwKGxhbWJkYSB0OiB0Lmxvd2VyKCkpKQoKICAgIFwiXCJcIlBhcnNlIGFjdGlvbiB0byBjb252ZXJ0IHRva2VucyB0byBsb3dlciBjYXNlLlwiXCJcIgoKCgogICAgIyBmbXQ6IG9mZgoKICAgIHVybCA9IFJlZ2V4KAoKICAgICAgICAjIGh0dHBzOi8vbWF0aGlhc2J5bmVucy5iZS9kZW1vL3VybC1yZWdleAoKICAgICAgICAjIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL2RwZXJpbmkvNzI5Mjk0CgogICAgICAgIHJcIl5cIiArCgogICAgICAgICMgcHJvdG9jb2wgaWRlbnRpZmllciAob3B0aW9uYWwpCgogICAgICAgICMgc2hvcnQgc3ludGF4IC8vIHN0aWxsIHJlcXVpcmVkCgogICAgICAgIHJcIig/Oig/Oig/UDxzY2hlbWU+aHR0cHM/fGZ0cCk6KT9cXC9cXC8pXCIgKwoKICAgICAgICAjIHVzZXI6cGFzcyBCYXNpY0F1dGggKG9wdGlvbmFsKQoKICAgICAgICByXCIoPzooP1A8YXV0aD5cXFMrKD86OlxcUyopPylAKT9cIiArCgogICAgICAgIHJcIig/UDxob3N0PlwiICsKCiAgICAgICAgIyBJUCBhZGRyZXNzIGV4Y2x1c2lvbgoKICAgICAgICAjIHByaXZhdGUgJiBsb2NhbCBuZXR3b3JrcwoKICAgICAgICByXCIoPyEoPzoxMHwxMjcpKD86XFwuXFxkezEsM30pezN9KVwiICsKCiAgICAgICAgclwiKD8hKD86MTY5XFwuMjU0fDE5MlxcLjE2OCkoPzpcXC5cXGR7MSwzfSl7Mn0pXCIgKwoKICAgICAgICByXCIoPyExNzJcXC4oPzoxWzYtOV18MlxcZHwzWzAtMV0pKD86XFwuXFxkezEsM30pezJ9KVwiICsKCiAgICAgICAgIyBJUCBhZGRyZXNzIGRvdHRlZCBub3RhdGlvbiBvY3RldHMKCiAgICAgICAgIyBleGNsdWRlcyBsb29wYmFjayBuZXR3b3JrIDAuMC4wLjAKCiAgICAgICAgIyBleGNsdWRlcyByZXNlcnZlZCBzcGFjZSA+PSAyMjQuMC4wLjAKCiAgICAgICAgIyBleGNsdWRlcyBuZXR3b3JrICYgYnJvYWRjYXN0IGFkZHJlc3NlcwoKICAgICAgICAjIChmaXJzdCAmIGxhc3QgSVAgYWRkcmVzcyBvZiBlYWNoIGNsYXNzKQoKICAgICAgICByXCIoPzpbMS05XVxcZD98MVxcZFxcZHwyWzAxXVxcZHwyMlswLTNdKVwiICsKCiAgICAgICAgclwiKD86XFwuKD86MT9cXGR7MSwyfXwyWzAtNF1cXGR8MjVbMC01XSkpezJ9XCIgKwoKICAgICAgICByXCIoPzpcXC4oPzpbMS05XVxcZD98MVxcZFxcZHwyWzAtNF1cXGR8MjVbMC00XSkpXCIgKwoKICAgICAgICByXCJ8XCIgKwoKICAgICAgICAjIGhvc3QgJiBkb21haW4gbmFtZXMsIG1heSBlbmQgd2l0aCBkb3QKCiAgICAgICAgIyBjYW4gYmUgcmVwbGFjZWQgYnkgYSBzaG9ydGVzdCBhbHRlcm5hdGl2ZQoKICAgICAgICAjICg/IVstX10pKD86Wy1cXHdcXHUwMGExLVxcdWZmZmZdezAsNjN9W14tX11cXC4pKwoKICAgICAgICByXCIoPzpcIiArCgogICAgICAgIHJcIig/OlwiICsKCiAgICAgICAgclwiW2EtejAtOVxcdTAwYTEtXFx1ZmZmZl1cIiArCgogICAgICAgIHJcIlthLXowLTlcXHUwMGExLVxcdWZmZmZfLV17MCw2Mn1cIiArCgogICAgICAgIHJcIik/XCIgKwoKICAgICAgICByXCJbYS16MC05XFx1MDBhMS1cXHVmZmZmXVxcLlwiICsKCiAgICAgICAgclwiKStcIiArCgogICAgICAgICMgVExEIGlkZW50aWZpZXIgbmFtZSwgbWF5IGVuZCB3aXRoIGRvdAoKICAgICAgICByXCIoPzpbYS16XFx1MDBhMS1cXHVmZmZmXXsyLH1cXC4/KVwiICsKCiAgICAgICAgclwiKVwiICsKCiAgICAgICAgIyBwb3J0IG51bWJlciAob3B0aW9uYWwpCgogICAgICAgIHJcIig6KD9QPHBvcnQ+XFxkezIsNX0pKT9cIiArCgogICAgICAgICMgcmVzb3VyY2UgcGF0aCAob3B0aW9uYWwpCgogICAgICAgIHJcIig/UDxwYXRoPlxcL1tePyMgXSopP1wiICsKCiAgICAgICAgIyBxdWVyeSBzdHJpbmcgKG9wdGlvbmFsKQoKICAgICAgICByXCIoXFw/KD9QPHF1ZXJ5PlteI10qKSk/XCIgKwoKICAgICAgICAjIGZyYWdtZW50IChvcHRpb25hbCkKCiAgICAgICAgclwiKCMoP1A8ZnJhZ21lbnQ+XFxTKikpP1wiICsKCiAgICAgICAgclwiJFwiCgogICAgKS5zZXRfbmFtZShcInVybFwiKQoKICAgICMgZm10OiBvbgoKCgogICAgIyBwcmUtUEVQOCBjb21wYXRpYmlsaXR5IG5hbWVzCgogICAgY29udmVydFRvSW50ZWdlciA9IGNvbnZlcnRfdG9faW50ZWdlcgoKICAgIGNvbnZlcnRUb0Zsb2F0ID0gY29udmVydF90b19mbG9hdAoKICAgIGNvbnZlcnRUb0RhdGUgPSBjb252ZXJ0X3RvX2RhdGUKCiAgICBjb252ZXJ0VG9EYXRldGltZSA9IGNvbnZlcnRfdG9fZGF0ZXRpbWUKCiAgICBzdHJpcEhUTUxUYWdzID0gc3RyaXBfaHRtbF90YWdzCgogICAgdXBjYXNlVG9rZW5zID0gdXBjYXNlX3Rva2VucwoKICAgIGRvd25jYXNlVG9rZW5zID0gZG93bmNhc2VfdG9rZW5zCgoKCgoKX2J1aWx0aW5fZXhwcnMgPSBbCgogICAgdiBmb3IgdiBpbiB2YXJzKHB5cGFyc2luZ19jb21tb24pLnZhbHVlcygpIGlmIGlzaW5zdGFuY2UodiwgUGFyc2VyRWxlbWVudCkKCl0KCgoKIiIiCgptb2R1bGVfZGljdFsicHlwYXJzaW5nL2FjdGlvbnMucHkiXT0iIiIKCiMgYWN0aW9ucy5weQoKCgpmcm9tIC5leGNlcHRpb25zIGltcG9ydCBQYXJzZUV4Y2VwdGlvbgoKZnJvbSAudXRpbCBpbXBvcnQgY29sCgoKCgoKY2xhc3MgT25seU9uY2U6CgogICAgXCJcIlwiCgogICAgV3JhcHBlciBmb3IgcGFyc2UgYWN0aW9ucywgdG8gZW5zdXJlIHRoZXkgYXJlIG9ubHkgY2FsbGVkIG9uY2UuCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oc2VsZiwgbWV0aG9kX2NhbGwpOgoKICAgICAgICBmcm9tIC5jb3JlIGltcG9ydCBfdHJpbV9hcml0eQoKCgogICAgICAgIHNlbGYuY2FsbGFibGUgPSBfdHJpbV9hcml0eShtZXRob2RfY2FsbCkKCiAgICAgICAgc2VsZi5jYWxsZWQgPSBGYWxzZQoKCgogICAgZGVmIF9fY2FsbF9fKHNlbGYsIHMsIGwsIHQpOgoKICAgICAgICBpZiBub3Qgc2VsZi5jYWxsZWQ6CgogICAgICAgICAgICByZXN1bHRzID0gc2VsZi5jYWxsYWJsZShzLCBsLCB0KQoKICAgICAgICAgICAgc2VsZi5jYWxsZWQgPSBUcnVlCgogICAgICAgICAgICByZXR1cm4gcmVzdWx0cwoKICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihzLCBsLCBcIk9ubHlPbmNlIG9iaiBjYWxsZWQgbXVsdGlwbGUgdGltZXMgdy9vdXQgcmVzZXRcIikKCgoKICAgIGRlZiByZXNldChzZWxmKToKCiAgICAgICAgXCJcIlwiCgogICAgICAgIEFsbG93IHRoZSBhc3NvY2lhdGVkIHBhcnNlIGFjdGlvbiB0byBiZSBjYWxsZWQgb25jZSBtb3JlLgoKICAgICAgICBcIlwiXCIKCgoKICAgICAgICBzZWxmLmNhbGxlZCA9IEZhbHNlCgoKCgoKZGVmIG1hdGNoX29ubHlfYXRfY29sKG4pOgoKICAgIFwiXCJcIgoKICAgIEhlbHBlciBtZXRob2QgZm9yIGRlZmluaW5nIHBhcnNlIGFjdGlvbnMgdGhhdCByZXF1aXJlIG1hdGNoaW5nIGF0CgogICAgYSBzcGVjaWZpYyBjb2x1bW4gaW4gdGhlIGlucHV0IHRleHQuCgogICAgXCJcIlwiCgoKCiAgICBkZWYgdmVyaWZ5X2NvbChzdHJnLCBsb2NuLCB0b2tzKToKCiAgICAgICAgaWYgY29sKGxvY24sIHN0cmcpICE9IG46CgogICAgICAgICAgICByYWlzZSBQYXJzZUV4Y2VwdGlvbihzdHJnLCBsb2NuLCBcIm1hdGNoZWQgdG9rZW4gbm90IGF0IGNvbHVtbiB7fVwiLmZvcm1hdChuKSkKCgoKICAgIHJldHVybiB2ZXJpZnlfY29sCgoKCgoKZGVmIHJlcGxhY2Vfd2l0aChyZXBsX3N0cik6CgogICAgXCJcIlwiCgogICAgSGVscGVyIG1ldGhvZCBmb3IgY29tbW9uIHBhcnNlIGFjdGlvbnMgdGhhdCBzaW1wbHkgcmV0dXJuCgogICAgYSBsaXRlcmFsIHZhbHVlLiAgRXNwZWNpYWxseSB1c2VmdWwgd2hlbiB1c2VkIHdpdGgKCiAgICA6Y2xhc3M6YHRyYW5zZm9ybV9zdHJpbmc8UGFyc2VyRWxlbWVudC50cmFuc2Zvcm1fc3RyaW5nPmAgKCkuCgoKCiAgICBFeGFtcGxlOjoKCgoKICAgICAgICBudW0gPSBXb3JkKG51bXMpLnNldF9wYXJzZV9hY3Rpb24obGFtYmRhIHRva3M6IGludCh0b2tzWzBdKSkKCiAgICAgICAgbmEgPSBvbmVfb2YoXCJOL0EgTkFcIikuc2V0X3BhcnNlX2FjdGlvbihyZXBsYWNlX3dpdGgobWF0aC5uYW4pKQoKICAgICAgICB0ZXJtID0gbmEgfCBudW0KCgoKICAgICAgICB0ZXJtWzEsIC4uLl0ucGFyc2Vfc3RyaW5nKFwiMzI0IDIzNCBOL0EgMjM0XCIpICMgLT4gWzMyNCwgMjM0LCBuYW4sIDIzNF0KCiAgICBcIlwiXCIKCiAgICByZXR1cm4gbGFtYmRhIHMsIGwsIHQ6IFtyZXBsX3N0cl0KCgoKCgpkZWYgcmVtb3ZlX3F1b3RlcyhzLCBsLCB0KToKCiAgICBcIlwiXCIKCiAgICBIZWxwZXIgcGFyc2UgYWN0aW9uIGZvciByZW1vdmluZyBxdW90YXRpb24gbWFya3MgZnJvbSBwYXJzZWQKCiAgICBxdW90ZWQgc3RyaW5ncy4KCgoKICAgIEV4YW1wbGU6OgoKCgogICAgICAgICMgYnkgZGVmYXVsdCwgcXVvdGF0aW9uIG1hcmtzIGFyZSBpbmNsdWRlZCBpbiBwYXJzZWQgcmVzdWx0cwoKICAgICAgICBxdW90ZWRfc3RyaW5nLnBhcnNlX3N0cmluZyhcIidOb3cgaXMgdGhlIFdpbnRlciBvZiBvdXIgRGlzY29udGVudCdcIikgIyAtPiBbXCInTm93IGlzIHRoZSBXaW50ZXIgb2Ygb3VyIERpc2NvbnRlbnQnXCJdCgoKCiAgICAgICAgIyB1c2UgcmVtb3ZlX3F1b3RlcyB0byBzdHJpcCBxdW90YXRpb24gbWFya3MgZnJvbSBwYXJzZWQgcmVzdWx0cwoKICAgICAgICBxdW90ZWRfc3RyaW5nLnNldF9wYXJzZV9hY3Rpb24ocmVtb3ZlX3F1b3RlcykKCiAgICAgICAgcXVvdGVkX3N0cmluZy5wYXJzZV9zdHJpbmcoXCInTm93IGlzIHRoZSBXaW50ZXIgb2Ygb3VyIERpc2NvbnRlbnQnXCIpICMgLT4gW1wiTm93IGlzIHRoZSBXaW50ZXIgb2Ygb3VyIERpc2NvbnRlbnRcIl0KCiAgICBcIlwiXCIKCiAgICByZXR1cm4gdFswXVsxOi0xXQoKCgoKCmRlZiB3aXRoX2F0dHJpYnV0ZSgqYXJncywgKiphdHRyX2RpY3QpOgoKICAgIFwiXCJcIgoKICAgIEhlbHBlciB0byBjcmVhdGUgYSB2YWxpZGF0aW5nIHBhcnNlIGFjdGlvbiB0byBiZSB1c2VkIHdpdGggc3RhcnQKCiAgICB0YWdzIGNyZWF0ZWQgd2l0aCA6Y2xhc3M6YG1ha2VfeG1sX3RhZ3NgIG9yCgogICAgOmNsYXNzOmBtYWtlX2h0bWxfdGFnc2AuIFVzZSBgYHdpdGhfYXR0cmlidXRlYGAgdG8gcXVhbGlmeQoKICAgIGEgc3RhcnRpbmcgdGFnIHdpdGggYSByZXF1aXJlZCBhdHRyaWJ1dGUgdmFsdWUsIHRvIGF2b2lkIGZhbHNlCgogICAgbWF0Y2hlcyBvbiBjb21tb24gdGFncyBzdWNoIGFzIGBgPFREPmBgIG9yIGBgPERJVj5gYC4KCgoKICAgIENhbGwgYGB3aXRoX2F0dHJpYnV0ZWBgIHdpdGggYSBzZXJpZXMgb2YgYXR0cmlidXRlIG5hbWVzIGFuZAoKICAgIHZhbHVlcy4gU3BlY2lmeSB0aGUgbGlzdCBvZiBmaWx0ZXIgYXR0cmlidXRlcyBuYW1lcyBhbmQgdmFsdWVzIGFzOgoKCgogICAgLSBrZXl3b3JkIGFyZ3VtZW50cywgYXMgaW4gYGAoYWxpZ249XCJyaWdodFwiKWBgLCBvcgoKICAgIC0gYXMgYW4gZXhwbGljaXQgZGljdCB3aXRoIGBgKipgYCBvcGVyYXRvciwgd2hlbiBhbiBhdHRyaWJ1dGUKCiAgICAgIG5hbWUgaXMgYWxzbyBhIFB5dGhvbiByZXNlcnZlZCB3b3JkLCBhcyBpbiBgYCoqe1wiY2xhc3NcIjpcIkN1c3RvbWVyXCIsIFwiYWxpZ25cIjpcInJpZ2h0XCJ9YGAKCiAgICAtIGEgbGlzdCBvZiBuYW1lLXZhbHVlIHR1cGxlcywgYXMgaW4gYGAoKFwibnMxOmNsYXNzXCIsIFwiQ3VzdG9tZXJcIiksIChcIm5zMjphbGlnblwiLCBcInJpZ2h0XCIpKWBgCgoKCiAgICBGb3IgYXR0cmlidXRlIG5hbWVzIHdpdGggYSBuYW1lc3BhY2UgcHJlZml4LCB5b3UgbXVzdCB1c2UgdGhlIHNlY29uZAoKICAgIGZvcm0uICBBdHRyaWJ1dGUgbmFtZXMgYXJlIG1hdGNoZWQgaW5zZW5zaXRpdmUgdG8gdXBwZXIvbG93ZXIgY2FzZS4KCgoKICAgIElmIGp1c3QgdGVzdGluZyBmb3IgYGBjbGFzc2BgICh3aXRoIG9yIHdpdGhvdXQgYSBuYW1lc3BhY2UpLCB1c2UKCiAgICA6Y2xhc3M6YHdpdGhfY2xhc3NgLgoKCgogICAgVG8gdmVyaWZ5IHRoYXQgdGhlIGF0dHJpYnV0ZSBleGlzdHMsIGJ1dCB3aXRob3V0IHNwZWNpZnlpbmcgYSB2YWx1ZSwKCiAgICBwYXNzIGBgd2l0aF9hdHRyaWJ1dGUuQU5ZX1ZBTFVFYGAgYXMgdGhlIHZhbHVlLgoKCgogICAgRXhhbXBsZTo6CgoKCiAgICAgICAgaHRtbCA9ICcnJwoKICAgICAgICAgICAgPGRpdj4KCiAgICAgICAgICAgIFNvbWUgdGV4dAoKICAgICAgICAgICAgPGRpdiB0eXBlPVwiZ3JpZFwiPjEgNCAwIDEgMDwvZGl2PgoKICAgICAgICAgICAgPGRpdiB0eXBlPVwiZ3JhcGhcIj4xLDMgMiwzIDEsMTwvZGl2PgoKICAgICAgICAgICAgPGRpdj50aGlzIGhhcyBubyB0eXBlPC9kaXY+CgogICAgICAgICAgICA8L2Rpdj4KCgoKICAgICAgICAnJycKCiAgICAgICAgZGl2LGRpdl9lbmQgPSBtYWtlX2h0bWxfdGFncyhcImRpdlwiKQoKCgogICAgICAgICMgb25seSBtYXRjaCBkaXYgdGFnIGhhdmluZyBhIHR5cGUgYXR0cmlidXRlIHdpdGggdmFsdWUgXCJncmlkXCIKCiAgICAgICAgZGl2X2dyaWQgPSBkaXYoKS5zZXRfcGFyc2VfYWN0aW9uKHdpdGhfYXR0cmlidXRlKHR5cGU9XCJncmlkXCIpKQoKICAgICAgICBncmlkX2V4cHIgPSBkaXZfZ3JpZCArIFNraXBUbyhkaXYgfCBkaXZfZW5kKShcImJvZHlcIikKCiAgICAgICAgZm9yIGdyaWRfaGVhZGVyIGluIGdyaWRfZXhwci5zZWFyY2hfc3RyaW5nKGh0bWwpOgoKICAgICAgICAgICAgcHJpbnQoZ3JpZF9oZWFkZXIuYm9keSkKCgoKICAgICAgICAjIGNvbnN0cnVjdCBhIG1hdGNoIHdpdGggYW55IGRpdiB0YWcgaGF2aW5nIGEgdHlwZSBhdHRyaWJ1dGUsIHJlZ2FyZGxlc3Mgb2YgdGhlIHZhbHVlCgogICAgICAgIGRpdl9hbnlfdHlwZSA9IGRpdigpLnNldF9wYXJzZV9hY3Rpb24od2l0aF9hdHRyaWJ1dGUodHlwZT13aXRoX2F0dHJpYnV0ZS5BTllfVkFMVUUpKQoKICAgICAgICBkaXZfZXhwciA9IGRpdl9hbnlfdHlwZSArIFNraXBUbyhkaXYgfCBkaXZfZW5kKShcImJvZHlcIikKCiAgICAgICAgZm9yIGRpdl9oZWFkZXIgaW4gZGl2X2V4cHIuc2VhcmNoX3N0cmluZyhodG1sKToKCiAgICAgICAgICAgIHByaW50KGRpdl9oZWFkZXIuYm9keSkKCgoKICAgIHByaW50czo6CgoKCiAgICAgICAgMSA0IDAgMSAwCgoKCiAgICAgICAgMSA0IDAgMSAwCgogICAgICAgIDEsMyAyLDMgMSwxCgogICAgXCJcIlwiCgogICAgaWYgYXJnczoKCiAgICAgICAgYXR0cnMgPSBhcmdzWzpdCgogICAgZWxzZToKCiAgICAgICAgYXR0cnMgPSBhdHRyX2RpY3QuaXRlbXMoKQoKICAgIGF0dHJzID0gWyhrLCB2KSBmb3IgaywgdiBpbiBhdHRyc10KCgoKICAgIGRlZiBwYShzLCBsLCB0b2tlbnMpOgoKICAgICAgICBmb3IgYXR0ck5hbWUsIGF0dHJWYWx1ZSBpbiBhdHRyczoKCiAgICAgICAgICAgIGlmIGF0dHJOYW1lIG5vdCBpbiB0b2tlbnM6CgogICAgICAgICAgICAgICAgcmFpc2UgUGFyc2VFeGNlcHRpb24ocywgbCwgXCJubyBtYXRjaGluZyBhdHRyaWJ1dGUgXCIgKyBhdHRyTmFtZSkKCiAgICAgICAgICAgIGlmIGF0dHJWYWx1ZSAhPSB3aXRoX2F0dHJpYnV0ZS5BTllfVkFMVUUgYW5kIHRva2Vuc1thdHRyTmFtZV0gIT0gYXR0clZhbHVlOgoKICAgICAgICAgICAgICAgIHJhaXNlIFBhcnNlRXhjZXB0aW9uKAoKICAgICAgICAgICAgICAgICAgICBzLAoKICAgICAgICAgICAgICAgICAgICBsLAoKICAgICAgICAgICAgICAgICAgICBcImF0dHJpYnV0ZSB7IXJ9IGhhcyB2YWx1ZSB7IXJ9LCBtdXN0IGJlIHshcn1cIi5mb3JtYXQoCgogICAgICAgICAgICAgICAgICAgICAgICBhdHRyTmFtZSwgdG9rZW5zW2F0dHJOYW1lXSwgYXR0clZhbHVlCgogICAgICAgICAgICAgICAgICAgICksCgogICAgICAgICAgICAgICAgKQoKCgogICAgcmV0dXJuIHBhCgoKCgoKd2l0aF9hdHRyaWJ1dGUuQU5ZX1ZBTFVFID0gb2JqZWN0KCkKCgoKCgpkZWYgd2l0aF9jbGFzcyhjbGFzc25hbWUsIG5hbWVzcGFjZT1cIlwiKToKCiAgICBcIlwiXCIKCiAgICBTaW1wbGlmaWVkIHZlcnNpb24gb2YgOmNsYXNzOmB3aXRoX2F0dHJpYnV0ZWAgd2hlbgoKICAgIG1hdGNoaW5nIG9uIGEgZGl2IGNsYXNzIC0gbWFkZSBkaWZmaWN1bHQgYmVjYXVzZSBgYGNsYXNzYGAgaXMKCiAgICBhIHJlc2VydmVkIHdvcmQgaW4gUHl0aG9uLgoKCgogICAgRXhhbXBsZTo6CgoKCiAgICAgICAgaHRtbCA9ICcnJwoKICAgICAgICAgICAgPGRpdj4KCiAgICAgICAgICAgIFNvbWUgdGV4dAoKICAgICAgICAgICAgPGRpdiBjbGFzcz1cImdyaWRcIj4xIDQgMCAxIDA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJncmFwaFwiPjEsMyAyLDMgMSwxPC9kaXY+CgogICAgICAgICAgICA8ZGl2PnRoaXMgJmx0O2RpdiZndDsgaGFzIG5vIGNsYXNzPC9kaXY+CgogICAgICAgICAgICA8L2Rpdj4KCgoKICAgICAgICAnJycKCiAgICAgICAgZGl2LGRpdl9lbmQgPSBtYWtlX2h0bWxfdGFncyhcImRpdlwiKQoKICAgICAgICBkaXZfZ3JpZCA9IGRpdigpLnNldF9wYXJzZV9hY3Rpb24od2l0aF9jbGFzcyhcImdyaWRcIikpCgoKCiAgICAgICAgZ3JpZF9leHByID0gZGl2X2dyaWQgKyBTa2lwVG8oZGl2IHwgZGl2X2VuZCkoXCJib2R5XCIpCgogICAgICAgIGZvciBncmlkX2hlYWRlciBpbiBncmlkX2V4cHIuc2VhcmNoX3N0cmluZyhodG1sKToKCiAgICAgICAgICAgIHByaW50KGdyaWRfaGVhZGVyLmJvZHkpCgoKCiAgICAgICAgZGl2X2FueV90eXBlID0gZGl2KCkuc2V0X3BhcnNlX2FjdGlvbih3aXRoX2NsYXNzKHdpdGhBdHRyaWJ1dGUuQU5ZX1ZBTFVFKSkKCiAgICAgICAgZGl2X2V4cHIgPSBkaXZfYW55X3R5cGUgKyBTa2lwVG8oZGl2IHwgZGl2X2VuZCkoXCJib2R5XCIpCgogICAgICAgIGZvciBkaXZfaGVhZGVyIGluIGRpdl9leHByLnNlYXJjaF9zdHJpbmcoaHRtbCk6CgogICAgICAgICAgICBwcmludChkaXZfaGVhZGVyLmJvZHkpCgoKCiAgICBwcmludHM6OgoKCgogICAgICAgIDEgNCAwIDEgMAoKCgogICAgICAgIDEgNCAwIDEgMAoKICAgICAgICAxLDMgMiwzIDEsMQoKICAgIFwiXCJcIgoKICAgIGNsYXNzYXR0ciA9IFwie306Y2xhc3NcIi5mb3JtYXQobmFtZXNwYWNlKSBpZiBuYW1lc3BhY2UgZWxzZSBcImNsYXNzXCIKCiAgICByZXR1cm4gd2l0aF9hdHRyaWJ1dGUoKip7Y2xhc3NhdHRyOiBjbGFzc25hbWV9KQoKCgoKCiMgcHJlLVBFUDggY29tcGF0aWJpbGl0eSBzeW1ib2xzCgpyZXBsYWNlV2l0aCA9IHJlcGxhY2Vfd2l0aAoKcmVtb3ZlUXVvdGVzID0gcmVtb3ZlX3F1b3RlcwoKd2l0aEF0dHJpYnV0ZSA9IHdpdGhfYXR0cmlidXRlCgp3aXRoQ2xhc3MgPSB3aXRoX2NsYXNzCgptYXRjaE9ubHlBdENvbCA9IG1hdGNoX29ubHlfYXRfY29sCgoKCiIiIgoKbW9kdWxlX2RpY3RbInB5cGFyc2luZy9kaWFncmFtL19faW5pdF9fLnB5Il09IiIiCgppbXBvcnQgcmFpbHJvYWQKCmltcG9ydCBweXBhcnNpbmcKCmltcG9ydCB0eXBpbmcKCmZyb20gdHlwaW5nIGltcG9ydCAoCgogICAgTGlzdCwKCiAgICBOYW1lZFR1cGxlLAoKICAgIEdlbmVyaWMsCgogICAgVHlwZVZhciwKCiAgICBEaWN0LAoKICAgIENhbGxhYmxlLAoKICAgIFNldCwKCiAgICBJdGVyYWJsZSwKCikKCmZyb20gamluamEyIGltcG9ydCBUZW1wbGF0ZQoKZnJvbSBpbyBpbXBvcnQgU3RyaW5nSU8KCmltcG9ydCBpbnNwZWN0CgoKCgoKamluamEyX3RlbXBsYXRlX3NvdXJjZSA9IFwiXCJcIlxcCgo8IURPQ1RZUEUgaHRtbD4KCjxodG1sPgoKPGhlYWQ+CgogICAgeyUgaWYgbm90IGhlYWQgJX0KCiAgICAgICAgPHN0eWxlIHR5cGU9XCJ0ZXh0L2Nzc1wiPgoKICAgICAgICAgICAgLnJhaWxyb2FkLWhlYWRpbmcgewoKICAgICAgICAgICAgICAgIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7CgogICAgICAgICAgICB9CgogICAgICAgIDwvc3R5bGU+CgogICAgeyUgZWxzZSAlfQoKICAgICAgICB7eyBoZWFkIHwgc2FmZSB9fQoKICAgIHslIGVuZGlmICV9Cgo8L2hlYWQ+Cgo8Ym9keT4KCnt7IGJvZHkgfCBzYWZlIH19Cgp7JSBmb3IgZGlhZ3JhbSBpbiBkaWFncmFtcyAlfQoKICAgIDxkaXYgY2xhc3M9XCJyYWlscm9hZC1ncm91cFwiPgoKICAgICAgICA8aDEgY2xhc3M9XCJyYWlscm9hZC1oZWFkaW5nXCI+e3sgZGlhZ3JhbS50aXRsZSB9fTwvaDE+CgogICAgICAgIDxkaXYgY2xhc3M9XCJyYWlscm9hZC1kZXNjcmlwdGlvblwiPnt7IGRpYWdyYW0udGV4dCB9fTwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPVwicmFpbHJvYWQtc3ZnXCI+CgogICAgICAgICAgICB7eyBkaWFncmFtLnN2ZyB9fQoKICAgICAgICA8L2Rpdj4KCiAgICA8L2Rpdj4KCnslIGVuZGZvciAlfQoKPC9ib2R5PgoKPC9odG1sPgoKXCJcIlwiCgoKCnRlbXBsYXRlID0gVGVtcGxhdGUoamluamEyX3RlbXBsYXRlX3NvdXJjZSkKCgoKIyBOb3RlOiBpZGVhbGx5IHRoaXMgd291bGQgYmUgYSBkYXRhY2xhc3MsIGJ1dCB3ZSdyZSBzdXBwb3J0aW5nIFB5dGhvbiAzLjUrIHNvIHdlIGNhbid0IGRvIHRoaXMgeWV0CgpOYW1lZERpYWdyYW0gPSBOYW1lZFR1cGxlKAoKICAgIFwiTmFtZWREaWFncmFtXCIsCgogICAgWyhcIm5hbWVcIiwgc3RyKSwgKFwiZGlhZ3JhbVwiLCB0eXBpbmcuT3B0aW9uYWxbcmFpbHJvYWQuRGlhZ3JhbUl0ZW1dKSwgKFwiaW5kZXhcIiwgaW50KV0sCgopCgpcIlwiXCIKCkEgc2ltcGxlIHN0cnVjdHVyZSBmb3IgYXNzb2NpYXRpbmcgYSBuYW1lIHdpdGggYSByYWlscm9hZCBkaWFncmFtCgpcIlwiXCIKCgoKVCA9IFR5cGVWYXIoXCJUXCIpCgoKCgoKY2xhc3MgRWFjaEl0ZW0ocmFpbHJvYWQuR3JvdXApOgoKICAgIFwiXCJcIgoKICAgIEN1c3RvbSByYWlscm9hZCBpdGVtIHRvIGNvbXBvc2UgYToKCiAgICAtIEdyb3VwIGNvbnRhaW5pbmcgYQoKICAgICAgLSBPbmVPck1vcmUgY29udGFpbmluZyBhCgogICAgICAgIC0gQ2hvaWNlIG9mIHRoZSBlbGVtZW50cyBpbiB0aGUgRWFjaAoKICAgIHdpdGggdGhlIGdyb3VwIGxhYmVsIGluZGljYXRpbmcgdGhhdCBhbGwgbXVzdCBiZSBtYXRjaGVkCgogICAgXCJcIlwiCgoKCiAgICBhbGxfbGFiZWwgPSBcIltBTExdXCIKCgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqaXRlbXMpOgoKICAgICAgICBjaG9pY2VfaXRlbSA9IHJhaWxyb2FkLkNob2ljZShsZW4oaXRlbXMpIC0gMSwgKml0ZW1zKQoKICAgICAgICBvbmVfb3JfbW9yZV9pdGVtID0gcmFpbHJvYWQuT25lT3JNb3JlKGl0ZW09Y2hvaWNlX2l0ZW0pCgogICAgICAgIHN1cGVyKCkuX19pbml0X18ob25lX29yX21vcmVfaXRlbSwgbGFiZWw9c2VsZi5hbGxfbGFiZWwpCgoKCgoKY2xhc3MgQW5ub3RhdGVkSXRlbShyYWlscm9hZC5Hcm91cCk6CgogICAgXCJcIlwiCgogICAgU2ltcGxlIHN1YmNsYXNzIG9mIEdyb3VwIHRoYXQgY3JlYXRlcyBhbiBhbm5vdGF0aW9uIGxhYmVsCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oc2VsZiwgbGFiZWw6IHN0ciwgaXRlbSk6CgogICAgICAgIHN1cGVyKCkuX19pbml0X18oaXRlbT1pdGVtLCBsYWJlbD1cIlt7fV1cIi5mb3JtYXQobGFiZWwpIGlmIGxhYmVsIGVsc2UgbGFiZWwpCgoKCgoKY2xhc3MgRWRpdGFibGVQYXJ0aWFsKEdlbmVyaWNbVF0pOgoKICAgIFwiXCJcIgoKICAgIEFjdHMgbGlrZSBhIGZ1bmN0b29scy5wYXJ0aWFsLCBidXQgY2FuIGJlIGVkaXRlZC4gSW4gb3RoZXIgd29yZHMsIGl0IHJlcHJlc2VudHMgYSB0eXBlIHRoYXQgaGFzbid0IHlldCBiZWVuCgogICAgY29uc3RydWN0ZWQuCgogICAgXCJcIlwiCgoKCiAgICAjIFdlIG5lZWQgdGhpcyBoZXJlIGJlY2F1c2UgdGhlIHJhaWxyb2FkIGNvbnN0cnVjdG9ycyBhY3R1YWxseSB0cmFuc2Zvcm0gdGhlIGRhdGEsIHNvIGNhbid0IGJlIGNhbGxlZCB1bnRpbCB0aGUKCiAgICAjIGVudGlyZSB0cmVlIGlzIGFzc2VtYmxlZAoKCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGZ1bmM6IENhbGxhYmxlWy4uLiwgVF0sIGFyZ3M6IGxpc3QsIGt3YXJnczogZGljdCk6CgogICAgICAgIHNlbGYuZnVuYyA9IGZ1bmMKCiAgICAgICAgc2VsZi5hcmdzID0gYXJncwoKICAgICAgICBzZWxmLmt3YXJncyA9IGt3YXJncwoKCgogICAgQGNsYXNzbWV0aG9kCgogICAgZGVmIGZyb21fY2FsbChjbHMsIGZ1bmM6IENhbGxhYmxlWy4uLiwgVF0sICphcmdzLCAqKmt3YXJncykgLT4gXCJFZGl0YWJsZVBhcnRpYWxbVF1cIjoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIElmIHlvdSBjYWxsIHRoaXMgZnVuY3Rpb24gaW4gdGhlIHNhbWUgd2F5IHRoYXQgeW91IHdvdWxkIGNhbGwgdGhlIGNvbnN0cnVjdG9yLCBpdCB3aWxsIHN0b3JlIHRoZSBhcmd1bWVudHMKCiAgICAgICAgYXMgeW91IGV4cGVjdC4gRm9yIGV4YW1wbGUgRWRpdGFibGVQYXJ0aWFsLmZyb21fY2FsbChGcmFjdGlvbiwgMSwgMykoKSA9PSBGcmFjdGlvbigxLCAzKQoKICAgICAgICBcIlwiXCIKCiAgICAgICAgcmV0dXJuIEVkaXRhYmxlUGFydGlhbChmdW5jPWZ1bmMsIGFyZ3M9bGlzdChhcmdzKSwga3dhcmdzPWt3YXJncykKCgoKICAgIEBwcm9wZXJ0eQoKICAgIGRlZiBuYW1lKHNlbGYpOgoKICAgICAgICByZXR1cm4gc2VsZi5rd2FyZ3NbXCJuYW1lXCJdCgoKCiAgICBkZWYgX19jYWxsX18oc2VsZikgLT4gVDoKCiAgICAgICAgXCJcIlwiCgogICAgICAgIEV2YWx1YXRlIHRoZSBwYXJ0aWFsIGFuZCByZXR1cm4gdGhlIHJlc3VsdAoKICAgICAgICBcIlwiXCIKCiAgICAgICAgYXJncyA9IHNlbGYuYXJncy5jb3B5KCkKCiAgICAgICAga3dhcmdzID0gc2VsZi5rd2FyZ3MuY29weSgpCgoKCiAgICAgICAgIyBUaGlzIGlzIGEgaGVscGZ1bCBoYWNrIHRvIGFsbG93IHlvdSB0byBzcGVjaWZ5IHZhcmFyZ3MgcGFyYW1ldGVycyAoZS5nLiAqYXJncykgYXMga2V5d29yZCBhcmdzIChlLmcuCgogICAgICAgICMgYXJncz1bJ2xpc3QnLCAnb2YnLCAndGhpbmdzJ10pCgogICAgICAgIGFyZ19zcGVjID0gaW5zcGVjdC5nZXRmdWxsYXJnc3BlYyhzZWxmLmZ1bmMpCgogICAgICAgIGlmIGFyZ19zcGVjLnZhcmFyZ3MgaW4gc2VsZi5rd2FyZ3M6CgogICAgICAgICAgICBhcmdzICs9IGt3YXJncy5wb3AoYXJnX3NwZWMudmFyYXJncykKCgoKICAgICAgICByZXR1cm4gc2VsZi5mdW5jKCphcmdzLCAqKmt3YXJncykKCgoKCgpkZWYgcmFpbHJvYWRfdG9faHRtbChkaWFncmFtczogTGlzdFtOYW1lZERpYWdyYW1dLCAqKmt3YXJncykgLT4gc3RyOgoKICAgIFwiXCJcIgoKICAgIEdpdmVuIGEgbGlzdCBvZiBOYW1lZERpYWdyYW0sIHByb2R1Y2UgYSBzaW5nbGUgSFRNTCBzdHJpbmcgdGhhdCB2aXN1YWxpc2VzIHRob3NlIGRpYWdyYW1zCgogICAgOnBhcmFtcyBrd2FyZ3M6IGt3YXJncyB0byBiZSBwYXNzZWQgaW4gdG8gdGhlIHRlbXBsYXRlCgogICAgXCJcIlwiCgogICAgZGF0YSA9IFtdCgogICAgZm9yIGRpYWdyYW0gaW4gZGlhZ3JhbXM6CgogICAgICAgIGlmIGRpYWdyYW0uZGlhZ3JhbSBpcyBOb25lOgoKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgaW8gPSBTdHJpbmdJTygpCgogICAgICAgIGRpYWdyYW0uZGlhZ3JhbS53cml0ZVN2Zyhpby53cml0ZSkKCiAgICAgICAgdGl0bGUgPSBkaWFncmFtLm5hbWUKCiAgICAgICAgaWYgZGlhZ3JhbS5pbmRleCA9PSAwOgoKICAgICAgICAgICAgdGl0bGUgKz0gXCIgKHJvb3QpXCIKCiAgICAgICAgZGF0YS5hcHBlbmQoe1widGl0bGVcIjogdGl0bGUsIFwidGV4dFwiOiBcIlwiLCBcInN2Z1wiOiBpby5nZXR2YWx1ZSgpfSkKCgoKICAgIHJldHVybiB0ZW1wbGF0ZS5yZW5kZXIoZGlhZ3JhbXM9ZGF0YSwgKiprd2FyZ3MpCgoKCgoKZGVmIHJlc29sdmVfcGFydGlhbChwYXJ0aWFsOiBcIkVkaXRhYmxlUGFydGlhbFtUXVwiKSAtPiBUOgoKICAgIFwiXCJcIgoKICAgIFJlY3Vyc2l2ZWx5IHJlc29sdmVzIGEgY29sbGVjdGlvbiBvZiBQYXJ0aWFscyBpbnRvIHdoYXRldmVyIHR5cGUgdGhleSBhcmUKCiAgICBcIlwiXCIKCiAgICBpZiBpc2luc3RhbmNlKHBhcnRpYWwsIEVkaXRhYmxlUGFydGlhbCk6CgogICAgICAgIHBhcnRpYWwuYXJncyA9IHJlc29sdmVfcGFydGlhbChwYXJ0aWFsLmFyZ3MpCgogICAgICAgIHBhcnRpYWwua3dhcmdzID0gcmVzb2x2ZV9wYXJ0aWFsKHBhcnRpYWwua3dhcmdzKQoKICAgICAgICByZXR1cm4gcGFydGlhbCgpCgogICAgZWxpZiBpc2luc3RhbmNlKHBhcnRpYWwsIGxpc3QpOgoKICAgICAgICByZXR1cm4gW3Jlc29sdmVfcGFydGlhbCh4KSBmb3IgeCBpbiBwYXJ0aWFsXQoKICAgIGVsaWYgaXNpbnN0YW5jZShwYXJ0aWFsLCBkaWN0KToKCiAgICAgICAgcmV0dXJuIHtrZXk6IHJlc29sdmVfcGFydGlhbCh4KSBmb3Iga2V5LCB4IGluIHBhcnRpYWwuaXRlbXMoKX0KCiAgICBlbHNlOgoKICAgICAgICByZXR1cm4gcGFydGlhbAoKCgoKCmRlZiB0b19yYWlscm9hZCgKCiAgICBlbGVtZW50OiBweXBhcnNpbmcuUGFyc2VyRWxlbWVudCwKCiAgICBkaWFncmFtX2t3YXJnczogdHlwaW5nLk9wdGlvbmFsW2RpY3RdID0gTm9uZSwKCiAgICB2ZXJ0aWNhbDogaW50ID0gMywKCiAgICBzaG93X3Jlc3VsdHNfbmFtZXM6IGJvb2wgPSBGYWxzZSwKCiAgICBzaG93X2dyb3VwczogYm9vbCA9IEZhbHNlLAoKKSAtPiBMaXN0W05hbWVkRGlhZ3JhbV06CgogICAgXCJcIlwiCgogICAgQ29udmVydCBhIHB5cGFyc2luZyBlbGVtZW50IHRyZWUgaW50byBhIGxpc3Qgb2YgZGlhZ3JhbXMuIFRoaXMgaXMgdGhlIHJlY29tbWVuZGVkIGVudHJ5cG9pbnQgdG8gZGlhZ3JhbQoKICAgIGNyZWF0aW9uIGlmIHlvdSB3YW50IHRvIGFjY2VzcyB0aGUgUmFpbHJvYWQgdHJlZSBiZWZvcmUgaXQgaXMgY29udmVydGVkIHRvIEhUTUwKCiAgICA6cGFyYW0gZWxlbWVudDogYmFzZSBlbGVtZW50IG9mIHRoZSBwYXJzZXIgYmVpbmcgZGlhZ3JhbW1lZAoKICAgIDpwYXJhbSBkaWFncmFtX2t3YXJnczoga3dhcmdzIHRvIHBhc3MgdG8gdGhlIERpYWdyYW0oKSBjb25zdHJ1Y3RvcgoKICAgIDpwYXJhbSB2ZXJ0aWNhbDogKG9wdGlvbmFsKSAtIGludCAtIGxpbWl0IGF0IHdoaWNoIG51bWJlciBvZiBhbHRlcm5hdGl2ZXMgc2hvdWxkIGJlCgogICAgICAgc2hvd24gdmVydGljYWxseSBpbnN0ZWFkIG9mIGhvcml6b250YWxseQoKICAgIDpwYXJhbSBzaG93X3Jlc3VsdHNfbmFtZXMgLSBib29sIHRvIGluZGljYXRlIHdoZXRoZXIgcmVzdWx0cyBuYW1lIGFubm90YXRpb25zIHNob3VsZCBiZQoKICAgICAgIGluY2x1ZGVkIGluIHRoZSBkaWFncmFtCgogICAgOnBhcmFtIHNob3dfZ3JvdXBzIC0gYm9vbCB0byBpbmRpY2F0ZSB3aGV0aGVyIGdyb3VwcyBzaG91bGQgYmUgaGlnaGxpZ2h0ZWQgd2l0aCBhbiB1bmxhYmVsZWQKCiAgICAgICBzdXJyb3VuZGluZyBib3gKCiAgICBcIlwiXCIKCiAgICAjIENvbnZlcnQgdGhlIHdob2xlIHRyZWUgdW5kZXJuZWF0aCB0aGUgcm9vdAoKICAgIGxvb2t1cCA9IENvbnZlcnRlclN0YXRlKGRpYWdyYW1fa3dhcmdzPWRpYWdyYW1fa3dhcmdzIG9yIHt9KQoKICAgIF90b19kaWFncmFtX2VsZW1lbnQoCgogICAgICAgIGVsZW1lbnQsCgogICAgICAgIGxvb2t1cD1sb29rdXAsCgogICAgICAgIHBhcmVudD1Ob25lLAoKICAgICAgICB2ZXJ0aWNhbD12ZXJ0aWNhbCwKCiAgICAgICAgc2hvd19yZXN1bHRzX25hbWVzPXNob3dfcmVzdWx0c19uYW1lcywKCiAgICAgICAgc2hvd19ncm91cHM9c2hvd19ncm91cHMsCgogICAgKQoKCgogICAgcm9vdF9pZCA9IGlkKGVsZW1lbnQpCgogICAgIyBDb252ZXJ0IHRoZSByb290IGlmIGl0IGhhc24ndCBiZWVuIGFscmVhZHkKCiAgICBpZiByb290X2lkIGluIGxvb2t1cDoKCiAgICAgICAgaWYgbm90IGVsZW1lbnQuY3VzdG9tTmFtZToKCiAgICAgICAgICAgIGxvb2t1cFtyb290X2lkXS5uYW1lID0gXCJcIgoKICAgICAgICBsb29rdXBbcm9vdF9pZF0ubWFya19mb3JfZXh0cmFjdGlvbihyb290X2lkLCBsb29rdXAsIGZvcmNlPVRydWUpCgoKCiAgICAjIE5vdyB0aGF0IHdlJ3JlIGZpbmlzaGVkLCB3ZSBjYW4gY29udmVydCBmcm9tIGludGVybWVkaWF0ZSBzdHJ1Y3R1cmVzIGludG8gUmFpbHJvYWQgZWxlbWVudHMKCiAgICBkaWFncyA9IGxpc3QobG9va3VwLmRpYWdyYW1zLnZhbHVlcygpKQoKICAgIGlmIGxlbihkaWFncykgPiAxOgoKICAgICAgICAjIGNvbGxhcHNlIG91dCBkdXBsaWNhdGUgZGlhZ3Mgd2l0aCB0aGUgc2FtZSBuYW1lCgogICAgICAgIHNlZW4gPSBzZXQoKQoKICAgICAgICBkZWR1cGVkX2RpYWdzID0gW10KCiAgICAgICAgZm9yIGQgaW4gZGlhZ3M6CgogICAgICAgICAgICAjIGRvbid0IGV4dHJhY3QgU2tpcFRvIGVsZW1lbnRzLCB0aGV5IGFyZSB1bmluZm9ybWF0aXZlIGFzIHN1YmRpYWdyYW1zCgogICAgICAgICAgICBpZiBkLm5hbWUgPT0gXCIuLi5cIjoKCiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgaWYgZC5uYW1lIGlzIG5vdCBOb25lIGFuZCBkLm5hbWUgbm90IGluIHNlZW46CgogICAgICAgICAgICAgICAgc2Vlbi5hZGQoZC5uYW1lKQoKICAgICAgICAgICAgICAgIGRlZHVwZWRfZGlhZ3MuYXBwZW5kKGQpCgogICAgICAgIHJlc29sdmVkID0gW3Jlc29sdmVfcGFydGlhbChwYXJ0aWFsKSBmb3IgcGFydGlhbCBpbiBkZWR1cGVkX2RpYWdzXQoKICAgIGVsc2U6CgogICAgICAgICMgc3BlY2lhbCBjYXNlIC0gaWYganVzdCBvbmUgZGlhZ3JhbSwgYWx3YXlzIGRpc3BsYXkgaXQsIGV2ZW4gaWYKCiAgICAgICAgIyBpdCBoYXMgbm8gbmFtZQoKICAgICAgICByZXNvbHZlZCA9IFtyZXNvbHZlX3BhcnRpYWwocGFydGlhbCkgZm9yIHBhcnRpYWwgaW4gZGlhZ3NdCgogICAgcmV0dXJuIHNvcnRlZChyZXNvbHZlZCwga2V5PWxhbWJkYSBkaWFnOiBkaWFnLmluZGV4KQoKCgoKCmRlZiBfc2hvdWxkX3ZlcnRpY2FsKAoKICAgIHNwZWNpZmljYXRpb246IGludCwgZXhwcnM6IEl0ZXJhYmxlW3B5cGFyc2luZy5QYXJzZXJFbGVtZW50XQoKKSAtPiBib29sOgoKICAgIFwiXCJcIgoKICAgIFJldHVybnMgdHJ1ZSBpZiB3ZSBzaG91bGQgcmV0dXJuIGEgdmVydGljYWwgbGlzdCBvZiBlbGVtZW50cwoKICAgIFwiXCJcIgoKICAgIGlmIHNwZWNpZmljYXRpb24gaXMgTm9uZToKCiAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZWxzZToKCiAgICAgICAgcmV0dXJuIGxlbihfdmlzaWJsZV9leHBycyhleHBycykpID49IHNwZWNpZmljYXRpb24KCgoKCgpjbGFzcyBFbGVtZW50U3RhdGU6CgogICAgXCJcIlwiCgogICAgU3RhdGUgcmVjb3JkZWQgZm9yIGFuIGluZGl2aWR1YWwgcHlwYXJzaW5nIEVsZW1lbnQKCiAgICBcIlwiXCIKCgoKICAgICMgTm90ZTogdGhpcyBzaG91bGQgYmUgYSBkYXRhY2xhc3MsIGJ1dCB3ZSBoYXZlIHRvIHN1cHBvcnQgUHl0aG9uIDMuNQoKICAgIGRlZiBfX2luaXRfXygKCiAgICAgICAgc2VsZiwKCiAgICAgICAgZWxlbWVudDogcHlwYXJzaW5nLlBhcnNlckVsZW1lbnQsCgogICAgICAgIGNvbnZlcnRlZDogRWRpdGFibGVQYXJ0aWFsLAoKICAgICAgICBwYXJlbnQ6IEVkaXRhYmxlUGFydGlhbCwKCiAgICAgICAgbnVtYmVyOiBpbnQsCgogICAgICAgIG5hbWU6IHN0ciA9IE5vbmUsCgogICAgICAgIHBhcmVudF9pbmRleDogdHlwaW5nLk9wdGlvbmFsW2ludF0gPSBOb25lLAoKICAgICk6CgogICAgICAgICM6IFRoZSBweXBhcnNpbmcgZWxlbWVudCB0aGF0IHRoaXMgcmVwcmVzZW50cwoKICAgICAgICBzZWxmLmVsZW1lbnQ6IHB5cGFyc2luZy5QYXJzZXJFbGVtZW50ID0gZWxlbWVudAoKICAgICAgICAjOiBUaGUgbmFtZSBvZiB0aGUgZWxlbWVudAoKICAgICAgICBzZWxmLm5hbWU6IHR5cGluZy5PcHRpb25hbFtzdHJdID0gbmFtZQoKICAgICAgICAjOiBUaGUgb3V0cHV0IFJhaWxyb2FkIGVsZW1lbnQgaW4gYW4gdW5jb252ZXJ0ZWQgc3RhdGUKCiAgICAgICAgc2VsZi5jb252ZXJ0ZWQ6IEVkaXRhYmxlUGFydGlhbCA9IGNvbnZlcnRlZAoKICAgICAgICAjOiBUaGUgcGFyZW50IFJhaWxyb2FkIGVsZW1lbnQsIHdoaWNoIHdlIHN0b3JlIHNvIHRoYXQgd2UgY2FuIGV4dHJhY3QgdGhpcyBpZiBpdCdzIGR1cGxpY2F0ZWQKCiAgICAgICAgc2VsZi5wYXJlbnQ6IEVkaXRhYmxlUGFydGlhbCA9IHBhcmVudAoKICAgICAgICAjOiBUaGUgb3JkZXIgaW4gd2hpY2ggd2UgZm91bmQgdGhpcyBlbGVtZW50LCB1c2VkIGZvciBzb3J0aW5nIGRpYWdyYW1zIGlmIHRoaXMgaXMgZXh0cmFjdGVkIGludG8gYSBkaWFncmFtCgogICAgICAgIHNlbGYubnVtYmVyOiBpbnQgPSBudW1iZXIKCiAgICAgICAgIzogVGhlIGluZGV4IG9mIHRoaXMgaW5zaWRlIGl0cyBwYXJlbnQKCiAgICAgICAgc2VsZi5wYXJlbnRfaW5kZXg6IHR5cGluZy5PcHRpb25hbFtpbnRdID0gcGFyZW50X2luZGV4CgogICAgICAgICM6IElmIHRydWUsIHdlIHNob3VsZCBleHRyYWN0IHRoaXMgb3V0IGludG8gYSBzdWJkaWFncmFtCgogICAgICAgIHNlbGYuZXh0cmFjdDogYm9vbCA9IEZhbHNlCgogICAgICAgICM6IElmIHRydWUsIGFsbCBvZiB0aGlzIGVsZW1lbnQncyBjaGlsZHJlbiBoYXZlIGJlZW4gZmlsbGVkIG91dAoKICAgICAgICBzZWxmLmNvbXBsZXRlOiBib29sID0gRmFsc2UKCgoKICAgIGRlZiBtYXJrX2Zvcl9leHRyYWN0aW9uKAoKICAgICAgICBzZWxmLCBlbF9pZDogaW50LCBzdGF0ZTogXCJDb252ZXJ0ZXJTdGF0ZVwiLCBuYW1lOiBzdHIgPSBOb25lLCBmb3JjZTogYm9vbCA9IEZhbHNlCgogICAgKToKCiAgICAgICAgXCJcIlwiCgogICAgICAgIENhbGxlZCB3aGVuIHRoaXMgaW5zdGFuY2UgaGFzIGJlZW4gc2VlbiB0d2ljZSwgYW5kIHRodXMgc2hvdWxkIGV2ZW50dWFsbHkgYmUgZXh0cmFjdGVkIGludG8gYSBzdWItZGlhZ3JhbQoKICAgICAgICA6cGFyYW0gZWxfaWQ6IGlkIG9mIHRoZSBlbGVtZW50CgogICAgICAgIDpwYXJhbSBzdGF0ZTogZWxlbWVudC9kaWFncmFtIHN0YXRlIHRyYWNrZXIKCiAgICAgICAgOnBhcmFtIG5hbWU6IG5hbWUgdG8gdXNlIGZvciB0aGlzIGVsZW1lbnQncyB0ZXh0CgogICAgICAgIDpwYXJhbSBmb3JjZTogSWYgdHJ1ZSwgZm9yY2UgZXh0cmFjdGlvbiBub3csIHJlZ2FyZGxlc3Mgb2YgdGhlIHN0YXRlIG9mIHRoaXMuIE9ubHkgdXNlZnVsIGZvciBleHRyYWN0aW5nIHRoZQoKICAgICAgICByb290IGVsZW1lbnQgd2hlbiB3ZSBrbm93IHdlJ3JlIGZpbmlzaGVkCgogICAgICAgIFwiXCJcIgoKICAgICAgICBzZWxmLmV4dHJhY3QgPSBUcnVlCgoKCiAgICAgICAgIyBTZXQgdGhlIG5hbWUKCiAgICAgICAgaWYgbm90IHNlbGYubmFtZToKCiAgICAgICAgICAgIGlmIG5hbWU6CgogICAgICAgICAgICAgICAgIyBBbGxvdyBmb3JjaW5nIGEgY3VzdG9tIG5hbWUKCiAgICAgICAgICAgICAgICBzZWxmLm5hbWUgPSBuYW1lCgogICAgICAgICAgICBlbGlmIHNlbGYuZWxlbWVudC5jdXN0b21OYW1lOgoKICAgICAgICAgICAgICAgIHNlbGYubmFtZSA9IHNlbGYuZWxlbWVudC5jdXN0b21OYW1lCgogICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIHNlbGYubmFtZSA9IFwiXCIKCgoKICAgICAgICAjIEp1c3QgYmVjYXVzZSB0aGlzIGlzIG1hcmtlZCBmb3IgZXh0cmFjdGlvbiBkb2Vzbid0IG1lYW4gd2UgY2FuIGRvIGl0IHlldC4gV2UgbWF5IGhhdmUgdG8gd2FpdCBmb3IgY2hpbGRyZW4KCiAgICAgICAgIyB0byBiZSBhZGRlZAoKICAgICAgICAjIEFsc28sIGlmIHRoaXMgaXMganVzdCBhIHN0cmluZyBsaXRlcmFsIGV0YywgZG9uJ3QgYm90aGVyIGV4dHJhY3RpbmcgaXQKCiAgICAgICAgaWYgZm9yY2Ugb3IgKHNlbGYuY29tcGxldGUgYW5kIF93b3J0aF9leHRyYWN0aW5nKHNlbGYuZWxlbWVudCkpOgoKICAgICAgICAgICAgc3RhdGUuZXh0cmFjdF9pbnRvX2RpYWdyYW0oZWxfaWQpCgoKCgoKY2xhc3MgQ29udmVydGVyU3RhdGU6CgogICAgXCJcIlwiCgogICAgU3RvcmVzIHNvbWUgc3RhdGUgdGhhdCBwZXJzaXN0cyBiZXR3ZWVuIHJlY3Vyc2lvbnMgaW50byB0aGUgZWxlbWVudCB0cmVlCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX19pbml0X18oc2VsZiwgZGlhZ3JhbV9rd2FyZ3M6IHR5cGluZy5PcHRpb25hbFtkaWN0XSA9IE5vbmUpOgoKICAgICAgICAjOiBBIGRpY3Rpb25hcnkgbWFwcGluZyBQYXJzZXJFbGVtZW50cyB0byBzdGF0ZSByZWxhdGluZyB0byB0aGVtCgogICAgICAgIHNlbGYuX2VsZW1lbnRfZGlhZ3JhbV9zdGF0ZXM6IERpY3RbaW50LCBFbGVtZW50U3RhdGVdID0ge30KCiAgICAgICAgIzogQSBkaWN0aW9uYXJ5IG1hcHBpbmcgUGFyc2VyRWxlbWVudCBJRHMgdG8gc3ViZGlhZ3JhbXMgZ2VuZXJhdGVkIGZyb20gdGhlbQoKICAgICAgICBzZWxmLmRpYWdyYW1zOiBEaWN0W2ludCwgRWRpdGFibGVQYXJ0aWFsW05hbWVkRGlhZ3JhbV1dID0ge30KCiAgICAgICAgIzogVGhlIGluZGV4IG9mIHRoZSBuZXh0IHVubmFtZWQgZWxlbWVudAoKICAgICAgICBzZWxmLnVubmFtZWRfaW5kZXg6IGludCA9IDEKCiAgICAgICAgIzogVGhlIGluZGV4IG9mIHRoZSBuZXh0IGVsZW1lbnQuIFRoaXMgaXMgdXNlZCBmb3Igc29ydGluZwoKICAgICAgICBzZWxmLmluZGV4OiBpbnQgPSAwCgogICAgICAgICM6IFNoYXJlZCBrd2FyZ3MgdGhhdCBhcmUgdXNlZCB0byBjdXN0b21pemUgdGhlIGNvbnN0cnVjdGlvbiBvZiBkaWFncmFtcwoKICAgICAgICBzZWxmLmRpYWdyYW1fa3dhcmdzOiBkaWN0ID0gZGlhZ3JhbV9rd2FyZ3Mgb3Ige30KCiAgICAgICAgc2VsZi5leHRyYWN0ZWRfZGlhZ3JhbV9uYW1lczogU2V0W3N0cl0gPSBzZXQoKQoKCgogICAgZGVmIF9fc2V0aXRlbV9fKHNlbGYsIGtleTogaW50LCB2YWx1ZTogRWxlbWVudFN0YXRlKToKCiAgICAgICAgc2VsZi5fZWxlbWVudF9kaWFncmFtX3N0YXRlc1trZXldID0gdmFsdWUKCgoKICAgIGRlZiBfX2dldGl0ZW1fXyhzZWxmLCBrZXk6IGludCkgLT4gRWxlbWVudFN0YXRlOgoKICAgICAgICByZXR1cm4gc2VsZi5fZWxlbWVudF9kaWFncmFtX3N0YXRlc1trZXldCgoKCiAgICBkZWYgX19kZWxpdGVtX18oc2VsZiwga2V5OiBpbnQpOgoKICAgICAgICBkZWwgc2VsZi5fZWxlbWVudF9kaWFncmFtX3N0YXRlc1trZXldCgoKCiAgICBkZWYgX19jb250YWluc19fKHNlbGYsIGtleTogaW50KToKCiAgICAgICAgcmV0dXJuIGtleSBpbiBzZWxmLl9lbGVtZW50X2RpYWdyYW1fc3RhdGVzCgoKCiAgICBkZWYgZ2VuZXJhdGVfdW5uYW1lZChzZWxmKSAtPiBpbnQ6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBHZW5lcmF0ZSBhIG51bWJlciB1c2VkIGluIHRoZSBuYW1lIG9mIGFuIG90aGVyd2lzZSB1bm5hbWVkIGRpYWdyYW0KCiAgICAgICAgXCJcIlwiCgogICAgICAgIHNlbGYudW5uYW1lZF9pbmRleCArPSAxCgogICAgICAgIHJldHVybiBzZWxmLnVubmFtZWRfaW5kZXgKCgoKICAgIGRlZiBnZW5lcmF0ZV9pbmRleChzZWxmKSAtPiBpbnQ6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBHZW5lcmF0ZSBhIG51bWJlciB1c2VkIHRvIGluZGV4IGEgZGlhZ3JhbQoKICAgICAgICBcIlwiXCIKCiAgICAgICAgc2VsZi5pbmRleCArPSAxCgogICAgICAgIHJldHVybiBzZWxmLmluZGV4CgoKCiAgICBkZWYgZXh0cmFjdF9pbnRvX2RpYWdyYW0oc2VsZiwgZWxfaWQ6IGludCk6CgogICAgICAgIFwiXCJcIgoKICAgICAgICBVc2VkIHdoZW4gd2UgZW5jb3VudGVyIHRoZSBzYW1lIHRva2VuIHR3aWNlIGluIHRoZSBzYW1lIHRyZWUuIFdoZW4gdGhpcwoKICAgICAgICBoYXBwZW5zLCB3ZSByZXBsYWNlIGFsbCBpbnN0YW5jZXMgb2YgdGhhdCB0b2tlbiB3aXRoIGEgdGVybWluYWwsIGFuZAoKICAgICAgICBjcmVhdGUgYSBuZXcgc3ViZGlhZ3JhbSBmb3IgdGhlIHRva2VuCgogICAgICAgIFwiXCJcIgoKICAgICAgICBwb3NpdGlvbiA9IHNlbGZbZWxfaWRdCgoKCiAgICAgICAgIyBSZXBsYWNlIHRoZSBvcmlnaW5hbCBkZWZpbml0aW9uIG9mIHRoaXMgZWxlbWVudCB3aXRoIGEgcmVndWxhciBibG9jawoKICAgICAgICBpZiBwb3NpdGlvbi5wYXJlbnQ6CgogICAgICAgICAgICByZXQgPSBFZGl0YWJsZVBhcnRpYWwuZnJvbV9jYWxsKHJhaWxyb2FkLk5vblRlcm1pbmFsLCB0ZXh0PXBvc2l0aW9uLm5hbWUpCgogICAgICAgICAgICBpZiBcIml0ZW1cIiBpbiBwb3NpdGlvbi5wYXJlbnQua3dhcmdzOgoKICAgICAgICAgICAgICAgIHBvc2l0aW9uLnBhcmVudC5rd2FyZ3NbXCJpdGVtXCJdID0gcmV0CgogICAgICAgICAgICBlbGlmIFwiaXRlbXNcIiBpbiBwb3NpdGlvbi5wYXJlbnQua3dhcmdzOgoKICAgICAgICAgICAgICAgIHBvc2l0aW9uLnBhcmVudC5rd2FyZ3NbXCJpdGVtc1wiXVtwb3NpdGlvbi5wYXJlbnRfaW5kZXhdID0gcmV0CgoKCiAgICAgICAgIyBJZiB0aGUgZWxlbWVudCB3ZSdyZSBleHRyYWN0aW5nIGlzIGEgZ3JvdXAsIHNraXAgdG8gaXRzIGNvbnRlbnQgYnV0IGtlZXAgdGhlIHRpdGxlCgogICAgICAgIGlmIHBvc2l0aW9uLmNvbnZlcnRlZC5mdW5jID09IHJhaWxyb2FkLkdyb3VwOgoKICAgICAgICAgICAgY29udGVudCA9IHBvc2l0aW9uLmNvbnZlcnRlZC5rd2FyZ3NbXCJpdGVtXCJdCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICBjb250ZW50ID0gcG9zaXRpb24uY29udmVydGVkCgoKCiAgICAgICAgc2VsZi5kaWFncmFtc1tlbF9pZF0gPSBFZGl0YWJsZVBhcnRpYWwuZnJvbV9jYWxsKAoKICAgICAgICAgICAgTmFtZWREaWFncmFtLAoKICAgICAgICAgICAgbmFtZT1wb3NpdGlvbi5uYW1lLAoKICAgICAgICAgICAgZGlhZ3JhbT1FZGl0YWJsZVBhcnRpYWwuZnJvbV9jYWxsKAoKICAgICAgICAgICAgICAgIHJhaWxyb2FkLkRpYWdyYW0sIGNvbnRlbnQsICoqc2VsZi5kaWFncmFtX2t3YXJncwoKICAgICAgICAgICAgKSwKCiAgICAgICAgICAgIGluZGV4PXBvc2l0aW9uLm51bWJlciwKCiAgICAgICAgKQoKCgogICAgICAgIGRlbCBzZWxmW2VsX2lkXQoKCgoKCmRlZiBfd29ydGhfZXh0cmFjdGluZyhlbGVtZW50OiBweXBhcnNpbmcuUGFyc2VyRWxlbWVudCkgLT4gYm9vbDoKCiAgICBcIlwiXCIKCiAgICBSZXR1cm5zIHRydWUgaWYgdGhpcyBlbGVtZW50IGlzIHdvcnRoIGhhdmluZyBpdHMgb3duIHN1Yi1kaWFncmFtLiBTaW1wbHksIGlmIGFueSBvZiBpdHMgY2hpbGRyZW4KCiAgICB0aGVtc2VsdmVzIGhhdmUgY2hpbGRyZW4sIHRoZW4gaXRzIGNvbXBsZXggZW5vdWdoIHRvIGV4dHJhY3QKCiAgICBcIlwiXCIKCiAgICBjaGlsZHJlbiA9IGVsZW1lbnQucmVjdXJzZSgpCgogICAgcmV0dXJuIGFueShjaGlsZC5yZWN1cnNlKCkgZm9yIGNoaWxkIGluIGNoaWxkcmVuKQoKCgoKCmRlZiBfYXBwbHlfZGlhZ3JhbV9pdGVtX2VuaGFuY2VtZW50cyhmbik6CgogICAgXCJcIlwiCgogICAgZGVjb3JhdG9yIHRvIGVuc3VyZSBlbmhhbmNlbWVudHMgdG8gYSBkaWFncmFtIGl0ZW0gKHN1Y2ggYXMgcmVzdWx0cyBuYW1lIGFubm90YXRpb25zKQoKICAgIGdldCBhcHBsaWVkIG9uIHJldHVybiBmcm9tIF90b19kaWFncmFtX2VsZW1lbnQgKHdlIGRvIHRoaXMgc2luY2UgdGhlcmUgYXJlIHNldmVyYWwKCiAgICByZXR1cm5zIGluIF90b19kaWFncmFtX2VsZW1lbnQpCgogICAgXCJcIlwiCgoKCiAgICBkZWYgX2lubmVyKAoKICAgICAgICBlbGVtZW50OiBweXBhcnNpbmcuUGFyc2VyRWxlbWVudCwKCiAgICAgICAgcGFyZW50OiB0eXBpbmcuT3B0aW9uYWxbRWRpdGFibGVQYXJ0aWFsXSwKCiAgICAgICAgbG9va3VwOiBDb252ZXJ0ZXJTdGF0ZSA9IE5vbmUsCgogICAgICAgIHZlcnRpY2FsOiBpbnQgPSBOb25lLAoKICAgICAgICBpbmRleDogaW50ID0gMCwKCiAgICAgICAgbmFtZV9oaW50OiBzdHIgPSBOb25lLAoKICAgICAgICBzaG93X3Jlc3VsdHNfbmFtZXM6IGJvb2wgPSBGYWxzZSwKCiAgICAgICAgc2hvd19ncm91cHM6IGJvb2wgPSBGYWxzZSwKCiAgICApIC0+IHR5cGluZy5PcHRpb25hbFtFZGl0YWJsZVBhcnRpYWxdOgoKCgogICAgICAgIHJldCA9IGZuKAoKICAgICAgICAgICAgZWxlbWVudCwKCiAgICAgICAgICAgIHBhcmVudCwKCiAgICAgICAgICAgIGxvb2t1cCwKCiAgICAgICAgICAgIHZlcnRpY2FsLAoKICAgICAgICAgICAgaW5kZXgsCgogICAgICAgICAgICBuYW1lX2hpbnQsCgogICAgICAgICAgICBzaG93X3Jlc3VsdHNfbmFtZXMsCgogICAgICAgICAgICBzaG93X2dyb3VwcywKCiAgICAgICAgKQoKCgogICAgICAgICMgYXBwbHkgYW5ub3RhdGlvbiBmb3IgcmVzdWx0cyBuYW1lLCBpZiBwcmVzZW50CgogICAgICAgIGlmIHNob3dfcmVzdWx0c19uYW1lcyBhbmQgcmV0IGlzIG5vdCBOb25lOgoKICAgICAgICAgICAgZWxlbWVudF9yZXN1bHRzX25hbWUgPSBlbGVtZW50LnJlc3VsdHNOYW1lCgogICAgICAgICAgICBpZiBlbGVtZW50X3Jlc3VsdHNfbmFtZToKCiAgICAgICAgICAgICAgICAjIGFkZCBcIipcIiB0byBpbmRpY2F0ZSBpZiB0aGlzIGlzIGEgXCJsaXN0IGFsbCByZXN1bHRzXCIgbmFtZQoKICAgICAgICAgICAgICAgIGVsZW1lbnRfcmVzdWx0c19uYW1lICs9IFwiXCIgaWYgZWxlbWVudC5tb2RhbFJlc3VsdHMgZWxzZSBcIipcIgoKICAgICAgICAgICAgICAgIHJldCA9IEVkaXRhYmxlUGFydGlhbC5mcm9tX2NhbGwoCgogICAgICAgICAgICAgICAgICAgIHJhaWxyb2FkLkdyb3VwLCBpdGVtPXJldCwgbGFiZWw9ZWxlbWVudF9yZXN1bHRzX25hbWUKCiAgICAgICAgICAgICAgICApCgoKCiAgICAgICAgcmV0dXJuIHJldAoKCgogICAgcmV0dXJuIF9pbm5lcgoKCgoKCmRlZiBfdmlzaWJsZV9leHBycyhleHByczogSXRlcmFibGVbcHlwYXJzaW5nLlBhcnNlckVsZW1lbnRdKToKCiAgICBub25fZGlhZ3JhbW1pbmdfZXhwcnMgPSAoCgogICAgICAgIHB5cGFyc2luZy5QYXJzZUVsZW1lbnRFbmhhbmNlLAoKICAgICAgICBweXBhcnNpbmcuUG9zaXRpb25Ub2tlbiwKCiAgICAgICAgcHlwYXJzaW5nLkFuZC5fRXJyb3JTdG9wLAoKICAgICkKCiAgICByZXR1cm4gWwoKICAgICAgICBlCgogICAgICAgIGZvciBlIGluIGV4cHJzCgogICAgICAgIGlmIG5vdCAoZS5jdXN0b21OYW1lIG9yIGUucmVzdWx0c05hbWUgb3IgaXNpbnN0YW5jZShlLCBub25fZGlhZ3JhbW1pbmdfZXhwcnMpKQoKICAgIF0KCgoKCgpAX2FwcGx5X2RpYWdyYW1faXRlbV9lbmhhbmNlbWVudHMKCmRlZiBfdG9fZGlhZ3JhbV9lbGVtZW50KAoKICAgIGVsZW1lbnQ6IHB5cGFyc2luZy5QYXJzZXJFbGVtZW50LAoKICAgIHBhcmVudDogdHlwaW5nLk9wdGlvbmFsW0VkaXRhYmxlUGFydGlhbF0sCgogICAgbG9va3VwOiBDb252ZXJ0ZXJTdGF0ZSA9IE5vbmUsCgogICAgdmVydGljYWw6IGludCA9IE5vbmUsCgogICAgaW5kZXg6IGludCA9IDAsCgogICAgbmFtZV9oaW50OiBzdHIgPSBOb25lLAoKICAgIHNob3dfcmVzdWx0c19uYW1lczogYm9vbCA9IEZhbHNlLAoKICAgIHNob3dfZ3JvdXBzOiBib29sID0gRmFsc2UsCgopIC0+IHR5cGluZy5PcHRpb25hbFtFZGl0YWJsZVBhcnRpYWxdOgoKICAgIFwiXCJcIgoKICAgIFJlY3Vyc2l2ZWx5IGNvbnZlcnRzIGEgUHlQYXJzaW5nIEVsZW1lbnQgdG8gYSByYWlscm9hZCBFbGVtZW50CgogICAgOnBhcmFtIGxvb2t1cDogVGhlIHNoYXJlZCBjb252ZXJ0ZXIgc3RhdGUgdGhhdCBrZWVwcyB0cmFjayBvZiB1c2VmdWwgdGhpbmdzCgogICAgOnBhcmFtIGluZGV4OiBUaGUgaW5kZXggb2YgdGhpcyBlbGVtZW50IHdpdGhpbiB0aGUgcGFyZW50CgogICAgOnBhcmFtIHBhcmVudDogVGhlIHBhcmVudCBvZiB0aGlzIGVsZW1lbnQgaW4gdGhlIG91dHB1dCB0cmVlCgogICAgOnBhcmFtIHZlcnRpY2FsOiBDb250cm9scyBhdCB3aGF0IHBvaW50IHdlIG1ha2UgYSBsaXN0IG9mIGVsZW1lbnRzIHZlcnRpY2FsLiBJZiB0aGlzIGlzIGFuIGludGVnZXIgKHRoZSBkZWZhdWx0KSwKCiAgICBpdCBzZXRzIHRoZSB0aHJlc2hvbGQgb2YgdGhlIG51bWJlciBvZiBpdGVtcyBiZWZvcmUgd2UgZ28gdmVydGljYWwuIElmIFRydWUsIGFsd2F5cyBnbyB2ZXJ0aWNhbCwgaWYgRmFsc2UsIG5ldmVyCgogICAgZG8gc28KCiAgICA6cGFyYW0gbmFtZV9oaW50OiBJZiBwcm92aWRlZCwgdGhpcyB3aWxsIG92ZXJyaWRlIHRoZSBnZW5lcmF0ZWQgbmFtZQoKICAgIDpwYXJhbSBzaG93X3Jlc3VsdHNfbmFtZXM6IGJvb2wgZmxhZyBpbmRpY2F0aW5nIHdoZXRoZXIgdG8gYWRkIGFubm90YXRpb25zIGZvciByZXN1bHRzIG5hbWVzCgogICAgOnJldHVybnM6IFRoZSBjb252ZXJ0ZWQgdmVyc2lvbiBvZiB0aGUgaW5wdXQgZWxlbWVudCwgYnV0IGFzIGEgUGFydGlhbCB0aGF0IGhhc24ndCB5ZXQgYmVlbiBjb25zdHJ1Y3RlZAoKICAgIDpwYXJhbSBzaG93X2dyb3VwczogYm9vbCBmbGFnIGluZGljYXRpbmcgd2hldGhlciB0byBzaG93IGdyb3VwcyB1c2luZyBib3VuZGluZyBib3gKCiAgICBcIlwiXCIKCiAgICBleHBycyA9IGVsZW1lbnQucmVjdXJzZSgpCgogICAgbmFtZSA9IG5hbWVfaGludCBvciBlbGVtZW50LmN1c3RvbU5hbWUgb3IgZWxlbWVudC5fX2NsYXNzX18uX19uYW1lX18KCgoKICAgICMgUHl0aG9uJ3MgaWQoKSBpcyB1c2VkIHRvIHByb3ZpZGUgYSB1bmlxdWUgaWRlbnRpZmllciBmb3IgZWxlbWVudHMKCiAgICBlbF9pZCA9IGlkKGVsZW1lbnQpCgoKCiAgICBlbGVtZW50X3Jlc3VsdHNfbmFtZSA9IGVsZW1lbnQucmVzdWx0c05hbWUKCgoKICAgICMgSGVyZSB3ZSBiYXNpY2FsbHkgYnlwYXNzIHByb2Nlc3NpbmcgY2VydGFpbiB3cmFwcGVyIGVsZW1lbnRzIGlmIHRoZXkgY29udHJpYnV0ZSBub3RoaW5nIHRvIHRoZSBkaWFncmFtCgogICAgaWYgbm90IGVsZW1lbnQuY3VzdG9tTmFtZToKCiAgICAgICAgaWYgaXNpbnN0YW5jZSgKCiAgICAgICAgICAgIGVsZW1lbnQsCgogICAgICAgICAgICAoCgogICAgICAgICAgICAgICAgIyBweXBhcnNpbmcuVG9rZW5Db252ZXJ0ZXIsCgogICAgICAgICAgICAgICAgIyBweXBhcnNpbmcuRm9yd2FyZCwKCiAgICAgICAgICAgICAgICBweXBhcnNpbmcuTG9jYXRlZCwKCiAgICAgICAgICAgICksCgogICAgICAgICk6CgogICAgICAgICAgICAjIEhvd2V2ZXIsIGlmIHRoaXMgZWxlbWVudCBoYXMgYSB1c2VmdWwgY3VzdG9tIG5hbWUsIGFuZCBpdHMgY2hpbGQgZG9lcyBub3QsIHdlIGNhbiBwYXNzIGl0IG9uIHRvIHRoZSBjaGlsZAoKICAgICAgICAgICAgaWYgZXhwcnM6CgogICAgICAgICAgICAgICAgaWYgbm90IGV4cHJzWzBdLmN1c3RvbU5hbWU6CgogICAgICAgICAgICAgICAgICAgIHByb3BhZ2F0ZWRfbmFtZSA9IG5hbWUKCiAgICAgICAgICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgICAgICBwcm9wYWdhdGVkX25hbWUgPSBOb25lCgoKCiAgICAgICAgICAgICAgICByZXR1cm4gX3RvX2RpYWdyYW1fZWxlbWVudCgKCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5leHByLAoKICAgICAgICAgICAgICAgICAgICBwYXJlbnQ9cGFyZW50LAoKICAgICAgICAgICAgICAgICAgICBsb29rdXA9bG9va3VwLAoKICAgICAgICAgICAgICAgICAgICB2ZXJ0aWNhbD12ZXJ0aWNhbCwKCiAgICAgICAgICAgICAgICAgICAgaW5kZXg9aW5kZXgsCgogICAgICAgICAgICAgICAgICAgIG5hbWVfaGludD1wcm9wYWdhdGVkX25hbWUsCgogICAgICAgICAgICAgICAgICAgIHNob3dfcmVzdWx0c19uYW1lcz1zaG93X3Jlc3VsdHNfbmFtZXMsCgogICAgICAgICAgICAgICAgICAgIHNob3dfZ3JvdXBzPXNob3dfZ3JvdXBzLAoKICAgICAgICAgICAgICAgICkKCgoKICAgICMgSWYgdGhlIGVsZW1lbnQgaXNuJ3Qgd29ydGggZXh0cmFjdGluZywgd2UgYWx3YXlzIHRyZWF0IGl0IGFzIHRoZSBmaXJzdCB0aW1lIHdlIHNheSBpdAoKICAgIGlmIF93b3J0aF9leHRyYWN0aW5nKGVsZW1lbnQpOgoKICAgICAgICBpZiBlbF9pZCBpbiBsb29rdXA6CgogICAgICAgICAgICAjIElmIHdlJ3ZlIHNlZW4gdGhpcyBlbGVtZW50IGV4YWN0bHkgb25jZSBiZWZvcmUsIHdlIGFyZSBvbmx5IGp1c3Qgbm93IGZpbmRpbmcgb3V0IHRoYXQgaXQncyBhIGR1cGxpY2F0ZSwKCiAgICAgICAgICAgICMgc28gd2UgaGF2ZSB0byBleHRyYWN0IGl0IGludG8gYSBuZXcgZGlhZ3JhbS4KCiAgICAgICAgICAgIGxvb2tlZF91cCA9IGxvb2t1cFtlbF9pZF0KCiAgICAgICAgICAgIGxvb2tlZF91cC5tYXJrX2Zvcl9leHRyYWN0aW9uKGVsX2lkLCBsb29rdXAsIG5hbWU9bmFtZV9oaW50KQoKICAgICAgICAgICAgcmV0ID0gRWRpdGFibGVQYXJ0aWFsLmZyb21fY2FsbChyYWlscm9hZC5Ob25UZXJtaW5hbCwgdGV4dD1sb29rZWRfdXAubmFtZSkKCiAgICAgICAgICAgIHJldHVybiByZXQKCgoKICAgICAgICBlbGlmIGVsX2lkIGluIGxvb2t1cC5kaWFncmFtczoKCiAgICAgICAgICAgICMgSWYgd2UgaGF2ZSBzZWVuIHRoZSBlbGVtZW50IGF0IGxlYXN0IHR3aWNlIGJlZm9yZSwgYW5kIGhhdmUgYWxyZWFkeSBleHRyYWN0ZWQgaXQgaW50byBhIHN1YmRpYWdyYW0sIHdlCgogICAgICAgICAgICAjIGp1c3QgcHV0IGluIGEgbWFya2VyIGVsZW1lbnQgdGhhdCByZWZlcnMgdG8gdGhlIHN1Yi1kaWFncmFtCgogICAgICAgICAgICByZXQgPSBFZGl0YWJsZVBhcnRpYWwuZnJvbV9jYWxsKAoKICAgICAgICAgICAgICAgIHJhaWxyb2FkLk5vblRlcm1pbmFsLCB0ZXh0PWxvb2t1cC5kaWFncmFtc1tlbF9pZF0ua3dhcmdzW1wibmFtZVwiXQoKICAgICAgICAgICAgKQoKICAgICAgICAgICAgcmV0dXJuIHJldAoKCgogICAgIyBSZWN1cnNpdmVseSBjb252ZXJ0IGNoaWxkIGVsZW1lbnRzCgogICAgIyBIZXJlIHdlIGZpbmQgdGhlIG1vc3QgcmVsZXZhbnQgUmFpbHJvYWQgZWxlbWVudCBmb3IgbWF0Y2hpbmcgcHlwYXJzaW5nIEVsZW1lbnQKCiAgICAjIFdlIHVzZSBgYGl0ZW1zPVtdYGAgaGVyZSB0byBob2xkIHRoZSBwbGFjZSBmb3Igd2hlcmUgdGhlIGNoaWxkIGVsZW1lbnRzIHdpbGwgZ28gb25jZSBjcmVhdGVkCgogICAgaWYgaXNpbnN0YW5jZShlbGVtZW50LCBweXBhcnNpbmcuQW5kKToKCiAgICAgICAgIyBkZXRlY3QgQW5kJ3MgY3JlYXRlZCB3aXRoIGBgZXhwcipOYGAgbm90YXRpb24gLSBmb3IgdGhlc2UgdXNlIGEgT25lT3JNb3JlIHdpdGggYSByZXBlYXQKCiAgICAgICAgIyAoYWxsIHdpbGwgaGF2ZSB0aGUgc2FtZSBuYW1lLCBhbmQgcmVzdWx0c05hbWUpCgogICAgICAgIGlmIG5vdCBleHByczoKCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIGlmIGxlbihzZXQoKGUubmFtZSwgZS5yZXN1bHRzTmFtZSkgZm9yIGUgaW4gZXhwcnMpKSA9PSAxOgoKICAgICAgICAgICAgcmV0ID0gRWRpdGFibGVQYXJ0aWFsLmZyb21fY2FsbCgKCiAgICAgICAgICAgICAgICByYWlscm9hZC5PbmVPck1vcmUsIGl0ZW09XCJcIiwgcmVwZWF0PXN0cihsZW4oZXhwcnMpKQoKICAgICAgICAgICAgKQoKICAgICAgICBlbGlmIF9zaG91bGRfdmVydGljYWwodmVydGljYWwsIGV4cHJzKToKCiAgICAgICAgICAgIHJldCA9IEVkaXRhYmxlUGFydGlhbC5mcm9tX2NhbGwocmFpbHJvYWQuU3RhY2ssIGl0ZW1zPVtdKQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgcmV0ID0gRWRpdGFibGVQYXJ0aWFsLmZyb21fY2FsbChyYWlscm9hZC5TZXF1ZW5jZSwgaXRlbXM9W10pCgogICAgZWxpZiBpc2luc3RhbmNlKGVsZW1lbnQsIChweXBhcnNpbmcuT3IsIHB5cGFyc2luZy5NYXRjaEZpcnN0KSk6CgogICAgICAgIGlmIG5vdCBleHByczoKCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgIGlmIF9zaG91bGRfdmVydGljYWwodmVydGljYWwsIGV4cHJzKToKCiAgICAgICAgICAgIHJldCA9IEVkaXRhYmxlUGFydGlhbC5mcm9tX2NhbGwocmFpbHJvYWQuQ2hvaWNlLCAwLCBpdGVtcz1bXSkKCiAgICAgICAgZWxzZToKCiAgICAgICAgICAgIHJldCA9IEVkaXRhYmxlUGFydGlhbC5mcm9tX2NhbGwocmFpbHJvYWQuSG9yaXpvbnRhbENob2ljZSwgaXRlbXM9W10pCgogICAgZWxpZiBpc2luc3RhbmNlKGVsZW1lbnQsIHB5cGFyc2luZy5FYWNoKToKCiAgICAgICAgaWYgbm90IGV4cHJzOgoKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgcmV0ID0gRWRpdGFibGVQYXJ0aWFsLmZyb21fY2FsbChFYWNoSXRlbSwgaXRlbXM9W10pCgogICAgZWxpZiBpc2luc3RhbmNlKGVsZW1lbnQsIHB5cGFyc2luZy5Ob3RBbnkpOgoKICAgICAgICByZXQgPSBFZGl0YWJsZVBhcnRpYWwuZnJvbV9jYWxsKEFubm90YXRlZEl0ZW0sIGxhYmVsPVwiTk9UXCIsIGl0ZW09XCJcIikKCiAgICBlbGlmIGlzaW5zdGFuY2UoZWxlbWVudCwgcHlwYXJzaW5nLkZvbGxvd2VkQnkpOgoKICAgICAgICByZXQgPSBFZGl0YWJsZVBhcnRpYWwuZnJvbV9jYWxsKEFubm90YXRlZEl0ZW0sIGxhYmVsPVwiTE9PS0FIRUFEXCIsIGl0ZW09XCJcIikKCiAgICBlbGlmIGlzaW5zdGFuY2UoZWxlbWVudCwgcHlwYXJzaW5nLlByZWNlZGVkQnkpOgoKICAgICAgICByZXQgPSBFZGl0YWJsZVBhcnRpYWwuZnJvbV9jYWxsKEFubm90YXRlZEl0ZW0sIGxhYmVsPVwiTE9PS0JFSElORFwiLCBpdGVtPVwiXCIpCgogICAgZWxpZiBpc2luc3RhbmNlKGVsZW1lbnQsIHB5cGFyc2luZy5Hcm91cCk6CgogICAgICAgIGlmIHNob3dfZ3JvdXBzOgoKICAgICAgICAgICAgcmV0ID0gRWRpdGFibGVQYXJ0aWFsLmZyb21fY2FsbChBbm5vdGF0ZWRJdGVtLCBsYWJlbD1cIlwiLCBpdGVtPVwiXCIpCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICByZXQgPSBFZGl0YWJsZVBhcnRpYWwuZnJvbV9jYWxsKHJhaWxyb2FkLkdyb3VwLCBsYWJlbD1cIlwiLCBpdGVtPVwiXCIpCgogICAgZWxpZiBpc2luc3RhbmNlKGVsZW1lbnQsIHB5cGFyc2luZy5Ub2tlbkNvbnZlcnRlcik6CgogICAgICAgIHJldCA9IEVkaXRhYmxlUGFydGlhbC5mcm9tX2NhbGwoCgogICAgICAgICAgICBBbm5vdGF0ZWRJdGVtLCBsYWJlbD10eXBlKGVsZW1lbnQpLl9fbmFtZV9fLmxvd2VyKCksIGl0ZW09XCJcIgoKICAgICAgICApCgogICAgZWxpZiBpc2luc3RhbmNlKGVsZW1lbnQsIHB5cGFyc2luZy5PcHQpOgoKICAgICAgICByZXQgPSBFZGl0YWJsZVBhcnRpYWwuZnJvbV9jYWxsKHJhaWxyb2FkLk9wdGlvbmFsLCBpdGVtPVwiXCIpCgogICAgZWxpZiBpc2luc3RhbmNlKGVsZW1lbnQsIHB5cGFyc2luZy5PbmVPck1vcmUpOgoKICAgICAgICByZXQgPSBFZGl0YWJsZVBhcnRpYWwuZnJvbV9jYWxsKHJhaWxyb2FkLk9uZU9yTW9yZSwgaXRlbT1cIlwiKQoKICAgIGVsaWYgaXNpbnN0YW5jZShlbGVtZW50LCBweXBhcnNpbmcuWmVyb09yTW9yZSk6CgogICAgICAgIHJldCA9IEVkaXRhYmxlUGFydGlhbC5mcm9tX2NhbGwocmFpbHJvYWQuWmVyb09yTW9yZSwgaXRlbT1cIlwiKQoKICAgIGVsaWYgaXNpbnN0YW5jZShlbGVtZW50LCBweXBhcnNpbmcuR3JvdXApOgoKICAgICAgICByZXQgPSBFZGl0YWJsZVBhcnRpYWwuZnJvbV9jYWxsKAoKICAgICAgICAgICAgcmFpbHJvYWQuR3JvdXAsIGl0ZW09Tm9uZSwgbGFiZWw9ZWxlbWVudF9yZXN1bHRzX25hbWUKCiAgICAgICAgKQoKICAgIGVsaWYgaXNpbnN0YW5jZShlbGVtZW50LCBweXBhcnNpbmcuRW1wdHkpIGFuZCBub3QgZWxlbWVudC5jdXN0b21OYW1lOgoKICAgICAgICAjIFNraXAgdW5uYW1lZCBcIkVtcHR5XCIgZWxlbWVudHMKCiAgICAgICAgcmV0ID0gTm9uZQoKICAgIGVsaWYgbGVuKGV4cHJzKSA+IDE6CgogICAgICAgIHJldCA9IEVkaXRhYmxlUGFydGlhbC5mcm9tX2NhbGwocmFpbHJvYWQuU2VxdWVuY2UsIGl0ZW1zPVtdKQoKICAgIGVsaWYgbGVuKGV4cHJzKSA+IDAgYW5kIG5vdCBlbGVtZW50X3Jlc3VsdHNfbmFtZToKCiAgICAgICAgcmV0ID0gRWRpdGFibGVQYXJ0aWFsLmZyb21fY2FsbChyYWlscm9hZC5Hcm91cCwgaXRlbT1cIlwiLCBsYWJlbD1uYW1lKQoKICAgIGVsc2U6CgogICAgICAgIHRlcm1pbmFsID0gRWRpdGFibGVQYXJ0aWFsLmZyb21fY2FsbChyYWlscm9hZC5UZXJtaW5hbCwgZWxlbWVudC5kZWZhdWx0TmFtZSkKCiAgICAgICAgcmV0ID0gdGVybWluYWwKCgoKICAgIGlmIHJldCBpcyBOb25lOgoKICAgICAgICByZXR1cm4KCgoKICAgICMgSW5kaWNhdGUgdGhpcyBlbGVtZW50J3MgcG9zaXRpb24gaW4gdGhlIHRyZWUgc28gd2UgY2FuIGV4dHJhY3QgaXQgaWYgbmVjZXNzYXJ5CgogICAgbG9va3VwW2VsX2lkXSA9IEVsZW1lbnRTdGF0ZSgKCiAgICAgICAgZWxlbWVudD1lbGVtZW50LAoKICAgICAgICBjb252ZXJ0ZWQ9cmV0LAoKICAgICAgICBwYXJlbnQ9cGFyZW50LAoKICAgICAgICBwYXJlbnRfaW5kZXg9aW5kZXgsCgogICAgICAgIG51bWJlcj1sb29rdXAuZ2VuZXJhdGVfaW5kZXgoKSwKCiAgICApCgogICAgaWYgZWxlbWVudC5jdXN0b21OYW1lOgoKICAgICAgICBsb29rdXBbZWxfaWRdLm1hcmtfZm9yX2V4dHJhY3Rpb24oZWxfaWQsIGxvb2t1cCwgZWxlbWVudC5jdXN0b21OYW1lKQoKCgogICAgaSA9IDAKCiAgICBmb3IgZXhwciBpbiBleHByczoKCiAgICAgICAgIyBBZGQgYSBwbGFjZWhvbGRlciBpbmRleCBpbiBjYXNlIHdlIGhhdmUgdG8gZXh0cmFjdCB0aGUgY2hpbGQgYmVmb3JlIHdlIGV2ZW4gYWRkIGl0IHRvIHRoZSBwYXJlbnQKCiAgICAgICAgaWYgXCJpdGVtc1wiIGluIHJldC5rd2FyZ3M6CgogICAgICAgICAgICByZXQua3dhcmdzW1wiaXRlbXNcIl0uaW5zZXJ0KGksIE5vbmUpCgoKCiAgICAgICAgaXRlbSA9IF90b19kaWFncmFtX2VsZW1lbnQoCgogICAgICAgICAgICBleHByLAoKICAgICAgICAgICAgcGFyZW50PXJldCwKCiAgICAgICAgICAgIGxvb2t1cD1sb29rdXAsCgogICAgICAgICAgICB2ZXJ0aWNhbD12ZXJ0aWNhbCwKCiAgICAgICAgICAgIGluZGV4PWksCgogICAgICAgICAgICBzaG93X3Jlc3VsdHNfbmFtZXM9c2hvd19yZXN1bHRzX25hbWVzLAoKICAgICAgICAgICAgc2hvd19ncm91cHM9c2hvd19ncm91cHMsCgogICAgICAgICkKCgoKICAgICAgICAjIFNvbWUgZWxlbWVudHMgZG9uJ3QgbmVlZCB0byBiZSBzaG93biBpbiB0aGUgZGlhZ3JhbQoKICAgICAgICBpZiBpdGVtIGlzIG5vdCBOb25lOgoKICAgICAgICAgICAgaWYgXCJpdGVtXCIgaW4gcmV0Lmt3YXJnczoKCiAgICAgICAgICAgICAgICByZXQua3dhcmdzW1wiaXRlbVwiXSA9IGl0ZW0KCiAgICAgICAgICAgIGVsaWYgXCJpdGVtc1wiIGluIHJldC5rd2FyZ3M6CgogICAgICAgICAgICAgICAgIyBJZiB3ZSd2ZSBhbHJlYWR5IGV4dHJhY3RlZCB0aGUgY2hpbGQsIGRvbid0IHRvdWNoIHRoaXMgaW5kZXgsIHNpbmNlIGl0J3Mgb2NjdXBpZWQgYnkgYSBub250ZXJtaW5hbAoKICAgICAgICAgICAgICAgIHJldC5rd2FyZ3NbXCJpdGVtc1wiXVtpXSA9IGl0ZW0KCiAgICAgICAgICAgICAgICBpICs9IDEKCiAgICAgICAgZWxpZiBcIml0ZW1zXCIgaW4gcmV0Lmt3YXJnczoKCiAgICAgICAgICAgICMgSWYgd2UncmUgc3VwcG9zZWQgdG8gc2tpcCB0aGlzIGVsZW1lbnQsIHJlbW92ZSBpdCBmcm9tIHRoZSBwYXJlbnQKCiAgICAgICAgICAgIGRlbCByZXQua3dhcmdzW1wiaXRlbXNcIl1baV0KCgoKICAgICMgSWYgYWxsIHRoaXMgaXRlbXMgY2hpbGRyZW4gYXJlIG5vbmUsIHNraXAgdGhpcyBpdGVtCgogICAgaWYgcmV0IGFuZCAoCgogICAgICAgIChcIml0ZW1zXCIgaW4gcmV0Lmt3YXJncyBhbmQgbGVuKHJldC5rd2FyZ3NbXCJpdGVtc1wiXSkgPT0gMCkKCiAgICAgICAgb3IgKFwiaXRlbVwiIGluIHJldC5rd2FyZ3MgYW5kIHJldC5rd2FyZ3NbXCJpdGVtXCJdIGlzIE5vbmUpCgogICAgKToKCiAgICAgICAgcmV0ID0gRWRpdGFibGVQYXJ0aWFsLmZyb21fY2FsbChyYWlscm9hZC5UZXJtaW5hbCwgbmFtZSkKCgoKICAgICMgTWFyayB0aGlzIGVsZW1lbnQgYXMgXCJjb21wbGV0ZVwiLCBpZSBpdCBoYXMgYWxsIG9mIGl0cyBjaGlsZHJlbgoKICAgIGlmIGVsX2lkIGluIGxvb2t1cDoKCiAgICAgICAgbG9va3VwW2VsX2lkXS5jb21wbGV0ZSA9IFRydWUKCgoKICAgIGlmIGVsX2lkIGluIGxvb2t1cCBhbmQgbG9va3VwW2VsX2lkXS5leHRyYWN0IGFuZCBsb29rdXBbZWxfaWRdLmNvbXBsZXRlOgoKICAgICAgICBsb29rdXAuZXh0cmFjdF9pbnRvX2RpYWdyYW0oZWxfaWQpCgogICAgICAgIGlmIHJldCBpcyBub3QgTm9uZToKCiAgICAgICAgICAgIHJldCA9IEVkaXRhYmxlUGFydGlhbC5mcm9tX2NhbGwoCgogICAgICAgICAgICAgICAgcmFpbHJvYWQuTm9uVGVybWluYWwsIHRleHQ9bG9va3VwLmRpYWdyYW1zW2VsX2lkXS5rd2FyZ3NbXCJuYW1lXCJdCgogICAgICAgICAgICApCgoKCiAgICByZXR1cm4gcmV0CgoKCiIiIgoKCgppbXBvcnQgb3MKCmltcG9ydCB0eXBlcwoKaW1wb3J0IHppcGZpbGUKCmltcG9ydCBzeXMKCmltcG9ydCBpbwoKCgpjbGFzcyBaaXBJbXBvcnRlcihvYmplY3QpOgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB6aXBfZmlsZSk6CgogICAgICAgIHNlbGYuemZpbGUgPSB6aXBfZmlsZQoKICAgICAgICBzZWxmLl9wYXRocyA9IFt4LmZpbGVuYW1lIGZvciB4IGluIHNlbGYuemZpbGUuZmlsZWxpc3RdCgogICAgICAgIAoKICAgIGRlZiBfbW9kX3RvX3BhdGhzKHNlbGYsIGZ1bGxuYW1lKToKCiAgICAgICAgIyBnZXQgdGhlIHB5dGhvbiBtb2R1bGUgbmFtZQoKICAgICAgICBweV9maWxlbmFtZSA9IGZ1bGxuYW1lLnJlcGxhY2UoIi4iLCBvcy5zZXApICsgIi5weSIKCiAgICAgICAgIyBnZXQgdGhlIGZpbGVuYW1lIGlmIGl0IGlzIGEgcGFja2FnZS9zdWJwYWNrYWdlCgogICAgICAgIHB5X3BhY2thZ2UgPSBmdWxsbmFtZS5yZXBsYWNlKCIuIiwgb3Muc2VwKSArICIvX19pbml0X18ucHkiCgogICAgICAgIGlmIHB5X2ZpbGVuYW1lIGluIHNlbGYuX3BhdGhzOgoKICAgICAgICAgICAgcmV0dXJuIHB5X2ZpbGVuYW1lCgogICAgICAgIGVsaWYgcHlfcGFja2FnZSBpbiBzZWxmLl9wYXRoczoKCiAgICAgICAgICAgIHJldHVybiBweV9wYWNrYWdlCgogICAgICAgIGVsc2U6CgogICAgICAgICAgICByZXR1cm4gTm9uZQoKCgogICAgZGVmIGZpbmRfbW9kdWxlKHNlbGYsIGZ1bGxuYW1lLCBwYXRoKToKCiAgICAgICAgaWYgc2VsZi5fbW9kX3RvX3BhdGhzKGZ1bGxuYW1lKSBpcyBub3QgTm9uZToKCiAgICAgICAgICAgIHJldHVybiBzZWxmCgogICAgICAgIHJldHVybiBOb25lCgoKCiAgICBkZWYgbG9hZF9tb2R1bGUoc2VsZiwgZnVsbG5hbWUpOgoKICAgICAgICBmaWxlbmFtZSA9IHNlbGYuX21vZF90b19wYXRocyhmdWxsbmFtZSkKCiAgICAgICAgaWYgbm90IGZpbGVuYW1lIGluIHNlbGYuX3BhdGhzOgoKICAgICAgICAgICAgcmFpc2UgSW1wb3J0RXJyb3IoZnVsbG5hbWUpCgogICAgICAgIG5ld19tb2R1bGUgPSB0eXBlcy5Nb2R1bGVUeXBlKGZ1bGxuYW1lKQoKICAgICAgICBzeXMubW9kdWxlc1tmdWxsbmFtZV09bmV3X21vZHVsZQoKICAgICAgICBpZiBmaWxlbmFtZS5lbmRzd2l0aCgiX19pbml0X18ucHkiKToKCiAgICAgICAgICAgIG5ld19tb2R1bGUuX19wYXRoX18gPSBbXSAKCiAgICAgICAgICAgIG5ld19tb2R1bGUuX19wYWNrYWdlX18gPSBmdWxsbmFtZQoKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgbmV3X21vZHVsZS5fX3BhY2thZ2VfXyA9IGZ1bGxuYW1lLnJwYXJ0aXRpb24oJy4nKVswXQoKICAgICAgICBleGVjKHNlbGYuemZpbGUub3BlbihmaWxlbmFtZSwgJ3InKS5yZWFkKCksbmV3X21vZHVsZS5fX2RpY3RfXykKCiAgICAgICAgbmV3X21vZHVsZS5fX2ZpbGVfXyA9IGZpbGVuYW1lCgogICAgICAgIG5ld19tb2R1bGUuX19sb2FkZXJfXyA9IHNlbGYKCiAgICAgICAgcmV0dXJuIG5ld19tb2R1bGUKCgoKbW9kdWxlX3ppcD16aXBmaWxlLlppcEZpbGUoaW8uQnl0ZXNJTygpLCJ3IikKCmZvciBrZXkgaW4gbW9kdWxlX2RpY3Q6CgogICAgbW9kdWxlX3ppcC53cml0ZXN0cihrZXksbW9kdWxlX2RpY3Rba2V5XSkKCnN5cy5tZXRhX3BhdGguYXBwZW5kKFppcEltcG9ydGVyKG1vZHVsZV96aXApKQoKCgpmcm9tIHB5cGFyc2luZyBpbXBvcnQgKgo=').decode("utf-8"),pyparsing_module.__dict__)
#sys.modules["pyparsing"]=pyparsing_module



from pyparsing import (Suppress, Word, nums, alphas, Regex, Forward, Group, 

						Optional, OneOrMore, ParseResults)





from collections import defaultdict




import base64
pt = base64.b64decode(b'ewoJIkh5ZHJvZ2VuIjogewoJCSJBdG9taWNOdW1iZXIiOiAxLAoJCSJTeW1ib2wiOiAiSCIsCgkJIkF0b21pY01hc3MiOiAxLjAwNywKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDAsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDEsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMSwKCQkiUGVyaW9kIjogMSwKCQkiR3JvdXAiOiAxLAoJCSJQaGFzZSI6ICJnYXMiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiBudWxsLAoJCSJOb25tZXRhbCI6ICJ5ZXMiLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIk5vbm1ldGFsIiwKCQkiQXRvbWljUmFkaXVzIjogMC43OSwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAyLjIsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDEzLjU5ODQsCgkJIkRlbnNpdHkiOiA4Ljk5ZS0wNSwKCQkiTWVsdGluZ1BvaW50IjogMTQuMTc1LAoJCSJCb2lsaW5nUG9pbnQiOiAyMC4yOCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDMsCgkJIkRpc2NvdmVyZXIiOiAiQ2F2ZW5kaXNoIiwKCQkiWWVhciI6IDE3NjYsCgkJIlNwZWNpZmljSGVhdCI6IDE0LjMwNCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiAxLAoJCSJOdW1iZXJvZlZhbGVuY2UiOiAxLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICIxczEiCgl9LAoJIkhlbGl1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMiwKCQkiU3ltYm9sIjogIkhlIiwKCQkiQXRvbWljTWFzcyI6IDQuMDAyLAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMiwKCQkiTnVtYmVyb2ZQcm90b25zIjogMiwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAyLAoJCSJQZXJpb2QiOiAxLAoJCSJHcm91cCI6IDE4LAoJCSJQaGFzZSI6ICJnYXMiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiBudWxsLAoJCSJOb25tZXRhbCI6ICJ5ZXMiLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIk5vYmxlIEdhcyIsCgkJIkF0b21pY1JhZGl1cyI6IDAuNDksCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogbnVsbCwKCQkiRmlyc3RJb25pemF0aW9uIjogMjQuNTg3NCwKCQkiRGVuc2l0eSI6IDAuMDAwMTc5LAoJCSJNZWx0aW5nUG9pbnQiOiBudWxsLAoJCSJCb2lsaW5nUG9pbnQiOiA0LjIyLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogNSwKCQkiRGlzY292ZXJlciI6ICJKYW5zc2VuIiwKCQkiWWVhciI6IDE4NjgsCgkJIlNwZWNpZmljSGVhdCI6IDUuMTkzLAoJCSJOdW1iZXJvZlNoZWxscyI6IDEsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIjFzMiIKCX0sCgkiTGl0aGl1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMywKCQkiU3ltYm9sIjogIkxpIiwKCQkiQXRvbWljTWFzcyI6IDYuOTQxLAoJCSJOdW1iZXJvZk5ldXRyb25zIjogNCwKCQkiTnVtYmVyb2ZQcm90b25zIjogMywKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAzLAoJCSJQZXJpb2QiOiAyLAoJCSJHcm91cCI6IDEsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJBbGthbGkgTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAyLjEsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMC45OCwKCQkiRmlyc3RJb25pemF0aW9uIjogNS4zOTE3LAoJCSJEZW5zaXR5IjogMC41MzQsCgkJIk1lbHRpbmdQb2ludCI6IDQ1My44NSwKCQkiQm9pbGluZ1BvaW50IjogMTYxNSwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDUsCgkJIkRpc2NvdmVyZXIiOiAiQXJmdmVkc29uIiwKCQkiWWVhciI6IDE4MTcsCgkJIlNwZWNpZmljSGVhdCI6IDMuNTgyLAoJCSJOdW1iZXJvZlNoZWxscyI6IDIsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDEsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltIZV0gMnMxIgoJfSwKCSJCZXJ5bGxpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDQsCgkJIlN5bWJvbCI6ICJCZSIsCgkJIkF0b21pY01hc3MiOiA5LjAxMiwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDUsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDQsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNCwKCQkiUGVyaW9kIjogMiwKCQkiR3JvdXAiOiAyLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiQWxrYWxpbmUgRWFydGggTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjQsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS41NywKCQkiRmlyc3RJb25pemF0aW9uIjogOS4zMjI3LAoJCSJEZW5zaXR5IjogMS44NSwKCQkiTWVsdGluZ1BvaW50IjogMTU2MC4xNSwKCQkiQm9pbGluZ1BvaW50IjogMjc0MiwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDYsCgkJIkRpc2NvdmVyZXIiOiAiVmF1bHF1ZWxpbiIsCgkJIlllYXIiOiAxNzk4LAoJCSJTcGVjaWZpY0hlYXQiOiAxLjgyNSwKCQkiTnVtYmVyb2ZTaGVsbHMiOiAyLAoJCSJOdW1iZXJvZlZhbGVuY2UiOiAyLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbSGVdIDJzMiIKCX0sCgkiQm9yb24iOiB7CgkJIkF0b21pY051bWJlciI6IDUsCgkJIlN5bWJvbCI6ICJCIiwKCQkiQXRvbWljTWFzcyI6IDEwLjgxMSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDYsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDUsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNSwKCQkiUGVyaW9kIjogMiwKCQkiR3JvdXAiOiAxMywKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiBudWxsLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6ICJ5ZXMiLAoJCSJUeXBlIjogIk1ldGFsbG9pZCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuMiwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAyLjA0LAoJCSJGaXJzdElvbml6YXRpb24iOiA4LjI5OCwKCQkiRGVuc2l0eSI6IDIuMzQsCgkJIk1lbHRpbmdQb2ludCI6IDI1NzMuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDQyMDAsCgkJIk51bWJlck9mSXNvdG9wZXMiOiA2LAoJCSJEaXNjb3ZlcmVyIjogIkdheS1MdXNzYWMiLAoJCSJZZWFyIjogMTgwOCwKCQkiU3BlY2lmaWNIZWF0IjogMS4wMjYsCgkJIk51bWJlcm9mU2hlbGxzIjogMiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogMywKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0hlXSAyczIgMnAxIgoJfSwKCSJDYXJib24iOiB7CgkJIkF0b21pY051bWJlciI6IDYsCgkJIlN5bWJvbCI6ICJDIiwKCQkiQXRvbWljTWFzcyI6IDEyLjAxMSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDYsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDYsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNiwKCQkiUGVyaW9kIjogMiwKCQkiR3JvdXAiOiAxNCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiBudWxsLAoJCSJOb25tZXRhbCI6ICJ5ZXMiLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIk5vbm1ldGFsIiwKCQkiQXRvbWljUmFkaXVzIjogMC45MSwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAyLjU1LAoJCSJGaXJzdElvbml6YXRpb24iOiAxMS4yNjAzLAoJCSJEZW5zaXR5IjogMi4yNywKCQkiTWVsdGluZ1BvaW50IjogMzk0OC4xNSwKCQkiQm9pbGluZ1BvaW50IjogNDMwMCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDcsCgkJIkRpc2NvdmVyZXIiOiAiUHJlaGlzdG9yaWMiLAoJCSJZZWFyIjogbnVsbCwKCQkiU3BlY2lmaWNIZWF0IjogMC43MDksCgkJIk51bWJlcm9mU2hlbGxzIjogMiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogNCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0hlXSAyczIgMnAyIgoJfSwKCSJOaXRyb2dlbiI6IHsKCQkiQXRvbWljTnVtYmVyIjogNywKCQkiU3ltYm9sIjogIk4iLAoJCSJBdG9taWNNYXNzIjogMTQuMDA3LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogNywKCQkiTnVtYmVyb2ZQcm90b25zIjogNywKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA3LAoJCSJQZXJpb2QiOiAyLAoJCSJHcm91cCI6IDE1LAoJCSJQaGFzZSI6ICJnYXMiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiBudWxsLAoJCSJOb25tZXRhbCI6ICJ5ZXMiLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIk5vbm1ldGFsIiwKCQkiQXRvbWljUmFkaXVzIjogMC43NSwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAzLjA0LAoJCSJGaXJzdElvbml6YXRpb24iOiAxNC41MzQxLAoJCSJEZW5zaXR5IjogMC4wMDEyNSwKCQkiTWVsdGluZ1BvaW50IjogNjMuMjksCgkJIkJvaWxpbmdQb2ludCI6IDc3LjM2LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogOCwKCQkiRGlzY292ZXJlciI6ICJSdXRoZXJmb3JkIiwKCQkiWWVhciI6IDE3NzIsCgkJIlNwZWNpZmljSGVhdCI6IDEuMDQsCgkJIk51bWJlcm9mU2hlbGxzIjogMiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogNSwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0hlXSAyczIgMnAzIgoJfSwKCSJPeHlnZW4iOiB7CgkJIkF0b21pY051bWJlciI6IDgsCgkJIlN5bWJvbCI6ICJPIiwKCQkiQXRvbWljTWFzcyI6IDE1Ljk5OSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDgsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDgsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogOCwKCQkiUGVyaW9kIjogMiwKCQkiR3JvdXAiOiAxNiwKCQkiUGhhc2UiOiAiZ2FzIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogbnVsbCwKCQkiTm9ubWV0YWwiOiAieWVzIiwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJOb25tZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDAuNjUsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMy40NCwKCQkiRmlyc3RJb25pemF0aW9uIjogMTMuNjE4MSwKCQkiRGVuc2l0eSI6IDAuMDAxNDMsCgkJIk1lbHRpbmdQb2ludCI6IDUwLjUsCgkJIkJvaWxpbmdQb2ludCI6IDkwLjIsCgkJIk51bWJlck9mSXNvdG9wZXMiOiA4LAoJCSJEaXNjb3ZlcmVyIjogIlByaWVzdGxleS9TY2hlZWxlIiwKCQkiWWVhciI6IDE3NzQsCgkJIlNwZWNpZmljSGVhdCI6IDAuOTE4LAoJCSJOdW1iZXJvZlNoZWxscyI6IDIsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDYsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltIZV0gMnMyIDJwNCIKCX0sCgkiRmx1b3JpbmUiOiB7CgkJIkF0b21pY051bWJlciI6IDksCgkJIlN5bWJvbCI6ICJGIiwKCQkiQXRvbWljTWFzcyI6IDE4Ljk5OCwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDEwLAoJCSJOdW1iZXJvZlByb3RvbnMiOiA5LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDksCgkJIlBlcmlvZCI6IDIsCgkJIkdyb3VwIjogMTcsCgkJIlBoYXNlIjogImdhcyIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6IG51bGwsCgkJIk5vbm1ldGFsIjogInllcyIsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiSGFsb2dlbiIsCgkJIkF0b21pY1JhZGl1cyI6IDAuNTcsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMy45OCwKCQkiRmlyc3RJb25pemF0aW9uIjogMTcuNDIyOCwKCQkiRGVuc2l0eSI6IDAuMDAxNywKCQkiTWVsdGluZ1BvaW50IjogNTMuNjMsCgkJIkJvaWxpbmdQb2ludCI6IDg1LjAzLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogNiwKCQkiRGlzY292ZXJlciI6ICJNb2lzc2FuIiwKCQkiWWVhciI6IDE4ODYsCgkJIlNwZWNpZmljSGVhdCI6IDAuODI0LAoJCSJOdW1iZXJvZlNoZWxscyI6IDIsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDcsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltIZV0gMnMyIDJwNSIKCX0sCgkiTmVvbiI6IHsKCQkiQXRvbWljTnVtYmVyIjogMTAsCgkJIlN5bWJvbCI6ICJOZSIsCgkJIkF0b21pY01hc3MiOiAyMC4xOCwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDEwLAoJCSJOdW1iZXJvZlByb3RvbnMiOiAxMCwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAxMCwKCQkiUGVyaW9kIjogMiwKCQkiR3JvdXAiOiAxOCwKCQkiUGhhc2UiOiAiZ2FzIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogbnVsbCwKCQkiTm9ubWV0YWwiOiAieWVzIiwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJOb2JsZSBHYXMiLAoJCSJBdG9taWNSYWRpdXMiOiAwLjUxLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IG51bGwsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDIxLjU2NDUsCgkJIkRlbnNpdHkiOiAwLjAwMDksCgkJIk1lbHRpbmdQb2ludCI6IDI0LjcwMywKCQkiQm9pbGluZ1BvaW50IjogMjcuMDcsCgkJIk51bWJlck9mSXNvdG9wZXMiOiA4LAoJCSJEaXNjb3ZlcmVyIjogIlJhbXNheSBhbmQgVHJhdmVycyIsCgkJIlllYXIiOiAxODk4LAoJCSJTcGVjaWZpY0hlYXQiOiAxLjAzLAoJCSJOdW1iZXJvZlNoZWxscyI6IDIsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDgsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltIZV0gMnMyIDJwNiIKCX0sCgkiU29kaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiAxMSwKCQkiU3ltYm9sIjogIk5hIiwKCQkiQXRvbWljTWFzcyI6IDIyLjk5LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTIsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDExLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDExLAoJCSJQZXJpb2QiOiAzLAoJCSJHcm91cCI6IDEsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJBbGthbGkgTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAyLjIsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMC45MywKCQkiRmlyc3RJb25pemF0aW9uIjogNS4xMzkxLAoJCSJEZW5zaXR5IjogMC45NzEsCgkJIk1lbHRpbmdQb2ludCI6IDM3MS4xNSwKCQkiQm9pbGluZ1BvaW50IjogMTE1NiwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDcsCgkJIkRpc2NvdmVyZXIiOiAiRGF2eSIsCgkJIlllYXIiOiAxODA3LAoJCSJTcGVjaWZpY0hlYXQiOiAxLjIyOCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiAzLAoJCSJOdW1iZXJvZlZhbGVuY2UiOiAxLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbTmVdIDNzMSIKCX0sCgkiTWFnbmVzaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiAxMiwKCQkiU3ltYm9sIjogIk1nIiwKCQkiQXRvbWljTWFzcyI6IDI0LjMwNSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDEyLAoJCSJOdW1iZXJvZlByb3RvbnMiOiAxMiwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAxMiwKCQkiUGVyaW9kIjogMywKCQkiR3JvdXAiOiAyLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiQWxrYWxpbmUgRWFydGggTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjcsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS4zMSwKCQkiRmlyc3RJb25pemF0aW9uIjogNy42NDYyLAoJCSJEZW5zaXR5IjogMS43NCwKCQkiTWVsdGluZ1BvaW50IjogOTIzLjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAxMzYzLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogOCwKCQkiRGlzY292ZXJlciI6ICJCbGFjayIsCgkJIlllYXIiOiAxNzU1LAoJCSJTcGVjaWZpY0hlYXQiOiAxLjAyMywKCQkiTnVtYmVyb2ZTaGVsbHMiOiAzLAoJCSJOdW1iZXJvZlZhbGVuY2UiOiAyLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbTmVdIDNzMiIKCX0sCgkiQWx1bWludW0iOiB7CgkJIkF0b21pY051bWJlciI6IDEzLAoJCSJTeW1ib2wiOiAiQWwiLAoJCSJBdG9taWNNYXNzIjogMjYuOTgyLAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTQsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDEzLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDEzLAoJCSJQZXJpb2QiOiAzLAoJCSJHcm91cCI6IDEzLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjgsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS42MSwKCQkiRmlyc3RJb25pemF0aW9uIjogNS45ODU4LAoJCSJEZW5zaXR5IjogMi43LAoJCSJNZWx0aW5nUG9pbnQiOiA5MzMuNCwKCQkiQm9pbGluZ1BvaW50IjogMjc5MiwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDgsCgkJIkRpc2NvdmVyZXIiOiAiV3NobGVyIiwKCQkiWWVhciI6IDE4MjcsCgkJIlNwZWNpZmljSGVhdCI6IDAuODk3LAoJCSJOdW1iZXJvZlNoZWxscyI6IDMsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDMsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltOZV0gM3MyIDNwMSIKCX0sCgkiU2lsaWNvbiI6IHsKCQkiQXRvbWljTnVtYmVyIjogMTQsCgkJIlN5bWJvbCI6ICJTaSIsCgkJIkF0b21pY01hc3MiOiAyOC4wODYsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxNCwKCQkiTnVtYmVyb2ZQcm90b25zIjogMTQsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMTQsCgkJIlBlcmlvZCI6IDMsCgkJIkdyb3VwIjogMTQsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogbnVsbCwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiAieWVzIiwKCQkiVHlwZSI6ICJNZXRhbGxvaWQiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjUsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS45LAoJCSJGaXJzdElvbml6YXRpb24iOiA4LjE1MTcsCgkJIkRlbnNpdHkiOiAyLjMzLAoJCSJNZWx0aW5nUG9pbnQiOiAxNjgzLjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAzNTM4LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogOCwKCQkiRGlzY292ZXJlciI6ICJCZXJ6ZWxpdXMiLAoJCSJZZWFyIjogMTgyNCwKCQkiU3BlY2lmaWNIZWF0IjogMC43MDUsCgkJIk51bWJlcm9mU2hlbGxzIjogMywKCQkiTnVtYmVyb2ZWYWxlbmNlIjogNCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW05lXSAzczIgM3AyIgoJfSwKCSJQaG9zcGhvcnVzIjogewoJCSJBdG9taWNOdW1iZXIiOiAxNSwKCQkiU3ltYm9sIjogIlAiLAoJCSJBdG9taWNNYXNzIjogMzAuOTc0LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTYsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDE1LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDE1LAoJCSJQZXJpb2QiOiAzLAoJCSJHcm91cCI6IDE1LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6IG51bGwsCgkJIk5vbm1ldGFsIjogInllcyIsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiTm9ubWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjIsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMi4xOSwKCQkiRmlyc3RJb25pemF0aW9uIjogMTAuNDg2NywKCQkiRGVuc2l0eSI6IDEuODIsCgkJIk1lbHRpbmdQb2ludCI6IDMxNy4yNSwKCQkiQm9pbGluZ1BvaW50IjogNTUzLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogNywKCQkiRGlzY292ZXJlciI6ICJCcmFuQnJhbmQiLAoJCSJZZWFyIjogMTY2OSwKCQkiU3BlY2lmaWNIZWF0IjogMC43NjksCgkJIk51bWJlcm9mU2hlbGxzIjogMywKCQkiTnVtYmVyb2ZWYWxlbmNlIjogNSwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW05lXSAzczIgM3AzIgoJfSwKCSJTdWxmdXIiOiB7CgkJIkF0b21pY051bWJlciI6IDE2LAoJCSJTeW1ib2wiOiAiUyIsCgkJIkF0b21pY01hc3MiOiAzMi4wNjUsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxNiwKCQkiTnVtYmVyb2ZQcm90b25zIjogMTYsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMTYsCgkJIlBlcmlvZCI6IDMsCgkJIkdyb3VwIjogMTYsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogbnVsbCwKCQkiTm9ubWV0YWwiOiAieWVzIiwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJOb25tZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuMSwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAyLjU4LAoJCSJGaXJzdElvbml6YXRpb24iOiAxMC4zNiwKCQkiRGVuc2l0eSI6IDIuMDcsCgkJIk1lbHRpbmdQb2ludCI6IDM4OC41MSwKCQkiQm9pbGluZ1BvaW50IjogNzE3LjgsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxMCwKCQkiRGlzY292ZXJlciI6ICJQcmVoaXN0b3JpYyIsCgkJIlllYXIiOiBudWxsLAoJCSJTcGVjaWZpY0hlYXQiOiAwLjcxLAoJCSJOdW1iZXJvZlNoZWxscyI6IDMsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDYsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltOZV0gM3MyIDNwNCIKCX0sCgkiQ2hsb3JpbmUiOiB7CgkJIkF0b21pY051bWJlciI6IDE3LAoJCSJTeW1ib2wiOiAiQ2wiLAoJCSJBdG9taWNNYXNzIjogMzUuNDUzLAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTgsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDE3LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDE3LAoJCSJQZXJpb2QiOiAzLAoJCSJHcm91cCI6IDE3LAoJCSJQaGFzZSI6ICJnYXMiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiBudWxsLAoJCSJOb25tZXRhbCI6ICJ5ZXMiLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkhhbG9nZW4iLAoJCSJBdG9taWNSYWRpdXMiOiAwLjk3LAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDMuMTYsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDEyLjk2NzYsCgkJIkRlbnNpdHkiOiAwLjAwMzIxLAoJCSJNZWx0aW5nUG9pbnQiOiAxNzIuMzEsCgkJIkJvaWxpbmdQb2ludCI6IDIzOS4xMSwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDExLAoJCSJEaXNjb3ZlcmVyIjogIlNjaGVlbGUiLAoJCSJZZWFyIjogMTc3NCwKCQkiU3BlY2lmaWNIZWF0IjogMC40NzksCgkJIk51bWJlcm9mU2hlbGxzIjogMywKCQkiTnVtYmVyb2ZWYWxlbmNlIjogNywKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW05lXSAzczIgM3A1IgoJfSwKCSJBcmdvbiI6IHsKCQkiQXRvbWljTnVtYmVyIjogMTgsCgkJIlN5bWJvbCI6ICJBciIsCgkJIkF0b21pY01hc3MiOiAzOS45NDgsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAyMiwKCQkiTnVtYmVyb2ZQcm90b25zIjogMTgsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMTgsCgkJIlBlcmlvZCI6IDMsCgkJIkdyb3VwIjogMTgsCgkJIlBoYXNlIjogImdhcyIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6IG51bGwsCgkJIk5vbm1ldGFsIjogInllcyIsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiTm9ibGUgR2FzIiwKCQkiQXRvbWljUmFkaXVzIjogMC44OCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiBudWxsLAoJCSJGaXJzdElvbml6YXRpb24iOiAxNS43NTk2LAoJCSJEZW5zaXR5IjogMC4wMDE3OCwKCQkiTWVsdGluZ1BvaW50IjogODMuOTYsCgkJIkJvaWxpbmdQb2ludCI6IDg3LjMsCgkJIk51bWJlck9mSXNvdG9wZXMiOiA4LAoJCSJEaXNjb3ZlcmVyIjogIlJheWxlaWdoIGFuZCBSYW1zYXkiLAoJCSJZZWFyIjogMTg5NCwKCQkiU3BlY2lmaWNIZWF0IjogMC41MiwKCQkiTnVtYmVyb2ZTaGVsbHMiOiAzLAoJCSJOdW1iZXJvZlZhbGVuY2UiOiA4LAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbTmVdIDNzMiAzcDYiCgl9LAoJIlBvdGFzc2l1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMTksCgkJIlN5bWJvbCI6ICJLIiwKCQkiQXRvbWljTWFzcyI6IDM5LjA5OCwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDIwLAoJCSJOdW1iZXJvZlByb3RvbnMiOiAxOSwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAxOSwKCQkiUGVyaW9kIjogNCwKCQkiR3JvdXAiOiAxLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiQWxrYWxpIE1ldGFsIiwKCQkiQXRvbWljUmFkaXVzIjogMi44LAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDAuODIsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDQuMzQwNywKCQkiRGVuc2l0eSI6IDAuODYyLAoJCSJNZWx0aW5nUG9pbnQiOiAzMzYuNSwKCQkiQm9pbGluZ1BvaW50IjogMTAzMiwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDEwLAoJCSJEaXNjb3ZlcmVyIjogIkRhdnkiLAoJCSJZZWFyIjogMTgwNywKCQkiU3BlY2lmaWNIZWF0IjogMC43NTcsCgkJIk51bWJlcm9mU2hlbGxzIjogNCwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogMSwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0FyXSA0czEiCgl9LAoJIkNhbGNpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDIwLAoJCSJTeW1ib2wiOiAiQ2EiLAoJCSJBdG9taWNNYXNzIjogNDAuMDc4LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMjAsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDIwLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDIwLAoJCSJQZXJpb2QiOiA0LAoJCSJHcm91cCI6IDIsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJBbGthbGluZSBFYXJ0aCBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDIuMiwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLAoJCSJGaXJzdElvbml6YXRpb24iOiA2LjExMzIsCgkJIkRlbnNpdHkiOiAxLjU0LAoJCSJNZWx0aW5nUG9pbnQiOiAxMTEyLjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAxNzU3LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTQsCgkJIkRpc2NvdmVyZXIiOiAiRGF2eSIsCgkJIlllYXIiOiAxODA4LAoJCSJTcGVjaWZpY0hlYXQiOiAwLjY0NywKCQkiTnVtYmVyb2ZTaGVsbHMiOiA0LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiAyLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbQXJdIDRzMiIKCX0sCgkiU2NhbmRpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDIxLAoJCSJTeW1ib2wiOiAiU2MiLAoJCSJBdG9taWNNYXNzIjogNDQuOTU2LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMjQsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDIxLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDIxLAoJCSJQZXJpb2QiOiA0LAoJCSJHcm91cCI6IDMsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJUcmFuc2l0aW9uIE1ldGFsIiwKCQkiQXRvbWljUmFkaXVzIjogMi4xLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDEuMzYsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuNTYxNSwKCQkiRGVuc2l0eSI6IDIuOTksCgkJIk1lbHRpbmdQb2ludCI6IDE4MTIuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDMxMDksCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxNSwKCQkiRGlzY292ZXJlciI6ICJOaWxzb24iLAoJCSJZZWFyIjogMTg3OCwKCQkiU3BlY2lmaWNIZWF0IjogMC41NjgsCgkJIk51bWJlcm9mU2hlbGxzIjogNCwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0FyXSAzZDEgNHMyIgoJfSwKCSJUaXRhbml1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMjIsCgkJIlN5bWJvbCI6ICJUaSIsCgkJIkF0b21pY01hc3MiOiA0Ny44NjcsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAyNiwKCQkiTnVtYmVyb2ZQcm90b25zIjogMjIsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMjIsCgkJIlBlcmlvZCI6IDQsCgkJIkdyb3VwIjogNCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIlRyYW5zaXRpb24gTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAyLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDEuNTQsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuODI4MSwKCQkiRGVuc2l0eSI6IDQuNTQsCgkJIk1lbHRpbmdQb2ludCI6IDE5MzMuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDM1NjAsCgkJIk51bWJlck9mSXNvdG9wZXMiOiA5LAoJCSJEaXNjb3ZlcmVyIjogIkdyZWdvciIsCgkJIlllYXIiOiAxNzkxLAoJCSJTcGVjaWZpY0hlYXQiOiAwLjUyMywKCQkiTnVtYmVyb2ZTaGVsbHMiOiA0LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbQXJdIDNkMiA0czIiCgl9LAoJIlZhbmFkaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiAyMywKCQkiU3ltYm9sIjogIlYiLAoJCSJBdG9taWNNYXNzIjogNTAuOTQyLAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMjgsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDIzLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDIzLAoJCSJQZXJpb2QiOiA0LAoJCSJHcm91cCI6IDUsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJUcmFuc2l0aW9uIE1ldGFsIiwKCQkiQXRvbWljUmFkaXVzIjogMS45LAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDEuNjMsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuNzQ2MiwKCQkiRGVuc2l0eSI6IDYuMTEsCgkJIk1lbHRpbmdQb2ludCI6IDIxNzUuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDM2ODAsCgkJIk51bWJlck9mSXNvdG9wZXMiOiA5LAoJCSJEaXNjb3ZlcmVyIjogIiAgIGRlbCBSaW8iLAoJCSJZZWFyIjogMTgwMSwKCQkiU3BlY2lmaWNIZWF0IjogMC40ODksCgkJIk51bWJlcm9mU2hlbGxzIjogNCwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0FyXSAzZDMgNHMyIgoJfSwKCSJDaHJvbWl1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMjQsCgkJIlN5bWJvbCI6ICJDciIsCgkJIkF0b21pY01hc3MiOiA1MS45OTYsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAyOCwKCQkiTnVtYmVyb2ZQcm90b25zIjogMjQsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMjQsCgkJIlBlcmlvZCI6IDQsCgkJIkdyb3VwIjogNiwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIlRyYW5zaXRpb24gTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjksCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS42NiwKCQkiRmlyc3RJb25pemF0aW9uIjogNi43NjY1LAoJCSJEZW5zaXR5IjogNy4xNSwKCQkiTWVsdGluZ1BvaW50IjogMjEzMC4xNSwKCQkiQm9pbGluZ1BvaW50IjogMjk0NCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDksCgkJIkRpc2NvdmVyZXIiOiAiVmF1cXVlbGluIiwKCQkiWWVhciI6IDE3OTcsCgkJIlNwZWNpZmljSGVhdCI6IDAuNDQ5LAoJCSJOdW1iZXJvZlNoZWxscyI6IDQsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltBcl0gM2Q1IDRzMSIKCX0sCgkiTWFuZ2FuZXNlIjogewoJCSJBdG9taWNOdW1iZXIiOiAyNSwKCQkiU3ltYm9sIjogIk1uIiwKCQkiQXRvbWljTWFzcyI6IDU0LjkzOCwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDMwLAoJCSJOdW1iZXJvZlByb3RvbnMiOiAyNSwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAyNSwKCQkiUGVyaW9kIjogNCwKCQkiR3JvdXAiOiA3LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuOCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjU1LAoJCSJGaXJzdElvbml6YXRpb24iOiA3LjQzNCwKCQkiRGVuc2l0eSI6IDcuNDQsCgkJIk1lbHRpbmdQb2ludCI6IDE1MTkuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDIzMzQsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxMSwKCQkiRGlzY292ZXJlciI6ICJHYWhuLCBTY2hlZWxlIiwKCQkiWWVhciI6IDE3NzQsCgkJIlNwZWNpZmljSGVhdCI6IDAuNDc5LAoJCSJOdW1iZXJvZlNoZWxscyI6IDQsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltBcl0gM2Q1IDRzMiIKCX0sCgkiSXJvbiI6IHsKCQkiQXRvbWljTnVtYmVyIjogMjYsCgkJIlN5bWJvbCI6ICJGZSIsCgkJIkF0b21pY01hc3MiOiA1NS44NDUsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAzMCwKCQkiTnVtYmVyb2ZQcm90b25zIjogMjYsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMjYsCgkJIlBlcmlvZCI6IDQsCgkJIkdyb3VwIjogOCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIlRyYW5zaXRpb24gTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjcsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS44MywKCQkiRmlyc3RJb25pemF0aW9uIjogNy45MDI0LAoJCSJEZW5zaXR5IjogNy44NywKCQkiTWVsdGluZ1BvaW50IjogMTgwOC4xNSwKCQkiQm9pbGluZ1BvaW50IjogMzEzNCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDEwLAoJCSJEaXNjb3ZlcmVyIjogIlByZWhpc3RvcmljIiwKCQkiWWVhciI6IG51bGwsCgkJIlNwZWNpZmljSGVhdCI6IDAuNDQ5LAoJCSJOdW1iZXJvZlNoZWxscyI6IDQsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltBcl0gM2Q2IDRzMiIKCX0sCgkiQ29iYWx0IjogewoJCSJBdG9taWNOdW1iZXIiOiAyNywKCQkiU3ltYm9sIjogIkNvIiwKCQkiQXRvbWljTWFzcyI6IDU4LjkzMywKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDMyLAoJCSJOdW1iZXJvZlByb3RvbnMiOiAyNywKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAyNywKCQkiUGVyaW9kIjogNCwKCQkiR3JvdXAiOiA5LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuNywKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjg4LAoJCSJGaXJzdElvbml6YXRpb24iOiA3Ljg4MSwKCQkiRGVuc2l0eSI6IDguODYsCgkJIk1lbHRpbmdQb2ludCI6IDE3NjguMTUsCgkJIkJvaWxpbmdQb2ludCI6IDMyMDAsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxNCwKCQkiRGlzY292ZXJlciI6ICJCcmFuZHQiLAoJCSJZZWFyIjogMTczNSwKCQkiU3BlY2lmaWNIZWF0IjogMC40MjEsCgkJIk51bWJlcm9mU2hlbGxzIjogNCwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0FyXSAzZDcgNHMyIgoJfSwKCSJOaWNrZWwiOiB7CgkJIkF0b21pY051bWJlciI6IDI4LAoJCSJTeW1ib2wiOiAiTmkiLAoJCSJBdG9taWNNYXNzIjogNTguNjkzLAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMzEsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDI4LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDI4LAoJCSJQZXJpb2QiOiA0LAoJCSJHcm91cCI6IDEwLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuNiwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjkxLAoJCSJGaXJzdElvbml6YXRpb24iOiA3LjYzOTgsCgkJIkRlbnNpdHkiOiA4LjkxLAoJCSJNZWx0aW5nUG9pbnQiOiAxNzI2LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAzMTg2LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTEsCgkJIkRpc2NvdmVyZXIiOiAiQ3JvbnN0ZWR0IiwKCQkiWWVhciI6IDE3NTEsCgkJIlNwZWNpZmljSGVhdCI6IDAuNDQ0LAoJCSJOdW1iZXJvZlNoZWxscyI6IDQsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltBcl0gM2Q4IDRzMiIKCX0sCgkiQ29wcGVyIjogewoJCSJBdG9taWNOdW1iZXIiOiAyOSwKCQkiU3ltYm9sIjogIkN1IiwKCQkiQXRvbWljTWFzcyI6IDYzLjU0NiwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDM1LAoJCSJOdW1iZXJvZlByb3RvbnMiOiAyOSwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAyOSwKCQkiUGVyaW9kIjogNCwKCQkiR3JvdXAiOiAxMSwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIlRyYW5zaXRpb24gTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjYsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS45LAoJCSJGaXJzdElvbml6YXRpb24iOiA3LjcyNjQsCgkJIkRlbnNpdHkiOiA4Ljk2LAoJCSJNZWx0aW5nUG9pbnQiOiAxMzU3Ljc1LAoJCSJCb2lsaW5nUG9pbnQiOiAyODM1LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTEsCgkJIkRpc2NvdmVyZXIiOiAiUHJlaGlzdG9yaWMiLAoJCSJZZWFyIjogbnVsbCwKCQkiU3BlY2lmaWNIZWF0IjogMC4zODUsCgkJIk51bWJlcm9mU2hlbGxzIjogNCwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0FyXSAzZDEwIDRzMSIKCX0sCgkiWmluYyI6IHsKCQkiQXRvbWljTnVtYmVyIjogMzAsCgkJIlN5bWJvbCI6ICJabiIsCgkJIkF0b21pY01hc3MiOiA2NS4zOCwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDM1LAoJCSJOdW1iZXJvZlByb3RvbnMiOiAzMCwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAzMCwKCQkiUGVyaW9kIjogNCwKCQkiR3JvdXAiOiAxMiwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIlRyYW5zaXRpb24gTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjUsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS42NSwKCQkiRmlyc3RJb25pemF0aW9uIjogOS4zOTQyLAoJCSJEZW5zaXR5IjogNy4xMywKCQkiTWVsdGluZ1BvaW50IjogNjkyLjg4LAoJCSJCb2lsaW5nUG9pbnQiOiAxMTgwLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTUsCgkJIkRpc2NvdmVyZXIiOiAiUHJlaGlzdG9yaWMiLAoJCSJZZWFyIjogbnVsbCwKCQkiU3BlY2lmaWNIZWF0IjogMC4zODgsCgkJIk51bWJlcm9mU2hlbGxzIjogNCwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0FyXSAzZDEwIDRzMiIKCX0sCgkiR2FsbGl1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMzEsCgkJIlN5bWJvbCI6ICJHYSIsCgkJIkF0b21pY01hc3MiOiA2OS43MjMsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAzOSwKCQkiTnVtYmVyb2ZQcm90b25zIjogMzEsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMzEsCgkJIlBlcmlvZCI6IDQsCgkJIkdyb3VwIjogMTMsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuOCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjgxLAoJCSJGaXJzdElvbml6YXRpb24iOiA1Ljk5OTMsCgkJIkRlbnNpdHkiOiA1LjkxLAoJCSJNZWx0aW5nUG9pbnQiOiAzMDIuOTEsCgkJIkJvaWxpbmdQb2ludCI6IDI0NzcsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxNCwKCQkiRGlzY292ZXJlciI6ICJkZSBCb2lzYmF1ZHJhbiIsCgkJIlllYXIiOiAxODc1LAoJCSJTcGVjaWZpY0hlYXQiOiAwLjM3MSwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA0LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiAzLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbQXJdIDNkMTAgNHMyIDRwMSIKCX0sCgkiR2VybWFuaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiAzMiwKCQkiU3ltYm9sIjogIkdlIiwKCQkiQXRvbWljTWFzcyI6IDcyLjY0LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogNDEsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDMyLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDMyLAoJCSJQZXJpb2QiOiA0LAoJCSJHcm91cCI6IDE0LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6IG51bGwsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogInllcyIsCgkJIlR5cGUiOiAiTWV0YWxsb2lkIiwKCQkiQXRvbWljUmFkaXVzIjogMS41LAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDIuMDEsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDcuODk5NCwKCQkiRGVuc2l0eSI6IDUuMzIsCgkJIk1lbHRpbmdQb2ludCI6IDEyMTEuNDUsCgkJIkJvaWxpbmdQb2ludCI6IDMxMDYsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxNywKCQkiRGlzY292ZXJlciI6ICJXaW5rbGVyIiwKCQkiWWVhciI6IDE4ODYsCgkJIlNwZWNpZmljSGVhdCI6IDAuMzIsCgkJIk51bWJlcm9mU2hlbGxzIjogNCwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogNCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0FyXSAzZDEwIDRzMiA0cDIiCgl9LAoJIkFyc2VuaWMiOiB7CgkJIkF0b21pY051bWJlciI6IDMzLAoJCSJTeW1ib2wiOiAiQXMiLAoJCSJBdG9taWNNYXNzIjogNzQuOTIyLAoJCSJOdW1iZXJvZk5ldXRyb25zIjogNDIsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDMzLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDMzLAoJCSJQZXJpb2QiOiA0LAoJCSJHcm91cCI6IDE1LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6IG51bGwsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogInllcyIsCgkJIlR5cGUiOiAiTWV0YWxsb2lkIiwKCQkiQXRvbWljUmFkaXVzIjogMS4zLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDIuMTgsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDkuNzg4NiwKCQkiRGVuc2l0eSI6IDUuNzgsCgkJIk1lbHRpbmdQb2ludCI6IDEwOTAuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDg4NywKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDE0LAoJCSJEaXNjb3ZlcmVyIjogIkFsYmVydHVzIE1hZ251cyIsCgkJIlllYXIiOiAxMjUwLAoJCSJTcGVjaWZpY0hlYXQiOiAwLjMyOSwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA0LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiA1LAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbQXJdIDNkMTAgNHMyIDRwMyIKCX0sCgkiU2VsZW5pdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDM0LAoJCSJTeW1ib2wiOiAiU2UiLAoJCSJBdG9taWNNYXNzIjogNzguOTYsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA0NSwKCQkiTnVtYmVyb2ZQcm90b25zIjogMzQsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMzQsCgkJIlBlcmlvZCI6IDQsCgkJIkdyb3VwIjogMTYsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogbnVsbCwKCQkiTm9ubWV0YWwiOiAieWVzIiwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJOb25tZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuMiwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAyLjU1LAoJCSJGaXJzdElvbml6YXRpb24iOiA5Ljc1MjQsCgkJIkRlbnNpdHkiOiA0LjgxLAoJCSJNZWx0aW5nUG9pbnQiOiA0OTQuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDk1OCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDIwLAoJCSJEaXNjb3ZlcmVyIjogIkJlcnplbGl1cyIsCgkJIlllYXIiOiAxODE3LAoJCSJTcGVjaWZpY0hlYXQiOiAwLjMyMSwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA0LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiA2LAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbQXJdIDNkMTAgNHMyIDRwNCIKCX0sCgkiQnJvbWluZSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMzUsCgkJIlN5bWJvbCI6ICJCciIsCgkJIkF0b21pY01hc3MiOiA3OS45MDQsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA0NSwKCQkiTnVtYmVyb2ZQcm90b25zIjogMzUsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMzUsCgkJIlBlcmlvZCI6IDQsCgkJIkdyb3VwIjogMTcsCgkJIlBoYXNlIjogImxpcSIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6IG51bGwsCgkJIk5vbm1ldGFsIjogInllcyIsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiSGFsb2dlbiIsCgkJIkF0b21pY1JhZGl1cyI6IDEuMSwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAyLjk2LAoJCSJGaXJzdElvbml6YXRpb24iOiAxMS44MTM4LAoJCSJEZW5zaXR5IjogMy4xMiwKCQkiTWVsdGluZ1BvaW50IjogMjY2LjA1LAoJCSJCb2lsaW5nUG9pbnQiOiAzMzIsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxOSwKCQkiRGlzY292ZXJlciI6ICJCYWxhcmQiLAoJCSJZZWFyIjogMTgyNiwKCQkiU3BlY2lmaWNIZWF0IjogMC40NzQsCgkJIk51bWJlcm9mU2hlbGxzIjogNCwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogNywKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0FyXSAzZDEwIDRzMiA0cDUiCgl9LAoJIktyeXB0b24iOiB7CgkJIkF0b21pY051bWJlciI6IDM2LAoJCSJTeW1ib2wiOiAiS3IiLAoJCSJBdG9taWNNYXNzIjogODMuNzk4LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogNDgsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDM2LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDM2LAoJCSJQZXJpb2QiOiA0LAoJCSJHcm91cCI6IDE4LAoJCSJQaGFzZSI6ICJnYXMiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiBudWxsLAoJCSJOb25tZXRhbCI6ICJ5ZXMiLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIk5vYmxlIEdhcyIsCgkJIkF0b21pY1JhZGl1cyI6IDEsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogbnVsbCwKCQkiRmlyc3RJb25pemF0aW9uIjogMTMuOTk5NiwKCQkiRGVuc2l0eSI6IDAuMDAzNzMsCgkJIk1lbHRpbmdQb2ludCI6IDExNS45MywKCQkiQm9pbGluZ1BvaW50IjogMTE5LjkzLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjMsCgkJIkRpc2NvdmVyZXIiOiAiUmFtc2F5IGFuZCBUcmF2ZXJzIiwKCQkiWWVhciI6IDE4OTgsCgkJIlNwZWNpZmljSGVhdCI6IDAuMjQ4LAoJCSJOdW1iZXJvZlNoZWxscyI6IDQsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDgsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltBcl0gM2QxMCA0czIgNHA2IgoJfSwKCSJSdWJpZGl1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMzcsCgkJIlN5bWJvbCI6ICJSYiIsCgkJIkF0b21pY01hc3MiOiA4NS40NjgsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA0OCwKCQkiTnVtYmVyb2ZQcm90b25zIjogMzcsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMzcsCgkJIlBlcmlvZCI6IDUsCgkJIkdyb3VwIjogMSwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkFsa2FsaSBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDMsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMC44MiwKCQkiRmlyc3RJb25pemF0aW9uIjogNC4xNzcxLAoJCSJEZW5zaXR5IjogMS41MywKCQkiTWVsdGluZ1BvaW50IjogMzEyLjc5LAoJCSJCb2lsaW5nUG9pbnQiOiA5NjEsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAyMCwKCQkiRGlzY292ZXJlciI6ICJCdW5zZW4gYW5kIEtpcmNob2ZmIiwKCQkiWWVhciI6IDE4NjEsCgkJIlNwZWNpZmljSGVhdCI6IDAuMzYzLAoJCSJOdW1iZXJvZlNoZWxscyI6IDUsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDEsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltLcl0gNXMxIgoJfSwKCSJTdHJvbnRpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDM4LAoJCSJTeW1ib2wiOiAiU3IiLAoJCSJBdG9taWNNYXNzIjogODcuNjIsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA1MCwKCQkiTnVtYmVyb2ZQcm90b25zIjogMzgsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMzgsCgkJIlBlcmlvZCI6IDUsCgkJIkdyb3VwIjogMiwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkFsa2FsaW5lIEVhcnRoIE1ldGFsIiwKCQkiQXRvbWljUmFkaXVzIjogMi41LAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDAuOTUsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDUuNjk0OSwKCQkiRGVuc2l0eSI6IDIuNjQsCgkJIk1lbHRpbmdQb2ludCI6IDEwNDIuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDE2NTUsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxOCwKCQkiRGlzY292ZXJlciI6ICJEYXZ5IiwKCQkiWWVhciI6IDE4MDgsCgkJIlNwZWNpZmljSGVhdCI6IDAuMzAxLAoJCSJOdW1iZXJvZlNoZWxscyI6IDUsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDIsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltLcl0gNXMyIgoJfSwKCSJZdHRyaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiAzOSwKCQkiU3ltYm9sIjogIlkiLAoJCSJBdG9taWNNYXNzIjogODguOTA2LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogNTAsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDM5LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDM5LAoJCSJQZXJpb2QiOiA1LAoJCSJHcm91cCI6IDMsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJUcmFuc2l0aW9uIE1ldGFsIiwKCQkiQXRvbWljUmFkaXVzIjogMi4zLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDEuMjIsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuMjE3MywKCQkiRGVuc2l0eSI6IDQuNDcsCgkJIk1lbHRpbmdQb2ludCI6IDE3OTkuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDM2MDksCgkJIk51bWJlck9mSXNvdG9wZXMiOiAyMSwKCQkiRGlzY292ZXJlciI6ICJHYWRvbGluIiwKCQkiWWVhciI6IDE3OTQsCgkJIlNwZWNpZmljSGVhdCI6IDAuMjk4LAoJCSJOdW1iZXJvZlNoZWxscyI6IDUsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltLcl0gNGQxIDVzMiIKCX0sCgkiWmlyY29uaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA0MCwKCQkiU3ltYm9sIjogIlpyIiwKCQkiQXRvbWljTWFzcyI6IDkxLjIyNCwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDUxLAoJCSJOdW1iZXJvZlByb3RvbnMiOiA0MCwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA0MCwKCQkiUGVyaW9kIjogNSwKCQkiR3JvdXAiOiA0LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDIuMiwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjMzLAoJCSJGaXJzdElvbml6YXRpb24iOiA2LjYzMzksCgkJIkRlbnNpdHkiOiA2LjUxLAoJCSJNZWx0aW5nUG9pbnQiOiAyMTI1LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiA0NjgyLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjAsCgkJIkRpc2NvdmVyZXIiOiAiS2xhcHJvdGgiLAoJCSJZZWFyIjogMTc4OSwKCQkiU3BlY2lmaWNIZWF0IjogMC4yNzgsCgkJIk51bWJlcm9mU2hlbGxzIjogNSwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0tyXSA0ZDIgNXMyIgoJfSwKCSJOaW9iaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA0MSwKCQkiU3ltYm9sIjogIk5iIiwKCQkiQXRvbWljTWFzcyI6IDkyLjkwNiwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDUyLAoJCSJOdW1iZXJvZlByb3RvbnMiOiA0MSwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA0MSwKCQkiUGVyaW9kIjogNSwKCQkiR3JvdXAiOiA1LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDIuMSwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjYsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuNzU4OSwKCQkiRGVuc2l0eSI6IDguNTcsCgkJIk1lbHRpbmdQb2ludCI6IDI3NDEuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDUwMTcsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAyNCwKCQkiRGlzY292ZXJlciI6ICJIYXRjaGV0dCIsCgkJIlllYXIiOiAxODAxLAoJCSJTcGVjaWZpY0hlYXQiOiAwLjI2NSwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA1LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbS3JdIDRkNCA1czEiCgl9LAoJIk1vbHliZGVudW0iOiB7CgkJIkF0b21pY051bWJlciI6IDQyLAoJCSJTeW1ib2wiOiAiTW8iLAoJCSJBdG9taWNNYXNzIjogOTUuOTYsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA1NCwKCQkiTnVtYmVyb2ZQcm90b25zIjogNDIsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNDIsCgkJIlBlcmlvZCI6IDUsCgkJIkdyb3VwIjogNiwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIlRyYW5zaXRpb24gTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAyLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDIuMTYsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDcuMDkyNCwKCQkiRGVuc2l0eSI6IDEwLjIsCgkJIk1lbHRpbmdQb2ludCI6IDI4OTAuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDQ5MTIsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAyMCwKCQkiRGlzY292ZXJlciI6ICJTY2hlZWxlIiwKCQkiWWVhciI6IDE3NzgsCgkJIlNwZWNpZmljSGVhdCI6IDAuMjUxLAoJCSJOdW1iZXJvZlNoZWxscyI6IDUsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltLcl0gNGQ1IDVzMSIKCX0sCgkiVGVjaG5ldGl1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogNDMsCgkJIlN5bWJvbCI6ICJUYyIsCgkJIkF0b21pY01hc3MiOiA5OCwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDU1LAoJCSJOdW1iZXJvZlByb3RvbnMiOiA0MywKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA0MywKCQkiUGVyaW9kIjogNSwKCQkiR3JvdXAiOiA3LAoJCSJQaGFzZSI6ICJhcnRpZmljaWFsIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6IG51bGwsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJUcmFuc2l0aW9uIE1ldGFsIiwKCQkiQXRvbWljUmFkaXVzIjogMiwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjksCgkJIkZpcnN0SW9uaXphdGlvbiI6IDcuMjgsCgkJIkRlbnNpdHkiOiAxMS41LAoJCSJNZWx0aW5nUG9pbnQiOiAyNDczLjE1LAoJCSJCb2lsaW5nUG9pbnQiOiA1MTUwLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjMsCgkJIkRpc2NvdmVyZXIiOiAiUGVycmllciBhbmQgU2Vncu+/vSIsCgkJIlllYXIiOiAxOTM3LAoJCSJTcGVjaWZpY0hlYXQiOiBudWxsLAoJCSJOdW1iZXJvZlNoZWxscyI6IDUsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltLcl0gNGQ1IDVzMiIKCX0sCgkiUnV0aGVuaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA0NCwKCQkiU3ltYm9sIjogIlJ1IiwKCQkiQXRvbWljTWFzcyI6IDEwMS4wNywKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDU3LAoJCSJOdW1iZXJvZlByb3RvbnMiOiA0NCwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA0NCwKCQkiUGVyaW9kIjogNSwKCQkiR3JvdXAiOiA4LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuOSwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAyLjIsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDcuMzYwNSwKCQkiRGVuc2l0eSI6IDEyLjQsCgkJIk1lbHRpbmdQb2ludCI6IDI1MjMuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDQ0MjMsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxNiwKCQkiRGlzY292ZXJlciI6ICJLbGF1cyIsCgkJIlllYXIiOiAxODQ0LAoJCSJTcGVjaWZpY0hlYXQiOiAwLjIzOCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA1LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbS3JdIDRkNyA1czEiCgl9LAoJIlJob2RpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDQ1LAoJCSJTeW1ib2wiOiAiUmgiLAoJCSJBdG9taWNNYXNzIjogMTAyLjkwNiwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDU4LAoJCSJOdW1iZXJvZlByb3RvbnMiOiA0NSwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA0NSwKCQkiUGVyaW9kIjogNSwKCQkiR3JvdXAiOiA5LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuOCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAyLjI4LAoJCSJGaXJzdElvbml6YXRpb24iOiA3LjQ1ODksCgkJIkRlbnNpdHkiOiAxMi40LAoJCSJNZWx0aW5nUG9pbnQiOiAyMjM5LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAzOTY4LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjAsCgkJIkRpc2NvdmVyZXIiOiAiV29sbGFzdG9uIiwKCQkiWWVhciI6IDE4MDMsCgkJIlNwZWNpZmljSGVhdCI6IDAuMjQzLAoJCSJOdW1iZXJvZlNoZWxscyI6IDUsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltLcl0gNGQ4IDVzMSIKCX0sCgkiUGFsbGFkaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA0NiwKCQkiU3ltYm9sIjogIlBkIiwKCQkiQXRvbWljTWFzcyI6IDEwNi40MiwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDYwLAoJCSJOdW1iZXJvZlByb3RvbnMiOiA0NiwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA0NiwKCQkiUGVyaW9kIjogNSwKCQkiR3JvdXAiOiAxMCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIlRyYW5zaXRpb24gTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjgsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMi4yLAoJCSJGaXJzdElvbml6YXRpb24iOiA4LjMzNjksCgkJIkRlbnNpdHkiOiAxMiwKCQkiTWVsdGluZ1BvaW50IjogMTgyNS4xNSwKCQkiQm9pbGluZ1BvaW50IjogMzIzNiwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDIxLAoJCSJEaXNjb3ZlcmVyIjogIldvbGxhc3RvbiIsCgkJIlllYXIiOiAxODAzLAoJCSJTcGVjaWZpY0hlYXQiOiAwLjI0NCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA1LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbS3JdIDRkMTAiCgl9LAoJIlNpbHZlciI6IHsKCQkiQXRvbWljTnVtYmVyIjogNDcsCgkJIlN5bWJvbCI6ICJBZyIsCgkJIkF0b21pY01hc3MiOiAxMDcuODY4LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogNjEsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDQ3LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDQ3LAoJCSJQZXJpb2QiOiA1LAoJCSJHcm91cCI6IDExLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuOCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjkzLAoJCSJGaXJzdElvbml6YXRpb24iOiA3LjU3NjIsCgkJIkRlbnNpdHkiOiAxMC41LAoJCSJNZWx0aW5nUG9pbnQiOiAxMjM0LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAyNDM1LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjcsCgkJIkRpc2NvdmVyZXIiOiAiUHJlaGlzdG9yaWMiLAoJCSJZZWFyIjogbnVsbCwKCQkiU3BlY2lmaWNIZWF0IjogMC4yMzUsCgkJIk51bWJlcm9mU2hlbGxzIjogNSwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0tyXSA0ZDEwIDVzMSIKCX0sCgkiQ2FkbWl1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogNDgsCgkJIlN5bWJvbCI6ICJDZCIsCgkJIkF0b21pY01hc3MiOiAxMTIuNDExLAoJCSJOdW1iZXJvZk5ldXRyb25zIjogNjQsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDQ4LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDQ4LAoJCSJQZXJpb2QiOiA1LAoJCSJHcm91cCI6IDEyLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuNywKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjY5LAoJCSJGaXJzdElvbml6YXRpb24iOiA4Ljk5MzgsCgkJIkRlbnNpdHkiOiA4LjY5LAoJCSJNZWx0aW5nUG9pbnQiOiA1OTQuMzMsCgkJIkJvaWxpbmdQb2ludCI6IDEwNDAsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAyMiwKCQkiRGlzY292ZXJlciI6ICJTdHJvbWV5ZXIiLAoJCSJZZWFyIjogMTgxNywKCQkiU3BlY2lmaWNIZWF0IjogMC4yMzIsCgkJIk51bWJlcm9mU2hlbGxzIjogNSwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0tyXSA0ZDEwIDVzMiIKCX0sCgkiSW5kaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA0OSwKCQkiU3ltYm9sIjogIkluIiwKCQkiQXRvbWljTWFzcyI6IDExNC44MTgsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA2NiwKCQkiTnVtYmVyb2ZQcm90b25zIjogNDksCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNDksCgkJIlBlcmlvZCI6IDUsCgkJIkdyb3VwIjogMTMsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDIsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS43OCwKCQkiRmlyc3RJb25pemF0aW9uIjogNS43ODY0LAoJCSJEZW5zaXR5IjogNy4zMSwKCQkiTWVsdGluZ1BvaW50IjogNDI5LjkxLAoJCSJCb2lsaW5nUG9pbnQiOiAyMzQ1LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMzQsCgkJIkRpc2NvdmVyZXIiOiAiUmVpY2ggYW5kIFJpY2h0ZXIiLAoJCSJZZWFyIjogMTg2MywKCQkiU3BlY2lmaWNIZWF0IjogMC4yMzMsCgkJIk51bWJlcm9mU2hlbGxzIjogNSwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogMywKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0tyXSA0ZDEwIDVzMiA1cDEiCgl9LAoJIlRpbiI6IHsKCQkiQXRvbWljTnVtYmVyIjogNTAsCgkJIlN5bWJvbCI6ICJTbiIsCgkJIkF0b21pY01hc3MiOiAxMTguNzEsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA2OSwKCQkiTnVtYmVyb2ZQcm90b25zIjogNTAsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNTAsCgkJIlBlcmlvZCI6IDUsCgkJIkdyb3VwIjogMTQsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuNywKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjk2LAoJCSJGaXJzdElvbml6YXRpb24iOiA3LjM0MzksCgkJIkRlbnNpdHkiOiA3LjI5LAoJCSJNZWx0aW5nUG9pbnQiOiA1MDUuMjEsCgkJIkJvaWxpbmdQb2ludCI6IDI4NzUsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAyOCwKCQkiRGlzY292ZXJlciI6ICJQcmVoaXN0b3JpYyIsCgkJIlllYXIiOiBudWxsLAoJCSJTcGVjaWZpY0hlYXQiOiAwLjIyOCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA1LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiA0LAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbS3JdIDRkMTAgNXMyIDVwMiIKCX0sCgkiQW50aW1vbnkiOiB7CgkJIkF0b21pY051bWJlciI6IDUxLAoJCSJTeW1ib2wiOiAiU2IiLAoJCSJBdG9taWNNYXNzIjogMTIxLjc2LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogNzEsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDUxLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDUxLAoJCSJQZXJpb2QiOiA1LAoJCSJHcm91cCI6IDE1LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6IG51bGwsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogInllcyIsCgkJIlR5cGUiOiAiTWV0YWxsb2lkIiwKCQkiQXRvbWljUmFkaXVzIjogMS41LAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDIuMDUsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDguNjA4NCwKCQkiRGVuc2l0eSI6IDYuNjksCgkJIk1lbHRpbmdQb2ludCI6IDkwNC4wNSwKCQkiQm9pbGluZ1BvaW50IjogMTg2MCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDI5LAoJCSJEaXNjb3ZlcmVyIjogIkVhcmx5IGhpc3RvcmljIHRpbWVzIiwKCQkiWWVhciI6IG51bGwsCgkJIlNwZWNpZmljSGVhdCI6IDAuMjA3LAoJCSJOdW1iZXJvZlNoZWxscyI6IDUsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDUsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltLcl0gNGQxMCA1czIgNXAzIgoJfSwKCSJUZWxsdXJpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDUyLAoJCSJTeW1ib2wiOiAiVGUiLAoJCSJBdG9taWNNYXNzIjogMTI3LjYsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA3NiwKCQkiTnVtYmVyb2ZQcm90b25zIjogNTIsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNTIsCgkJIlBlcmlvZCI6IDUsCgkJIkdyb3VwIjogMTYsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogbnVsbCwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiAieWVzIiwKCQkiVHlwZSI6ICJNZXRhbGxvaWQiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjQsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMi4xLAoJCSJGaXJzdElvbml6YXRpb24iOiA5LjAwOTYsCgkJIkRlbnNpdHkiOiA2LjIzLAoJCSJNZWx0aW5nUG9pbnQiOiA3MjIuOCwKCQkiQm9pbGluZ1BvaW50IjogMTI2MSwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDI5LAoJCSJEaXNjb3ZlcmVyIjogInZvbiBSZWljaGVuc3RlaW4iLAoJCSJZZWFyIjogMTc4MiwKCQkiU3BlY2lmaWNIZWF0IjogMC4yMDIsCgkJIk51bWJlcm9mU2hlbGxzIjogNSwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogNiwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0tyXSA0ZDEwIDVzMiA1cDQiCgl9LAoJIklvZGluZSI6IHsKCQkiQXRvbWljTnVtYmVyIjogNTMsCgkJIlN5bWJvbCI6ICJJIiwKCQkiQXRvbWljTWFzcyI6IDEyNi45MDQsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA3NCwKCQkiTnVtYmVyb2ZQcm90b25zIjogNTMsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNTMsCgkJIlBlcmlvZCI6IDUsCgkJIkdyb3VwIjogMTcsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogbnVsbCwKCQkiTm9ubWV0YWwiOiAieWVzIiwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJIYWxvZ2VuIiwKCQkiQXRvbWljUmFkaXVzIjogMS4zLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDIuNjYsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDEwLjQ1MTMsCgkJIkRlbnNpdHkiOiA0LjkzLAoJCSJNZWx0aW5nUG9pbnQiOiAzODYuNjUsCgkJIkJvaWxpbmdQb2ludCI6IDQ1Ny40LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjQsCgkJIkRpc2NvdmVyZXIiOiAiQ291cnRvaXMiLAoJCSJZZWFyIjogMTgxMSwKCQkiU3BlY2lmaWNIZWF0IjogMC4yMTQsCgkJIk51bWJlcm9mU2hlbGxzIjogNSwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogNywKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW0tyXSA0ZDEwIDVzMiA1cDUiCgl9LAoJIlhlbm9uIjogewoJCSJBdG9taWNOdW1iZXIiOiA1NCwKCQkiU3ltYm9sIjogIlhlIiwKCQkiQXRvbWljTWFzcyI6IDEzMS4yOTMsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA3NywKCQkiTnVtYmVyb2ZQcm90b25zIjogNTQsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNTQsCgkJIlBlcmlvZCI6IDUsCgkJIkdyb3VwIjogMTgsCgkJIlBoYXNlIjogImdhcyIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6IG51bGwsCgkJIk5vbm1ldGFsIjogInllcyIsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiTm9ibGUgR2FzIiwKCQkiQXRvbWljUmFkaXVzIjogMS4yLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IG51bGwsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDEyLjEyOTgsCgkJIkRlbnNpdHkiOiAwLjAwNTg5LAoJCSJNZWx0aW5nUG9pbnQiOiAxNjEuNDUsCgkJIkJvaWxpbmdQb2ludCI6IDE2NS4wMywKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDMxLAoJCSJEaXNjb3ZlcmVyIjogIlJhbXNheSBhbmQgVHJhdmVycyIsCgkJIlllYXIiOiAxODk4LAoJCSJTcGVjaWZpY0hlYXQiOiAwLjE1OCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA1LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiA4LAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbS3JdIDRkMTAgNXMyIDVwNiIKCX0sCgkiQ2VzaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA1NSwKCQkiU3ltYm9sIjogIkNzIiwKCQkiQXRvbWljTWFzcyI6IDEzMi45MDUsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA3OCwKCQkiTnVtYmVyb2ZQcm90b25zIjogNTUsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNTUsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogMSwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkFsa2FsaSBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDMuMywKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAwLjc5LAoJCSJGaXJzdElvbml6YXRpb24iOiAzLjg5MzksCgkJIkRlbnNpdHkiOiAxLjg3LAoJCSJNZWx0aW5nUG9pbnQiOiAzMDEuNywKCQkiQm9pbGluZ1BvaW50IjogOTQ0LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjIsCgkJIkRpc2NvdmVyZXIiOiAiQnVuc2VuIGFuZCBLaXJjaG9mZiIsCgkJIlllYXIiOiAxODYwLAoJCSJTcGVjaWZpY0hlYXQiOiAwLjI0MiwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA2LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiAxLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbWGVdIDZzMSIKCX0sCgkiQmFyaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA1NiwKCQkiU3ltYm9sIjogIkJhIiwKCQkiQXRvbWljTWFzcyI6IDEzNy4zMjcsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA4MSwKCQkiTnVtYmVyb2ZQcm90b25zIjogNTYsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNTYsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogMiwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkFsa2FsaW5lIEVhcnRoIE1ldGFsIiwKCQkiQXRvbWljUmFkaXVzIjogMi44LAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDAuODksCgkJIkZpcnN0SW9uaXphdGlvbiI6IDUuMjExNywKCQkiRGVuc2l0eSI6IDMuNTksCgkJIk1lbHRpbmdQb2ludCI6IDEwMDIuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDIxNzAsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAyNSwKCQkiRGlzY292ZXJlciI6ICJEYXZ5IiwKCQkiWWVhciI6IDE4MDgsCgkJIlNwZWNpZmljSGVhdCI6IDAuMjA0LAoJCSJOdW1iZXJvZlNoZWxscyI6IDYsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDIsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltYZV0gNnMyIgoJfSwKCSJMYW50aGFudW0iOiB7CgkJIkF0b21pY051bWJlciI6IDU3LAoJCSJTeW1ib2wiOiAiTGEiLAoJCSJBdG9taWNNYXNzIjogMTM4LjkwNSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDgyLAoJCSJOdW1iZXJvZlByb3RvbnMiOiA1NywKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA1NywKCQkiUGVyaW9kIjogNiwKCQkiR3JvdXAiOiAzLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiTGFudGhhbmlkZSIsCgkJIkF0b21pY1JhZGl1cyI6IDIuNywKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjEsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDUuNTc2OSwKCQkiRGVuc2l0eSI6IDYuMTUsCgkJIk1lbHRpbmdQb2ludCI6IDExOTMuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDM3MzcsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxOSwKCQkiRGlzY292ZXJlciI6ICJNb3NhbmRlciIsCgkJIlllYXIiOiAxODM5LAoJCSJTcGVjaWZpY0hlYXQiOiAwLjE5NSwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA2LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbWGVdIDVkMSA2czIiCgl9LAoJIkNlcml1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogNTgsCgkJIlN5bWJvbCI6ICJDZSIsCgkJIkF0b21pY01hc3MiOiAxNDAuMTE2LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogODIsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDU4LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDU4LAoJCSJQZXJpb2QiOiA2LAoJCSJHcm91cCI6IG51bGwsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJMYW50aGFuaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogMi43LAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDEuMTIsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDUuNTM4NywKCQkiRGVuc2l0eSI6IDYuNzcsCgkJIk1lbHRpbmdQb2ludCI6IDEwNzEuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDM3MTYsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxOSwKCQkiRGlzY292ZXJlciI6ICJCZXJ6ZWxpdXMiLAoJCSJZZWFyIjogMTgwMywKCQkiU3BlY2lmaWNIZWF0IjogMC4xOTIsCgkJIk51bWJlcm9mU2hlbGxzIjogNiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1hlXSA0ZjEgNWQxIDZzMiIKCX0sCgkiUHJhc2VvZHltaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA1OSwKCQkiU3ltYm9sIjogIlByIiwKCQkiQXRvbWljTWFzcyI6IDE0MC45MDgsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA4MiwKCQkiTnVtYmVyb2ZQcm90b25zIjogNTksCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNTksCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogbnVsbCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkxhbnRoYW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiAyLjcsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS4xMywKCQkiRmlyc3RJb25pemF0aW9uIjogNS40NzMsCgkJIkRlbnNpdHkiOiA2Ljc3LAoJCSJNZWx0aW5nUG9pbnQiOiAxMjA0LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAzNzkzLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTUsCgkJIkRpc2NvdmVyZXIiOiAidm9uIFdlbHNiYWNoIiwKCQkiWWVhciI6IDE4ODUsCgkJIlNwZWNpZmljSGVhdCI6IDAuMTkzLAoJCSJOdW1iZXJvZlNoZWxscyI6IDYsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltYZV0gNGYzIDZzMiIKCX0sCgkiTmVvZHltaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA2MCwKCQkiU3ltYm9sIjogIk5kIiwKCQkiQXRvbWljTWFzcyI6IDE0NC4yNDIsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA4NCwKCQkiTnVtYmVyb2ZQcm90b25zIjogNjAsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNjAsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogbnVsbCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkxhbnRoYW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiAyLjYsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS4xNCwKCQkiRmlyc3RJb25pemF0aW9uIjogNS41MjUsCgkJIkRlbnNpdHkiOiA3LjAxLAoJCSJNZWx0aW5nUG9pbnQiOiAxMjg5LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAzMzQ3LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTYsCgkJIkRpc2NvdmVyZXIiOiAidm9uIFdlbHNiYWNoIiwKCQkiWWVhciI6IDE4ODUsCgkJIlNwZWNpZmljSGVhdCI6IDAuMTksCgkJIk51bWJlcm9mU2hlbGxzIjogNiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1hlXSA0ZjQgNnMyIgoJfSwKCSJQcm9tZXRoaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA2MSwKCQkiU3ltYm9sIjogIlBtIiwKCQkiQXRvbWljTWFzcyI6IDE0NSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDg0LAoJCSJOdW1iZXJvZlByb3RvbnMiOiA2MSwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA2MSwKCQkiUGVyaW9kIjogNiwKCQkiR3JvdXAiOiBudWxsLAoJCSJQaGFzZSI6ICJhcnRpZmljaWFsIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6IG51bGwsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJMYW50aGFuaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogMi42LAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDEuMTMsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDUuNTgyLAoJCSJEZW5zaXR5IjogNy4yNiwKCQkiTWVsdGluZ1BvaW50IjogMTIwNC4xNSwKCQkiQm9pbGluZ1BvaW50IjogMzI3MywKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDE0LAoJCSJEaXNjb3ZlcmVyIjogIk1hcmluc2t5IGV0IGFsLiIsCgkJIlllYXIiOiAxOTQ1LAoJCSJTcGVjaWZpY0hlYXQiOiBudWxsLAoJCSJOdW1iZXJvZlNoZWxscyI6IDYsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltYZV0gNGY1IDZzMiIKCX0sCgkiU2FtYXJpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDYyLAoJCSJTeW1ib2wiOiAiU20iLAoJCSJBdG9taWNNYXNzIjogMTUwLjM2LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogODgsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDYyLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDYyLAoJCSJQZXJpb2QiOiA2LAoJCSJHcm91cCI6IG51bGwsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJMYW50aGFuaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogMi42LAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDEuMTcsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDUuNjQzNywKCQkiRGVuc2l0eSI6IDcuNTIsCgkJIk1lbHRpbmdQb2ludCI6IDEzNDUuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDIwNjcsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxNywKCQkiRGlzY292ZXJlciI6ICJCb2lzYmF1ZHJhbiIsCgkJIlllYXIiOiAxODc5LAoJCSJTcGVjaWZpY0hlYXQiOiAwLjE5NywKCQkiTnVtYmVyb2ZTaGVsbHMiOiA2LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbWGVdIDRmNiA2czIiCgl9LAoJIkV1cm9waXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA2MywKCQkiU3ltYm9sIjogIkV1IiwKCQkiQXRvbWljTWFzcyI6IDE1MS45NjQsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA4OSwKCQkiTnVtYmVyb2ZQcm90b25zIjogNjMsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNjMsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogbnVsbCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkxhbnRoYW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiAyLjYsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS4yLAoJCSJGaXJzdElvbml6YXRpb24iOiA1LjY3MDQsCgkJIkRlbnNpdHkiOiA1LjI0LAoJCSJNZWx0aW5nUG9pbnQiOiAxMDk1LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAxODAyLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjEsCgkJIkRpc2NvdmVyZXIiOiAiRGVtYXJjYXkiLAoJCSJZZWFyIjogMTkwMSwKCQkiU3BlY2lmaWNIZWF0IjogMC4xODIsCgkJIk51bWJlcm9mU2hlbGxzIjogNiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1hlXSA0ZjcgNnMyIgoJfSwKCSJHYWRvbGluaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA2NCwKCQkiU3ltYm9sIjogIkdkIiwKCQkiQXRvbWljTWFzcyI6IDE1Ny4yNSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDkzLAoJCSJOdW1iZXJvZlByb3RvbnMiOiA2NCwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA2NCwKCQkiUGVyaW9kIjogNiwKCQkiR3JvdXAiOiBudWxsLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiTGFudGhhbmlkZSIsCgkJIkF0b21pY1JhZGl1cyI6IDIuNSwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjIsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuMTUwMSwKCQkiRGVuc2l0eSI6IDcuOSwKCQkiTWVsdGluZ1BvaW50IjogMTU4NS4xNSwKCQkiQm9pbGluZ1BvaW50IjogMzU0NiwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDE3LAoJCSJEaXNjb3ZlcmVyIjogImRlIE1hcmlnbmFjIiwKCQkiWWVhciI6IDE4ODAsCgkJIlNwZWNpZmljSGVhdCI6IDAuMjM2LAoJCSJOdW1iZXJvZlNoZWxscyI6IDYsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltYZV0gNGY3IDVkMSA2czIiCgl9LAoJIlRlcmJpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDY1LAoJCSJTeW1ib2wiOiAiVGIiLAoJCSJBdG9taWNNYXNzIjogMTU4LjkyNSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDk0LAoJCSJOdW1iZXJvZlByb3RvbnMiOiA2NSwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA2NSwKCQkiUGVyaW9kIjogNiwKCQkiR3JvdXAiOiBudWxsLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiTGFudGhhbmlkZSIsCgkJIkF0b21pY1JhZGl1cyI6IDIuNSwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjIsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDUuODYzOCwKCQkiRGVuc2l0eSI6IDguMjMsCgkJIk1lbHRpbmdQb2ludCI6IDE2MzAuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDM1MDMsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAyNCwKCQkiRGlzY292ZXJlciI6ICJNb3NhbmRlciIsCgkJIlllYXIiOiAxODQzLAoJCSJTcGVjaWZpY0hlYXQiOiAwLjE4MiwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA2LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbWGVdIDRmOSA2czIiCgl9LAoJIkR5c3Byb3NpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDY2LAoJCSJTeW1ib2wiOiAiRHkiLAoJCSJBdG9taWNNYXNzIjogMTYyLjUsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA5NywKCQkiTnVtYmVyb2ZQcm90b25zIjogNjYsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNjYsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogbnVsbCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkxhbnRoYW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiAyLjUsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS4yMiwKCQkiRmlyc3RJb25pemF0aW9uIjogNS45Mzg5LAoJCSJEZW5zaXR5IjogOC41NSwKCQkiTWVsdGluZ1BvaW50IjogMTY4MC4xNSwKCQkiQm9pbGluZ1BvaW50IjogMjg0MCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDIxLAoJCSJEaXNjb3ZlcmVyIjogImRlIEJvaXNiYXVkcmFuIiwKCQkiWWVhciI6IDE4ODYsCgkJIlNwZWNpZmljSGVhdCI6IDAuMTcsCgkJIk51bWJlcm9mU2hlbGxzIjogNiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1hlXSA0ZjEwIDZzMiIKCX0sCgkiSG9sbWl1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogNjcsCgkJIlN5bWJvbCI6ICJIbyIsCgkJIkF0b21pY01hc3MiOiAxNjQuOTMsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiA5OCwKCQkiTnVtYmVyb2ZQcm90b25zIjogNjcsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNjcsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogbnVsbCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkxhbnRoYW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiAyLjUsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS4yMywKCQkiRmlyc3RJb25pemF0aW9uIjogNi4wMjE1LAoJCSJEZW5zaXR5IjogOC44LAoJCSJNZWx0aW5nUG9pbnQiOiAxNzQzLjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAyOTkzLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjksCgkJIkRpc2NvdmVyZXIiOiAiRGVsYWZvbnRhaW5lIGFuZCBTb3JldCIsCgkJIlllYXIiOiAxODc4LAoJCSJTcGVjaWZpY0hlYXQiOiAwLjE2NSwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA2LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbWGVdIDRmMTEgNnMyIgoJfSwKCSJFcmJpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDY4LAoJCSJTeW1ib2wiOiAiRXIiLAoJCSJBdG9taWNNYXNzIjogMTY3LjI1OSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDk5LAoJCSJOdW1iZXJvZlByb3RvbnMiOiA2OCwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA2OCwKCQkiUGVyaW9kIjogNiwKCQkiR3JvdXAiOiBudWxsLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiTGFudGhhbmlkZSIsCgkJIkF0b21pY1JhZGl1cyI6IDIuNSwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjI0LAoJCSJGaXJzdElvbml6YXRpb24iOiA2LjEwNzcsCgkJIkRlbnNpdHkiOiA5LjA3LAoJCSJNZWx0aW5nUG9pbnQiOiAxNzk1LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAzNTAzLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTYsCgkJIkRpc2NvdmVyZXIiOiAiTW9zYW5kZXIiLAoJCSJZZWFyIjogMTg0MywKCQkiU3BlY2lmaWNIZWF0IjogMC4xNjgsCgkJIk51bWJlcm9mU2hlbGxzIjogNiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1hlXSA0ZjEyIDZzMiIKCX0sCgkiVGh1bGl1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogNjksCgkJIlN5bWJvbCI6ICJUbSIsCgkJIkF0b21pY01hc3MiOiAxNjguOTM0LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTAwLAoJCSJOdW1iZXJvZlByb3RvbnMiOiA2OSwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA2OSwKCQkiUGVyaW9kIjogNiwKCQkiR3JvdXAiOiBudWxsLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiTGFudGhhbmlkZSIsCgkJIkF0b21pY1JhZGl1cyI6IDIuNCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjI1LAoJCSJGaXJzdElvbml6YXRpb24iOiA2LjE4NDMsCgkJIkRlbnNpdHkiOiA5LjMyLAoJCSJNZWx0aW5nUG9pbnQiOiAxODE4LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAyMjIzLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTgsCgkJIkRpc2NvdmVyZXIiOiAiQ2xldmUiLAoJCSJZZWFyIjogMTg3OSwKCQkiU3BlY2lmaWNIZWF0IjogMC4xNiwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA2LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbWGVdIDRmMTMgNnMyIgoJfSwKCSJZdHRlcmJpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDcwLAoJCSJTeW1ib2wiOiAiWWIiLAoJCSJBdG9taWNNYXNzIjogMTczLjA1NCwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDEwMywKCQkiTnVtYmVyb2ZQcm90b25zIjogNzAsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNzAsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogbnVsbCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkxhbnRoYW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiAyLjQsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS4xLAoJCSJGaXJzdElvbml6YXRpb24iOiA2LjI1NDIsCgkJIkRlbnNpdHkiOiA2Ljk3LAoJCSJNZWx0aW5nUG9pbnQiOiAxMDk3LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAxNDY5LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTYsCgkJIkRpc2NvdmVyZXIiOiAiTWFyaWduYWMiLAoJCSJZZWFyIjogMTg3OCwKCQkiU3BlY2lmaWNIZWF0IjogMC4xNTUsCgkJIk51bWJlcm9mU2hlbGxzIjogNiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1hlXSA0ZjE0IDZzMiIKCX0sCgkiTHV0ZXRpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDcxLAoJCSJTeW1ib2wiOiAiTHUiLAoJCSJBdG9taWNNYXNzIjogMTc0Ljk2NywKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDEwNCwKCQkiTnVtYmVyb2ZQcm90b25zIjogNzEsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNzEsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogbnVsbCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkxhbnRoYW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiAyLjMsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS4yNywKCQkiRmlyc3RJb25pemF0aW9uIjogNS40MjU5LAoJCSJEZW5zaXR5IjogOS44NCwKCQkiTWVsdGluZ1BvaW50IjogMTkzNi4xNSwKCQkiQm9pbGluZ1BvaW50IjogMzY3NSwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDIyLAoJCSJEaXNjb3ZlcmVyIjogIlVyYmFpbi8gdm9uIFdlbHNiYWNoIiwKCQkiWWVhciI6IDE5MDcsCgkJIlNwZWNpZmljSGVhdCI6IDAuMTU0LAoJCSJOdW1iZXJvZlNoZWxscyI6IDYsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltYZV0gNGYxNCA1ZDEgNnMyIgoJfSwKCSJIYWZuaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA3MiwKCQkiU3ltYm9sIjogIkhmIiwKCQkiQXRvbWljTWFzcyI6IDE3OC40OSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDEwNiwKCQkiTnVtYmVyb2ZQcm90b25zIjogNzIsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNzIsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogNCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIlRyYW5zaXRpb24gTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAyLjIsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS4zLAoJCSJGaXJzdElvbml6YXRpb24iOiA2LjgyNTEsCgkJIkRlbnNpdHkiOiAxMy4zLAoJCSJNZWx0aW5nUG9pbnQiOiAyNTAwLjE1LAoJCSJCb2lsaW5nUG9pbnQiOiA0ODc2LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTcsCgkJIkRpc2NvdmVyZXIiOiAiQ29zdGVyIGFuZCB2b24gSGV2ZXN5IiwKCQkiWWVhciI6IDE5MjMsCgkJIlNwZWNpZmljSGVhdCI6IDAuMTQ0LAoJCSJOdW1iZXJvZlNoZWxscyI6IDYsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltYZV0gNGYxNCA1ZDIgNnMyIgoJfSwKCSJUYW50YWx1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogNzMsCgkJIlN5bWJvbCI6ICJUYSIsCgkJIkF0b21pY01hc3MiOiAxODAuOTQ4LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTA4LAoJCSJOdW1iZXJvZlByb3RvbnMiOiA3MywKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA3MywKCQkiUGVyaW9kIjogNiwKCQkiR3JvdXAiOiA1LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDIuMSwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjUsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDcuNTQ5NiwKCQkiRGVuc2l0eSI6IDE2LjcsCgkJIk1lbHRpbmdQb2ludCI6IDMyNjkuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDU3MzEsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxOSwKCQkiRGlzY292ZXJlciI6ICJFa2ViZXJnIiwKCQkiWWVhciI6IDE4MDEsCgkJIlNwZWNpZmljSGVhdCI6IDAuMTQsCgkJIk51bWJlcm9mU2hlbGxzIjogNiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1hlXSA0ZjE0IDVkMyA2czIiCgl9LAoJIlR1bmdzdGVuIjogewoJCSJBdG9taWNOdW1iZXIiOiA3NCwKCQkiU3ltYm9sIjogIlciLAoJCSJBdG9taWNNYXNzIjogMTgzLjg0LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTEwLAoJCSJOdW1iZXJvZlByb3RvbnMiOiA3NCwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA3NCwKCQkiUGVyaW9kIjogNiwKCQkiR3JvdXAiOiA2LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDIsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMi4zNiwKCQkiRmlyc3RJb25pemF0aW9uIjogNy44NjQsCgkJIkRlbnNpdHkiOiAxOS4zLAoJCSJNZWx0aW5nUG9pbnQiOiAzNjgwLjE1LAoJCSJCb2lsaW5nUG9pbnQiOiA1ODI4LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjIsCgkJIkRpc2NvdmVyZXIiOiAiSi4gYW5kIEYuIGQnRWxodXlhciIsCgkJIlllYXIiOiAxNzgzLAoJCSJTcGVjaWZpY0hlYXQiOiAwLjEzMiwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA2LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbWGVdIDRmMTQgNWQ0IDZzMiIKCX0sCgkiUmhlbml1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogNzUsCgkJIlN5bWJvbCI6ICJSZSIsCgkJIkF0b21pY01hc3MiOiAxODYuMjA3LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTExLAoJCSJOdW1iZXJvZlByb3RvbnMiOiA3NSwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA3NSwKCQkiUGVyaW9kIjogNiwKCQkiR3JvdXAiOiA3LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDIsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS45LAoJCSJGaXJzdElvbml6YXRpb24iOiA3LjgzMzUsCgkJIkRlbnNpdHkiOiAyMSwKCQkiTWVsdGluZ1BvaW50IjogMzQ1My4xNSwKCQkiQm9pbGluZ1BvaW50IjogNTg2OSwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDIxLAoJCSJEaXNjb3ZlcmVyIjogIk5vZGRhY2ssIEJlcmcsIGFuZCBUYWNrZSIsCgkJIlllYXIiOiAxOTI1LAoJCSJTcGVjaWZpY0hlYXQiOiAwLjEzNywKCQkiTnVtYmVyb2ZTaGVsbHMiOiA2LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbWGVdIDRmMTQgNWQ1IDZzMiIKCX0sCgkiT3NtaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA3NiwKCQkiU3ltYm9sIjogIk9zIiwKCQkiQXRvbWljTWFzcyI6IDE5MC4yMywKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDExNCwKCQkiTnVtYmVyb2ZQcm90b25zIjogNzYsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNzYsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogOCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6IG51bGwsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIlRyYW5zaXRpb24gTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjksCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMi4yLAoJCSJGaXJzdElvbml6YXRpb24iOiA4LjQzODIsCgkJIkRlbnNpdHkiOiAyMi42LAoJCSJNZWx0aW5nUG9pbnQiOiAzMzAwLjE1LAoJCSJCb2lsaW5nUG9pbnQiOiA1Mjg1LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTksCgkJIkRpc2NvdmVyZXIiOiAiVGVubmFudCIsCgkJIlllYXIiOiAxODAzLAoJCSJTcGVjaWZpY0hlYXQiOiAwLjEzLAoJCSJOdW1iZXJvZlNoZWxscyI6IDYsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltYZV0gNGYxNCA1ZDYgNnMyIgoJfSwKCSJJcmlkaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA3NywKCQkiU3ltYm9sIjogIklyIiwKCQkiQXRvbWljTWFzcyI6IDE5Mi4yMTcsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxMTUsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDc3LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDc3LAoJCSJQZXJpb2QiOiA2LAoJCSJHcm91cCI6IDksCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJUcmFuc2l0aW9uIE1ldGFsIiwKCQkiQXRvbWljUmFkaXVzIjogMS45LAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDIuMiwKCQkiRmlyc3RJb25pemF0aW9uIjogOC45NjcsCgkJIkRlbnNpdHkiOiAyMi42LAoJCSJNZWx0aW5nUG9pbnQiOiAyNzE2LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiA0NzAxLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjUsCgkJIkRpc2NvdmVyZXIiOiAiVGVubmFudCIsCgkJIlllYXIiOiAxODA0LAoJCSJTcGVjaWZpY0hlYXQiOiAwLjEzMSwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA2LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbWGVdIDRmMTQgNWQ3IDZzMiIKCX0sCgkiUGxhdGludW0iOiB7CgkJIkF0b21pY051bWJlciI6IDc4LAoJCSJTeW1ib2wiOiAiUHQiLAoJCSJBdG9taWNNYXNzIjogMTk1LjA4NCwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDExNywKCQkiTnVtYmVyb2ZQcm90b25zIjogNzgsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogNzgsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogMTAsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJUcmFuc2l0aW9uIE1ldGFsIiwKCQkiQXRvbWljUmFkaXVzIjogMS44LAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDIuMjgsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDguOTU4NywKCQkiRGVuc2l0eSI6IDIxLjUsCgkJIk1lbHRpbmdQb2ludCI6IDIwNDUuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDQwOTgsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAzMiwKCQkiRGlzY292ZXJlciI6ICJVbGxvYS9Xb29kIiwKCQkiWWVhciI6IDE3MzUsCgkJIlNwZWNpZmljSGVhdCI6IDAuMTMzLAoJCSJOdW1iZXJvZlNoZWxscyI6IDYsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltYZV0gNGYxNCA1ZDkgNnMxIgoJfSwKCSJHb2xkIjogewoJCSJBdG9taWNOdW1iZXIiOiA3OSwKCQkiU3ltYm9sIjogIkF1IiwKCQkiQXRvbWljTWFzcyI6IDE5Ni45NjcsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxMTgsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDc5LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDc5LAoJCSJQZXJpb2QiOiA2LAoJCSJHcm91cCI6IDExLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuOCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAyLjU0LAoJCSJGaXJzdElvbml6YXRpb24iOiA5LjIyNTUsCgkJIkRlbnNpdHkiOiAxOS4zLAoJCSJNZWx0aW5nUG9pbnQiOiAxMzM3LjczLAoJCSJCb2lsaW5nUG9pbnQiOiAzMTI5LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjEsCgkJIkRpc2NvdmVyZXIiOiAiUHJlaGlzdG9yaWMiLAoJCSJZZWFyIjogbnVsbCwKCQkiU3BlY2lmaWNIZWF0IjogMC4xMjksCgkJIk51bWJlcm9mU2hlbGxzIjogNiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1hlXSA0ZjE0IDVkMTAgNnMxIgoJfSwKCSJNZXJjdXJ5IjogewoJCSJBdG9taWNOdW1iZXIiOiA4MCwKCQkiU3ltYm9sIjogIkhnIiwKCQkiQXRvbWljTWFzcyI6IDIwMC41OSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDEyMSwKCQkiTnVtYmVyb2ZQcm90b25zIjogODAsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogODAsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogMTIsCgkJIlBoYXNlIjogImxpcSIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNpdGlvbiBNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDEuOCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAyLAoJCSJGaXJzdElvbml6YXRpb24iOiAxMC40Mzc1LAoJCSJEZW5zaXR5IjogMTMuNSwKCQkiTWVsdGluZ1BvaW50IjogMjM0LjQzLAoJCSJCb2lsaW5nUG9pbnQiOiA2MzAsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAyNiwKCQkiRGlzY292ZXJlciI6ICJQcmVoaXN0b3JpYyIsCgkJIlllYXIiOiBudWxsLAoJCSJTcGVjaWZpY0hlYXQiOiAwLjE0LAoJCSJOdW1iZXJvZlNoZWxscyI6IDYsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltYZV0gNGYxNCA1ZDEwIDZzMiIKCX0sCgkiVGhhbGxpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDgxLAoJCSJTeW1ib2wiOiAiVGwiLAoJCSJBdG9taWNNYXNzIjogMjA0LjM4MywKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDEyMywKCQkiTnVtYmVyb2ZQcm90b25zIjogODEsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogODEsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogMTMsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiBudWxsLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJNZXRhbCIsCgkJIkF0b21pY1JhZGl1cyI6IDIuMSwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAyLjA0LAoJCSJGaXJzdElvbml6YXRpb24iOiA2LjEwODIsCgkJIkRlbnNpdHkiOiAxMS45LAoJCSJNZWx0aW5nUG9pbnQiOiA1NzcuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDE3NDYsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAyOCwKCQkiRGlzY292ZXJlciI6ICJDcm9va2VzIiwKCQkiWWVhciI6IDE4NjEsCgkJIlNwZWNpZmljSGVhdCI6IDAuMTI5LAoJCSJOdW1iZXJvZlNoZWxscyI6IDYsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDMsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltYZV0gNGYxNCA1ZDEwIDZzMiA2cDEiCgl9LAoJIkxlYWQiOiB7CgkJIkF0b21pY051bWJlciI6IDgyLAoJCSJTeW1ib2wiOiAiUGIiLAoJCSJBdG9taWNNYXNzIjogMjA3LjIsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxMjUsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDgyLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDgyLAoJCSJQZXJpb2QiOiA2LAoJCSJHcm91cCI6IDE0LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjgsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMi4zMywKCQkiRmlyc3RJb25pemF0aW9uIjogNy40MTY3LAoJCSJEZW5zaXR5IjogMTEuMywKCQkiTWVsdGluZ1BvaW50IjogNjAwLjc1LAoJCSJCb2lsaW5nUG9pbnQiOiAyMDIyLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjksCgkJIkRpc2NvdmVyZXIiOiAiUHJlaGlzdG9yaWMiLAoJCSJZZWFyIjogbnVsbCwKCQkiU3BlY2lmaWNIZWF0IjogMC4xMjksCgkJIk51bWJlcm9mU2hlbGxzIjogNiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogNCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1hlXSA0ZjE0IDVkMTAgNnMyIDZwMiIKCX0sCgkiQmlzbXV0aCI6IHsKCQkiQXRvbWljTnVtYmVyIjogODMsCgkJIlN5bWJvbCI6ICJCaSIsCgkJIkF0b21pY01hc3MiOiAyMDguOTgsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxMjYsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDgzLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDgzLAoJCSJQZXJpb2QiOiA2LAoJCSJHcm91cCI6IDE1LAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogbnVsbCwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjYsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMi4wMiwKCQkiRmlyc3RJb25pemF0aW9uIjogNy4yODU2LAoJCSJEZW5zaXR5IjogOS44MSwKCQkiTWVsdGluZ1BvaW50IjogNTQ0LjY3LAoJCSJCb2lsaW5nUG9pbnQiOiAxODM3LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTksCgkJIkRpc2NvdmVyZXIiOiAiR2VvZmZyb3kgdGhlIFlvdW5nZXIiLAoJCSJZZWFyIjogMTc1MywKCQkiU3BlY2lmaWNIZWF0IjogMC4xMjIsCgkJIk51bWJlcm9mU2hlbGxzIjogNiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogNSwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1hlXSA0ZjE0IDVkMTAgNnMyIDZwMyIKCX0sCgkiUG9sb25pdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDg0LAoJCSJTeW1ib2wiOiAiUG8iLAoJCSJBdG9taWNNYXNzIjogMjEwLAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTI2LAoJCSJOdW1iZXJvZlByb3RvbnMiOiA4NCwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA4NCwKCQkiUGVyaW9kIjogNiwKCQkiR3JvdXAiOiAxNiwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogbnVsbCwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiAieWVzIiwKCQkiVHlwZSI6ICJNZXRhbGxvaWQiLAoJCSJBdG9taWNSYWRpdXMiOiAxLjUsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMiwKCQkiRmlyc3RJb25pemF0aW9uIjogOC40MTcsCgkJIkRlbnNpdHkiOiA5LjMyLAoJCSJNZWx0aW5nUG9pbnQiOiA1MjcuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDEyMzUsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAzNCwKCQkiRGlzY292ZXJlciI6ICJDdXJpZSIsCgkJIlllYXIiOiAxODk4LAoJCSJTcGVjaWZpY0hlYXQiOiBudWxsLAoJCSJOdW1iZXJvZlNoZWxscyI6IDYsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDYsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltYZV0gNGYxNCA1ZDEwIDZzMiA2cDQiCgl9LAoJIkFzdGF0aW5lIjogewoJCSJBdG9taWNOdW1iZXIiOiA4NSwKCQkiU3ltYm9sIjogIkF0IiwKCQkiQXRvbWljTWFzcyI6IDIxMCwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDEyNSwKCQkiTnVtYmVyb2ZQcm90b25zIjogODUsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogODUsCgkJIlBlcmlvZCI6IDYsCgkJIkdyb3VwIjogMTcsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6IG51bGwsCgkJIk5vbm1ldGFsIjogInllcyIsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiTm9ibGUgR2FzIiwKCQkiQXRvbWljUmFkaXVzIjogMS40LAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDIuMiwKCQkiRmlyc3RJb25pemF0aW9uIjogOS4zLAoJCSJEZW5zaXR5IjogNywKCQkiTWVsdGluZ1BvaW50IjogNTc1LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiA2MTAsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAyMSwKCQkiRGlzY292ZXJlciI6ICJDb3Jzb24gZXQgYWwuIiwKCQkiWWVhciI6IDE5NDAsCgkJIlNwZWNpZmljSGVhdCI6IG51bGwsCgkJIk51bWJlcm9mU2hlbGxzIjogNiwKCQkiTnVtYmVyb2ZWYWxlbmNlIjogNywKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1hlXSA0ZjE0IDVkMTAgNnMyIDZwNSIKCX0sCgkiUmFkb24iOiB7CgkJIkF0b21pY051bWJlciI6IDg2LAoJCSJTeW1ib2wiOiAiUm4iLAoJCSJBdG9taWNNYXNzIjogMjIyLAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTM2LAoJCSJOdW1iZXJvZlByb3RvbnMiOiA4NiwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA4NiwKCQkiUGVyaW9kIjogNiwKCQkiR3JvdXAiOiAxOCwKCQkiUGhhc2UiOiAiZ2FzIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiQWxrYWxpIE1ldGFsIiwKCQkiQXRvbWljUmFkaXVzIjogMS4zLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IG51bGwsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDEwLjc0ODUsCgkJIkRlbnNpdHkiOiAwLjAwOTczLAoJCSJNZWx0aW5nUG9pbnQiOiAyMDIuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDIxMS4zLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjAsCgkJIkRpc2NvdmVyZXIiOiAiRG9ybiIsCgkJIlllYXIiOiAxOTAwLAoJCSJTcGVjaWZpY0hlYXQiOiAwLjA5NCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA2LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiA4LAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbWGVdIDRmMTQgNWQxMCA2czIgNnA2IgoJfSwKCSJGcmFuY2l1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogODcsCgkJIlN5bWJvbCI6ICJGciIsCgkJIkF0b21pY01hc3MiOiAyMjMsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxMzYsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDg3LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDg3LAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IDEsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiQWxrYWxpbmUgRWFydGggTWV0YWwiLAoJCSJBdG9taWNSYWRpdXMiOiBudWxsLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDAuNywKCQkiRmlyc3RJb25pemF0aW9uIjogNC4wNzI3LAoJCSJEZW5zaXR5IjogMS44NywKCQkiTWVsdGluZ1BvaW50IjogMzAwLjE1LAoJCSJCb2lsaW5nUG9pbnQiOiA5NTAsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAyMSwKCQkiRGlzY292ZXJlciI6ICJQZXJleSIsCgkJIlllYXIiOiAxOTM5LAoJCSJTcGVjaWZpY0hlYXQiOiBudWxsLAoJCSJOdW1iZXJvZlNoZWxscyI6IDcsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDEsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltSbl0gN3MxIgoJfSwKCSJSYWRpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDg4LAoJCSJTeW1ib2wiOiAiUmEiLAoJCSJBdG9taWNNYXNzIjogMjI2LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTM4LAoJCSJOdW1iZXJvZlByb3RvbnMiOiA4OCwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA4OCwKCQkiUGVyaW9kIjogNywKCQkiR3JvdXAiOiAyLAoJCSJQaGFzZSI6ICJzb2xpZCIsCgkJIlJhZGlvYWN0aXZlIjogInllcyIsCgkJIk5hdHVyYWwiOiAieWVzIiwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkFjdGluaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAwLjksCgkJIkZpcnN0SW9uaXphdGlvbiI6IDUuMjc4NCwKCQkiRGVuc2l0eSI6IDUuNSwKCQkiTWVsdGluZ1BvaW50IjogOTczLjE1LAoJCSJCb2lsaW5nUG9pbnQiOiAyMDEwLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTUsCgkJIkRpc2NvdmVyZXIiOiAiUGllcnJlIGFuZCBNYXJpZSBDdXJpZSIsCgkJIlllYXIiOiAxODk4LAoJCSJTcGVjaWZpY0hlYXQiOiBudWxsLAoJCSJOdW1iZXJvZlNoZWxscyI6IDcsCgkJIk51bWJlcm9mVmFsZW5jZSI6IDIsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltSbl0gN3MyIgoJfSwKCSJBY3Rpbml1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogODksCgkJIlN5bWJvbCI6ICJBYyIsCgkJIkF0b21pY01hc3MiOiAyMjcsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxMzgsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDg5LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDg5LAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IDMsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiQWN0aW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiBudWxsLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDEuMSwKCQkiRmlyc3RJb25pemF0aW9uIjogNS4xNywKCQkiRGVuc2l0eSI6IDEwLjEsCgkJIk1lbHRpbmdQb2ludCI6IDEzMjMuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDM0NzEsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxMSwKCQkiRGlzY292ZXJlciI6ICJEZWJpZXJuZS9HaWVzZWwiLAoJCSJZZWFyIjogMTg5OSwKCQkiU3BlY2lmaWNIZWF0IjogMC4xMiwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDZkMSA3czIiCgl9LAoJIlRob3JpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDkwLAoJCSJTeW1ib2wiOiAiVGgiLAoJCSJBdG9taWNNYXNzIjogMjMyLjAzOCwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDE0MiwKCQkiTnVtYmVyb2ZQcm90b25zIjogOTAsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogOTAsCgkJIlBlcmlvZCI6IDcsCgkJIkdyb3VwIjogbnVsbCwKCQkiUGhhc2UiOiAic29saWQiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogInllcyIsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJBY3RpbmlkZSIsCgkJIkF0b21pY1JhZGl1cyI6IG51bGwsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS4zLAoJCSJGaXJzdElvbml6YXRpb24iOiA2LjMwNjcsCgkJIkRlbnNpdHkiOiAxMS43LAoJCSJNZWx0aW5nUG9pbnQiOiAyMDI4LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiA1MDYxLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTIsCgkJIkRpc2NvdmVyZXIiOiAiQmVyemVsaXVzIiwKCQkiWWVhciI6IDE4MjgsCgkJIlNwZWNpZmljSGVhdCI6IDAuMTEzLAoJCSJOdW1iZXJvZlNoZWxscyI6IDcsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltSbl0gNmQyIDdzMiIKCX0sCgkiUHJvdGFjdGluaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA5MSwKCQkiU3ltYm9sIjogIlBhIiwKCQkiQXRvbWljTWFzcyI6IDIzMS4wMzYsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxNDAsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDkxLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDkxLAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IG51bGwsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiQWN0aW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiBudWxsLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDEuNSwKCQkiRmlyc3RJb25pemF0aW9uIjogNS44OSwKCQkiRGVuc2l0eSI6IDE1LjQsCgkJIk1lbHRpbmdQb2ludCI6IDE4NzMuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDQzMDAsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxNCwKCQkiRGlzY292ZXJlciI6ICJIYWhuIGFuZCBNZWl0bmVyIiwKCQkiWWVhciI6IDE5MTcsCgkJIlNwZWNpZmljSGVhdCI6IG51bGwsCgkJIk51bWJlcm9mU2hlbGxzIjogNywKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1JuXSA1ZjIgNmQxIDdzMiIKCX0sCgkiVXJhbml1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogOTIsCgkJIlN5bWJvbCI6ICJVIiwKCQkiQXRvbWljTWFzcyI6IDIzOC4wMjksCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxNDYsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDkyLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDkyLAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IG51bGwsCgkJIlBoYXNlIjogInNvbGlkIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6ICJ5ZXMiLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiQWN0aW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiBudWxsLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDEuMzgsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuMTk0MSwKCQkiRGVuc2l0eSI6IDE5LAoJCSJNZWx0aW5nUG9pbnQiOiAxNDA1LjE1LAoJCSJCb2lsaW5nUG9pbnQiOiA0NDA0LAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTUsCgkJIkRpc2NvdmVyZXIiOiAiUGVsaWdvdCIsCgkJIlllYXIiOiAxODQxLAoJCSJTcGVjaWZpY0hlYXQiOiAwLjExNiwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMyA2ZDEgN3MyIgoJfSwKCSJOZXB0dW5pdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDkzLAoJCSJTeW1ib2wiOiAiTnAiLAoJCSJBdG9taWNNYXNzIjogMjM3LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTQ0LAoJCSJOdW1iZXJvZlByb3RvbnMiOiA5MywKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiA5MywKCQkiUGVyaW9kIjogNywKCQkiR3JvdXAiOiBudWxsLAoJCSJQaGFzZSI6ICJhcnRpZmljaWFsIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6IG51bGwsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJBY3RpbmlkZSIsCgkJIkF0b21pY1JhZGl1cyI6IG51bGwsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogMS4zNiwKCQkiRmlyc3RJb25pemF0aW9uIjogNi4yNjU3LAoJCSJEZW5zaXR5IjogMjAuNSwKCQkiTWVsdGluZ1BvaW50IjogOTEzLjE1LAoJCSJCb2lsaW5nUG9pbnQiOiA0MjczLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTUzLAoJCSJEaXNjb3ZlcmVyIjogIk1jTWlsbGFuIGFuZCBBYmVsc29uIiwKCQkiWWVhciI6IDE5NDAsCgkJIlNwZWNpZmljSGVhdCI6IG51bGwsCgkJIk51bWJlcm9mU2hlbGxzIjogNywKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1JuXSA1ZjQgNmQxIDdzMiIKCX0sCgkiUGx1dG9uaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA5NCwKCQkiU3ltYm9sIjogIlB1IiwKCQkiQXRvbWljTWFzcyI6IDI0NCwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDE1MCwKCQkiTnVtYmVyb2ZQcm90b25zIjogOTQsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogOTQsCgkJIlBlcmlvZCI6IDcsCgkJIkdyb3VwIjogbnVsbCwKCQkiUGhhc2UiOiAiYXJ0aWZpY2lhbCIsCgkJIlJhZGlvYWN0aXZlIjogInllcyIsCgkJIk5hdHVyYWwiOiBudWxsLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiQWN0aW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiBudWxsLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDEuMjgsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuMDI2MiwKCQkiRGVuc2l0eSI6IDE5LjgsCgkJIk1lbHRpbmdQb2ludCI6IDkxMy4xNSwKCQkiQm9pbGluZ1BvaW50IjogMzUwMSwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDE2MywKCQkiRGlzY292ZXJlciI6ICJTZWFib3JnIGV0IGFsLiIsCgkJIlllYXIiOiAxOTQwLAoJCSJTcGVjaWZpY0hlYXQiOiBudWxsLAoJCSJOdW1iZXJvZlNoZWxscyI6IDcsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltSbl0gNWY2IDdzMiIKCX0sCgkiQW1lcmljaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA5NSwKCQkiU3ltYm9sIjogIkFtIiwKCQkiQXRvbWljTWFzcyI6IDI0MywKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDE0OCwKCQkiTnVtYmVyb2ZQcm90b25zIjogOTUsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogOTUsCgkJIlBlcmlvZCI6IDcsCgkJIkdyb3VwIjogbnVsbCwKCQkiUGhhc2UiOiAiYXJ0aWZpY2lhbCIsCgkJIlJhZGlvYWN0aXZlIjogInllcyIsCgkJIk5hdHVyYWwiOiBudWxsLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiQWN0aW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiBudWxsLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDEuMywKCQkiRmlyc3RJb25pemF0aW9uIjogNS45NzM4LAoJCSJEZW5zaXR5IjogMTMuNywKCQkiTWVsdGluZ1BvaW50IjogMTI2Ny4xNSwKCQkiQm9pbGluZ1BvaW50IjogMjg4MCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDEzMywKCQkiRGlzY292ZXJlciI6ICJTZWFib3JnIGV0IGFsLiIsCgkJIlllYXIiOiAxOTQ0LAoJCSJTcGVjaWZpY0hlYXQiOiBudWxsLAoJCSJOdW1iZXJvZlNoZWxscyI6IDcsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltSbl0gNWY3IDdzMiIKCX0sCgkiQ3VyaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiA5NiwKCQkiU3ltYm9sIjogIkNtIiwKCQkiQXRvbWljTWFzcyI6IDI0NywKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDE1MSwKCQkiTnVtYmVyb2ZQcm90b25zIjogOTYsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogOTYsCgkJIlBlcmlvZCI6IDcsCgkJIkdyb3VwIjogbnVsbCwKCQkiUGhhc2UiOiAiYXJ0aWZpY2lhbCIsCgkJIlJhZGlvYWN0aXZlIjogInllcyIsCgkJIk5hdHVyYWwiOiBudWxsLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiQWN0aW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiBudWxsLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IDEuMywKCQkiRmlyc3RJb25pemF0aW9uIjogNS45OTE1LAoJCSJEZW5zaXR5IjogMTMuNSwKCQkiTWVsdGluZ1BvaW50IjogMTM0MC4xNSwKCQkiQm9pbGluZ1BvaW50IjogMzM4MywKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDEzMywKCQkiRGlzY292ZXJlciI6ICJTZWFib3JnIGV0IGFsLiIsCgkJIlllYXIiOiAxOTQ0LAoJCSJTcGVjaWZpY0hlYXQiOiBudWxsLAoJCSJOdW1iZXJvZlNoZWxscyI6IDcsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltSbl0gNWY3IDZkMSA3czIiCgl9LAoJIkJlcmtlbGl1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogOTcsCgkJIlN5bWJvbCI6ICJCayIsCgkJIkF0b21pY01hc3MiOiAyNDcsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxNTAsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDk3LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDk3LAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IG51bGwsCgkJIlBoYXNlIjogImFydGlmaWNpYWwiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogbnVsbCwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkFjdGluaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjMsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuMTk3OSwKCQkiRGVuc2l0eSI6IDE0LjgsCgkJIk1lbHRpbmdQb2ludCI6IDEyNTkuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDk4MywKCQkiTnVtYmVyT2ZJc290b3BlcyI6IDgzLAoJCSJEaXNjb3ZlcmVyIjogIlNlYWJvcmcgZXQgYWwuIiwKCQkiWWVhciI6IDE5NDksCgkJIlNwZWNpZmljSGVhdCI6IG51bGwsCgkJIk51bWJlcm9mU2hlbGxzIjogNywKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1JuXSA1ZjkgN3MyIgoJfSwKCSJDYWxpZm9ybml1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogOTgsCgkJIlN5bWJvbCI6ICJDZiIsCgkJIkF0b21pY01hc3MiOiAyNTEsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxNTMsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDk4LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDk4LAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IG51bGwsCgkJIlBoYXNlIjogImFydGlmaWNpYWwiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogbnVsbCwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkFjdGluaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjMsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuMjgxNywKCQkiRGVuc2l0eSI6IDE1LjEsCgkJIk1lbHRpbmdQb2ludCI6IDE5MjUuMTUsCgkJIkJvaWxpbmdQb2ludCI6IDExNzMsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxMjMsCgkJIkRpc2NvdmVyZXIiOiAiU2VhYm9yZyBldCBhbC4iLAoJCSJZZWFyIjogMTk1MCwKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTAgN3MyIgoJfSwKCSJFaW5zdGVpbml1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogOTksCgkJIlN5bWJvbCI6ICJFcyIsCgkJIkF0b21pY01hc3MiOiAyNTIsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxNTMsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDk5LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDk5LAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IG51bGwsCgkJIlBoYXNlIjogImFydGlmaWNpYWwiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogbnVsbCwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkFjdGluaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjMsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuNDIsCgkJIkRlbnNpdHkiOiAxMy41LAoJCSJNZWx0aW5nUG9pbnQiOiAxMTMzLjE1LAoJCSJCb2lsaW5nUG9pbnQiOiBudWxsLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMTIzLAoJCSJEaXNjb3ZlcmVyIjogIkdoaW9yc28gZXQgYWwuIiwKCQkiWWVhciI6IDE5NTIsCgkJIlNwZWNpZmljSGVhdCI6IG51bGwsCgkJIk51bWJlcm9mU2hlbGxzIjogNywKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1JuXSA1ZjExIDdzMiIKCX0sCgkiRmVybWl1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMTAwLAoJCSJTeW1ib2wiOiAiRm0iLAoJCSJBdG9taWNNYXNzIjogMjU3LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTU3LAoJCSJOdW1iZXJvZlByb3RvbnMiOiAxMDAsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMTAwLAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IG51bGwsCgkJIlBoYXNlIjogImFydGlmaWNpYWwiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogbnVsbCwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkFjdGluaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjMsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuNSwKCQkiRGVuc2l0eSI6IG51bGwsCgkJIk1lbHRpbmdQb2ludCI6IG51bGwsCgkJIkJvaWxpbmdQb2ludCI6IG51bGwsCgkJIk51bWJlck9mSXNvdG9wZXMiOiAxMDMsCgkJIkRpc2NvdmVyZXIiOiAiR2hpb3JzbyBldCBhbC4iLAoJCSJZZWFyIjogMTk1MywKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTIgN3MyIgoJfSwKCSJNZW5kZWxldml1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMTAxLAoJCSJTeW1ib2wiOiAiTWQiLAoJCSJBdG9taWNNYXNzIjogMjU4LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTU3LAoJCSJOdW1iZXJvZlByb3RvbnMiOiAxMDEsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMTAxLAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IG51bGwsCgkJIlBoYXNlIjogImFydGlmaWNpYWwiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogbnVsbCwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkFjdGluaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjMsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuNTgsCgkJIkRlbnNpdHkiOiBudWxsLAoJCSJNZWx0aW5nUG9pbnQiOiBudWxsLAoJCSJCb2lsaW5nUG9pbnQiOiBudWxsLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMzMsCgkJIkRpc2NvdmVyZXIiOiAiR2hpb3JzbyBldCBhbC4iLAoJCSJZZWFyIjogMTk1NSwKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTMgN3MyIgoJfSwKCSJOb2JlbGl1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMTAyLAoJCSJTeW1ib2wiOiAiTm8iLAoJCSJBdG9taWNNYXNzIjogMjU5LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTU3LAoJCSJOdW1iZXJvZlByb3RvbnMiOiAxMDIsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMTAyLAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IG51bGwsCgkJIlBoYXNlIjogImFydGlmaWNpYWwiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogbnVsbCwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIkFjdGluaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiAxLjMsCgkJIkZpcnN0SW9uaXphdGlvbiI6IDYuNjUsCgkJIkRlbnNpdHkiOiBudWxsLAoJCSJNZWx0aW5nUG9pbnQiOiBudWxsLAoJCSJCb2lsaW5nUG9pbnQiOiBudWxsLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogNzMsCgkJIkRpc2NvdmVyZXIiOiAiR2hpb3JzbyBldCBhbC4iLAoJCSJZZWFyIjogMTk1OCwKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTQgN3MyIgoJfSwKCSJMYXdyZW5jaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiAxMDMsCgkJIlN5bWJvbCI6ICJMciIsCgkJIkF0b21pY01hc3MiOiAyNjIsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxNTksCgkJIk51bWJlcm9mUHJvdG9ucyI6IDEwMywKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAxMDMsCgkJIlBlcmlvZCI6IDcsCgkJIkdyb3VwIjogbnVsbCwKCQkiUGhhc2UiOiAiYXJ0aWZpY2lhbCIsCgkJIlJhZGlvYWN0aXZlIjogInllcyIsCgkJIk5hdHVyYWwiOiBudWxsLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiQWN0aW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiBudWxsLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IG51bGwsCgkJIkZpcnN0SW9uaXphdGlvbiI6IG51bGwsCgkJIkRlbnNpdHkiOiBudWxsLAoJCSJNZWx0aW5nUG9pbnQiOiBudWxsLAoJCSJCb2lsaW5nUG9pbnQiOiBudWxsLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogMjAzLAoJCSJEaXNjb3ZlcmVyIjogIkdoaW9yc28gZXQgYWwuIiwKCQkiWWVhciI6IDE5NjEsCgkJIlNwZWNpZmljSGVhdCI6IG51bGwsCgkJIk51bWJlcm9mU2hlbGxzIjogNywKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1JuXSA1ZjE0IDdzMiA3cDEiCgl9LAoJIlJ1dGhlcmZvcmRpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDEwNCwKCQkiU3ltYm9sIjogIlJmIiwKCQkiQXRvbWljTWFzcyI6IDI2MSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDE1NywKCQkiTnVtYmVyb2ZQcm90b25zIjogMTA0LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDEwNCwKCQkiUGVyaW9kIjogNywKCQkiR3JvdXAiOiA0LAoJCSJQaGFzZSI6ICJhcnRpZmljaWFsIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6IG51bGwsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJUcmFuc2FjdGluaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiBudWxsLAoJCSJGaXJzdElvbml6YXRpb24iOiBudWxsLAoJCSJEZW5zaXR5IjogMTguMSwKCQkiTWVsdGluZ1BvaW50IjogbnVsbCwKCQkiQm9pbGluZ1BvaW50IjogbnVsbCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IG51bGwsCgkJIkRpc2NvdmVyZXIiOiAiR2hpb3JzbyBldCBhbC4iLAoJCSJZZWFyIjogMTk2OSwKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTQgNmQyIDdzMiIKCX0sCgkiRHVibml1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMTA1LAoJCSJTeW1ib2wiOiAiRGIiLAoJCSJBdG9taWNNYXNzIjogMjYyLAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTU3LAoJCSJOdW1iZXJvZlByb3RvbnMiOiAxMDUsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMTA1LAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IDUsCgkJIlBoYXNlIjogImFydGlmaWNpYWwiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogbnVsbCwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIlRyYW5zYWN0aW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiBudWxsLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IG51bGwsCgkJIkZpcnN0SW9uaXphdGlvbiI6IG51bGwsCgkJIkRlbnNpdHkiOiAzOSwKCQkiTWVsdGluZ1BvaW50IjogbnVsbCwKCQkiQm9pbGluZ1BvaW50IjogbnVsbCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IG51bGwsCgkJIkRpc2NvdmVyZXIiOiAiR2hpb3JzbyBldCBhbC4iLAoJCSJZZWFyIjogMTk3MCwKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTQgNmQzIDdzMiIKCX0sCgkiU2VhYm9yZ2l1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMTA2LAoJCSJTeW1ib2wiOiAiU2ciLAoJCSJBdG9taWNNYXNzIjogMjY2LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTYwLAoJCSJOdW1iZXJvZlByb3RvbnMiOiAxMDYsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMTA2LAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IDYsCgkJIlBoYXNlIjogImFydGlmaWNpYWwiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogbnVsbCwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIlRyYW5zYWN0aW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiBudWxsLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IG51bGwsCgkJIkZpcnN0SW9uaXphdGlvbiI6IG51bGwsCgkJIkRlbnNpdHkiOiAzNSwKCQkiTWVsdGluZ1BvaW50IjogbnVsbCwKCQkiQm9pbGluZ1BvaW50IjogbnVsbCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IG51bGwsCgkJIkRpc2NvdmVyZXIiOiAiR2hpb3JzbyBldCBhbC4iLAoJCSJZZWFyIjogMTk3NCwKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTQgNmQ0IDdzMiIKCX0sCgkiQm9ocml1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMTA3LAoJCSJTeW1ib2wiOiAiQmgiLAoJCSJBdG9taWNNYXNzIjogMjY0LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTU3LAoJCSJOdW1iZXJvZlByb3RvbnMiOiAxMDcsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMTA3LAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IDcsCgkJIlBoYXNlIjogImFydGlmaWNpYWwiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogbnVsbCwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogIlRyYW5zYWN0aW5pZGUiLAoJCSJBdG9taWNSYWRpdXMiOiBudWxsLAoJCSJFbGVjdHJvbmVnYXRpdml0eSI6IG51bGwsCgkJIkZpcnN0SW9uaXphdGlvbiI6IG51bGwsCgkJIkRlbnNpdHkiOiAzNywKCQkiTWVsdGluZ1BvaW50IjogbnVsbCwKCQkiQm9pbGluZ1BvaW50IjogbnVsbCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IG51bGwsCgkJIkRpc2NvdmVyZXIiOiAiQXJtYnJ1c3RlciBhbmQgTe+/vW56ZW5iZXJnIiwKCQkiWWVhciI6IDE5ODEsCgkJIlNwZWNpZmljSGVhdCI6IG51bGwsCgkJIk51bWJlcm9mU2hlbGxzIjogNywKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1JuXSA1ZjE0IDZkNSA3czIiCgl9LAoJIkhhc3NpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDEwOCwKCQkiU3ltYm9sIjogIkhzIiwKCQkiQXRvbWljTWFzcyI6IDI2NywKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDE1OSwKCQkiTnVtYmVyb2ZQcm90b25zIjogMTA4LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDEwOCwKCQkiUGVyaW9kIjogNywKCQkiR3JvdXAiOiA4LAoJCSJQaGFzZSI6ICJhcnRpZmljaWFsIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6IG51bGwsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJUcmFuc2FjdGluaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiBudWxsLAoJCSJGaXJzdElvbml6YXRpb24iOiBudWxsLAoJCSJEZW5zaXR5IjogNDEsCgkJIk1lbHRpbmdQb2ludCI6IG51bGwsCgkJIkJvaWxpbmdQb2ludCI6IG51bGwsCgkJIk51bWJlck9mSXNvdG9wZXMiOiBudWxsLAoJCSJEaXNjb3ZlcmVyIjogIkFybWJydXN0ZXIgYW5kIE3vv71uemVuYmVyZyIsCgkJIlllYXIiOiAxOTgzLAoJCSJTcGVjaWZpY0hlYXQiOiBudWxsLAoJCSJOdW1iZXJvZlNoZWxscyI6IDcsCgkJIk51bWJlcm9mVmFsZW5jZSI6IG51bGwsCgkJIkVsZWN0cm9uaWNDb25maWd1cmF0aW9uIjogIltSbl0gNWYxNCA2ZDYgN3MyIgoJfSwKCSJNZWl0bmVyaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiAxMDksCgkJIlN5bWJvbCI6ICJNdCIsCgkJIkF0b21pY01hc3MiOiAyNjgsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxNTksCgkJIk51bWJlcm9mUHJvdG9ucyI6IDEwOSwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAxMDksCgkJIlBlcmlvZCI6IDcsCgkJIkdyb3VwIjogOSwKCQkiUGhhc2UiOiAiYXJ0aWZpY2lhbCIsCgkJIlJhZGlvYWN0aXZlIjogInllcyIsCgkJIk5hdHVyYWwiOiBudWxsLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNhY3RpbmlkZSIsCgkJIkF0b21pY1JhZGl1cyI6IG51bGwsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogbnVsbCwKCQkiRmlyc3RJb25pemF0aW9uIjogbnVsbCwKCQkiRGVuc2l0eSI6IDM1LAoJCSJNZWx0aW5nUG9pbnQiOiBudWxsLAoJCSJCb2lsaW5nUG9pbnQiOiBudWxsLAoJCSJOdW1iZXJPZklzb3RvcGVzIjogbnVsbCwKCQkiRGlzY292ZXJlciI6ICJHU0ksIERhcm1zdGFkdCwgV2VzdCBHZXJtYW55IiwKCQkiWWVhciI6IDE5ODIsCgkJIlNwZWNpZmljSGVhdCI6IG51bGwsCgkJIk51bWJlcm9mU2hlbGxzIjogNywKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1JuXSA1ZjE0IDZkNyA3czIiCgl9LAoJIkRhcm1zdGFkdGl1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMTEwLAoJCSJTeW1ib2wiOiAiRHMgIiwKCQkiQXRvbWljTWFzcyI6IDI3MSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDE2MSwKCQkiTnVtYmVyb2ZQcm90b25zIjogMTEwLAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDExMCwKCQkiUGVyaW9kIjogNywKCQkiR3JvdXAiOiAxMCwKCQkiUGhhc2UiOiAiYXJ0aWZpY2lhbCIsCgkJIlJhZGlvYWN0aXZlIjogInllcyIsCgkJIk5hdHVyYWwiOiBudWxsLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNhY3RpbmlkZSIsCgkJIkF0b21pY1JhZGl1cyI6IG51bGwsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogbnVsbCwKCQkiRmlyc3RJb25pemF0aW9uIjogbnVsbCwKCQkiRGVuc2l0eSI6IG51bGwsCgkJIk1lbHRpbmdQb2ludCI6IG51bGwsCgkJIkJvaWxpbmdQb2ludCI6IG51bGwsCgkJIk51bWJlck9mSXNvdG9wZXMiOiBudWxsLAoJCSJEaXNjb3ZlcmVyIjogbnVsbCwKCQkiWWVhciI6IDE5OTQsCgkJIlNwZWNpZmljSGVhdCI6IG51bGwsCgkJIk51bWJlcm9mU2hlbGxzIjogNywKCQkiTnVtYmVyb2ZWYWxlbmNlIjogbnVsbCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1JuXSA1ZjE0IDZkOSA3czEiCgl9LAoJIlJvZW50Z2VuaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiAxMTEsCgkJIlN5bWJvbCI6ICJSZyAiLAoJCSJBdG9taWNNYXNzIjogMjcyLAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTYxLAoJCSJOdW1iZXJvZlByb3RvbnMiOiAxMTEsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMTExLAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IDExLAoJCSJQaGFzZSI6ICJhcnRpZmljaWFsIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6IG51bGwsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJUcmFuc2FjdGluaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiBudWxsLAoJCSJGaXJzdElvbml6YXRpb24iOiBudWxsLAoJCSJEZW5zaXR5IjogbnVsbCwKCQkiTWVsdGluZ1BvaW50IjogbnVsbCwKCQkiQm9pbGluZ1BvaW50IjogbnVsbCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IG51bGwsCgkJIkRpc2NvdmVyZXIiOiBudWxsLAoJCSJZZWFyIjogMTk5NCwKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTQgNmQxMCA3czEiCgl9LAoJIkNvcGVybmljaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiAxMTIsCgkJIlN5bWJvbCI6ICJDbiAiLAoJCSJBdG9taWNNYXNzIjogMjg1LAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTczLAoJCSJOdW1iZXJvZlByb3RvbnMiOiAxMTIsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMTEyLAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IDEyLAoJCSJQaGFzZSI6ICJhcnRpZmljaWFsIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6IG51bGwsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJUcmFuc2FjdGluaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiBudWxsLAoJCSJGaXJzdElvbml6YXRpb24iOiBudWxsLAoJCSJEZW5zaXR5IjogbnVsbCwKCQkiTWVsdGluZ1BvaW50IjogbnVsbCwKCQkiQm9pbGluZ1BvaW50IjogbnVsbCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IG51bGwsCgkJIkRpc2NvdmVyZXIiOiBudWxsLAoJCSJZZWFyIjogMTk5NiwKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiBudWxsLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTQgNmQxMCA3czIiCgl9LAoJIk5paG9uaXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiAxMTMsCgkJIlN5bWJvbCI6ICJOaCIsCgkJIkF0b21pY01hc3MiOiAyODQsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxNzEsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDExMywKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAxMTMsCgkJIlBlcmlvZCI6IDcsCgkJIkdyb3VwIjogMTMsCgkJIlBoYXNlIjogImFydGlmaWNpYWwiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogbnVsbCwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogbnVsbCwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiBudWxsLAoJCSJGaXJzdElvbml6YXRpb24iOiBudWxsLAoJCSJEZW5zaXR5IjogbnVsbCwKCQkiTWVsdGluZ1BvaW50IjogbnVsbCwKCQkiQm9pbGluZ1BvaW50IjogbnVsbCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IG51bGwsCgkJIkRpc2NvdmVyZXIiOiBudWxsLAoJCSJZZWFyIjogMjAwNCwKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiAzLAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTQgNmQxMCA3czIgN3AxIgoJfSwKCSJGbGVyb3ZpdW0iOiB7CgkJIkF0b21pY051bWJlciI6IDExNCwKCQkiU3ltYm9sIjogIkZsIiwKCQkiQXRvbWljTWFzcyI6IDI4OSwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDE3NSwKCQkiTnVtYmVyb2ZQcm90b25zIjogMTE0LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDExNCwKCQkiUGVyaW9kIjogNywKCQkiR3JvdXAiOiAxNCwKCQkiUGhhc2UiOiAiYXJ0aWZpY2lhbCIsCgkJIlJhZGlvYWN0aXZlIjogInllcyIsCgkJIk5hdHVyYWwiOiBudWxsLAoJCSJNZXRhbCI6ICJ5ZXMiLAoJCSJOb25tZXRhbCI6IG51bGwsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiVHJhbnNhY3RpbmlkZSIsCgkJIkF0b21pY1JhZGl1cyI6IG51bGwsCgkJIkVsZWN0cm9uZWdhdGl2aXR5IjogbnVsbCwKCQkiRmlyc3RJb25pemF0aW9uIjogbnVsbCwKCQkiRGVuc2l0eSI6IG51bGwsCgkJIk1lbHRpbmdQb2ludCI6IG51bGwsCgkJIkJvaWxpbmdQb2ludCI6IG51bGwsCgkJIk51bWJlck9mSXNvdG9wZXMiOiBudWxsLAoJCSJEaXNjb3ZlcmVyIjogbnVsbCwKCQkiWWVhciI6IDE5OTksCgkJIlNwZWNpZmljSGVhdCI6IG51bGwsCgkJIk51bWJlcm9mU2hlbGxzIjogNywKCQkiTnVtYmVyb2ZWYWxlbmNlIjogNCwKCQkiRWxlY3Ryb25pY0NvbmZpZ3VyYXRpb24iOiAiW1JuXSA1ZjE0IDZkMTAgN3MyIDdwMiIKCX0sCgkiTW9zY292aXVtIjogewoJCSJBdG9taWNOdW1iZXIiOiAxMTUsCgkJIlN5bWJvbCI6ICJNYyIsCgkJIkF0b21pY01hc3MiOiAyODgsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxNzMsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDExNSwKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAxMTUsCgkJIlBlcmlvZCI6IDcsCgkJIkdyb3VwIjogMTUsCgkJIlBoYXNlIjogImFydGlmaWNpYWwiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogbnVsbCwKCQkiTWV0YWwiOiAieWVzIiwKCQkiTm9ubWV0YWwiOiBudWxsLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogbnVsbCwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiBudWxsLAoJCSJGaXJzdElvbml6YXRpb24iOiBudWxsLAoJCSJEZW5zaXR5IjogbnVsbCwKCQkiTWVsdGluZ1BvaW50IjogbnVsbCwKCQkiQm9pbGluZ1BvaW50IjogbnVsbCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IG51bGwsCgkJIkRpc2NvdmVyZXIiOiBudWxsLAoJCSJZZWFyIjogMjAxMCwKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiA1LAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTQgNmQxMCA3czIgN3AzIgoJfSwKCSJMaXZlcm1vcml1bSI6IHsKCQkiQXRvbWljTnVtYmVyIjogMTE2LAoJCSJTeW1ib2wiOiAiTHYiLAoJCSJBdG9taWNNYXNzIjogMjkyLAoJCSJOdW1iZXJvZk5ldXRyb25zIjogMTc2LAoJCSJOdW1iZXJvZlByb3RvbnMiOiAxMTYsCgkJIk51bWJlcm9mRWxlY3Ryb25zIjogMTE2LAoJCSJQZXJpb2QiOiA3LAoJCSJHcm91cCI6IDE2LAoJCSJQaGFzZSI6ICJhcnRpZmljaWFsIiwKCQkiUmFkaW9hY3RpdmUiOiAieWVzIiwKCQkiTmF0dXJhbCI6IG51bGwsCgkJIk1ldGFsIjogInllcyIsCgkJIk5vbm1ldGFsIjogbnVsbCwKCQkiTWV0YWxsb2lkIjogbnVsbCwKCQkiVHlwZSI6ICJUcmFuc2FjdGluaWRlIiwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiBudWxsLAoJCSJGaXJzdElvbml6YXRpb24iOiBudWxsLAoJCSJEZW5zaXR5IjogbnVsbCwKCQkiTWVsdGluZ1BvaW50IjogbnVsbCwKCQkiQm9pbGluZ1BvaW50IjogbnVsbCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IG51bGwsCgkJIkRpc2NvdmVyZXIiOiBudWxsLAoJCSJZZWFyIjogMjAwMCwKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiA2LAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTQgNmQxMCA3czIgN3A0IgoJfSwKCSJUZW5uZXNzaW5lIjogewoJCSJBdG9taWNOdW1iZXIiOiAxMTcsCgkJIlN5bWJvbCI6ICJUcyIsCgkJIkF0b21pY01hc3MiOiAyOTUsCgkJIk51bWJlcm9mTmV1dHJvbnMiOiAxNzgsCgkJIk51bWJlcm9mUHJvdG9ucyI6IDExNywKCQkiTnVtYmVyb2ZFbGVjdHJvbnMiOiAxMTcsCgkJIlBlcmlvZCI6IDcsCgkJIkdyb3VwIjogMTcsCgkJIlBoYXNlIjogImFydGlmaWNpYWwiLAoJCSJSYWRpb2FjdGl2ZSI6ICJ5ZXMiLAoJCSJOYXR1cmFsIjogbnVsbCwKCQkiTWV0YWwiOiBudWxsLAoJCSJOb25tZXRhbCI6ICJ5ZXMiLAoJCSJNZXRhbGxvaWQiOiBudWxsLAoJCSJUeXBlIjogbnVsbCwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiBudWxsLAoJCSJGaXJzdElvbml6YXRpb24iOiBudWxsLAoJCSJEZW5zaXR5IjogbnVsbCwKCQkiTWVsdGluZ1BvaW50IjogbnVsbCwKCQkiQm9pbGluZ1BvaW50IjogbnVsbCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IG51bGwsCgkJIkRpc2NvdmVyZXIiOiBudWxsLAoJCSJZZWFyIjogMjAxMCwKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiA3LAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTQgNmQxMCA3czIgN3A1IgoJfSwKCSJPZ2FuZXNzb24iOiB7CgkJIkF0b21pY051bWJlciI6IDExOCwKCQkiU3ltYm9sIjogIk9nIiwKCQkiQXRvbWljTWFzcyI6IDI5NCwKCQkiTnVtYmVyb2ZOZXV0cm9ucyI6IDE3NiwKCQkiTnVtYmVyb2ZQcm90b25zIjogMTE4LAoJCSJOdW1iZXJvZkVsZWN0cm9ucyI6IDExOCwKCQkiUGVyaW9kIjogNywKCQkiR3JvdXAiOiAxOCwKCQkiUGhhc2UiOiAiYXJ0aWZpY2lhbCIsCgkJIlJhZGlvYWN0aXZlIjogInllcyIsCgkJIk5hdHVyYWwiOiBudWxsLAoJCSJNZXRhbCI6IG51bGwsCgkJIk5vbm1ldGFsIjogInllcyIsCgkJIk1ldGFsbG9pZCI6IG51bGwsCgkJIlR5cGUiOiAiTm9ibGUgR2FzIiwKCQkiQXRvbWljUmFkaXVzIjogbnVsbCwKCQkiRWxlY3Ryb25lZ2F0aXZpdHkiOiBudWxsLAoJCSJGaXJzdElvbml6YXRpb24iOiBudWxsLAoJCSJEZW5zaXR5IjogbnVsbCwKCQkiTWVsdGluZ1BvaW50IjogbnVsbCwKCQkiQm9pbGluZ1BvaW50IjogbnVsbCwKCQkiTnVtYmVyT2ZJc290b3BlcyI6IG51bGwsCgkJIkRpc2NvdmVyZXIiOiBudWxsLAoJCSJZZWFyIjogMjAwNiwKCQkiU3BlY2lmaWNIZWF0IjogbnVsbCwKCQkiTnVtYmVyb2ZTaGVsbHMiOiA3LAoJCSJOdW1iZXJvZlZhbGVuY2UiOiA4LAoJCSJFbGVjdHJvbmljQ29uZmlndXJhdGlvbiI6ICJbUm5dIDVmMTQgNmQxMCA3czIgN3A2IgoJfQp9IAo=')




import base64
table = base64.b64decode(b'IF9fX19fICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fX19fCnwgIDEgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgIDIgIHwKfCAgSCAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgSGUgfAp8X19fX198X19fX18gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19fX19fX19fX19fX19fX19fX19fX19fX19fX198X19fX198CnwgIDMgIHwgIDQgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgIDUgIHwgIDYgIHwgIDcgIHwgIDggIHwgIDkgIHwgIDEwIHwKfCAgTGkgfCAgQmUgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgQiAgfCAgQyAgfCAgTiAgfCAgTyAgfCAgRiAgfCAgTmUgfAp8X19fX198X19fX198ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198CnwgIDExIHwgIDEyIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgIDEzIHwgIDE0IHwgIDE1IHwgIDE2IHwgIDE3IHwgIDE4IHwKfCAgTmEgfCAgTWcgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgQWwgfCAgU2kgfCAgUCAgfCAgUyAgfCAgQ2wgfCAgQXIgfAp8X19fX198X19fX198X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198CnwgIDE5IHwgIDIwIHwgIDIxIHwgIDIyIHwgIDIzIHwgIDI0IHwgIDI1IHwgIDI2IHwgIDI3IHwgIDI4IHwgIDI5IHwgIDMwIHwgIDMxIHwgIDMyIHwgIDMzIHwgIDM0IHwgIDM1IHwgIDM2IHwKfCAgSyAgfCAgQ2EgfCAgU2MgfCAgVGkgfCAgViAgfCAgQ3IgfCAgTW4gfCAgRmUgfCAgQ28gfCAgTmkgfCAgQ3UgfCAgWm4gfCAgR2EgfCAgR2UgfCAgQXMgfCAgU2UgfCAgQnIgfCAgS3IgfAp8X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198CnwgIDM3IHwgIDM4IHwgIDM5IHwgIDQwIHwgIDQxIHwgIDQyIHwgIDQzIHwgIDQ0IHwgIDQ1IHwgIDQ2IHwgIDQ3IHwgIDQ4IHwgIDQ5IHwgIDUwIHwgIDUxIHwgIDUyIHwgIDUzIHwgIDU0IHwKfCAgUmIgfCAgU3IgfCAgWSAgfCAgWnIgfCAgTmIgfCAgTW8gfCAgVGMgfCAgUnUgfCAgUmggfCAgUGQgfCAgQWcgfCAgQ2QgfCAgSW4gfCAgU24gfCAgU2IgfCAgVGUgfCAgSSAgfCAgWGUgfAp8X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198CnwgIDU1IHwgIDU2IHwgIDU3IFwgIDcyIHwgIDczIHwgIDc0IHwgIDc1IHwgIDc2IHwgIDc3IHwgIDc4IHwgIDc5IHwgIDgwIHwgIDgxIHwgIDgyIHwgIDgzIHwgIDg0IHwgIDg1IHwgIDg2IHwKfCAgQ3MgfCAgQmEgfCAgTGEgLyAgSGYgfCAgVGEgfCAgVyAgfCAgUmUgfCAgT3MgfCAgSXIgfCAgUHQgfCAgQXUgfCAgSGcgfCAgVGwgfCAgUGIgfCAgQmkgfCAgUG8gfCAgQXQgfCAgUm4gfAp8X19fX198X19fX198X19fX19cX19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198CnwgIDg3IHwgIDg4IHwgIDg5IC8gMTA0IHwgMTA1IHwgMTA2IHwgMTA3IHwgMTA4IHwgMTA5IHwgMTEwIHwgMTExIHwgMTEyIHwgMTEzIHwgMTE0IHwgMTE1IHwgMTE2IHwgMTE3IHwgMTE4IHwKfCAgRnIgfCAgUmEgfCAgQWMgXCAgUmYgfCAgRGIgfCAgU2cgfCAgQmggfCAgSHMgfCAgTXQgfCAgRHMgfCAgUmcgfCAgQ24gfCAgTmggfCAgRmwgfCAgTWMgfCAgTHYgfCAgVHMgfCAgT2cgfAp8X19fX198X19fX198X19fX18vX19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198CgoJCQkJICBfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18gCgkJCQkgIFwgIDU4IHwgIDU5IHwgIDYwIHwgIDYxIHwgIDYyIHwgIDYzIHwgIDY0IHwgIDY1IHwgIDY2IHwgIDY3IHwgIDY4IHwgIDY5IHwgIDcwIHwgIDcxIFwKCQkJCSAgLyAgQ2UgfCAgUHIgfCAgTmQgfCAgUG0gfCAgU20gfCAgRXUgfCAgR2QgfCAgVGIgfCAgRHkgfCAgSG8gfCAgRXIgfCAgVG0gfCAgWWIgfCAgTHUgLwoJCQkJICBcX19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX19cCgkJCQkgIC8gIDkwIHwgIDkxIHwgIDkyIHwgIDkzIHwgIDk0IHwgIDk1IHwgIDk2IHwgIDk3IHwgIDk4IHwgIDk5IHwgMTAwIHwgMTAxIHwgMTAyIHwgMTAzIC8KCQkJCSAgXCAgVGggfCAgUGEgfCAgVSAgfCAgTnAgfCAgUHUgfCAgQW0gfCAgQ20gfCAgQmsgfCAgQ2YgfCAgRXMgfCAgRm0gfCAgTWQgfCAgTm8gfCAgTHIgXAoJCQkJICAvX19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX198X19fX18vCg==')



table=table.decode()





import json

import readline

from pprint import pprint

import copy

import sys

import math

from decimal import Decimal

pt=json.loads(pt)



elements=list(map(str.lower, list(pt.keys())))



symbols=[pt[_]["Symbol"].lower() for _ in list(pt.keys())]



keepnames=["Symbol","Protons","Electrons","Neutrons", "Period", "Group", "Electronic configuration","Atomic mass", "Atomic number", "Atomic radius", "Density (g/cm^3)", "Specific heat (J/K)", "Electronegativity", "Melting point (K)", "Boiling point (K)", "First ionization (eV)"]



keepkeys=["Symbol","NumberofProtons","NumberofElectrons","NumberofNeutrons","Period","Group","ElectronicConfiguration", "AtomicMass","AtomicNumber","AtomicRadius","Density","SpecificHeat","Electronegativity","MeltingPoint","BoilingPoint","FirstIonization"]



def getResult(Element):

	

	if isinstance(Element,str):

		temp_dict={}

		for key in keepkeys:

			temp_dict[keepnames[keepkeys.index(key)]]=pt[Element][key]

			

		result={}

		result['Name']=Element

		result=result | temp_dict

	else:

		result={}

		result['Compound']=''.join([str(_[0])+str(_[1]) for _ in Element])

		result['Molar Mass']=float(sum([Decimal(_[1]*float(getResult(parseElement(_[0]))['Atomic mass'])) for _ in Element]))

	return result

	



def parseElement(Input):

	if Input.lower() in elements:

		return Input.title()

	elif Input.lower() in symbols:

		return elements[symbols.index(Input.lower())].title()

	else:

		raise Exception



def parseCompound(Input):

	LPAR,RPAR = map(Suppress,"()")

	integer = Word(nums)

	

	# add parse action to convert integers to ints, to support doing addition 

	# and multiplication at parse time

	integer.setParseAction(lambda dummy1,dummy2,t:int(t[0]))

	

	element = Word(alphas.upper(), alphas.lower())

	# or if you want to be more specific, use this Regex

	# element = Regex(r"A[cglmrstu]|B[aehikr]?|C[adeflmorsu]?|D[bsy]|E[rsu]|F[emr]?|"

	#                 "G[ade]|H[efgos]?|I[nr]?|Kr?|L[airu]|M[dgnot]|N[abdeiop]?|"

	#                 "Os?|P[abdmortu]?|R[abefghnu]|S[bcegimnr]?|T[abcehilm]|"

	#                 "Uu[bhopqst]|U|V|W|Xe|Yb?|Z[nr]")

	

	# forward declare 'formula' so it can be used in definition of 'term'

	formula = Forward()

	

	term = Group((element | Group(LPAR + formula + RPAR)("subgroup")) + 

					Optional(integer, default=1)("mult"))

	

	# define contents of a formula as one or more terms

	formula << OneOrMore(term)

	

	

	# add parse actions for parse-time processing

	

	# parse action to multiply out subgroups

	def multiplyContents(dummy1,dummy2,tokens):

		t = tokens[0]

		# if these tokens contain a subgroup, then use multiplier to

		# extend counts of all elements in the subgroup

		if t.subgroup:

			mult = t.mult

			for term in t.subgroup:

				term[1] *= mult

			return t.subgroup

	term.setParseAction(multiplyContents)

	

	# add parse action to sum up multiple references to the same element

	def sumByElement(w,x,tokens):

		elementsList = [t[0] for t in tokens]

	

		# construct set to see if there are duplicates

		duplicates = len(elementsList) > len(set(elementsList))

	

		# if there are duplicate element names, sum up by element and

		# return a new nested ParseResults

		if duplicates:

			ctr = defaultdict(int)

			for t in tokens:

				ctr[t[0]] += t[1]

			return ParseResults([ParseResults([k,v]) for k,v in ctr.items()])

	formula.setParseAction(sumByElement)

	return formula.parseString(Input)



def parseInput(Input):

	parseCompound(Input)

	try:

		if Input.islower():

			result=parseElement(Input)

		else:

			result=parseCompound(Input)

	except:

		print("Incorrect Element/Molecule")

		return

	pprint(getResult(result),sort_dicts=False,width=1)

	

def repl():

	while True:

		Input=input('>> ')

		parseInput(Input)



if len(sys.argv)==1:

	try:

	   repl()

	except (EOFError,KeyboardInterrupt):

		print()

		exit()

else:

	if sys.argv[-1]=="--table":

		print(table)

		exit()

	Input=sys.argv[1]

	parseInput(Input)



	